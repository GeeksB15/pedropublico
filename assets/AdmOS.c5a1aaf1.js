import{_ as I,a0 as B,bQ as E,bL as p,ay as D,b4 as F,bE as k,ch as L,az as R,r as _,o as m,d as w,w as r,f as t,h as V,i as z,k as g,Q as q,aU as M,j as h,C as l,au as H,p as x,F as j,u as Z,t as v,e as A,z as G,v as J,O as P,m as U,aP as K,H as X,P as W,S as Q,T as y,U as N,N as Y,J as $}from"./index.a1a1867c.js";import{C as oo}from"./Campo.5cd61c3c.js";import{O as ao}from"./OSTrocarStatus.e222735b.js";import{M as eo}from"./ModalHistoricoStatus.f4b94690.js";import{d as to}from"./vuedraggable.umd.3e5fe9dd.js";const so={components:{Badge:B,Campo:oo,OSTrocarStatus:ao,ModalHistoricoStatus:eo,draggable:to},data(){return{drawer:!0,showfilters:!1,empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date(E()).toDateString()),entregueFim:new Date(new Date(E()).toDateString()),fraseFiltro:"",listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeOS"},{label:"Entrega para esta semana",value:"bordaAmarelaOS"},{label:"Entrega atrasada",value:"bordaVermelhaOS"}]}},methods:{async eventoEnd(){for(const s in this.listas)for(const o of this.listas[s])if(o.status!==s){p.log("AdmOS","eventoEnd De:",o.status,"Para:",s,"codigo:",o.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoUsuario:null,nomeCliente:o.nomeCliente,observacao:"",statusAtual:o.status,statusNovo:s},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(s){p.log("AdmOS","eventoConfirmaTroca",{...s}),this.$q.loading.show();try{let o;$db.usuario.logado.cpf&&(o=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(e=>{var a;return e.numeroDocumentoNacional.replace(/\D/g,"")===((a=$db.usuario.logado.cpf)==null?void 0:a.replace(/\D/g,""))})),s.cpfUsuario=o==null?void 0:o.numeroDocumentoNacional,await D.os.trocaStatusOnline(s),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(o){this.$q.notifyError("Erro na troca de status",o)}finally{this.$q.loading.hide()}},eventoCancelarTroca(s){p.log("AdmOS","eventoCancelarTroca",s),this.atualiza()},async empresaOpcoesCarregar(){const s=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=s.map(o=>({label:o.nome,value:o.codigoContato,id:o.id}))},filtraDebounce(){F.exports.debounce(this.refazFiltro,700)()},refazFiltro(){p.log("AdmOSs","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const s=k(this.fraseFiltro.toUpperCase()).split(" ").filter(o=>o!=="");for(const o in this.listas)for(const n of this.listas[o]){const e=k(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroOS)+" ");let a=!0;for(const c of s)isNaN(Number(c))?a=a&&e.includes(c):a=a&&e.includes(" "+c+" ");this.empresaSelecionada&&(a=a&&this.empresaSelecionada.value===n.codigoEmpresa),n.mostra=a}},async atualiza(){try{const s=await D.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,empresas:this.empresaOpcoes.map(e=>e.id)});p.log("AdmOS","atualiza()",s.length),L(!s||!s.length,"N\xE3o h\xE1 ordens de servi\xE7o");let o=await D.configuracoes.le({nome:"vendas.os.status"});o=o.filter(e=>!["Processando","Entregue"].includes(e.texto));const n={Processando:[]};for(const e of F.exports.orderBy(o,"valor","asc").map(a=>a.texto))n[e]=[];n.Entregue=[];for(const e of s){let a="bordaVerdeOS",c="",f="Normal";if(e.status==="Entregue"){if(!!e.dataHoraPrevisto&&!!e.dataHoraFinalizado){const S=new Date(new Date(e.dataHoraPrevisto).toDateString()),d=(new Date(new Date(e.dataHoraFinalizado).toDateString())-S)/(1e3*60*60*24);a=d>=0?"bordaVermelhaOS":d>-7?"bordaAmarelaOS":"bordaVerdeOS",c=d>=0?"negative":d>-7?"warning":"",f=d>=0?"Atrasado":d>-7?"Aten\xE7\xE3o":"Normal"}}else if(e.dataHoraPrevisto){const S=new Date(new Date(e.dataHoraPrevisto).toDateString()),d=(new Date(new Date().toDateString())-S)/(1e3*60*60*24);a=d>=0?"bordaVermelhaOS":d>-7?"bordaAmarelaOS":"bordaVerdeOS",c=d>=0?"negative":d>-7?"warning":"",f=d>=0?"Atrasado":d>-7?"Aten\xE7\xE3o":"Normal"}const b={id:e.id,codigoCompra:e.codigoCompra||"-",codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoContato:e.codigoContato,codigoEmpresa:e.codigoEmpresa,descricaoEmpresa:e.descricaoEmpresa,descricao:e.descricao,corBorda:a,corLabel:c,txtLabel:f,dataHoraEmissao:new Date(e.dataHoraEmissao),dataHoraFinalizado:new Date(e.dataHoraFinalizado),dataHoraRetorno:new Date(e.dataHoraRetorno),dataHoraPrevisto:new Date(e.dataHoraPrevisto),mostra:!0,nomeCliente:e.nomeCliente||"-",nomeResponsavel:e.nomeResponsavel||"-",numeroVenda:e.numeroVenda?String(e.numeroVenda):"-",numeroOS:e.numeroOS?String(e.numeroOS):"-",status:e.status};n[e.status]&&n[e.status].push(b)}this.listas=n,this.refazFiltro()}catch(s){this.$q.notifyError("Erro na consulta online de oss",s)}},async irParaAtendimento(s){const o=await R().contato.where({codigoContato:s}).first()||{};o.id&&this.$router.push({name:"Atendimento",params:{id:o.id}})}},watch:{entregueInicio(){p.log("AdmOSs","entregueInicio"),this.atualiza()},entregueFim(){p.log("AdmOSs","entregueFim"),this.atualiza()}},async created(){p.log("AdmOSs","created()"),await this.empresaOpcoesCarregar(),this.atualiza()}},ro={class:"q-pa-md"},io={class:"row overflowXOS filterfalse"},lo={class:"q-pa-none"},no={key:0,class:"row"},co={class:"col-12"},uo={class:"q-pa-md"},mo={class:"row q-mt-xs"},po={class:"col-6"},go={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},fo={class:"text-subtitle1"},ho={class:"text-caption"},vo={class:"col-11"},bo={key:0,style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},So={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},_o={class:"text-caption",style:{display:"inline-block","margin-right":"6px"}},wo={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},xo={class:"text-caption",style:{display:"inline-block"}},yo={class:"col-1 self-end"};function Co(s,o,n,e,a,c){const f=_("campo"),b=_("badge"),S=_("draggable"),C=_("OS-trocar-status"),d=_("modal-historico-status");return m(),w($,{class:"AdmOS",id:"AdmOS"},{default:r(()=>[t(V,{class:"bg-gradiente text-white"},{default:r(()=>[t(z,null,{default:r(()=>[g("Adm. OS")]),_:1}),t(q,{icon:"mdi-filter",round:"",dense:"",flat:"",onClick:o[0]||(o[0]=u=>a.showfilters=!a.showfilters)})]),_:1}),t(M,{modelValue:a.showfilters,"onUpdate:modelValue":o[5]||(o[5]=u=>a.showfilters=u),bordered:"",side:"right"},{default:r(()=>[t(V,{color:"white",class:"text-tertiary"},{default:r(()=>[t(h,{class:"text-h5",name:"mdi-filter"}),t(z,null,{default:r(()=>[g("Filtro Avan\xE7ado")]),_:1}),t(q,{dense:"",flat:"",icon:"close",round:"",onClick:o[1]||(o[1]=u=>a.showfilters=!a.showfilters)})]),_:1}),l("div",ro,[t(f,{modelValue:a.fraseFiltro,"onUpdate:modelValue":[o[2]||(o[2]=u=>a.fraseFiltro=u),c.filtraDebounce],rotulo:"Por cliente ou respons\xE1vel",dense:""},null,8,["modelValue","onUpdate:modelValue"]),t(H,{modelValue:a.prazoSelecionado,"onUpdate:modelValue":o[3]||(o[3]=u=>a.prazoSelecionado=u),options:a.prazoOpcoes,clearable:"",label:"Por prazo"},null,8,["modelValue","options"]),t(H,{modelValue:a.empresaSelecionada,"onUpdate:modelValue":[o[4]||(o[4]=u=>a.empresaSelecionada=u),c.refazFiltro],options:a.empresaOpcoes,clearable:"",label:"Por empresa"},null,8,["modelValue","options","onUpdate:modelValue"])])]),_:1},8,["modelValue"]),l("div",io,[(m(!0),x(j,null,Z(a.listas,(u,O)=>(m(),x("div",{key:O,class:"no-shadow col q-px-none coluna"},[l("div",lo,[t(V,{class:"no-shadow q-py-none q-px-sm text-white"},{default:r(()=>[t(z,{class:"q-py-none"},{default:r(()=>[g(v(O),1)]),_:2},1024)]),_:2},1024),O==="Entregue"?(m(),x("div",no,[l("div",co,[l("div",uo,[t(f,{modelValue:a.entregueInicio,"onUpdate:modelValue":o[6]||(o[6]=i=>a.entregueInicio=i),rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),t(f,{modelValue:a.entregueFim,"onUpdate:modelValue":o[7]||(o[7]=i=>a.entregueFim=i),rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])])):A("",!0),t(S,{class:"dragAreaOS",delay:"250",list:u,group:"osGroup",draggable:".extratoOS",onEnd:c.eventoEnd,itemKey:"id"},{item:r(({element:i})=>[i.mostra&&(a.prazoSelecionado===null||a.prazoSelecionado===i.corBorda)?(m(),w(G,{key:0,class:J(["q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 extratoOS bg-white",i.corBorda])},{default:r(()=>[l("div",mo,[l("div",po,[i.corLabel?(m(),w(b,{key:0,cor:i.corLabel,escuro:"",class:"q-mx-xs",rotulo:i.txtLabel},null,8,["cor","rotulo"])):(m(),w(b,{key:1,class:"q-mx-xs",rotulo:i.txtLabel},null,8,["rotulo"]))]),l("div",go,[t(b,{cor:"grey-1",class:"q-mx-sm",icone:"shopping_cart",rotulo:i.numeroVenda},null,8,["rotulo"]),t(b,{cor:"grey-8",escuro:"",icone:"assignment_turned_in",rotulo:i.numeroOS},null,8,["rotulo"])])]),t(P,{class:"q-pa-xs"},{default:r(()=>[l("div",fo,v(i.nomeCliente),1),l("span",ho,v(i.descricao),1)]),_:2},1024),t(P,{class:"row q-pa-xs q-pb-none q-mt-md"},{default:r(()=>[l("div",vo,[i.descricaoEmpresa?(m(),x("div",bo,[t(h,{name:"business",color:"grey-7",size:"14px"}),t(U,null,{default:r(()=>[g(v(i.descricaoEmpresa),1)]),_:2},1024)])):A("",!0),l("div",So,[t(h,{name:"person",color:"grey-7",size:"14px"})]),l("div",_o,v(i.nomeResponsavel),1),l("div",wo,[t(h,{name:"calendar_today",color:"grey-7",size:"14px"})]),l("div",xo,[g(v(s.$filters.data(i.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?i.dataHoraFinalizado:i.dataHoraPrevisto))+" ",1),t(U,null,{default:r(()=>[g(v(i.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para"),1)]),_:2},1024)])]),l("div",yo,[t(h,{name:"more_vert",color:"blue-grey-6",style:{color:"grey",float:"right","text-align":"right","font-size":"1.2rem",cursor:"pointer"},onMouseOver:"this.style.color='black'",onMouseOut:"this.style.color='grey'"},{default:r(()=>[t(K,null,{default:r(()=>[X((m(),w(W,{link:"",separator:""},{default:r(()=>[t(Q,{clickable:"",onClick:T=>s.$refs.modalHistoricoStatus.mostrar({idDocumento:i.id})},{default:r(()=>[t(y,{avatar:""},{default:r(()=>[t(h,{name:"history"})]),_:1}),t(y,null,{default:r(()=>[t(N,null,{default:r(()=>[g("Hist\xF3rico do Status")]),_:1})]),_:1})]),_:2},1032,["onClick"]),t(Q,{clickable:"",onClick:T=>c.irParaAtendimento(i.codigoContato)},{default:r(()=>[t(y,{avatar:""},{default:r(()=>[t(h,{name:"launch"})]),_:1}),t(y,null,{default:r(()=>[t(N,null,{default:r(()=>[g("Ir para o Atendimentos")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[Y]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["class"])):A("",!0)]),_:2},1032,["list","onEnd"])])]))),128))]),t(C,{modelValue:a.trocarStatusModal,"onUpdate:modelValue":o[8]||(o[8]=u=>a.trocarStatusModal=u),dados:a.trocarStatusDados,onConfirmar:c.eventoConfirmarTroca,onCancelar:c.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),t(d,{ref:"modalHistoricoStatus"},null,512)]),_:1})}var Eo=I(so,[["render",Co]]);export{Eo as default};
