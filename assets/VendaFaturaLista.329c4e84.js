import{_ as J,Y as Z,cL as M,ce as $,aF as P,bi as K,cM as oo,bq as ao,p as q,o as p,d as C,i as y,w as i,f as a,R as v,e as f,t as h,C as I,x as b,bs as U,S as _,bw as O,F,k as z,l as w,D as T,az as Q,N as x,P as E,j as V,r as D,L as R,b0 as eo,a4 as N,s as to,B as io,E as lo,M as ro,a7 as so,b1 as j,a6 as L,cN as no,cs as co,y as uo,a as mo}from"./index.094a6fb0.js";import{l as fo}from"./listaV2.63da52a4.js";import{Q as po}from"./QSpinnerHourglass.279ca571.js";import{Q as ho}from"./QSpinnerDots.1eea4478.js";import{D as go}from"./DocumentosFiscais.beacb47e.js";import{e as vo}from"./emitirNFe.35117289.js";import{F as Y}from"./FaturaModal.b92f4cce.js";import{M as bo}from"./ModalHistoricoStatus.ff89e6fe.js";import{x as H}from"./xlsx.6cceadb4.js";import"./QBreadcrumbs.efe5b83b.js";import"./Campo.f7ddd6ff.js";import"./compactarValidarNFe.0b4dde72.js";import"./obterItens.1bd429f9.js";import"./codigosANP.a6c1a264.js";import"./VendaCard.21927762.js";import"./EnvelopeCard.fe39d933.js";const yo={components:{Avatar:Z,DocumentosFiscais:go,FaturaModal:Y,ModalHistoricoStatus:bo},computed:{config(){return $db.configuracoes.valores},mostrarOpcaoEmitirBoleto(){return(this.modalBoleto.condicoesPagamento||[]).length&&(this.modalBoleto.bancos||[]).length},mostrarOpcaoRemoverFatura(){return this.dados.fatura.status==="Aberta"&&!this.dados.carnes.length&&!this.dados.condicaoPagamento.length&&!this.dados.vendas.length},ativarBotaoEmissaoBoleto(){const e=Number(this.modalBoleto.financeiroBanco.value);return Number.isInteger(e)&&e&&this.modalBoleto.condicoesPagamento.find(t=>t.checked)}},data(){return{dbUsuario:$db.usuario,dados:{fatura:{}},contatos:{},detalhesVisivel:!1,sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],modalBoleto:{},podeEditar:!1,mostrarBotaoEnviarAvaliacao:!1}},emits:["executar"],methods:{async removerFatura(){try{await new Promise((e,t)=>{this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 remover esta fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{e()}).onCancel(()=>{t()})})}catch{return}this.dados.fatura.id?(await $db.fatura.remover(this.dados.fatura.id),this.$emit("executar","atualizar")):this.$q.notify("N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o")},abrirModalBoleto(){for(const e of this.modalBoleto.condicoesPagamento)e.checked=!1,e.disable=!0,e.codigoFinanceiroBoleto="",e.codigoFinanceiroTitulo="",e.banco={};this.modalBoleto.checked=!1,this.modalBoleto.financeiroBanco=this.modalBoleto.bancos[0],this.modalBoleto.ativo=!0,this.$nextTick().then(()=>{this.modalBoleto.visivel=!0,this.atualizarBoletos()})},alternarCheckboxModalBoleto(e){if(e==="todos"){this.modalBoleto.condicoesPagamento.forEach(t=>{t.checked=this.modalBoleto.checked});return}this.modalBoleto.checked=!this.modalBoleto.condicoesPagamento.find(t=>!t.checked)},async atualizarBoletos(){let e,t,u,n;n=this.modalBoleto.condicoesPagamento,u=n.reduce((r,s)=>r+"'"+s.idFinanceiroTitulo+"',",""),u=u.slice(0,u.length-1),e=`select
          fTitulo.id,
          fTitulo.codigoFinanceiroTitulo,
          fBoleto.codigoFinanceiroBoleto,
          fBoleto.dataEmissao,
          b.descricao,
          fBanco.agencia,
          fBanco.conta,
          b.arquivoBoleto
        from financeiroTitulo fTitulo
        left join financeiroBoleto fBoleto on fBoleto.codigoFinanceiroBoleto = fTitulo.codigoFinanceiroBoleto
        left join financeiroBanco fBanco on fBanco.CodigoFinanceiroBanco = fBoleto.codigoFinanceiroBanco
        left join _banco b on b.codigoBanco = fBanco.codigoBanco
        where fTitulo.id in (${u})`,this.cancelarAtualizarBoletos=!1;let o=0;do{try{t=await M(e),o=0}catch(r){t=[],++o%3===0&&this.$q.notifyError(r.message)}for(const r of t){const s=n.find(d=>d.idFinanceiroTitulo===r.id);s&&(r.codigoFinanceiroBoleto&&(s.codigoFinanceiroBoleto=r.codigoFinanceiroBoleto,s.banco={descricao:r.descricao,dataEmissao:r.dataEmissao,agencia:r.agencia,conta:r.conta,arquivoBoleto:r.arquivoBoleto}),r.codigoFinanceiroTitulo&&(s.codigoFinanceiroTitulo=r.codigoFinanceiroTitulo,s.disable=!1))}if(t.length===n.length||this.cancelarAtualizarBoletos)break;await $(5e3)}while(1)},async atualizarModalBoleto(){this.modalBoleto={ativo:!1,visivel:!1,loading:!1,codigoFinanceiroBanco:"",condicoesPagamento:[],bancos:[]};const e=[],t=await P().formaPagamento.toArray(),u=await P().empresa.where({idContato:this.dados.fatura.idEmpresa}).toArray();if(await P().documentoCondicaoPagamento.where({idDocumento:this.dados.fatura.id}).each(d=>{const c=t.find(g=>g.id===d.idFormaPagamento&&g.tipo===99&&g.tipoFinanceiro==="T\xEDtulo em aberto");c&&e.push({dataVencimento:d.dataVencimento,descricao:c.descricao,idFinanceiroTitulo:d.idFinanceiroTitulo,codigoFinanceiroBoleto:"",checked:!1,disable:!0,valor:d.valor})}),!e.length)return;const n=[];await P().financeiroBanco.each(d=>{if(!!d.ativo){if(d.id==="7D07229E-B35E-42AA-A312-78313BE61B2F"){n.push(d);return}d.idEmpresa&&u.find(c=>c.id===d.idEmpresa)&&n.push(d)}});const o=[...new Set(n.map(d=>d.codigoBanco))],r=[];await P()._banco.each(d=>{o.find(c=>c===d.codigoBanco)&&r.push(d)}),this.modalBoleto.condicoesPagamento=K.exports.orderBy(e,"dataVencimento","asc");const s=[];for(const d of n){const c=r.find(B=>B.codigoBanco===d.codigoBanco)||{};if(!c)continue;const g=(c.descricao||"").trim(),k=(d.agencia||"").trim(),m=(d.conta||"").trim();if(!c.arquivoBoleto||!g||!k||!m)continue;let l=g+" - Ag. "+k+" C/C "+m;s.push({arquivoBoleto:c.arquivoBoleto,label:l,value:d.codigoFinanceiroBanco})}s.length&&(this.modalBoleto.financeiroBanco=s[0],this.modalBoleto.bancos=s)},fecharModalBoleto(){this.cancelarAtualizarBoletos=!0,this.cancelarEmitirBoletos=!0,this.modalBoleto.visivel=!1,this.$nextTick().then(()=>{this.modalBoleto.avito=!1})},async emitirImprimirBoleto(){var s;this.modalBoleto.loading=!0;let e,t,u,n={},o=[];u=this.modalBoleto.condicoesPagamento.filter(d=>d.checked);for(const d of u){if(d.codigoFinanceiroBoleto&&(d.banco||{}).arquivoBoleto){if(!n[d.banco.arquivoBoleto]){n[d.banco.arquivoBoleto]=[d.codigoFinanceiroBoleto];continue}n[d.banco.arquivoBoleto].push(d.codigoFinanceiroBoleto);continue}o.push(d.codigoFinanceiroTitulo)}if(o.length&&((s=this.modalBoleto.financeiroBanco)==null?void 0:s.value)){this.cancelarEmitirBoletos=!1;let d,c,g,k=0,m=0,l;if(l=(this.modalBoleto.bancos.find(B=>B.value===this.modalBoleto.financeiroBanco.value)||{}).arquivoBoleto,!l){this.$q.notifyError("Arquivo boleto n\xE3o encontrado");return}e=`sp_financeiro_boletoEmitir ${this.modalBoleto.financeiroBanco.value}, '${o.join(",")}'`;do{if(this.cancelarEmitirBoletos)break;try{t=await M(e),k=0}catch(B){t=[],++k%3===0&&this.$q.notifyError(B.message)}if(d=(t||[])[0],c=((d||{}).Msg||"").trim(),g=((d||{}).Retorno||"").trim(),c==="Boleto Gerado com sucesso!"&&g){const B=g.substring(0,g.length-1).split(",");if(!n[l]){n[l]=B;break}for(const S of B)n[l].push(S);break}else++m%3===0&&this.$q.notifyError(c);await $(5e3)}while(1)}let r=JSON.parse(localStorage.getItem("clienteSistema"))||{};for(const d in n){let c;c="https://rel.storage.b15.com.br/Relatorios/"+d+".html?",c+="CodigoFinanceiroBoleto="+n[d].join(","),c+="&Banco="+r.bancoDeDados,c+="&URLServidor="+r.urlServidor,window.open(c)}await this.atualizarBoletos(),this.modalBoleto.loading=!1},alternarDetalhes(){this.detalhesVisivel=!this.detalhesVisivel},async atualizar(){const e=await $db.fatura.leCompleto(this.id);e.vendas.sort((n,o)=>new Date(n.dataHoraFinalizado)<new Date(o.dataHoraFinalizado)?-1:1),e.carnes.sort((n,o)=>new Date(n.dataVencimento)<new Date(o.dataVencimento)?-1:1);const t=await e.vendas.reduce(async(n,o)=>(n[o.idContatoVendedor]||(n[o.idContatoVendedor]=await $db.contato.le({id:o.idContatoVendedor})),n),{});if(e.fatura.idContato){const n=e.fatura.idContato;t[n]||(t[n]=await $db.contato.le({id:n}))}this.configuraImpressaoCarne(e.fatura.idEmpresa),this.configuraImpressaoConvenio(e.fatura.idEmpresa),this.configuraImpressaoEnvelope(e.fatura.idEmpresa),this.configuraImpressaoFatura(e.fatura.idEmpresa),this.contatos=t,this.dados=e,this.atualizarModalBoleto(),this.condicaoPagamento=e.condicaoPagamento,this.resumeCondicaoPagamento();const u=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.podeEditar=!1,u.find(n=>n.id===e.fatura.idEmpresa)&&(this.podeEditar=!0),this.$nextTick(()=>{e.fatura.id===localStorage.getItem("idFatura")&&(this.podeEditar&&this.$refs.faturaModal.mostrar({id:this.dados.fatura.id}),localStorage.removeItem("idFatura"))})},copiarUid(){const e=this.$refs.uid;e.type="text";try{e.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a \xE1rea de transfer\xEAncia.",type:"info"})}catch{this.$q.notify("Erro ao copiar.")}e.type="hidden",window.getSelection().removeAllRanges()},async configuraImpressaoConvenio(e){const t=await $db.configuracoes.porNome("impressao.convenio",e);this.configImpressaoConvenio=[...t.length?t.map(u=>({texto:"Imprimir Conv\xEAnio",...u})):[{valor:"convenio",texto:"Imprimir Conv\xEAnio"}]]},async configuraImpressaoCarne(e){const t=await $db.configuracoes.porNome("impressao.carne",e);this.configImpressaoCarne=[...t.length?t.map(u=>({texto:"Imprimir Carn\xEA",...u})):[{valor:"carne-crediario",texto:"Reimprimir carn\xEA e notas promiss\xF3rias da fatura"}]]},async configuraImpressaoEnvelope(e){const t=await $db.configuracoes.porNome("impressao.envelope",e);this.configImpressaoEnvelope=[...t.length?t.map(u=>({texto:"Imprimir Envelope",...u})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoFatura(e){const t=await $db.configuracoes.porNome("impressao.fatura",e);this.configImpressaoFatura=[...t.length?t.map(u=>({texto:"Imprimir Fatura",...u})):[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}]]},editar(){this.$refs.faturaModal.mostrar({id:this.dados.fatura.id})},async executar(e){switch(e){case"atualizar":case"finalizar":case"retornarOrcamento":case"remover":this.$emit("executar","atualizar");return}await this.atualizar()},async sendReview(e){try{this.$q.loading.show();const t=[],u=this.contatos[e.idContato],n=await $api.bten.send(u,e);for(let o=0;o<n.length;o++){const r=n[o];r.status?t.push(r.telefone):this.$q.notifyError(`Falha ao enviar NPS para ${r.telefone}!`)}this.$q.loading.hide(),t.length&&this.$q.notifyPositive(`NPS enviado para ${t.join(",")}!`)}catch(t){if(t.name==="GeeksException"){this.$q.notifyAlert(t.message);return}this.$q.notifyError("N\xE3o foi possivel enviar NPS para o contato.",t)}finally{this.$q.loading.hide()}}},mixins:[oo,vo],props:{id:{required:!0,type:String}},async mounted(){var n,o,r,s;let e,t,u;e=await $db.configuracoes.porNome("integracao.bten.business"),t=(o=(n=e[0])==null?void 0:n.valor)!=null?o:!1,e=await $db.configuracoes.porNome("integracao.bten.authorization"),u=(s=(r=e[0])==null?void 0:r.valor)!=null?s:!1,this.mostrarBotaoEnviarAvaliacao=t&&u,this.sistemaPai=ao(),this.atualizar()}},_o={class:"col-auto q-pl-none items-center"},Bo={class:"col"},Eo={class:"col-auto"},Co={class:"col"},wo={class:"col"},ko={class:"col"},Fo={class:"col-12 col-md-6"},So={class:"text-subtitle1 text-weight-bold q-ma-none items-center"},Vo={class:"col-12 col-md-4"},qo=b("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Faturamento ",-1),Do={class:"q-ma-none"},Io={class:"col-12 col-md-2 text-right"},zo=b("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1),To={class:"q-ma-none"},xo=b("span",{class:"text-weight-bold"},"Emiss\xE3o de Boleto",-1),Po={class:"q-mt-lg text-center"};function Ao(e,t,u,n,o,r){const s=q("badge"),d=q("avatar"),c=q("row"),g=q("documentos-fiscais"),k=q("fatura-modal"),m=q("modal-historico-status");return p(),C(F,null,[o.dados.fatura.id?(p(),y(E,{key:0,id:"FaturaCard","manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:i(()=>[a(v,{avatar:"",center:"",class:"mw100 hideonmobile",onClick:r.editar},{default:i(()=>[a(s,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:r.copiarUid},{default:i(()=>[f(" #"+h(parseInt(o.dados.fatura.numero)||(o.dados.fatura.id||"").slice(-6))+" ",1),I(b("input",{type:"hidden","onUpdate:modelValue":t[0]||(t[0]=l=>o.dados.fatura.id=l),ref:"uid"},null,512),[[U,o.dados.fatura.id]])]),_:1},8,["onClick"])]),_:1},8,["onClick"]),a(v,{onClick:r.editar},{default:i(()=>[a(c,{class:"items-center"},{default:i(()=>[b("div",_o,[a(d,{imagem:(o.contatos[o.dados.fatura.idContato]||{}).imagem,rotulo:o.dados.fatura.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"])]),b("div",Bo,[a(_,{class:"text-tertiary text-weight-bold"},{default:i(()=>[f(h((o.contatos[o.dados.fatura.idContato]||{}).apelido),1)]),_:1}),a(c,{class:"hideondesktop items-center q-my-sm"},{default:i(()=>[b("div",Eo,[a(s,{class:"q-mr-sm",escuro:"",cor:"positive",onClick:r.copiarUid},{default:i(()=>[f(" #"+h(parseInt(o.dados.fatura.numero)||(o.dados.fatura.id||"").slice(-6))+" ",1),I(b("input",{type:"hidden","onUpdate:modelValue":t[1]||(t[1]=l=>o.dados.fatura.id=l),ref:"uid"},null,512),[[U,o.dados.fatura.id]])]),_:1},8,["onClick"])]),b("div",Co,[a(O,{color:"tertiary"},{default:i(()=>[f(h(o.dados.fatura.status),1)]),_:1})])]),_:1}),a(c,{class:"hideondesktop items-center q-my-sm"},{default:i(()=>[b("div",wo,[o.dados.fatura.dataHoraFinalizado?(p(),C(F,{key:0},[f(h(e.$filters.data(o.dados.fatura.dataHoraFinalizado))+" ",1),a(z,null,{default:i(()=>[f(" Finalizado ")]),_:1})],64)):(p(),C(F,{key:1},[f(h(e.$filters.data(o.dados.fatura.dataHoraEmissao))+" ",1),a(z,null,{default:i(()=>[f(" Emiss\xE3o ")]),_:1})],64))]),b("div",ko,[f(h((o.contatos[o.dados.fatura.idContatoVendedor]||{}).apelido)+" ",1),a(z,null,{default:i(()=>[f(" Vendedor(a) ")]),_:1})])]),_:1})])]),_:1})]),_:1},8,["onClick"]),a(v,{onClick:r.editar,class:"hideonmobile"},{default:i(()=>[o.dados.fatura.dataHoraFinalizado?(p(),C(F,{key:0},[f(h(e.$filters.data(o.dados.fatura.dataHoraFinalizado))+" ",1),a(z,null,{default:i(()=>[f(" Finalizado ")]),_:1})],64)):(p(),C(F,{key:1},[f(h(e.$filters.data(o.dados.fatura.dataHoraEmissao))+" ",1),a(z,null,{default:i(()=>[f(" Emiss\xE3o ")]),_:1})],64))]),_:1},8,["onClick"]),a(v,{avatar:"",class:"mw240 hideonmobile"},{default:i(()=>[a(O,{color:"tertiary"},{default:i(()=>[f(h(o.dados.fatura.status),1)]),_:1}),o.dados.fatura.rotaStatus?(p(),y(O,{key:0,color:"secondary",style:{"margin-top":"5px"}},{default:i(()=>[b("span",null,h(o.dados.fatura.rotaStatus),1)]),_:1})):w("",!0)]),_:1}),a(v,{onClick:r.editar,class:"hideonmobile text-right"},{default:i(()=>[b("b",null,[f(h(e.$filters.numero(o.dados.fatura.totalDocumento,2))+" ",1),a(z,null,{default:i(()=>[f(" Total ")]),_:1})]),b("span",null,[f(h(e.$filters.numero(o.dados.fatura.subTotal,2))+" ",1),a(z,null,{default:i(()=>[f(" Subtotal ")]),_:1})])]),_:1},8,["onClick"]),a(v,{side:"",top:""},{default:i(()=>[a(c,null,{default:i(()=>[a(T,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs",color:"tertiary",style:{float:"right"},onClick:r.alternarDetalhes},null,8,["icon","onClick"]),o.podeEditar?(p(),y(T,{key:0,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-ma-xs",size:"md",onClick:r.editar,style:{float:"right"}},null,8,["onClick"])):w("",!0),a(T,{rounded:"",dense:"",flat:"",icon:"print",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:i(()=>[a(Q,null,{default:i(()=>[I((p(),y(x,{link:"",separator:""},{default:i(()=>[r.mostrarOpcaoEmitirBoleto?(p(),y(E,{key:0,clickable:"",onClick:t[2]||(t[2]=l=>r.abrirModalBoleto())},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"mdi-printer"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f("Emitir Boleto")]),_:1})]),_:1})]),_:1})):w("",!0),(p(!0),C(F,null,D(o.configImpressaoFatura,l=>(p(),y(E,{clickable:"",key:l.valor,onClick:B=>e.$imprimir(l.valor,(o.dados.fatura||{}).id||"0")},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"print"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f(h(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(p(!0),C(F,{key:1},D(o.configImpressaoEnvelope,l=>(p(),y(E,{clickable:"",key:l.valor,onClick:B=>e.$imprimir(l.valor,(o.dados.fatura||{}).id||"0")},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"print"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f(h(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):w("",!0),(p(!0),C(F,null,D(o.configImpressaoCarne,l=>(p(),y(E,{clickable:"",key:l.valor,onClick:B=>e.$imprimir(l.valor,(o.dados.fatura||{}).id||"0")},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"print"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f(h(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(p(!0),C(F,null,D(o.configImpressaoConvenio,l=>(p(),y(E,{clickable:"",key:l.valor,onClick:B=>e.$imprimir(l.valor,(o.dados.fatura||{}).id||"0")},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"print"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f(h(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})),[[R]])]),_:1})]),_:1}),a(T,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:i(()=>[a(Q,null,{default:i(()=>[I((p(),y(x,{link:"",separator:""},{default:i(()=>[o.dados.fatura.id?(p(),y(E,{key:0,clickable:"",onClick:t[3]||(t[3]=l=>e.$refs.documentosFiscais.emitirCupom(o.dados.fatura.id))},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"account_balance"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f("Emitir cupom")]),_:1})]),_:1})]),_:1})):w("",!0),e.$utils.mapearStatus(o.dados.fatura).permiteNota?(p(),C(F,{key:1},[a(E,{clickable:"",onClick:t[4]||(t[4]=l=>e.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Venda"))},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"account_balance"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f("NFe de Sa\xEDda/Venda")]),_:1})]),_:1})]),_:1}),a(E,{clickable:"",onClick:t[5]||(t[5]=l=>e.emitirNFeV2({idFatura:o.dados.fatura.id},0,"Devolu\xE7\xE3o"))},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"account_balance"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f("NFe de Entrada/Devolu\xE7\xE3o")]),_:1})]),_:1})]),_:1}),a(E,{clickable:"",onClick:t[6]||(t[6]=l=>e.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Remessa"))},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"account_balance"})]),_:1}),a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f("NFe de Remessa")]),_:1})]),_:1})]),_:1})],64)):w("",!0),r.mostrarOpcaoRemoverFatura?(p(),y(E,{key:2,clickable:"",onClick:t[7]||(t[7]=l=>r.removerFatura())},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"mdi-trash-can"})]),_:1}),a(v,null,{default:i(()=>[f("Remover Fatura")]),_:1})]),_:1})):w("",!0),a(E,{clickable:"",onClick:t[8]||(t[8]=l=>e.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.fatura.id}))},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"history"})]),_:1}),a(v,null,{default:i(()=>[f("Hist\xF3rico do Status")]),_:1})]),_:1}),o.mostrarBotaoEnviarAvaliacao&&o.dados.fatura.status==="Finalizada"?(p(),y(E,{key:3,clickable:"",onClick:t[9]||(t[9]=l=>r.sendReview(o.dados.fatura))},{default:i(()=>[a(v,{avatar:""},{default:i(()=>[a(V,{name:"mdi-file-replace-outline"})]),_:1}),a(v,null,{default:i(()=>[f("Enviar Avalia\xE7\xE3o")]),_:1})]),_:1})):w("",!0)]),_:1})),[[R]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):w("",!0),I(a(c,{class:"items-start q-mx-none q-px-none q-mt-md"},{default:i(()=>[b("div",Fo,[b("p",So,[a(V,{name:"business"}),f(" "+h(o.dados.fatura.descricaoEmpresa),1)]),a(g,{ref:"documentosFiscais",idFatura:o.dados.fatura.id},null,8,["idFatura"])]),b("div",Vo,[qo,b("p",Do,h(o.dados.fatura.observacaoFaturamento),1),a(x,{class:"no-border"},{default:i(()=>[(p(!0),C(F,null,D(e.condicaoPagamentoResumo,l=>(p(),y(E,{key:l.id,class:"q-pa-none row",style:{"min-height":"auto"}},{default:i(()=>[a(v,null,{default:i(()=>[a(_,null,{default:i(()=>[f(h(l.formaPagamento),1)]),_:2},1024)]),_:2},1024),a(v,{class:"text-right"},{default:i(()=>[a(_,null,{default:i(()=>[f(h(e.$filters.numero(l.valor,2))+h(l.parcelas>1?` (em ${l.parcelas}x)`:""),1)]),_:2},1024)]),_:2},1024),a(v,{right:""},{default:i(()=>[a(_,null,{default:i(()=>[f(h(e.$filters.data(l.dataVencimento)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),b("div",Io,[zo,b("p",To,h(e.$filters.numero(o.dados.fatura.totalDesconto,2)),1)])]),_:1},512),[[eo,o.detalhesVisivel]]),a(N),a(k,{ref:"faturaModal",onExecutar:r.executar},null,8,["onExecutar"]),o.modalBoleto.ativo?(p(),y(uo,{key:1,modelValue:o.modalBoleto.visivel,"onUpdate:modelValue":t[12]||(t[12]=l=>o.modalBoleto.visivel=l),onHide:r.fecharModalBoleto,minimized:""},{default:i(()=>[a(to,null,{default:i(()=>[a(io,null,{default:i(()=>[a(lo,null,{default:i(()=>[xo]),_:1}),I(a(T,{flat:"",round:"",dense:"",icon:"close"},null,512),[[R]])]),_:1}),a(ro,null,{default:i(()=>[o.modalBoleto.condicoesPagamento.filter(l=>l.disable).length?(p(),y(x,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:i(()=>[a(_,{header:""},{default:i(()=>[f("Recuperando informa\xE7\xF5es do servidor "),a(po)]),_:1}),a(N),(p(!0),C(F,null,D(o.modalBoleto.condicoesPagamento.filter(l=>l.disable),(l,B)=>(p(),y(E,{key:B,tag:"label"},{default:i(()=>[a(v,null,{default:i(()=>[l.disable?(p(),y(ho,{key:0})):w("",!0)]),_:2},1024),a(_,null,{default:i(()=>[a(_,{header:""},{default:i(()=>[f(h(l.descricao)+" - "+h(e.$filters.numero(l.valor,2))+" - Venc. "+h(e.$filters.data(l.dataVencimento)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):w("",!0),b("form",{class:"q-pa-sm",onSubmit:t[11]||(t[11]=so(l=>r.emitirImprimirBoleto(),["prevent"]))},[o.modalBoleto.condicoesPagamento.filter(l=>!l.disable&&l.codigoFinanceiroBoleto).length?(p(),y(x,{key:0,dense:"",highlight:"",class:"q-mb-sm"},{default:i(()=>[a(_,{header:""},{default:i(()=>[f("Boletos emitidos")]),_:1}),a(N),(p(!0),C(F,null,D(o.modalBoleto.condicoesPagamento.filter(l=>!l.disable&&l.codigoFinanceiroBoleto),(l,B)=>(p(),y(E,{key:B,tag:"label"},{default:i(()=>[a(v,null,{default:i(()=>[a(j,{modelValue:l.checked,"onUpdate:modelValue":S=>l.checked=S},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(_,null,{default:i(()=>[a(_,{header:""},{default:i(()=>[f(h(l.descricao)+" - "+h(e.$filters.numero(l.valor,2))+" - Venc. "+h(e.$filters.data(l.dataVencimento)),1)]),_:2},1024),a(_,{caption:""},{default:i(()=>[f(h(l.banco.descricao)+" - Ag. "+h(l.banco.agencia)+" C/C "+h(l.banco.conta)+" - Emitido em "+h(e.$filters.dataHora(l.banco.dataEmissao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):w("",!0),o.modalBoleto.condicoesPagamento.filter(l=>!l.disable&&!l.codigoFinanceiroBoleto).length?(p(),y(x,{key:1,dense:"",highlight:""},{default:i(()=>[a(_,{header:""},{default:i(()=>[f("Boletos a emitir")]),_:1}),a(N),a(E,null,{default:i(()=>[a(_,null,{default:i(()=>[a(L,{modelValue:o.modalBoleto.financeiroBanco,"onUpdate:modelValue":t[10]||(t[10]=l=>o.modalBoleto.financeiroBanco=l),options:o.modalBoleto.bancos},null,8,["modelValue","options"])]),_:1})]),_:1}),(p(!0),C(F,null,D(o.modalBoleto.condicoesPagamento.filter(l=>!l.disable&&!l.codigoFinanceiroBoleto),(l,B)=>(p(),y(E,{key:B,tag:"label"},{default:i(()=>[a(v,null,{default:i(()=>[a(j,{modelValue:l.checked,"onUpdate:modelValue":S=>l.checked=S},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(_,null,{default:i(()=>[a(_,{header:""},{default:i(()=>[f(h(l.descricao)+" - "+h(e.$filters.numero(l.valor,2))+" - Venc. "+h(e.$filters.data(l.dataVencimento)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):w("",!0),b("div",Po,[I(a(T,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[R]]),a(T,{color:"primary",class:"q-ml-sm",label:"Imprimir",type:"submit",unelevated:"",disable:!r.ativarBotaoEmissaoBoleto},null,8,["disable"])])],32),a(no,{showing:o.modalBoleto.loading},{default:i(()=>[a(co,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])):w("",!0),a(m,{ref:"modalHistoricoStatus"},null,512)],64)}var Ro=J(yo,[["render",Ao]]);const No={alterados:0,arquivo:null,cor:"text-negative",corFinal:"",erro:"",erros:0,incluidos:0,listaErros:[],mensagem:"",mensagemFinal:"",modalResultado:!1},Oo={components:{lista:fo,FaturaCardLista:Ro,FaturaModal:Y},data(){return new Date(new Date($utils.dataAtual()).toDateString()),{tokenRoutEasy:null,tabSelecionada:{valor:"Aberta"},importar:$utils.clonarV2(No),opcoesStatusEnvio:[{rotulo:"Todos"},{rotulo:"Enviados"},{rotulo:"N\xE3o Enviados"}],page:{Aberta:{current:1,min:0,max:0},Finalizada:{current:1,min:0,max:0},ativa:"Aberta"},entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),status:[],operacoes:[],pageSize:10,grupos:[],buscaCampo:"",empresas:[],empresa:{},empresaOpcoes:[],contatosModal:!1,vendedorModal:!1,digitadorModal:!1,buscaCliente:"",filtro:{opcaoDataSelected:"Data Emiss\xE3o",statusEnvio:"Todos",valorTotal:0,status:"Aberta",operacao:"",grupos:[],empresa:{id:null},cliente:{id:"",nome:""},vendedor:{id:""},digitador:{id:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},paginacao:{atual:1,maximo:1,total:1,limite:25},dbContato:$db.contato,documentos:[],showFilters:!1,vendedorDigitadorSelecionado:null,vendedoresDigitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1,showAllPreviewDetail:!1,lista:[],usuario:JSON.parse(localStorage.getItem("usuario")),prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeCRM"},{label:"Entrega para esta semana",value:"bordaAmarelaCRM"},{label:"Entrega atrasada",value:"bordaVermelhaCRM"}],opcoesData:[{label:"Data Emiss\xE3o"},{label:"Data Finaliza\xE7\xE3o"}]}},methods:{async atualizar(){var e,t;try{$q.loading.show(),this.vendedorDigitadorSelecionado!==null&&(this.filtro.vendedor.id=this.vendedorDigitadorSelecionado.value);let u="";this.tabSelecionada.valor!=="Todas"&&(u=this.tabSelecionada.valor);let n=this.filtro.vendedor.id;this.diretivaContatosAcessaTodosContatos||(n=this.usuario.codigoContato,this.filtro.vendedor.id=n);let o={status:u,valorTotal:this.filtro.valorTotal,cliente:this.filtro.cliente.nome,operacao:this.filtro.operacao,idEmpresa:(t=(e=this.empresaSelecionada)==null?void 0:e.id)!=null?t:"",idContato:this.filtro.cliente.id,idContatoVendedor:n,idContatoDigitador:this.filtro.digitador.id,statusEnvio:this.filtro.statusEnvio,termoBusca:this.buscaCampo};this.filtro.opcaoDataSelected==="Data Emiss\xE3o"&&(o.periodoEmissao={ini:this.filtro.periodo.emissao.ini,fim:this.filtro.periodo.emissao.fim}),this.filtro.opcaoDataSelected==="Data Finaliza\xE7\xE3o"&&(o.periodoFinalizado={ini:this.filtro.periodo.finalizado.ini,fim:this.filtro.periodo.finalizado.fim});let r=[];const s=await $db.fatura.leRefatorado({filtros:o,termoBusca:this.buscaCampo,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataFinalizacao","dataHoraEmissao"],dir:["desc","desc"]});r=s.data,this.documentos=r,this.paginacao.total=s.total,this.paginacao.maximo=s.totalPages}catch(u){console.log(u),this.$q.notifyError("Erro ao filtrar")}finally{$q.loading.hide()}},limparFiltros_click(){this.empresaSelecionada="",this.filtro={opcaoDataSelected:"Data Emiss\xE3o",statusEnvio:"Todos",valorTotal:0,status:"Aberta",operacao:"",grupos:[],empresa:{id:null},cliente:{id:"",nome:""},vendedor:{id:""},digitador:{id:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},this.atualizar()},async resetarEnvio(e){$q.dialog({message:"Deseja resetar o envio desta fatura?",title:"Aten\xE7\xE3o!",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Resetar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{const t=e.id;e.rotaJson="",e.rotaStatus="",e.rotaNome="";const u=(await $db.hibrido.lista({table:"documento",where:{id:t}}))[0],n=$utils.clonarV2(u);n.rotaJson="",n.rotaStatus="",n.rotaNome="",await $db.documento.grava({atual:n,original:u})})},async sendRouteEasyAll(){var e,t;$q.loading.show();try{let u="";this.tabSelecionada.valor!=="Todas"&&(u=this.tabSelecionada.valor),this.tabSelecionada.values&&this.tabSelecionada.values.length&&(u=this.tabSelecionada.values);let n=await $db.venda.leRefatorado({filtros:{faturado:{ini:this.filtro.periodo.faturado.ini,fim:this.filtro.periodo.faturado.fim},periodoEmissao:{ini:this.filtro.periodo.emissao.ini,fim:this.filtro.periodo.emissao.fim},periodoFinalizado:{ini:this.filtro.periodo.finalizado.ini,fim:this.filtro.periodo.finalizado.fim},status:u,valorTotal:this.filtro.valorTotal,cliente:this.filtro.cliente.nome,operacao:this.filtro.operacao,idEmpresa:(t=(e=this.empresaSelecionada)==null?void 0:e.id)!=null?t:null,idContato:this.filtro.cliente.id,idContatoVendedor:this.filtro.vendedor.id,idContatoDigitador:this.filtro.digitador.id},termoBusca:this.buscaCampo,limit:this.paginacao.total,page:this.paginacao.atual,sort:["dataHoraEmissao","dataFinalizacao"],dir:["desc","desc"]});await this.sendRouteEasy(n),$q.notify({message:"Sincronismo efetuado com sucesso!",type:"positive"})}catch(u){console.log(u)}finally{$q.loading.hide()}},async sendRouteEasy(e){$q.loading.show();let t=e.data,u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYxNDIwYWQ2YzRiNTYzMWEyMmQwYTZhZSIsInRpbWVzdGFtcCI6MTYzMjQ5NTY1ODE1OH0.Nodh7i5OjMak8PQaavO8yComhN6BJa7bPs37SKfe4rE",n="https://company.routeasy.com.br",o={deliveries:[]};try{for(let r=0;r<t.length;r++){const s=t[r],d=await $db.contatoEndereco.le({idContato:s.idContato});if(d.length===0){let c=`N\xE3o foi possivel envia fatura #ID[${s.id}], pois n\xE3o foi vinculado um endere\xE7o.`;$q.notify(c),console.log(c)}if(s&&s.idContato&&d.length>0){let c=await $db.contato.le({id:s.idContato}),g=await $db.contatoTelefone.le({idContato:c.id}),k=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:s.idFatura}}),m=$utils.dataAtual();const l=d[0],B=await this.calcularPesoECubicoTotal(s.id);let S=B.pesoTotal||0,A=B.metroCubicoTotal||0,G=k.length>0?k[0].nNF:"",jo=$filters.numero(s.totalDocumento,2),W=parseInt(s.totalDocumento),X={code:s.idContato,name:s.descricaoContato,site:s.numeroDocumentoEmpresa,additional_info_2:s.numeroDocumentoEmpresa,order_number:s.numero+" "+s.numeroDocumentoEmpresa,invoice_number:G,loads:[S,A,W],email:c.email||"",customer_profile:c.id,phone:g.length>0?g[0].telefone:"",address:{route:l.logradouro,street_number:l.numero?l.numero:"",neighborhood:l.bairro,city:l.municipio,state:l.uf,postal_code:l.cep,country:l.pais}};o.deliveries.push(X)}}if(o.deliveries.length>0){const r=await mo({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},baseURL:n,url:`/group?api_key=${u}`,validateStatus:s=>s>=200&&s<=500,timeout:3e4,data:o});for(const s of r.data.deliveries){const d=t.find(l=>l.numeroDocumentoEmpresa===s.order_number.split(" ")[1]&&l.numero===parseInt(s.order_number.split(" ")[0]));if(!d){$q.notify(`Venda N\xBA ${s.order_number} / ${s.site} n\xE3o encontrada!`);continue}const c=(await $db.hibrido.lista({table:"documento",where:{id:d.id}}))[0],g=$utils.clonarV2(c);g.rotaJson=JSON.stringify({envio:s}),g.rotaStatus="Enviado";let m=$utils.dataAtual().split("T")[0].split("-");g.rotaNome=`Rota do dia ${m[2]}/${m[1]}/${m[0]}`,await $db.documento.grava({atual:g,original:c}),this.$refs[g.id]&&this.$refs[g.id].atualizar()}}else $q.notify("Rota(s) j\xE1 enviadas ou nao tem informa\xE7\xF5es suficientes.")}catch(r){$q.notify(r.message),console.log("[ERROR][SINCRONSMO][ROUTEASY] => ",r)}finally{if(o.deliveries.length>0){let r=o.deliveries.length>1?"s":"";$q.notify({message:`(${o.deliveries.length}) Rota${r} enviada${r} com sucesso!`,type:"positive"})}$q.loading.hide()}},async executar(e){if(this.$refs.faturaModal.venda.status){for(const t of this.tabs)if(t.value.indexOf(this.$refs.faturaModal.venda.status)!==-1){this.tabSelecionada.valor=t.value;break}this.$refs.faturaModal.venda.status==="Or\xE7amento"&&(this.filtro.opcaoDataSelected="Data Emiss\xE3o")}await this.atualizar()},async calcularPesoECubicoTotal(e){if(!e)return!1;const t={};let u=0,n=0,o=0,r=0,s=0;const d=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:e}});for(const c of d)if(c.operacaoFator===-1){if(c.idItem&&!t[c.idItem]){const g=await $erp().item.get(c.idItem);g&&(t[c.idItem]=g)}u+=(t[c.idItem].peso||0)*(c.quantidade||0),n+=(t[c.idItem].pesoBruto||0)*(c.quantidade||0),r=(t[c.idItem].altura||0)*(t[c.idItem].largura||0)*t[c.idItem].comprimento||0,s=c.quantidade||0,o+=r>0?r*s:0}return u=$utils.arredondar(u,4),n=$utils.arredondar(n,4),o=$utils.arredondar(o,4),{pesoTotal:u,pesoBrutoTotal:n,metroCubicoTotal:o}},async importarPlanilhaRetorno(e){try{const u=await(r=>new Promise((s,d)=>{const c=new FileReader;c.readAsBinaryString(r),c.onload=()=>s(c.result),c.onerror=g=>d(g)}))(e[0]);let n=H.read(u,{type:"binary"}),o=H.utils.sheet_to_json(n.Sheets[Object.keys(n.Sheets)[0]],{header:1});for(let r=1;r<o.length;r++){const s=o[r],d=o[0];d[0]="Nome Rota";const c=$utils.convertArrToObj(d,s);if(s[29]&&s[29].length>1){console.log("numero pedido => ",s[29].replace("Pedido ",""));try{const g=s[29].replace("Pedido ","").split(" "),k=parseInt(g[0]),m=g[1];if(k>1){const l=(await $erp().documento.where({tipo:"Venda"}).filter(A=>A.numero===k&&A.numeroDocumentoEmpresa===m).toArray())[0],B={...l},S=$utils.clonarV2(l);S.rotaJson=JSON.stringify({...JSON.parse(S.rotaJson),recebido:JSON.stringify(c)}),S.rotaNome=s[0],S.rotaSequencia=s[4],S.rotaData=$utils.dataAtual(),await $db.documento.grava({original:B,atual:S})}}catch(g){console.log(`[ERROR][IMPORTACAO] => ${g.message}`,g)}}}await this.atualizar(),this.$q.notify({type:"positive",message:"Importa\xE7\xE3o realizada com sucesso"})}catch(t){t.name&&t.name==="ErroValidacao"?this.$q.notifyError(t.message,t):this.$q.notifyError("Ocorreu erro ao importar roteriza\xE7\xE3o xlsx",t)}},acessarPainel(){let e="https://company.routeasy.com.br/#!/routings/create";window.open(e,"_blank").focus()},montarObjImportacaoRE(e,t){let u={};for(let n=1;n<e.length;n++){const o=$utils.removerCaracteresEspeciais(e[n]).split(" ");for(let s=0;s<o.length;s++)o[s]=o[s].charAt(0).toUpperCase()+o[s].slice(1);const r=o.join("");u[r]=t[n]}return u},aoSelecionarEmpresa(){this.filtro.empresa=this.empresas.filter(e=>e.id===this.filtro.empresa.id)[0]},aoSelecionarStatusEnvio(){},aoSelecionarCliente(e,t){e&&(this.filtro.cliente=$utils.clonarV2(t),this.contatosModal=!1)},adicionarVenda(){this.$refs.faturaModal.mostrar()},abrirTodosPreview(){this.showAllPreviewDetail=!this.showAllPreviewDetail;for(let e of this.documentos)this.$refs[e.id].detalhesVisivel=this.showAllPreviewDetail},async empresaOpcoesCarregar(){this.contatosEmpresa=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,this.empresaOpcoes=this.contatosEmpresa.map(e=>({label:e.nome,value:e.codigoContato,id:e.id}))},filtraDebounce(){$lodash.debounce(this.atualizar,10)()}},async created(){$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then(async e=>{this.$route.params.id&&this.$route.params.id.length&&this.$refs.faturaModal.mostrar({id:this.$route.params.id}),this.diretivaContatosAcessaTodosContatos=e,this.diretivaContatosAcessaTodosContatos&&(this.vendedoresDigitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then(u=>{u.forEach(n=>{n.codigo&&this.vendedoresDigitadoresOpcoes.push({label:n.nome,value:n.codigo})})}));let t=await $db.configuracoes.le({nome:"integracao.routeasy"});this.tokenRoutEasy=t.length?t[0].valor:null,await this.empresaOpcoesCarregar(),this.atualizar()}),this.empresaOpcoesCarregar()},async mounted(){let e=await $db.configuracoes.le({nome:"vendas.usaExpedicao"});e=e.length?e[0].valor:null,this.tabs=[{rotulo:"Abertas",value:"Aberta"},{rotulo:"Finalizado",value:"Finalizada"},{rotulo:"Todas",value:""}]}},Mo=b("span",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Emiss\xE3o",-1),$o=b("span",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Finaliza\xE7\xE3o",-1),Uo=b("p",null,null,-1);function Qo(e,t,u,n,o,r){const s=q("campo"),d=q("row"),c=q("fatura-card-lista"),g=q("lista"),k=q("fatura-modal");return p(),C(F,null,[b("div",null,[a(g,{titulo:"Faturas",onCriar_click:r.adicionarVenda,icone:"how_to_vote",onFiltro_change:r.atualizar,onLimparFiltros_click:r.limparFiltros_click,onAbrirTodosPreview:r.abrirTodosPreview,tabSelecionada:o.tabSelecionada,tabs:e.tabs,lista:o.documentos,paginacao:o.paginacao,permissaoExtrasV2:o.tokenRoutEasy,showToolbar:!1,permissaoExtras:!1,disableRemove:!0,permissaoNovo:!1,filtros:o.filtro,exportarXLSXVisible:!1,permissaoFicha:!1,buscaCampo:o.buscaCampo,"onUpdate:buscaCampo":t[9]||(t[9]=m=>o.buscaCampo=m),showAdd:!1,checkboxVisible:!1},{menuExtras:i(()=>[]),filtroCampos:i(()=>[a(d,{class:"q-col-gutter-md q-mt-md",style:{"margin-top":"-10px"}},{default:i(()=>[a(s,{modelValue:o.filtro.cliente.nome,"onUpdate:modelValue":[t[0]||(t[0]=m=>o.filtro.cliente.nome=m),r.filtraDebounce],class:"col-md-12",style:{"padding-top":"0px"},debounce:500,before:[{icon:"search"}],rotulo:"Por cliente ou respons\xE1vel",dense:""},null,8,["modelValue","onUpdate:modelValue"]),a(L,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[t[1]||(t[1]=m=>e.empresaSelecionada=m),e.refazFiltro],options:o.empresaOpcoes,clearable:"",label:"Por empresa"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:1}),o.tokenRoutEasy&&o.tokenRoutEasy.length>3?(p(),y(d,{key:0,class:"q-col-gutter-md q-mt-md"},{default:i(()=>[a(s,{tipo:"seletor",dense:"",modelValue:o.filtro.statusEnvio,"onUpdate:modelValue":[t[2]||(t[2]=m=>o.filtro.statusEnvio=m),r.aoSelecionarStatusEnvio],options:o.opcoesStatusEnvio.map(m=>({label:m.rotulo,value:m.rotulo})),clearable:"",rotulo:"Status Envio"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:1})):w("",!0),a(d,{class:"q-col-gutter-md q-mt-md"},{default:i(()=>[a(s,{tipo:"seletor",dense:"",modelValue:o.filtro.opcaoDataSelected,"onUpdate:modelValue":t[3]||(t[3]=m=>o.filtro.opcaoDataSelected=m),options:o.opcoesData.map(m=>({label:m.label,value:m.label})),rotulo:"Selecione data para filtro"},null,8,["modelValue","options"])]),_:1}),o.filtro.opcaoDataSelected==="Data Emiss\xE3o"?(p(),y(d,{key:1,class:"q-col-gutter-md q-mt-md"},{default:i(()=>[Mo,a(s,{modelValue:o.filtro.periodo.emissao.ini,"onUpdate:modelValue":t[4]||(t[4]=m=>o.filtro.periodo.emissao.ini=m),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){o.filtro.periodo.emissao.ini=""}}],dense:""},null,8,["modelValue","after"]),a(s,{modelValue:o.filtro.periodo.emissao.fim,"onUpdate:modelValue":t[5]||(t[5]=m=>o.filtro.periodo.emissao.fim=m),tipo:"data",class:"no-shadow full-width",rotulo:"at\xE9",col:"12",after:[{icon:"mdi-close-circle",handler(){o.filtro.periodo.emissao.fim=""}}],dense:""},null,8,["modelValue","after"])]),_:1})):w("",!0),o.filtro.opcaoDataSelected==="Data Finaliza\xE7\xE3o"?(p(),y(d,{key:2,class:"q-col-gutter-md q-mt-md"},{default:i(()=>[$o,a(s,{modelValue:o.filtro.periodo.finalizado.ini,"onUpdate:modelValue":t[6]||(t[6]=m=>o.filtro.periodo.finalizado.ini=m),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){o.filtro.periodo.finalizado.ini=""}}],dense:""},null,8,["modelValue","after"]),a(s,{modelValue:o.filtro.periodo.finalizado.fim,"onUpdate:modelValue":t[7]||(t[7]=m=>o.filtro.periodo.finalizado.fim=m),tipo:"data",class:"no-shadow full-width",rotulo:"at\xE9",col:"12",after:[{icon:"mdi-close-circle",handler(){o.filtro.periodo.finalizado.fim=""}}],dense:""},null,8,["modelValue","after"])]),_:1})):w("",!0),Uo,a(s,{modelValue:o.paginacao.limite,"onUpdate:modelValue":t[8]||(t[8]=m=>o.paginacao.limite=m),min:"1",rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",dense:""},null,8,["modelValue"])]),itemLista:i(()=>[a(x,{class:"rounded-borders"},{default:i(()=>[(p(!0),C(F,null,D(o.documentos,m=>(p(),C("div",{key:m.id,class:"itemHover fullWidth q-px-sm"},[a(c,{sendRouteEasy:r.sendRouteEasy,resetarEnvio:r.resetarEnvio,fatura:m.fatura,id:m.id,ref_for:!0,ref:m.id,class:"q-mb-md"},null,8,["sendRouteEasy","resetarEnvio","fatura","id"])]))),128))]),_:1})]),_:1},8,["onCriar_click","onFiltro_change","onLimparFiltros_click","onAbrirTodosPreview","tabSelecionada","tabs","lista","paginacao","permissaoExtrasV2","filtros","buscaCampo"])]),a(k,{ref:"faturaModal",onExecutar:r.executar,onAtualizarAtendimentoVenda:r.executar,continueMesmaTela:!1},null,8,["onExecutar","onAtualizarAtendimentoVenda"])],64)}var sa=J(Oo,[["render",Qo]]);export{sa as default};
