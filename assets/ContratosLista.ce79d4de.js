import{_ as Y,bw as oe,bx as Q,by as F,bz as D,bB as B,r as v,o as u,d as c,w as t,f as o,L as te,E as ae,h as J,Q as y,i as X,k as d,H as ie,I as le,t as I,n as A,e as g,F as O,ax as R,O as U,s as M,R as S,S as b,T,B as L,m as k,l as ee,J as re,C as se,j as Z,aq as H,aT as K,G as W,c$ as ne,bb as de,M as ue}from"./index.188ab8e6.js";import{L as me}from"./Lista.e6905c5e.js";import{P as ce}from"./PromptContatoV2.4e1c9fa3.js";import"./QBtnDropdown.2d90fa9b.js";import"./QBtnGroup.0884e20d.js";import"./QScrollArea.10dd49ab.js";const fe={components:{PromptItemV2:oe,PromptContatoV2:ce},data(){return{visivel:!1,cliente:{},emitente:{},diaVencimento:"",documentoAnterior:{},documento:{id:Q(),dataHoraEmissao:F(),numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",numeroVolumeTransporte:"",status:"Ativo",tipo:"Contrato"},documentoItens:[],documentoItensAnterior:[],totalItens:0,itensModal:!1,contatosModal:!1,emitenteModal:!1,empresas:[],configImpressaoContrato:[]}},emits:["atualizar"],methods:{async atualizar(i){if($q.loading.show(),i=i||this.$route.params.id,i)this.documentoAnterior=await $db.hibrido.le({table:"documento",id:i}),this.documento=D(this.documentoAnterior),this.documentoItensAnterior=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:i}}),this.documentoItens=D(this.documentoItensAnterior),this.cliente.id=this.documento.idContato,this.cliente.nome=this.documento.descricaoContato,this.emitente.id=this.documento.idEmpresa,this.emitente.nome=this.documento.descricaoEmpresa,this.diaVencimento=this.documento.numeroVolumeTransporte;else{this.limparCampos(),this.documento.id=Q(),this.documento.dataHoraEmissao=F(),this.documento.status="Ativo",this.documento.tipo="Contrato";const e=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione"});this.emitente=D(e),this.documento.idEmpresa=this.emitente.id,this.documento.descricaoEmpresa=this.emitente.nome}this.empresas=await $db.hibrido.lista({table:"empresa"}),this.somarValorTotal(),this.configuraImpressaoContrato(this.documento.idEmpresa),$q.loading.hide()},fechar(){this.$router.replace({params:{id:""}}),this.limparCampos(),this.visivel=!1},limparCampos(){this.documentoAnterior={},this.documento={id:"",dataHoraEmissao:null,numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",numeroVolumeTransporte:"",status:"",tipo:""},this.documentoItensAnterior=[],this.documentoItens=[],this.cliente.id="",this.cliente.nome="",this.emitente.id="",this.emitente.nome="",this.diaVencimento=""},async configuraImpressaoContrato(i){const e=await $db.configuracoes.porNome("impressao.contrato",i);this.configImpressaoContrato=e},async abrirModal(i=""){let e={},m=[];i?m=this.documentoItens.filter(f=>f.idItem===i):m=this.documentoItens;for(const f of m)e[f.idItem]={item:await $db.hibrido.le({table:"item",id:f.idItem}),quantidade:f.quantidade};this.$refs.promptItem.itensSelecionados=e,this.$refs.promptItem.termo=i,this.$refs.promptItem.atualizar(),this.itensModal=!0},recalcularTotal(i){i.subTotal=B(i.quantidade*i.valorItem),i.total=B(i.quantidade*i.valorItem),this.somarValorTotal()},aoSelecionarCliente(i,e){},async selecionarCliente(){if(this.documento.status!=="Cancelado"){const i=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione"});this.cliente=D(i),this.contatosModal=!1,this.documento.idContato=this.cliente.id,this.documento.descricaoContato=this.cliente.nome}},async selecionarEmitente(i,e){if(!i){this.emitenteModal=!1;return}this.emitente=D(e),this.emitenteModal=!1,this.documento.idEmpresa=this.emitente.id,this.documento.descricaoEmpresa=this.emitente.nome},aoSelecionarVencimento(){this.documento.numeroVolumeTransporte=this.diaVencimento},selecionarItens:function(i){for(const e in i){const m=i[e].item||{},f=i[e].quantidade||0;let a=this.documentoItens.find(s=>s.idItem===e);a?(a.quantidade=f,a.quantidadeRealizado=f,a.total=B(f*m.valorVenda)):this.documentoItens.push({dataHoraEmissao:F(),descricaoItem:m.descricao,id:Q(),idDocumento:this.documento.id,idItem:m.id,operacao:"-",quantidade:f,unidade:m.unidade,quantidadeRealizado:f,tipoItem:m.tipo,total:B(f*m.valorVenda),valorItem:m.valorVenda})}this.somarValorTotal()},somarValorTotal(){this.totalItens=this.documentoItens.reduce((i,e)=>i+=e.total,0)},excluirItem(i){this.documentoItens=this.documentoItens.filter(e=>e.id!==i),this.somarValorTotal()},validaDia(){if(this.diaVencimento<1||this.diaVencimento>28){this.$q.notifyAlert("O dia deve ser um valor entre 1 e 28"),this.diaVencimento="";return}this.aoSelecionarVencimento()},async gravar(i=!1){if(!this.cliente.id){this.$q.notifyAlert("Selecione um Cliente");return}if(!this.emitente.id){this.$q.notifyAlert("Selecione um Emitente");return}if(!this.diaVencimento){this.$q.notifyAlert("Selecione um dia de Vencimento");return}if(!this.totalItens){this.$q.notifyAlert("Adicione alguns itens ao contrato");return}try{await $db.contrato.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens}),this.visivel=i,this.atualizar(this.documento.id),this.$emit("atualizar")}catch(e){this.$q.notifyError("Erro ao salvar",e)}},cancelar(){this.documento.status="Cancelado",this.documento.dataHoraFinalizado=F(),this.gravar(!0),$q.notifyPositive("Contrato Cancelado")},ativar(){this.documento.status="Ativo",this.documento.dataHoraFinalizado="",this.gravar(!0),$q.notifyPositive("Contrato Reativado")}}},pe={key:0},he={ref:"form"},be={class:"u-container"};function ve(i,e,m,f,a,s){const C=v("badge"),w=v("BadgeCopiarUid"),_=v("avatar"),r=v("g-col"),V=v("campo"),p=v("g-row"),l=v("g-label"),h=v("PromptItemV2"),E=v("PromptContatoV2");return u(),c(se,{modelValue:a.visivel,"onUpdate:modelValue":e[11]||(e[11]=n=>a.visivel=n),maximized:"",onHide:e[12]||(e[12]=n=>s.fechar())},{default:t(()=>[o(te,{view:"hHh LpR fFf",container:"",class:"bg-light"},{default:t(()=>[o(ae,null,{default:t(()=>[o(J,null,{default:t(()=>[o(y,{onClick:e[0]||(e[0]=n=>s.fechar()),icon:"arrow_back",round:"",dense:"",flat:""}),o(X,null,{default:t(()=>e[13]||(e[13]=[d("Contrato")])),_:1}),o(y,{onClick:e[1]||(e[1]=n=>s.gravar(!1)),label:"Salvar",color:"white","text-color":"primary",unelevated:""})]),_:1})]),_:1}),o(ie,{class:"u-container"},{default:t(()=>[o(le,null,{default:t(()=>[o(J,{color:"transparent",class:"q-my-md"},{default:t(()=>[o(X,{class:"text-body2"},{default:t(()=>[d(" Emiss\xE3o: "+I(i.$filters.data(a.documento.dataHoraEmissao))+" ",1),a.documento.dataHoraFinalizado?(u(),A("span",pe,", Cancelamento: "+I(i.$filters.data(a.documento.dataHoraFinalizado)),1)):g("",!0)]),_:1}),a.documento.status?(u(),c(C,{key:0,rotulo:a.documento.status,escuro:"",dica:"Status",class:"q-ml-sm",cor:a.documento.status==="Ativo"?"primary":"tertiary"},null,8,["rotulo","cor"])):g("",!0),a.documento.numero?(u(),c(w,{key:1,id:a.documento.id,numero:a.documento.numero,cor:a.documento.status==="Ativo"?"positive":"tertiary",dica:"C\xF3digo: "+a.documento.codigoDocumento,class:"q-ml-sm"},null,8,["id","numero","cor","dica"])):g("",!0),a.documento.numero?(u(),A(O,{key:2},[a.configImpressaoContrato.length>1?(u(),c(y,{key:0,icon:"print",color:"primary",round:"",dense:"",flat:"",class:"q-ml-xs"},{default:t(()=>[o(R,{self:"top middle",anchor:"bottom middle"},{default:t(()=>[o(U,{link:"",separator:""},{default:t(()=>[(u(!0),A(O,null,M(a.configImpressaoContrato.filter(n=>n.valor),n=>(u(),c(S,{key:n.valor,onClick:z=>i.$imprimir(n.valor,{id:(a.documento||{}).id||"0",Oculto:"0"})},{default:t(()=>[o(b,{icon:"print"}),o(T,{label:n.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})):(u(),c(y,{key:1,icon:"print",color:"primary",round:"",dense:"",flat:"",class:"q-ml-xs",onClick:e[2]||(e[2]=n=>i.$imprimir(a.configImpressaoContrato[0].valor,{id:(a.documento||{}).id||"0",Oculto:"0"}))}))],64)):g("",!0)]),_:1}),L("form",he,[o(p,{gutter:"md",mg:"md-y",bg:"bg-white","rounded-borders":""},{default:t(()=>[o(r,{col:"12 sm"},{default:t(()=>[o(p,null,{default:t(()=>[o(r,{col:"shrink"},{default:t(()=>[o(_,{imagem:a.emitente.imagem,rotulo:a.emitente.nome,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"])]),_:1}),o(r,{col:"grow"},{default:t(()=>[o(V,{modelValue:a.emitente.nome,"onUpdate:modelValue":e[3]||(e[3]=n=>a.emitente.nome=n),rotulo:"Emitente",tipo:"texto",disable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(r,{col:"12 sm"},{default:t(()=>[o(p,null,{default:t(()=>[o(r,{col:"shrink"},{default:t(()=>[o(_,{imagem:a.cliente.imagem,rotulo:a.cliente.nome,tamanho:"30",style:{float:"left"}},null,8,["imagem","rotulo"])]),_:1}),o(r,{col:"grow"},{default:t(()=>[o(V,{modelValue:a.cliente.nome,"onUpdate:modelValue":[e[4]||(e[4]=n=>a.cliente.nome=n),s.aoSelecionarCliente],onClick:s.selecionarCliente,after:[{icon:"edit",handler(){s.selecionarCliente()}}],somenteLeitura:a.documento.status==="Cancelado",placeholder:"Cliente",rotulo:"Cliente",tipo:"texto"},null,8,["modelValue","onUpdate:modelValue","onClick","after","somenteLeitura"])]),_:1})]),_:1})]),_:1}),o(r,{col:"12 sm"},{default:t(()=>[o(V,{modelValue:a.diaVencimento,"onUpdate:modelValue":e[5]||(e[5]=n=>a.diaVencimento=n),onBlur:s.validaDia,opcoes:{minimumValue:1,maximumValue:28},error:a.diaVencimento>28||a.diaVencimento<1,rotulo:"Dia de Vencimento",tipo:"numero",errorMessage:"Dia entre 1 e 28",placeholder:"Dia Vencimento"},null,8,["modelValue","onBlur","error"])]),_:1})]),_:1})],512),o(p,{gutter:"md",mg:"md-y",bg:"bg-white","rounded-borders":""},{default:t(()=>[o(r,{col:"grow"},{default:t(()=>[o(l,{icon:"shopping_cart sm tertiary left"},{default:t(()=>e[14]||(e[14]=[d("Produtos e Servi\xE7os")])),_:1})]),_:1}),o(r,{col:"shrink"},{default:t(()=>[a.documento.status!=="Cancelado"?(u(),c(y,{key:0,onClick:e[6]||(e[6]=n=>s.abrirModal()),icon:"add",size:"md",color:"positive",round:"",dense:"",flat:""},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[15]||(e[15]=[d("Adicionar Item")])),_:1})]),_:1})):g("",!0)]),_:1}),o(r,{col:"12"},{default:t(()=>[o(U,null,{default:t(()=>[o(p,{class:"hideonmobile",justify:"around",text:"bold"},{default:t(()=>[o(r,{col:"2 md"},{default:t(()=>e[16]||(e[16]=[d("C\xF3digo")])),_:1}),o(r,{col:"10 md4 "},{default:t(()=>e[17]||(e[17]=[d("Descri\xE7\xE3o")])),_:1}),o(r,{col:"6 md",text:"right"},{default:t(()=>e[18]||(e[18]=[d("Quantidade")])),_:1}),o(r,{col:"6 md",text:"right"},{default:t(()=>e[19]||(e[19]=[d("Valor")])),_:1}),o(r,{col:"6 md",text:"right"},{default:t(()=>e[20]||(e[20]=[d("Total")])),_:1}),o(r,{col:"6 md1",text:"center"},{default:t(()=>e[21]||(e[21]=[d("A\xE7\xF5es")])),_:1})]),_:1}),o(ee,{class:"q-mt-xs q-mb-sm"}),(u(!0),A(O,null,M(a.documentoItens,(n,z)=>(u(),c(p,{key:z,items:"center",justify:"center",bordered:"bottom"},{default:t(()=>[o(r,{col:"grow md",order:"xs0 sm0"},{default:t(()=>[o(p,{items:"center",justify:"center"},{default:t(()=>[o(r,{col:"2",text:"left",class:"hideondesktop"},{default:t(()=>e[22]||(e[22]=[d(" C\xF3d.: ")])),_:1}),o(r,{col:"grow"},{default:t(()=>[d(I(n.codigoItem||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(r,{col:"12 md4",order:"xs2 sm1"},{default:t(()=>[o(p,{items:"center",justify:"center"},{default:t(()=>[o(r,{col:"2",text:"left",class:"hideondesktop"},{default:t(()=>e[23]||(e[23]=[d(" Desc.: ")])),_:1}),o(r,{col:"grow"},{default:t(()=>[d(I(n.descricaoItem||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(r,{col:"12 md",order:"xs3 sm2"},{default:t(()=>[o(p,{items:"center",justify:"center"},{default:t(()=>[o(r,{col:"2",text:"left",class:"hideondesktop"},{default:t(()=>[o(l,{class:"q-mr-xs"},{default:t(()=>e[24]||(e[24]=[d("Qtd.:")])),_:1})]),_:1}),o(r,{col:"grow sm10",text:"right"},{default:t(()=>[o(V,{modelValue:n.quantidade,"onUpdate:modelValue":x=>n.quantidade=x,onBlur:x=>s.recalcularTotal(n),tipo:"decimal",decimals:"4",filled:""},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024),o(r,{col:"2",text:"center"},{default:t(()=>[o(l,null,{default:t(()=>[d(I(n.unidade||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(r,{col:"12 md",order:"xs4 sm3"},{default:t(()=>[o(p,{items:"center",justify:"center"},{default:t(()=>[o(r,{col:"2",text:"left",class:"hideondesktop"},{default:t(()=>e[25]||(e[25]=[d(" Valor: ")])),_:1}),o(r,{col:"grow",text:"right"},{default:t(()=>[o(V,{modelValue:n.valorItem,"onUpdate:modelValue":x=>n.valorItem=x,onBlur:x=>s.recalcularTotal(n),tipo:"decimal",decimals:"4",filled:""},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(r,{col:"12 md",order:"xs5 sm4"},{default:t(()=>[o(p,{items:"center",justify:"center"},{default:t(()=>[o(r,{col:"2",text:"left",class:"hideondesktop"},{default:t(()=>e[26]||(e[26]=[d(" Total: ")])),_:1}),o(r,{col:"grow",text:"right"},{default:t(()=>[d(I(i.$filters.numero(n.total,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(r,{col:"shrink md1",order:"xs1 sm5",text:"center"},{default:t(()=>[o(y,{onClick:x=>s.abrirModal(n.idItem),icon:"edit",round:"",dense:"",flat:""},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[27]||(e[27]=[d("Editar")])),_:1})]),_:2},1032,["onClick"]),o(y,{onClick:x=>s.excluirItem(n.id),icon:"delete",round:"",dense:"",flat:""},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[28]||(e[28]=[d("Excluir")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(p,{items:"center",justify:"center"},{default:t(()=>[o(r,{col:"grow md"},{default:t(()=>e[29]||(e[29]=[d("\xA0")])),_:1}),o(r,{col:"10 md4"},{default:t(()=>e[30]||(e[30]=[d("\xA0")])),_:1}),o(r,{col:"12 md",text:"right"},{default:t(()=>e[31]||(e[31]=[d("\xA0")])),_:1}),o(r,{col:"12 md",text:"right"},{default:t(()=>e[32]||(e[32]=[d("\xA0")])),_:1}),o(r,{col:"12 md",text:"right"},{default:t(()=>[d(I(i.$filters.numero(a.totalItens,2)),1)]),_:1}),o(r,{col:"12 md1",text:"right"},{default:t(()=>e[33]||(e[33]=[d("\xA0")])),_:1})]),_:1}),o(p,{items:"center",justify:"center"},{default:t(()=>[o(r,{col:"12",text:"center"},{default:t(()=>[o(y,{onClick:e[7]||(e[7]=n=>s.abrirModal()),label:"Adicionar item",icon:"add",size:"xs",color:"positive",outline:"",class:"q-mx-auto"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(h,{modelValue:a.itensModal,"onUpdate:modelValue":e[8]||(e[8]=n=>a.itensModal=n),onSelecionarItens:s.selecionarItens,filtro:{ativo:!0,idEmpresa:a.documento.idEmpresa},habilitarQuantidade:!0,ref:"promptItem"},null,8,["modelValue","onSelecionarItens","filtro"]),o(E,{modelValue:a.contatosModal,"onUpdate:modelValue":e[9]||(e[9]=n=>a.contatosModal=n),onSelecionar:s.aoSelecionarCliente,filtro:{ativo:!0},placeholder:"Seleciona o Cliente"},null,8,["modelValue","onSelecionar"]),o(E,{modelValue:a.emitenteModal,"onUpdate:modelValue":e[10]||(e[10]=n=>a.emitenteModal=n),onSelecionar:s.selecionarEmitente,filtro:{ativo:!0,empresas:!0},placeholder:"Seleciona a empresa emitente"},null,8,["modelValue","onSelecionar"])]),_:1})]),_:1}),o(re,{class:"q-pa-sm bg-white text-right",bordered:""},{default:t(()=>[L("div",be,[a.documento.status==="Cancelado"?(u(),c(y,{key:0,onClick:s.ativar,label:"Ativar",color:"primary",unelevated:""},null,8,["onClick"])):g("",!0),a.documento.status==="Ativo"?(u(),c(y,{key:1,onClick:s.cancelar,label:"Cancelar",color:"negative",flat:""},null,8,["onClick"])):g("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ge=Y(fe,[["render",ve]]);const Ce={components:{Lista:me,ContratoFicha:ge},data(){return{usuario:"",listaLayout:{},lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"gavel",titulo:"Contratos",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!0,btnRemover:!0,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!0,toolbarAdicao:!1,bannerMsg:""},busca:"",filtrosOriginal:{},filtros:{status:"Ativo",termoBusca:"",empresa:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},empresa:"",empresaOpcoes:[],sort:{value:"numero",label:"N\xFAmero Contrato"},sortOpcoes:[{value:"numero",label:"N\xFAmero Contrato"},{value:"codigoDocumento",label:"C\xF3digo Documento"},{value:"dataHoraEmissao",label:"Data emiss\xE3o"},{value:"codigoDocumento",label:"Data finaliza\xE7\xE3o"}],order:{value:"desc",label:"Decrescente"},orderOpcoes:[{value:"asc",label:"Crescente"},{value:"desc",label:"Decrescente"}],checkBox:!1,tabSelecionada:{valor:"Ativos"},tabs:[{valor:"Ativo",rotulo:"Ativos"},{valor:"Suspenso",rotulo:"Suspensos"},{valor:"Cancelado",rotulo:"Cancelados"},{valor:"Todos",rotulo:"Todos"}],paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(i){var m;const e=$utils.logarIni("ContratosLista");await $tryLoading(async()=>{var _,r,V,p,l,h,E,n,z,x,P,N,j,$,G;this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor;let{buscarDadosRecentes:f}=i!=null?i:{},a={},s={};f&&(a=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"ContratosLista_"+((_=this.usuario)==null?void 0:_.id)}),a!=null&&a._id&&(this.tabSelecionada.valor=a==null?void 0:a.tabSelecionada,this.busca=(a==null?void 0:a.busca)||"",this.filtros={termoBusca:((r=a==null?void 0:a.filtros)==null?void 0:r.termoBusca)||null,empresa:((V=a==null?void 0:a.filtros)==null?void 0:V.empresa)||null,periodoEmissao:{ini:((l=(p=a==null?void 0:a.filtros)==null?void 0:p.periodoEmissao)==null?void 0:l.ini)||"",fim:((E=(h=a==null?void 0:a.filtros)==null?void 0:h.periodoEmissao)==null?void 0:E.fim)||""},periodoFinalizado:{ini:((z=(n=a==null?void 0:a.filtros)==null?void 0:n.periodoFinalizado)==null?void 0:z.ini)||"",fim:((P=(x=a==null?void 0:a.filtros)==null?void 0:x.periodoFinalizado)==null?void 0:P.fim)||""}},this.compareObject(this.filtrosOriginal,this.filtros,["termoBusca"])&&(this.$refs.contratosLista.filtros=!0))),s=$utils.eliminarVazios(this.filtros),delete s.status,((N=this.tabSelecionada)==null?void 0:N.valor)!=="Todos"&&(s.status=(j=this.tabSelecionada)==null?void 0:j.valor),console.log("STATUS: ",s.status),this.empresa&&(s.empresa=(($=this.empresa)==null?void 0:$.value)||""),this.busca&&(s.termoBusca=this.busca||"");let C={data:[],totalPages:0,total:0};C=await $db.contrato.leListaCompleta({filtros:s,limit:this.paginacao.limite,page:this.paginacao.atual,sort:[this.sort.value],order:[this.order.value]});let w=!0;for(const q of C.data)this.listaLayout.hasOwnProperty(q.id)||($db.hibrido.isOnline()||(q.documentoItens=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:q.id}})),q.totalContrato=$utils.somar(q.documentoItens,"total"),this.listaLayout[q.id]={detalhes:!1,remover:!1}),this.listaLayout[q.id].remover||(w=!1);this.$refs.contratosLista.checkbox=w,this.lista=C.data,this.paginacao.total=C.total,this.paginacao.maximo=C.totalPages,a={_id:"ContratosLista_"+((G=this.usuario)==null?void 0:G.id),tabSelecionada:this.tabSelecionada.valor,busca:this.busca,filtros:$utils.clonar(s)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:a})}),$utils.logarFim(e,((m=this.paginacao)==null?void 0:m.total)||1)},async gerarLoteNFSe(){await this.$q.dialog({title:"Gerar lote de NFS-e",message:"Deseja gerar as notas de servi\xE7o a partir dos contratos?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async()=>{const i=$utils.logarIni("ContratosLista");await $tryLoading(async()=>{await $db.contrato.gerarNFSEapartirContrato(),$q.notifyPositive("Exporta\xE7\xE3o das notas finalizada.")},{mensagem:"Exportando Contratos para NFSe...",erro:"Ocorreu um erro ao exportar contratos"}),$utils.logarFim(i,1)}).onCancel(()=>{}).onDismiss(()=>{})},async criarClick(){await this.$refs.contrato.atualizar(),this.$refs.contrato.visivel=!0},async abrirItem(i){this.$router.replace({params:{id:i}}),await this.$refs.contrato.atualizar(i),this.$refs.contrato.visivel=!0},checkBoxClick(){for(const i of this.lista)this.listaLayout[i.id].remover=this.checkBox},verificarCheckbox(){let i=!0;for(const e of this.lista)this.listaLayout[e.id].remover||(i=!1);this.$refs.contratosLista.checkbox=i},async removerItem(i){$q.dialog({title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show(),await $db.contrato.remove(i.id),this.atualizar(),$q.notifyPositive("O contrato foi exclu\xEDdo com sucesso.")}catch(e){$q.notifyError("Ocorreu um erro ao remover contrato.",e)}finally{$q.loading.hide()}})},async removerTodos(){$q.dialog({title:"Remover contratos",message:"Deseja remover todos os contratos selecionados?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();for(let i of this.lista)if(this.listaLayout[i.id].remover)try{await $db.contrato.remove(i.id)}catch{$q.notify("Ocorreu um erro ao remover os contratos selecionados. Tente novamente.")}this.atualizar(),$q.notifyPositive("Os contratos foram removidos com sucesso.")}catch(i){$q.notifyError("Ocorreu um erro ao remover todos os contratos selecionados.",i)}finally{$q.loading.hide()}})},async limparFiltrosClick(){this.empresa="",this.sort={label:"N\xFAmero Contrato",value:"numero"},this.order={label:"Decrescente",value:"desc"},this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},compareObject(i,e,m=[]){const f=Object.keys(i);for(const a of f)if(!m.includes(a)){if(typeof i[a]=="object"&&i[a]!==null){if(!this.compareObject(i[a],e[a],m))continue;return!0}else if(i[a]!==e[a])return!0}return!1}},async mounted(){if(this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),$db.hibrido.isOnline()){const i=(await $db.hibrido.lista({table:"empresa",where:{ativo:!0}})).map(e=>(e.ordenar=this.$utils.removerCaracteresEspeciais(e.apelido),e)).sort((e,m)=>e.ordenar>m.ordenar?1:m.ordenar>e.ordenar?-1:0);for(const e of i)this.empresaOpcoes.push({label:e.apelido,value:e.idContato})}else{const i=(await $erp().empresa.toArray()).filter(e=>e.ativo===!0).map(e=>(e.ordenar=this.$utils.removerCaracteresEspeciais(e.apelido),e)).sort((e,m)=>e.ordenar>m.ordenar?1:m.ordenar>e.ordenar?-1:0);for(const e of i)this.empresaOpcoes.push({label:e.apelido,value:e.idContato})}await this.atualizar({buscarDadosRecentes:!0}),this.$route.params.id&&this.$route.params.id.length&&this.abrirItem(this.$route.params.id)}},ye={id:"ContratosLista"},ke={class:"mw80 text-center"},Ve={class:"q-mt-sm"};function xe(i,e,m,f,a,s){const C=v("campo"),w=v("BadgeCopiarUid"),_=v("avatar"),r=v("badge"),V=v("Lista"),p=v("ContratoFicha");return u(),A("div",ye,[o(V,{ref:"contratosLista",busca:a.busca,"onUpdate:busca":e[11]||(e[11]=l=>a.busca=l),checkBox:a.checkBox,"onUpdate:checkBox":e[12]||(e[12]=l=>a.checkBox=l),onAtualizar:s.atualizar,onCriarClick:s.criarClick,onRemoverClick:s.removerTodos,onCheckBoxClick:s.checkBoxClick,onLimparFiltrosClick:s.limparFiltrosClick,lista:a.lista,tabs:a.tabs,tabSelecionada:a.tabSelecionada,paginacao:a.paginacao,mostrar:a.mostrar},{menuExtras:t(()=>[o(S,{onClick:e[0]||(e[0]=l=>s.gerarLoteNFSe()),clickable:""},{default:t(()=>[o(b,{avatar:""},{default:t(()=>[o(Z,{name:"mdi-file-replace",size:"sm"})]),_:1}),o(b,null,{default:t(()=>e[13]||(e[13]=[d("Gerar notas de servi\xE7o")])),_:1})]),_:1})]),filtroCampos:t(()=>[o(H,{modelValue:a.empresa,"onUpdate:modelValue":e[1]||(e[1]=l=>a.empresa=l),options:a.empresaOpcoes,clearable:"",dense:"",label:"Por empresa",class:"q-mb-xl"},null,8,["modelValue","options"]),o(C,{modelValue:a.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[2]||(e[2]=l=>a.filtros.periodoEmissao.ini=l),rotulo:"Data emiss\xE3o",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),o(C,{modelValue:a.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[3]||(e[3]=l=>a.filtros.periodoEmissao.fim=l),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),o(C,{modelValue:a.filtros.periodoFinalizado.ini,"onUpdate:modelValue":e[4]||(e[4]=l=>a.filtros.periodoFinalizado.ini=l),rotulo:"Data finalizado",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),o(C,{modelValue:a.filtros.periodoFinalizado.fim,"onUpdate:modelValue":e[5]||(e[5]=l=>a.filtros.periodoFinalizado.fim=l),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),o(H,{modelValue:a.sort,"onUpdate:modelValue":e[6]||(e[6]=l=>a.sort=l),options:a.sortOpcoes,dense:"",label:"Ordenar por",class:"q-mb-xs"},null,8,["modelValue","options"]),o(H,{modelValue:a.order,"onUpdate:modelValue":e[7]||(e[7]=l=>a.order=l),options:a.orderOpcoes,dense:"",label:"Crescente/Decrescente",class:"q-mb-xl"},null,8,["modelValue","options"]),o(C,{modelValue:a.paginacao.limite,"onUpdate:modelValue":e[8]||(e[8]=l=>a.paginacao.limite=l),rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",min:"1",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:t(()=>[o(U,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:t(()=>[(u(!0),A(O,null,M(a.lista,l=>(u(),A("div",{key:l.id,class:"itemHover"},[o(S,{class:"items-center d-flex q-pa-xs",clickable:""},{default:t(()=>[o(b,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:t(()=>[o(S,{class:"q-pa-none"},{default:t(()=>[o(b,{side:"",class:"col-auto q-pa-none"},{default:t(()=>[o(K,{modelValue:a.listaLayout[l.id].remover,"onUpdate:modelValue":h=>a.listaLayout[l.id].remover=h,onClick:e[9]||(e[9]=h=>s.verificarCheckbox())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(b,{side:"",class:"col-auto q-pa-none"},{default:t(()=>[L("div",ke,[o(w,{id:l.id,numero:l.numero,cor:l.status==="Ativo"?"positive":"tertiary",class:"q-mr-sm hideonmobile"},null,8,["id","numero","cor"])])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(b,{class:"col no-margin"},{default:t(()=>[o(S,{class:"q-pa-none"},{default:t(()=>[o(b,{onClick:h=>s.abrirItem(l.id),class:"col-auto items-center"},{default:t(()=>[o(_,{rotulo:l.descricaoContato,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["rotulo"]),o(K,{modelValue:a.listaLayout[l.id].remover,"onUpdate:modelValue":h=>a.listaLayout[l.id].remover=h,onClick:e[10]||(e[10]=h=>s.verificarCheckbox()),class:"hideondesktop q-mt-md"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onClick"]),o(b,{onClick:h=>s.abrirItem(l.id),class:"col"},{default:t(()=>[l.descricaoContato?(u(),c(T,{key:0,lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[d(I(l.descricaoContato)+" ",1),o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[14]||(e[14]=[d("Descri\xE7\xE3o")])),_:1})]),_:2},1024)):g("",!0),l.codigoDocumento?(u(),c(T,{key:1,caption:"",lines:"1",class:"text-tertiary ellipsis hideonmobile"},{default:t(()=>[o(r,{rotulo:"#"+l.codigoDocumento,cor:"light",class:"q-mr-xs"},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[15]||(e[15]=[d("C\xF3digo Documento")])),_:1})]),_:2},1032,["rotulo"])]),_:2},1024)):g("",!0),o(b,{class:"hideondesktop q-mt-sm"},{default:t(()=>[L("div",null,[o(w,{id:l.id,numero:l.numero,cor:l.status==="Ativo"?"positive":"tertiary",class:"q-mr-sm"},null,8,["id","numero","cor"]),o(r,{rotulo:"#"+l.codigoDocumento,cor:"light",class:"q-mr-sm"},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[16]||(e[16]=[d("C\xF3digo Documento")])),_:1})]),_:2},1032,["rotulo"])]),L("div",Ve,[l.dataHoraEmissao?(u(),c(r,{key:0,rotulo:i.$filters.data(l.dataHoraEmissao),escuro:"",icone:"today",cor:"tertiary",class:"q-mr-xs"},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[17]||(e[17]=[d("Data Emiss\xE3o")])),_:1})]),_:2},1032,["rotulo"])):g("",!0),l.dataHoraFinalizado?(u(),c(r,{key:1,rotulo:i.$filters.data(l.dataHoraFinalizado),escuro:"",icone:"today",cor:"tertiary"},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[18]||(e[18]=[d("Data Finaliza\xE7\xE3o")])),_:1})]),_:2},1032,["rotulo"])):g("",!0)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),W(o(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:t(()=>[l.status?(u(),c(ne,{key:0,class:"col-auto q-mx-auto q-py-xs",color:l.status==="Ativo"?"primary":"tertiary"},{default:t(()=>[d(I(l.status)+" ",1),o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[19]||(e[19]=[d("Status")])),_:1})]),_:2},1032,["color"])):g("",!0)]),_:2},1032,["onClick"]),[[de,a.tabSelecionada.valor!="Ativos"&&a.tabSelecionada.valor!="Cancelados"]]),o(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:t(()=>[l.dataHoraEmissao?(u(),c(r,{key:0,rotulo:i.$filters.data(l.dataHoraEmissao),icone:"today",cor:"transparent",class:"col-auto q-mx-auto q-py-xs"},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[20]||(e[20]=[d("Data Emiss\xE3o")])),_:1})]),_:2},1032,["rotulo"])):g("",!0)]),_:2},1032,["onClick"]),o(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:t(()=>[l.dataHoraFinalizado?(u(),c(r,{key:0,rotulo:i.$filters.data(l.dataHoraFinalizado),icone:"today",cor:"transparent",class:"col-auto q-mx-auto q-py-xs"},{default:t(()=>[o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[21]||(e[21]=[d("Data Finaliza\xE7\xE3o")])),_:1})]),_:2},1032,["rotulo"])):g("",!0)]),_:2},1032,["onClick"]),o(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw140 q-pl-sm no-margin"},{default:t(()=>[o(T,{class:"text-tertiary text-weight-bold text-right"},{default:t(()=>[d(I(i.$filters.numeroZerosDireita(l.totalContrato,4,2))+" ",1),o(k,{anchor:"bottom middle",self:"center middle"},{default:t(()=>e[22]||(e[22]=[d("Valor do Contrato")])),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),o(b,{side:"",top:""},{default:t(()=>[o(S,{class:"q-pa-none"},{default:t(()=>[o(b,{class:"hideonmobile q-pr-sm no-margin"},{default:t(()=>[o(y,{onClick:h=>s.abrirItem(l.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024),o(y,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:t(()=>[o(R,null,{default:t(()=>[W((u(),c(U,{link:"","no-border":"",separator:""},{default:t(()=>[l.status==="Ativo"?(u(),c(S,{key:0,onClick:h=>s.removerItem(l),clickable:""},{default:t(()=>[o(b,{avatar:""},{default:t(()=>[o(Z,{name:"delete"})]),_:1}),o(b,null,{default:t(()=>e[23]||(e[23]=[d("Remover")])),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)),[[ue]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(ee)]))),128))]),_:1})]),_:1},8,["busca","checkBox","onAtualizar","onCriarClick","onRemoverClick","onCheckBoxClick","onLimparFiltrosClick","lista","tabs","tabSelecionada","paginacao","mostrar"]),o(p,{onAtualizar:s.atualizar,ref:"contrato"},null,8,["onAtualizar"])])}var Ee=Y(Ce,[["render",xe]]);export{Ee as default};
