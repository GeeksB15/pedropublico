import{_ as P,bA as E,bl as u,aE as b,b1 as q,b2 as y,cR as k,r as _,o as g,n as h,f as s,w as i,h as w,j as U,i as D,k as f,E as R,I as Q,y as F,B as r,Q as T,q as B,as as z,F as O,s as H,t as m,e as V,d as N,u as I,N as A,l as M,H as K}from"./index.9b156bba.js";import{C as j}from"./Campo.7909a0e7.js";import{d as L}from"./vuedraggable.umd.7aa082d1.js";const G={components:{Campo:j,draggable:L},data(){return{empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date(E()).toDateString()),entregueFim:new Date(new Date(E()).toDateString()),fraseFiltro:"",listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeOS"},{label:"Entrega para esta semana",value:"bordaAmarelaOS"},{label:"Entrega atrasada",value:"bordaVermelhaOS"}]}},methods:{async eventoEnd(){for(const t in this.listas)for(const e of this.listas[t])if(e.status!==t){u.log("AdmOS","eventoEnd De:",e.status,"Para:",t,"codigo:",e.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.status,statusNovo:t},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(t){u.log("AdmOS","eventoConfirmaTroca",{...t}),this.$q.loading.show();try{let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(o=>{var a;return o.numeroDocumentoNacional.replace(/\D/g,"")===((a=$db.usuario.logado.cpf)==null?void 0:a.replace(/\D/g,""))})),t.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await b.os.trocaStatusOnline(t),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(e){this.$q.notifyError("Erro na troca de status",e)}finally{this.$q.loading.hide()}},eventoCancelarTroca(t){u.log("AdmOS","eventoCancelarTroca",t),this.atualiza()},async empresaOpcoesCarregar(){u.log("AdmOS","empresaOpcoesCarregar()"),this.empresaOpcoes=(await b.empresa.leOnline()).map(t=>({label:t.nome,value:t.codigoContato}))},filtraDebounce(){q.exports.debounce(this.refazFiltro,700)()},refazFiltro(){u.log("AdmOSs","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const t=y(this.fraseFiltro.toUpperCase()).split(" ").filter(e=>e!=="");for(const e in this.listas)for(const n of this.listas[e]){const o=y(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroOS)+" ");let a=!0;for(const d of t)isNaN(Number(d))?a=a&&o.includes(d):a=a&&o.includes(" "+d+" ");this.empresaSelecionada&&(a=a&&this.empresaSelecionada===n.codigoEmpresa),n.mostra=a}},async atualiza(){try{const t=await b.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim});u.log("AdmOS","atualiza()",t.length),k(!t||!t.length,"N\xE3o h\xE1 ordens de servi\xE7o");let e=await b.configuracoes.le({nome:"vendas.os.status"});e=e.filter(o=>!["Processando","Entregue"].includes(o.texto));const n={Processando:[]};for(const o of q.exports.orderBy(e,"valor","asc").map(a=>a.texto))n[o]=[];n.Entregue=[];for(const o of t){let a="bordaVerdeOS";if(o.status==="Entregue"){if(!!o.dataHoraPrevisto&&!!o.dataHoraFinalizado){const v=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date(o.dataHoraFinalizado).toDateString())-v)/(1e3*60*60*24);a=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}}else if(o.dataHoraPrevisto){const v=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date().toDateString())-v)/(1e3*60*60*24);a=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}const d={id:o.id,codigoCompra:o.codigoCompra||"-",codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoEmpresa:o.codigoEmpresa,descricaoEmpresa:o.descricaoEmpresa,corBorda:a,dataHoraEmissao:new Date(o.dataHoraEmissao),dataHoraFinalizado:new Date(o.dataHoraFinalizado),dataHoraRetorno:new Date(o.dataHoraRetorno),dataHoraPrevisto:new Date(o.dataHoraPrevisto),mostra:!0,nomeCliente:o.nomeCliente||"-",nomeResponsavel:o.nomeResponsavel||"-",numeroVenda:o.numeroVenda||"-",numeroOS:o.numeroOS||"-",status:o.status};n[o.status]&&n[o.status].push(d)}this.listas=n,this.refazFiltro()}catch(t){this.$q.notifyError("Erro na consulta online de oss",t)}}},watch:{entregueInicio(){u.log("AdmOSs","entregueInicio"),this.atualiza()},entregueFim(){u.log("AdmOSs","entregueFim"),this.atualiza()}},created(){u.log("AdmOSs","created()"),this.atualiza()}},X={id:"Kanban"},J={class:"filters row q-pa-sm q-ma-md bg-white",style:{"border-radius":"5px","min-height":"50px"}},W={class:"col-auto"},Y={class:"col-10 col-md-5 q-ml-sm"},Z={class:"col-6 col-md q-pl-none"},$={class:"col-6 col-md q-pl-none"},ee={class:"row overflowXOS"},ae={class:"bg-white q-pa-xs"},oe={key:0,class:"row"},te={class:"col-12 q-pl-none"},se={style:{display:"block"}},re={style:{display:"block"}},ne=r("br",null,null,-1),le=r("br",null,null,-1),ie=r("br",null,null,-1),de=r("br",null,null,-1);function ce(t,e,n,o,a,d){const v=_("barraTopo"),S=_("campo"),p=_("draggable"),x=_("OS-trocar-status");return g(),h("div",X,[s(R,{elevated:"",class:"bg-gradiente text-white"},{default:i(()=>[s(v),s(w,{class:"q-px-sm"},{default:i(()=>[s(U,{name:"view_week",size:"sm"}),s(D,null,{default:i(()=>[f("Kanban")]),_:1})]),_:1})]),_:1}),s(K,null,{default:i(()=>[s(Q,null,{default:i(()=>[s(F,{class:"row no-shadow"},{default:i(()=>[s(w,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(D,{class:"q-pa-none"},{default:i(()=>[r("div",J,[r("div",W,[s(T,{icon:"filter_list",round:"",color:"tertiary",class:"no-shadow u-semClique"})]),r("div",Y,[s(B,{modelValue:a.fraseFiltro,"onUpdate:modelValue":[e[0]||(e[0]=c=>a.fraseFiltro=c),d.filtraDebounce],debounce:500,placeholder:"Filtrar cliente ou respons\xE1vel"},null,8,["modelValue","onUpdate:modelValue"])]),r("div",Z,[s(z,{modelValue:a.prazoSelecionado,"onUpdate:modelValue":e[1]||(e[1]=c=>a.prazoSelecionado=c),options:a.prazoOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por prazo"},null,8,["modelValue","options"])]),r("div",$,[s(z,{modelValue:a.empresaSelecionada,"onUpdate:modelValue":[e[2]||(e[2]=c=>a.empresaSelecionada=c),d.refazFiltro],onClick:d.empresaOpcoesCarregar,options:a.empresaOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por empresa"},null,8,["modelValue","onClick","onUpdate:modelValue","options"])])])]),_:1})]),_:1})]),_:1}),r("div",ee,[(g(!0),h(O,null,H(a.listas,(c,C)=>(g(),h("div",{key:C,class:"no-shadow q-pa-sm col"},[r("div",ae,[s(w,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(D,{class:"q-py-none"},{default:i(()=>[f(m(C),1)]),_:2},1024)]),_:2},1024),C==="Entregue"?(g(),h("div",oe,[r("div",te,[s(S,{modelValue:a.entregueInicio,"onUpdate:modelValue":e[3]||(e[3]=l=>a.entregueInicio=l),class:"q-mx-sm",rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),s(S,{modelValue:a.entregueFim,"onUpdate:modelValue":e[4]||(e[4]=l=>a.entregueFim=l),class:"q-mx-sm",rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])):V("",!0),s(p,{onEnd:d.eventoEnd,list:c,draggable:".extratoOS",delay:"400",group:"osGroup",class:"dragAreaOS bg-white"},{default:i(()=>[t.os.mostra&&(a.prazoSelecionado===null||a.prazoSelecionado===t.os.corBorda)?(g(!0),h(O,{key:0},H(c,l=>(g(),N(F,{key:l.codigoDocumento,class:I([l.corBorda,"q-pa-sm q-mb-md shadow-2 extratoOS"])},{default:i(()=>[s(A,{class:"q-py-none"},{right:i(()=>[r("div",null,[r("small",se,"Venda: "+m(l.numeroVenda),1),r("small",re,"OS: "+m(l.numeroOS),1)])]),default:i(()=>[f(m(l.nomeCliente)+" ",1),r("span",null,"Empresa: "+m(l.descricaoEmpresa),1)]),_:2},1024),s(M,{class:"q-my-sm"}),s(A,{class:"row q-py-none"},{default:i(()=>[f(" T\xE9cnico: "+m(l.nomeResponsavel)+" ",1),ne,f(" Data de Emissao: "+m(t.$filters.data(l.dataHoraEmissao))+" ",1),le,l.dataHoraRetorno?(g(),h(O,{key:0},[f(" Data de Retorno: "+m(t.$filters.data(l.dataHoraRetorno))+" ",1),ie],64)):V("",!0),f(" Previs\xE3o de Entrega: "+m(t.$filters.data(l.dataHoraPrevisto))+" ",1),de]),_:2},1024)]),_:2},1032,["class"]))),128)):V("",!0)]),_:2},1032,["onEnd","list"])])]))),128))])]),_:1})]),_:1}),s(x,{modelValue:a.trocarStatusModal,"onUpdate:modelValue":e[5]||(e[5]=c=>a.trocarStatusModal=c),dados:a.trocarStatusDados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"])])}var ge=P(G,[["render",ce]]);export{ge as default};
