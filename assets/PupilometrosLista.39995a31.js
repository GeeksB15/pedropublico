import{_ as M,r as y,as as B,o as b,d as g,w as o,f as e,L as Q,D as I,E as J,h as j,Q as _,e as w,i as H,k,t as F,H as $,I as G,G as N,q as K,n as D,F as A,s as z,aq as S,R as L,x as q,S as f,j as P,T as x,bD as W,C as R,en as X,ax as E,O as T,M as U,B as Y,l as Z}from"./index.129a5639.js";import{L as ee}from"./Lista.0485e31d.js";import"./QBtnDropdown.549d789e.js";import"./QBtnGroup.dde1c940.js";import"./QScrollArea.93b95b42.js";const v={habilitarSalvar:!0,habilitarVoltar:!0,idContato:"",somenteLeitura:!1,titulo:"Contato",visivel:!1},oe={computed:{dataAberturaLabel(){return this.ehCPF?"Data Nascimento":this.ehCNPJ?"Data Abertura":"Data Nascimento/Data Abertura"},ehCPF(){var l;return((l=this.contato.numeroDocumentoNacional)==null?void 0:l.length)===14},ehCNPJ(){var l;return((l=this.contato.numeroDocumentoNacional)==null?void 0:l.length)===18},numeroDocumentoNacionalLabel(){return this.ehCPF?"CPF":this.ehCNPJ?"CNPJ":"CPF/CNPJ"},numeroDocumentoEstadualLabel(){return this.ehCPF?"RG":this.ehCNPJ?"Inscri\xE7\xE3o Estadual":"RG/IE"}},data(){return{contato:{},contatoCompletoOriginal:{},contatoEnderecos:[],contatoTelefones:[],enderecoTipos:[{label:"Principal",value:"Principal",icon:"star",color:"orange"},{label:"Cobran\xE7a",value:"Cobran\xE7a",icon:"attach_money"},{label:"Comercial",value:"Comercial",icon:"business"},{label:"Correspond\xEAncia",value:"Correspond\xEAncia",icon:"mail"},{label:"Entrega",value:"Entrega",icon:"local_shipping"},{label:"Instala\xE7\xE3o",value:"Instala\xE7\xE3o",icon:"build"},{label:"Residencial",value:"Residencial",icon:"store_mall_directory"},{label:"Outros",value:"Outros",icon:"location_city"}],model:{},telefoneTipos:[{label:"Principal",value:"Principal",color:"orange",icon:"star"},{label:"Comercial",value:"Comercial",color:"dark",icon:"phone"},{label:"Celular",value:"Celular",color:"dark",icon:"phone_iphone"},{label:"Fixo",value:"Fixo",color:"dark",icon:"phone"},{label:"WhatsApp",value:"WhatsApp",color:"positive",icon:"mdi-whatsapp",ix:"duo"}],validationRules:{}}},emits:["evento","fecharTelas"],props:{modelValue:{type:Object,required:!0}},methods:{adicionarEndereco(){const l={id:$utils.uuid(),idContato:this.contato.id};this.contatoEnderecos.push(l),console.log(this.contatoEnderecos)},adicionarTelefone(){const l={id:$utils.uuid(),idContato:this.contato.id};this.contatoTelefones.push(l)},cfgValidationRules(){this.validationRules={required:[l=>!!l||"Campo obrigat\xF3rio"],numeroDocumentoNacional:[()=>{const l=(this.contato.numeroDocumentoNacional||"").replace(/\D/g,"");return l.trim()?$utils.validarDocumentoNacional(l)?!0:"Documento inv\xE1lido":!0}]}},async ehDocumentoNacionalExistente(){var l,t;for(const d of $db.contato.contatos){if(d.id===this.contato.id)continue;const h=(l=d.numeroDocumentoNacional)==null?void 0:l.replace(/\D/g,"");if(!!h&&((t=this.contato.numeroDocumentoNacional)==null?void 0:t.replace(/\D/g,""))===h)return new Promise((a,n)=>{$q.dialog({title:"Contato encontrado. Deseja utiliz\xE1-lo?",message:`
                <div style="width:40px;text-align:right;font-weight:bold;display:inline-block;margin-right:10px;">Nome</div>
                ${d.nome}
                <br />
                <div style="width:40px;text-align:right;font-weight:bold;display:inline-block;margin-right:10px;">${this.ehCPF?"CPF":"CNPJ"}</div>
                ${d.numeroDocumentoNacional}
              `,persistent:!0,html:!0,cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-info",textColor:"white",flat:!0}}).onOk(()=>{a(!0),this.$emit("evento","contatoEncontrado",d.id)}).onCancel(()=>{a(!0)})})}},enderecoIcone(l){const t=this.enderecoTipos.find(d=>d.label===l)||{};return{color:t.color||"dark",name:t.icon||"store_mall_directory",size:l==="Principal"?"18px":"24px"}},removerEndereco(l){this.contatoEnderecos=this.contatoEnderecos.filter(t=>t.id!==l)},removerTelefone(l){this.contatoTelefones=this.contatoTelefones.filter(t=>t.id!==l)},async salvar(){if(!!this.model.habilitarSalvar&&!await this.ehDocumentoNacionalExistente())try{$q.loading.show({message:"Salvando contato...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),await $db.contato.gravar({atual:{...this.contatoCompletoOriginal,contato:this.contato,telefone:this.contatoTelefones,endereco:this.contatoEnderecos},original:this.contatoCompletoOriginal}),this.$emit("evento","sucessoAoSalvar",this.contato.id),this.$q.notify({message:"Contato salvo",type:"positive"})}catch{this.$q.notify({message:"N\xE3o foi poss\xEDvel salvar o contato",type:"negative"})}finally{$q.loading.hide()}},async setup(){var a,n,c,r,m,p,C,s,i,u,O;const l={habilitarVoltar:(n=(a=this.modelValue)==null?void 0:a.habilitarVoltar)!=null?n:v==null?void 0:v.habilitarVoltar,somenteLeitura:(r=(c=this.modelValue)==null?void 0:c.somenteLeitura)!=null?r:v==null?void 0:v.somenteLeitura,titulo:(p=(m=this.modelValue)==null?void 0:m.titulo)!=null?p:v==null?void 0:v.titulo,visivel:(s=(C=this.modelValue)==null?void 0:C.visivel)!=null?s:v==null?void 0:v.visivel,habilitarSalvar:(u=(i=this.modelValue)==null?void 0:i.habilitarSalvar)!=null?u:v==null?void 0:v.habilitarSalvar};let t,d,h;if(l.habilitarSalvar=!l.somenteLeitura&&l.habilitarSalvar,(O=this.modelValue)!=null&&O.idContato){const V=await $db.contato.leCompletoV3(this.modelValue.idContato);this.contatoCompletoOriginal=$utils.clonarV2(V),t=V==null?void 0:V.contato,d=V==null?void 0:V.telefone,h=V==null?void 0:V.endereco}this.contato=t!=null?t:{id:$utils.uuid(),ativo:!0},this.contatoTelefones=d!=null?d:[],this.contatoEnderecos=h!=null?h:[],this.cfgValidationRules(),this.model=l},voltar(){!this.model.habilitarVoltar||(this.model.visivel=!1)},async btFechar(){!await $q.dialogSimNao({title:"Fechar pupil\xF4metro",message:"Ao continuar voc\xEA ir\xE1 perder os dados inseridos."})||(this.$emit("fecharTelas","fechar"),this.model.visivel=!1)}},watch:{modelValue(){this.setup()}},created(){this.setup()}};function te(l,t,d,h,a,n){const c=y("BadgeCopiarUid"),r=y("g-col"),m=y("campo"),p=y("g-row"),C=y("g-label"),s=B("mask");return b(),g(R,{modelValue:a.model.visivel,"onUpdate:modelValue":t[7]||(t[7]=i=>a.model.visivel=i),onKeyup:W(n.voltar,["esc"]),maximized:"",persistent:""},{default:o(()=>[e(Q,{container:"",view:"hHh LpR fFf",class:"bg-light"},{default:o(()=>[e(I,{onSubmit:n.salvar},{default:o(()=>[e(J,null,{default:o(()=>[e(j,{class:"bg-primary text-white q-px-sm"},{default:o(()=>[a.model.habilitarVoltar?(b(),g(_,{key:0,onClick:t[0]||(t[0]=i=>n.voltar()),icon:"arrow_back",round:"",flat:"",dense:""})):w("",!0),e(H,null,{default:o(()=>[k(F(a.model.titulo),1)]),_:1}),e(_,{onClick:t[1]||(t[1]=i=>n.btFechar()),icon:"close",round:"",flat:"",dense:""}),a.model.habilitarSalvar?(b(),g(_,{key:1,unelevated:"",label:"Salvar",type:"submit",color:"white","text-color":"primary",class:"q-ml-sm"})):w("",!0)]),_:1})]),_:1}),e($,null,{default:o(()=>[e(G,{class:"u-container"},{default:o(()=>[e(p,{gutter:"md",mg:"md-y",bg:"bg-white","rounded-borders":""},{default:o(()=>[e(r,{col:"12",text:"right"},{default:o(()=>[e(c,{id:a.contato.id,numero:a.contato.codigoContato,cor:"positive"},null,8,["id","numero"])]),_:1}),e(r,{col:"12"},{default:o(()=>[e(m,{modelValue:a.contato.apelido,"onUpdate:modelValue":t[2]||(t[2]=i=>a.contato.apelido=i),somenteLeitura:a.model.somenteLeitura,rotulo:"Apelido",dense:""},null,8,["modelValue","somenteLeitura"])]),_:1}),e(r,{col:"12"},{default:o(()=>[e(m,{modelValue:a.contato.nome,"onUpdate:modelValue":t[3]||(t[3]=i=>a.contato.nome=i),somenteLeitura:a.model.somenteLeitura,rules:a.validationRules.required,rotulo:"Nome completo",dense:""},null,8,["modelValue","somenteLeitura","rules"])]),_:1}),e(r,{col:"12 sm"},{default:o(()=>[N(e(K,{label:n.numeroDocumentoNacionalLabel,class:"q-pb-xs",modelValue:a.contato.numeroDocumentoNacional,"onUpdate:modelValue":t[4]||(t[4]=i=>a.contato.numeroDocumentoNacional=i),dense:"",rules:a.validationRules.numeroDocumentoNacional,onBlur:n.ehDocumentoNacionalExistente,readonly:a.model.somenteLeitura},null,8,["label","modelValue","rules","onBlur","readonly"]),[[s,["###.###.###-##","##.###.###/####-##"]]])]),_:1}),e(r,{col:"12 sm"},{default:o(()=>[e(m,{modelValue:a.contato.numeroDocumentoEstadual,"onUpdate:modelValue":t[5]||(t[5]=i=>a.contato.numeroDocumentoEstadual=i),rotulo:n.numeroDocumentoEstadualLabel,dense:"",somenteLeitura:a.model.somenteLeitura},null,8,["modelValue","rotulo","somenteLeitura"])]),_:1}),e(r,{col:"12 sm"},{default:o(()=>[e(m,{modelValue:a.contato.dataAbertura,"onUpdate:modelValue":t[6]||(t[6]=i=>a.contato.dataAbertura=i),rotulo:n.dataAberturaLabel,dense:"",somenteLeitura:a.model.somenteLeitura},null,8,["modelValue","rotulo","somenteLeitura"])]),_:1})]),_:1}),e(p,{gutter:"md",mg:"md-b",bg:"bg-white","rounded-borders":""},{default:o(()=>[e(r,{col:"12"},{default:o(()=>[e(C,{text:"h6"},{default:o(()=>t[8]||(t[8]=[k("Telefones")])),_:1})]),_:1}),e(r,{col:"12"},{default:o(()=>[(b(!0),D(A,null,z(a.contatoTelefones,i=>(b(),g(p,{key:i.id,gutter:"md",items:"center",mg:"md-b",bordered:"","rounded-borders":""},{default:o(()=>[e(r,{col:"12 sm"},{default:o(()=>[e(S,{modelValue:i.tipoTelefone,"onUpdate:modelValue":u=>i.tipoTelefone=u,readonly:a.model.somenteLeitura,options:a.telefoneTipos,"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",label:"Tipo"},{before:o(()=>[e(_,{flat:"",round:"",icon:(a.telefoneTipos.find(u=>u.value===i.tipoTelefone)||{}).icon||"star",color:"tertiary",size:"sm"},null,8,["icon"])]),option:o(u=>[e(L,q({ref_for:!0},u.itemProps),{default:o(()=>[e(f,{avatar:""},{default:o(()=>[e(P,{name:u.opt.icon},null,8,["name"])]),_:2},1024),e(f,null,{default:o(()=>[e(x,{innerHTML:u.opt.label},null,8,["innerHTML"])]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","readonly","options"])]),_:2},1024),e(r,{col:"12 sm"},{default:o(()=>[e(m,{modelValue:i.telefone,"onUpdate:modelValue":u=>i.telefone=u,rotulo:"Telefone",dense:"",somenteLeitura:a.model.somenteLeitura},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"grow sm"},{default:o(()=>[e(m,{modelValue:i.observacao,"onUpdate:modelValue":u=>i.observacao=u,rotulo:"Observa\xE7\xE3o",dense:"",somenteLeitura:a.model.somenteLeitura},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),a.model.somenteLeitura?w("",!0):(b(),g(r,{key:0,col:"shrink",text:"center"},{default:o(()=>[e(_,{onClick:u=>n.removerTelefone(i.id),icon:"delete",size:"md",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024))]),_:2},1024))),128))]),_:1}),a.model.somenteLeitura?w("",!0):(b(),g(r,{key:0,col:"12",text:"center",mg:"md-t-ng"},{default:o(()=>[e(_,{onClick:n.adicionarTelefone,icon:"add",label:"Telefone",size:"sm",outline:"",color:"positive"},null,8,["onClick"])]),_:1}))]),_:1}),e(p,{gutter:"md",mg:"md-b",bg:"bg-white","rounded-borders":""},{default:o(()=>[e(r,{col:"12"},{default:o(()=>[e(C,{text:"h6"},{default:o(()=>t[9]||(t[9]=[k("Endere\xE7os")])),_:1})]),_:1}),e(r,{col:"12"},{default:o(()=>[(b(!0),D(A,null,z(a.contatoEnderecos,i=>(b(),g(p,{key:i.id,gutter:"md",items:"center",mg:"md-b",bordered:"","rounded-borders":""},{default:o(()=>[e(r,{col:"12 md3"},{default:o(()=>[e(S,{modelValue:i.grupo,"onUpdate:modelValue":u=>i.grupo=u,readonly:a.model.somenteLeitura,options:a.enderecoTipos,"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",label:"Grupo"},{before:o(()=>[e(P,q({ref_for:!0},n.enderecoIcone(i.grupo),{color:"tertiary",size:"xs",class:"q-mx-xs"}),null,16)]),option:o(u=>[e(L,q({ref_for:!0},u.itemProps),{default:o(()=>[e(f,{avatar:""},{default:o(()=>[e(P,{name:u.opt.icon},null,8,["name"])]),_:2},1024),e(f,null,{default:o(()=>[e(x,{innerHTML:u.opt.label},null,8,["innerHTML"])]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","readonly","options"])]),_:2},1024),e(r,{col:"12 sm4 md3"},{default:o(()=>[e(m,{modelValue:i.cep,"onUpdate:modelValue":u=>i.cep=u,somenteLeitura:a.model.somenteLeitura,rotulo:"CEP",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"2 sm2 md2"},{default:o(()=>[e(m,{modelValue:i.uf,"onUpdate:modelValue":u=>i.uf=u,somenteLeitura:a.model.somenteLeitura,rotulo:"UF",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"10 sm6 md4"},{default:o(()=>[e(m,{modelValue:i.municipio,"onUpdate:modelValue":u=>i.municipio=u,somenteLeitura:a.model.somenteLeitura,rotulo:"Munic\xEDpio",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"12 sm9 md7"},{default:o(()=>[e(m,{modelValue:i.logradouro,"onUpdate:modelValue":u=>i.logradouro=u,somenteLeitura:a.model.somenteLeitura,rotulo:"Logradouro",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"12 sm3 md2"},{default:o(()=>[e(m,{modelValue:i.numero,"onUpdate:modelValue":u=>i.numero=u,somenteLeitura:a.model.somenteLeitura,rotulo:"N\xFAmero",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"12 sm6 md3"},{default:o(()=>[e(m,{modelValue:i.complemento,"onUpdate:modelValue":u=>i.complemento=u,somenteLeitura:a.model.somenteLeitura,rotulo:"Complemento",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"12 sm6 md6"},{default:o(()=>[e(m,{modelValue:i.bairro,"onUpdate:modelValue":u=>i.bairro=u,somenteLeitura:a.model.somenteLeitura,rotulo:"Bairro",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),e(r,{col:"grow md"},{default:o(()=>[e(m,{modelValue:i.pais,"onUpdate:modelValue":u=>i.pais=u,somenteLeitura:a.model.somenteLeitura,rotulo:"Pa\xEDs",dense:""},null,8,["modelValue","onUpdate:modelValue","somenteLeitura"])]),_:2},1024),a.model.somenteLeitura?w("",!0):(b(),g(r,{key:0,col:"shrink",text:"center"},{default:o(()=>[e(_,{onClick:u=>n.removerEndereco(i.id),icon:"delete",size:"md",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024))]),_:2},1024))),128))]),_:1}),a.model.somenteLeitura?w("",!0):(b(),g(r,{key:0,col:"12",text:"center",mg:"md-t-ng"},{default:o(()=>[e(_,{onClick:n.adicionarEndereco,icon:"add",label:"Endere\xE7o",size:"sm",outline:"",color:"positive"},null,8,["onClick"])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue","onKeyup"])}var ae=M(oe,[["render",te]]);const le={components:{Lista:ee,Pupilometro:X,ModalCriarContatoCompleto:ae},data(){return{lista:[],pupilometro:{},propsModalCriarContatoCompleto:{},mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"mdi-eye-settings-outline",titulo:"Pupil\xF4metro",buscar:!0,filtroAvancado:!1,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!1,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},busca:null,buscaAnterior:null,paginacao:null}},methods:{async irParaAtendimento(l){var h,a;const t=/^idEnvelope:/.test(l.referencia)?(h=l.referencia)==null?void 0:h.replace(/^idEnvelope:/,""):null;let d=/^idContato:/.test(l.referencia)?(a=l.referencia)==null?void 0:a.replace(/^idContato:/,""):null;if(t){const n=await $db.hibrido.le({table:"documento",id:t});d=n==null?void 0:n.idContato}this.$router.push({name:"Atendimento",params:{id:d||"0"}})},async abrir(l){$db.pupilometro.limpar();const t=async d=>{$db.pupilometro[d]=await $db.pupilometro.leFoto({id:l.id,tipoFoto:d})};await Promise.all([t("foto"),t("fotoOriginal")]),$db.pupilometro.medidas=l.json.medidas,this.pupilometro={visivel:!1,somenteLeitura:!0,avancar:"CartaoMedidas"},$db.pupilometro.medidas.tipo!=="Cart\xE3o"&&(this.pupilometro.avancar="Medidas"),this.pupilometro.visivel=!0},async atualizar(){var t,d;const l=$utils.logarIni("Pupil\xF4metroListar");await $tryLoading(async()=>{$db.hibrido.isOnline()?await this.atualizarOnline():await this.atualizarOffline(),this.atualizarFotosOnline()}),$utils.logarFim(l,(d=(t=this.paginacao)==null?void 0:t.total)!=null?d:1)},async atualizarOffline(){var l,t,d,h;try{$q.loading.show({message:"Carregando...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});let a,n;(!this.paginacao||this.busca!==this.buscaAnterior)&&(this.buscaAnterior=this.busca,this.paginacao={atual:1,maximo:1,total:1,limite:15}),a=await $db.pupilometro.ler({termoBusca:this.busca,recordsPerPage:this.paginacao.limite,page:this.paginacao.atual}),this.paginacao.maximo=a.totalPages,this.paginacao.total=a.totalRecords,n=a.result;for(const c of n){let r,m,p,C,s;if(c.json=(t=JSON.parse((l=c.json)!=null?l:null))!=null?t:{},c.nome="Contato n\xE3o identificado",r=/^idEnvelope:/.test(c.referencia)?(d=c.referencia)==null?void 0:d.replace(/^idEnvelope:/,""):null,m=/^idContato:/.test(c.referencia)?(h=c.referencia)==null?void 0:h.replace(/^idContato:/,""):null,!(!r&&!m)){if(r){if(p=await $db.hibrido.le({table:"documento",id:r}),!(p!=null&&p.idContato))continue;m=p.idContato}C=(await $db.contato.ler({filtros:{id:m}})).data,s=C[0],s!=null&&s.nome&&(c.nome=s.nome)}}this.lista=n.sort((c,r)=>c.dataModificacao>r.dataModificacao?-1:1)}catch(a){console.log(a.message)}finally{$q.loading.hide()}},async atualizarOnline(){var l,t,d,h;try{$q.loading.show({message:"Carregando...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});let a,n;(!this.paginacao||this.busca!==this.buscaAnterior)&&(this.buscaAnterior=this.busca,this.paginacao={atual:1,maximo:1,total:1,limite:15}),a=await $db.pupilometro.leListaCompleta({termoBusca:this.busca,recordsPerPage:this.paginacao.limite,page:this.paginacao.atual}),this.paginacao.maximo=a.totalPages,this.paginacao.total=a.total,n=a.data;for(const c of n){let r,m,p,C,s;if(c.json=(t=JSON.parse((l=c.Json)!=null?l:null))!=null?t:{},c.nome="Contato n\xE3o identificado",r=/^idEnvelope:/.test(c.Referencia)?(d=c.Referencia)==null?void 0:d.replace(/^idEnvelope:/,""):null,m=/^idContato:/.test(c.Referencia)?(h=c.Referencia)==null?void 0:h.replace(/^idContato:/,""):null,!(!r&&!m)){if(r){if(p=await $db.hibrido.le({table:"documento",id:r}),!(p!=null&&p.idContato))continue;m=p.idContato}C=(await $db.contato.ler({filtros:{id:m}})).data,s=C[0],s!=null&&s.nome&&(c.nome=s.nome)}}this.lista=n.sort((c,r)=>c.dataModificacao>r.dataModificacao?-1:1)}catch(a){console.log(a.message)}finally{$q.loading.hide()}},async atualizarFotosOnline(){try{for(const l of this.lista)l.foto=await $db.pupilometro.leFoto({id:l.id,tipoFoto:"foto"})}catch{console.error("Erro ao carregar fotos da lista",error)}},async eventoModalCriarContatoCompleto(l,t){l==="sucessoAoSalvar"&&await this.salvar(t),l==="contatoEncontrado"&&await this.salvar(t)},fechar(l=""){if(l==="fechar"&&(this.pupilometro={visivel:!1}),l==="abrirContato"){if(this.pupilometro.somenteLeitura){this.pupilometro={visivel:!1};return}this.pupilometro.somenteLeitura||(this.propsModalCriarContatoCompleto={visivel:!0})}},fecharOld(){if(this.pupilometro.somenteLeitura){this.pupilometro={visivel:!1};return}this.pupilometro.somenteLeitura||(this.propsModalCriarContatoCompleto={visivel:!0})},async criarClick(l){if($db.pupilometro.limpar(),l==="Cart\xE3o"){$db.pupilometro.medidas.tipo=l,$db.pupilometro.medidas.olhoDireito.centroOlho.top=345,$db.pupilometro.medidas.olhoDireito.centroOlho.left=255,$db.pupilometro.medidas.olhoEsquerdo.centroOlho.top=345,$db.pupilometro.medidas.olhoEsquerdo.centroOlho.left=450,$db.pupilometro.medidas.nariz.top=0,$db.pupilometro.medidas.nariz.left=0,$db.pupilometro.medidas.ponte=23,this.pupilometro={visivel:!0,somenteLeitura:!1,avancar:"CartaoFoto"},await this.$nextTick(),this.$refs.pupilometro.cartaoNovo();return}$db.pupilometro.medidas.tipo="Arma\xE7\xE3o",this.pupilometro={visivel:!0,somenteLeitura:!1,avancar:"TirarFoto"}},async salvar(l){try{$q.loading.show({message:"Salvando medidas...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),this.propsModalCriarContatoCompleto={visivel:!1};const t=$utils.uuid();await $db.hibrido.grava("json",{atual:{id:t,descricao:"Pupil\xF4metro",referencia:"idContato:"+l,json:JSON.stringify({medidas:$db.pupilometro.medidas})}});try{await Promise.all([$db.pupilometro.gravaFoto({base64:$db.pupilometro.foto,idPupilometro:t,tipoFoto:"foto"}),$db.pupilometro.gravaFoto({base64:$db.pupilometro.fotoOriginal,idPupilometro:t,tipoFoto:"fotoOriginal"})])}catch(d){this.$q.notifyError("N\xE3o foi poss\xEDvel salvar a foto",d)}this.pupilometro={visivel:!1},$q.notifyPositive("Medidas salvas com sucesso"),await this.atualizar()}catch(t){this.$q.notifyError("N\xE3o foi poss\xEDvel salvar as medidas",t)}finally{$q.loading.hide()}}},created(){this.atualizar()}},ie={id:"PupilometrosLista"},re={class:"mw80 text-center"};function ne(l,t,d,h,a,n){const c=y("BadgeCopiarUid"),r=y("avatar"),m=y("Lista"),p=y("Pupilometro"),C=y("ModalCriarContatoCompleto");return b(),D("div",ie,[e(m,{busca:a.busca,"onUpdate:busca":t[4]||(t[4]=s=>a.busca=s),onAtualizar:n.atualizar,onCriarClick:n.criarClick,lista:a.lista,paginacao:a.paginacao,mostrar:a.mostrar},{botaoNovo:o(()=>[e(_,{icon:"add",label:"Novo",color:"primary","text-color":"white",unelevated:"",class:"hideonmobile"},{default:o(()=>[e(E,null,{default:o(()=>[e(T,{link:"","no-border":"",separator:""},{default:o(()=>[N((b(),g(L,{onClick:t[0]||(t[0]=s=>n.criarClick("Presencial")),clickable:""},{default:o(()=>[e(f,{avatar:""},{default:o(()=>[e(P,{name:"add"})]),_:1}),e(f,null,{default:o(()=>[e(x,null,{default:o(()=>t[7]||(t[7]=[k("Pupilometro (Arma\xE7\xE3o)")])),_:1})]),_:1})]),_:1})),[[U]]),N((b(),g(L,{onClick:t[1]||(t[1]=s=>n.criarClick("Cart\xE3o")),clickable:""},{default:o(()=>[e(f,{avatar:""},{default:o(()=>[e(P,{name:"add"})]),_:1}),e(f,null,{default:o(()=>[e(x,null,{default:o(()=>t[8]||(t[8]=[k("Pupilometro (Cart\xE3o)")])),_:1})]),_:1})]),_:1})),[[U]])]),_:1})]),_:1})]),_:1}),e(_,{icon:"add",color:"primary","text-color":"white",round:"",unelevated:"",class:"hideondesktop"},{default:o(()=>[e(E,null,{default:o(()=>[e(T,{link:"","no-border":"",separator:""},{default:o(()=>[N((b(),g(L,{onClick:t[2]||(t[2]=s=>n.criarClick("Presencial")),clickable:""},{default:o(()=>[e(f,{avatar:""},{default:o(()=>[e(P,{name:"add"})]),_:1}),e(f,null,{default:o(()=>[e(x,null,{default:o(()=>t[9]||(t[9]=[k("Pupilometro (Arma\xE7\xE3o)")])),_:1})]),_:1})]),_:1})),[[U]]),N((b(),g(L,{onClick:t[3]||(t[3]=s=>n.criarClick("Cart\xE3o")),clickable:""},{default:o(()=>[e(f,{avatar:""},{default:o(()=>[e(P,{name:"add"})]),_:1}),e(f,null,{default:o(()=>[e(x,null,{default:o(()=>t[10]||(t[10]=[k("Pupilometro (Cart\xE3o)")])),_:1})]),_:1})]),_:1})),[[U]])]),_:1})]),_:1})]),_:1})]),itemLista:o(()=>[e(T,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:o(()=>[(b(!0),D(A,null,z(a.lista,s=>(b(),D("div",{key:s.id,class:"itemHover"},[e(L,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:o(()=>[e(f,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:o(()=>[Y("div",re,[e(c,{id:s.id,numero:s.codigoJson,cor:"positive"},null,8,["id","numero"])])]),_:2},1024),e(f,{class:"col-xs no-margin"},{default:o(()=>[e(L,{class:"q-pa-none"},{default:o(()=>[e(f,{onClick:i=>n.abrir(s),class:"col-auto items-center cursor-pointer"},{default:o(()=>[s.foto?(b(),g(r,{key:0,imagem:s.foto,rotulo:s.nome,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])):w("",!0)]),_:2},1032,["onClick"]),e(f,{onClick:i=>n.abrir(s),class:"col cursor-pointer"},{default:o(()=>[e(x,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:o(()=>[k(F(s.nome),1)]),_:2},1024),e(x,{caption:"",lines:"1",class:"text-tertiary ellipsis"},{default:o(()=>[k(F(l.$filters.dataHora(s.dataCriacao)),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(f,{class:"col-auto q-pl-sm no-margin"},{default:o(()=>[e(L,{class:"q-pa-none"},{default:o(()=>[e(f,{class:"q-pr-sm no-margin"},{default:o(()=>[e(_,{onClick:i=>n.abrir(s),icon:"mdi-eye-settings-outline",size:"md",color:"tertiary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024),e(f,{class:"q-pr-sm no-margin"},{default:o(()=>[e(_,{onClick:i=>n.irParaAtendimento(s),icon:"mdi-account-switch",size:"md",color:"tertiary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(Z)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onCriarClick","lista","paginacao","mostrar"]),e(R,{modelValue:a.pupilometro.visivel,"onUpdate:modelValue":t[5]||(t[5]=s=>a.pupilometro.visivel=s),maximized:"",persistent:""},{default:o(()=>[e(Q,{class:"bg-light"},{default:o(()=>[e(p,{ref:"pupilometro",avancar:a.pupilometro.avancar,somenteLeitura:a.pupilometro.somenteLeitura,onFecharModal:n.fechar},null,8,["avancar","somenteLeitura","onFecharModal"])]),_:1})]),_:1},8,["modelValue"]),e(C,{modelValue:a.propsModalCriarContatoCompleto,"onUpdate:modelValue":t[6]||(t[6]=s=>a.propsModalCriarContatoCompleto=s),onEvento:n.eventoModalCriarContatoCompleto,onFecharTelas:n.fechar},null,8,["modelValue","onEvento","onFecharTelas"])])}var pe=M(le,[["render",ne]]);export{pe as default};
