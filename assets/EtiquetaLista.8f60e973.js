import{_ as ie,aC as we,ag as $,r as y,o as m,d as C,w as i,ax as le,f as t,O as Z,n as A,F as W,s as Y,u as Ee,G as T,R as U,S as c,T as M,k as h,t as k,B as E,e as L,Q as S,W as ue,l as se,q as xe,a9 as Se,dJ as Ve,d7 as _e,dK as Ie,dL as ke,dM as Pe,dN as Be,dO as Te,dP as Ue,dQ as Fe,ah as _,dR as de,dS as Ae,a5 as Q,aw as Ne,dT as Re,al as De,a8 as Qe,v as je,dw as Le,dU as ee,L as Me,D as ze,E as ce,h as te,i as me,j as F,U as Oe,M as oe,H as fe,I as pe,ar as He,bb as ae,J as he,aY as ge,C as Ge,dV as Je,bD as Ke,m as j}from"./index.c8ffb049.js";import"./xlsx.8a8b2b91.js";const $e={data(){return{indexSelected:-1}},methods:{addEtiqueta(a){this.$emit("addEtiqueta",a)},async buscarItens(){this.campo.isLoading=!0,await this.erpQuery(),this.campo.isLoading=!1,this.campo.searches.length>0&&(this.indexSelected=0)},async erpQuery(){const a=this.campo;await we[a.db].carregarMemoria(),this.getReceived(a.db);const e={termoBusca:a.value,ativo:!0},r=99,n=1,o=["descricaoConcatenada"],f=(await $db.item.ler({filtros:{...e},limit:r,page:n,sort:o})).data;a.searches=f,f.length>0&&(a.showing=$(!0)),a.isLoading=!1,await this.$forceUpdate()},getReceived(a){return a==="item"?"itens":this.modalConfig.received},getChaveDescricao(a){return Object.keys(a).find(e=>e.toLowerCase().match(/(descricao|nome|apelido)/))},mostrarResultados(){if(!this.campo.searches.length)return!1;setTimeout(function(){this.campo.showing=$(!0),this.$forceUpdate()},100)},selecionarProximo(a){if(!this.campo.searches.length)return!1;this.campo.showing||(this.campo.showing=!0);let e=40,r=38;return 13===a.keyCode&&(this.indexSelected=this.indexSelected===-1&&this.campo.searches.length===1?0:this.indexSelected,this.indexSelected>-1&&(this.addEtiqueta(this.campo.searches[this.indexSelected]),this.campo.value="",this.campo.searches=[])),e===a.keyCode?this.indexSelected<this.campo.searches.length-1&&this.indexSelected++:r===a.keyCode&&this.indexSelected>0&&this.indexSelected--,!0}},props:{campo:{required:!0,type:Object},filled:{default:!1,type:Boolean},outlined:{default:!1,type:Boolean},clearable:{default:!1,type:Boolean},dense:{default:!1,type:Boolean},dark:{default:!1,type:Boolean},cor:{default:"tertiary",type:String},debounce:{default:500,type:Number}}},Ze={class:"text-tertiary text-weight-bold text-caption float-right"};function We(a,e,r,n,o,d){const f=y("avatar"),p=y("badge"),x=y("BadgeCopiarUid");return m(),C(xe,{modelValue:r.campo.value,"onUpdate:modelValue":[e[1]||(e[1]=s=>r.campo.value=s),e[2]||(e[2]=s=>d.buscarItens())],onKeydown:d.selecionarProximo,onFocus:d.mostrarResultados,loading:r.campo.isLoading,debounce:r.debounce,color:r.cor,dense:r.dense,dark:r.dark,filled:r.filled,outlined:r.outlined,clearable:r.clearable,autocomplete:"off",placeholder:"C\xF3digo de barras, descri\xE7\xE3o, etc...",ref:"adicionarProduto"},{default:i(()=>[r.campo.showing?(m(),C(le,{key:0,modelValue:r.campo.showing,"onUpdate:modelValue":e[0]||(e[0]=s=>r.campo.showing=s),"no-focus":""},{default:i(()=>[t(Z,{class:"bg-white rounded-borders",style:{"min-width":"220px",width:"auto","max-width":"320px"}},{default:i(()=>[(m(!0),A(W,null,Y(r.campo.searches,(s,b)=>(m(),A("div",{key:b,class:Ee(["itemHover",{selected:o.indexSelected===b}])},[T((m(),C(U,{"manual-focus":"",class:"q-pa-sm items-center"},{default:i(()=>[t(c,{class:"col-shrink items-center"},{default:i(()=>[t(f,{imagem:s.imagem,rotulo:s.descricaoConcatenada,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1024),t(c,{class:"col"},{default:i(()=>[t(M,{caption:"",lines:"2",class:"text-tertiary text-weight-medium ellipsis-2-lines"},{default:i(()=>[h(k(s[d.getChaveDescricao(s)]),1)]),_:2},1024),t(c,{caption:"",class:"q-pt-xs no-margin"},{default:i(()=>[E("div",null,[s!=null&&s.referencia?(m(),C(p,{key:0,escuro:"",cor:"tertiary",rotulo:s==null?void 0:s.referencia,class:"q-mr-xs"},null,8,["rotulo"])):L("",!0),s!=null&&s.codigoBarras?(m(),C(p,{key:1,cor:"light",rotulo:s==null?void 0:s.codigoBarras,class:"q-mr-xs"},null,8,["rotulo"])):L("",!0)])]),_:2},1024),t(c,{class:"q-pt-xs no-margin"},{default:i(()=>[E("div",null,[t(x,{id:s==null?void 0:s.id,numero:s==null?void 0:s.codigoItem,escuro:"",cor:s!=null&&s.ativo?"positive":"tertiary",class:"q-mr-xs"},null,8,["id","numero","cor"]),E("span",Ze,k(a.$filters.numeroZerosDireita(s.valorVenda,4,2)),1)])]),_:2},1024)]),_:2},1024),t(c,{onClick:P=>d.addEtiqueta(s),class:"col-shrink"},{default:i(()=>[t(S,{icon:"mdi-tag-plus",color:"primary",flat:"",round:"",dense:""})]),_:2},1032,["onClick"])]),_:2},1024)),[[ue]]),t(se)],2))),128))]),_:1})]),_:1},8,["modelValue"])):L("",!0)]),_:1},8,["modelValue","onKeydown","onFocus","loading","debounce","color","dense","dark","filled","outlined","clearable"])}var Ye=ie($e,[["render",We]]),Xe=Se({name:"QFile",inheritAttrs:!1,props:{...Ve,..._e,...Ie,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ke,...Pe],setup(a,{slots:e,emit:r,attrs:n}){const{proxy:o}=De(),d=Be(),f=$(null),p=$(!1),x=Te(a),{pickFiles:s,onDragover:b,onDragleave:P,processFiles:z,getDndNode:O}=Ue({editable:d.editable,dnd:p,getFileInput:re,addFilesToQueue:ne}),H=Fe(a),g=_(()=>Object(a.modelValue)===a.modelValue?"length"in a.modelValue?Array.from(a.modelValue):[a.modelValue]:[]),G=_(()=>de(g.value)),l=_(()=>g.value.map(u=>u.name).join(", ")),q=_(()=>Ae(g.value.reduce((u,w)=>u+w.size,0))),v=_(()=>({totalSize:q.value,filesNumber:g.value.length,maxFiles:a.maxFiles})),N=_(()=>({tabindex:-1,type:"file",title:"",accept:a.accept,capture:a.capture,name:x.value,...n,id:d.targetUid.value,disabled:d.editable.value!==!0})),R=_(()=>"q-file q-field--auto-height"+(p.value===!0?" q-file--dnd":"")),B=_(()=>a.multiple===!0&&a.append===!0);function I(u){const w=g.value.slice();w.splice(u,1),D(w)}function J(u){const w=g.value.indexOf(u);w!==-1&&I(w)}function D(u){r("update:modelValue",a.multiple===!0?u:u[0])}function ve(u){u.keyCode===13&&Qe(u)}function be(u){(u.keyCode===13||u.keyCode===32)&&s(u)}function re(){return f.value}function ne(u,w){const V=z(u,w,g.value,B.value),X=re();X!=null&&(X.value=""),V!==void 0&&((a.multiple===!0?a.modelValue&&V.every(Ce=>g.value.includes(Ce)):a.modelValue===V[0])||D(B.value===!0?g.value.concat(V):V))}function K(){return[Q("input",{class:[a.inputClass,"q-file__filler"],style:a.inputStyle})]}function qe(){if(e.file!==void 0)return g.value.length===0?K():g.value.map((w,V)=>e.file({index:V,file:w,ref:this}));if(e.selected!==void 0)return g.value.length===0?K():e.selected({files:g.value,ref:this});if(a.useChips===!0)return g.value.length===0?K():g.value.map((w,V)=>Q(je,{key:"file-"+V,removable:d.editable.value,dense:!0,textColor:a.color,tabindex:a.tabindex,onRemove:()=>{I(V)}},()=>Q("span",{class:"ellipsis",textContent:w.name})));const u=a.displayValue!==void 0?a.displayValue:l.value;return u.length!==0?[Q("div",{class:a.inputClass,style:a.inputStyle,textContent:u})]:K()}function ye(){const u={ref:f,...N.value,...H.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:ne};return a.multiple===!0&&(u.multiple=!0),Q("input",u)}return Object.assign(d,{fieldClass:R,emitValue:D,hasValue:G,inputRef:f,innerValue:g,floatingLabel:_(()=>G.value===!0||de(a.displayValue)),computedCounter:_(()=>{if(a.counterLabel!==void 0)return a.counterLabel(v.value);const u=a.maxFiles;return`${g.value.length}${u!==void 0?" / "+u:""} (${q.value})`}),getControlChild:()=>O("file"),getControl:()=>{const u={ref:d.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:a.tabindex};return d.editable.value===!0&&Object.assign(u,{onDragover:b,onDragleave:P,onKeydown:ve,onKeyup:be}),Q("div",u,[ye()].concat(qe()))}}),Object.assign(o,{removeAtIndex:I,removeFile:J,getNativeElement:()=>f.value}),Ne(o,"nativeEl",()=>f.value),Re(d)}});const ea={components:{SeletorCampoTabela:Le},computed:{opcoesTipo(){return ee},totalEstoqueSaldo(){return this.estoque.reduce((a,e)=>e.saldo+a,0)},showReferencia(){return this.campos.some(a=>a.name==="referencia"&&a.show)},showCodigoBarras(){return this.campos.some(a=>a.name==="codigoBarras"&&a.show)},showMarca(){return this.campos.some(a=>a.name==="marca"&&a.show)}},data(){return{show:!1,campos:[],item:{},permissaoAjusteEstoque:!1,estoque:[],fileError:!1,rules:{referencia:[async a=>await this.verificarReferenciaExistente(a)]}}},emits:["salvarContinuar","salvar","update:modelValue"],methods:{arquivoRejeitado(){this.fileError=!0,this.item.imagem=null,clearTimeout(this.fileErrorTimeout),this.fileErrorTimeout=setTimeout(()=>{this.fileError=!1,console.log("this.fileError: ",this.fileError)},2e3)},async salvar(a){var e,r;try{$q.loading.show();const n={id:$utils.uuid(),descricaoConcatenada:this.item.descricao,descricao:this.item.descricao,...this.item.referencia?{referencia:this.item.referencia}:{},...this.item.codigoBarras?{codigoBarras:this.item.codigoBarras}:{},...this.item.marca?{marca:this.item.marca}:{},...this.item.tipo?{tipo:this.item.tipo}:{},valorCustoReposicao:(e=this.item.valorCustoReposicao)!=null?e:0,valorVenda:(r=this.item.valorVenda)!=null?r:0,ativo:!0};this.item.imagem&&(n.imagem=await(o=>new Promise((d,f)=>{const p=new FileReader;p.readAsDataURL(o),p.onload=()=>d(p.result),p.onerror=x=>f(x)}))(this.item.imagem)),await $db.item.grava({atual:n});try{for(const o of this.estoque)o.saldo>0&&await $db.item.ajusteEstoque({codigoEmpresaSelecionada:o.codigoEmpresa,idItem:n.id,custoDesejado:n.valorCustoReposicao,data:$utils.dataAtual(),lote:"",qtdeDesejada:o.saldo,qtdeDiferenca:o.saldo,qtdeMomento:0,custoMomento:0,planoConta:"146,125",planoContaEstoque:146,planoContaMovimento:125})}catch(o){console.error(o)}finally{$q.notify({type:"positive",message:"Produto gravado com sucesso"})}a.submitter.name==="salvarContinuar"?this.$emit("salvarContinuar",n.id,this.totalEstoqueSaldo):(this.show=!1,this.$emit("salvar",n.id,this.totalEstoqueSaldo))}catch(n){$q.notify({type:"negative",message:"N\xE3o foi poss\xEDvel gravar o produto"}),console.error(n)}finally{$q.loading.hide()}},async tipoSelecionado(){await this.ajustarSecaoEstoque()},ajustarExibicaoCampos(){var r;const a=JSON.parse((r=localStorage.getItem("modalNovoItemCampos"))!=null?r:null);let e=[{name:"referencia",label:"Refer\xEAncia",show:!0},{name:"codigoBarras",label:"C\xF3digo de barras",show:!0},{name:"marca",label:"Marca",show:!0}];if(this.permissaoAjusteEstoque&&e.push({name:"estoque",label:"Estoque",show:!0}),a)for(const n of e){const o=a.find(d=>d.name===n.name);o&&(n.show=o.show)}this.campos=e},async exibicaoCampoAlterado(){var a;this.campos.forEach(e=>{e.show||delete this.item[e.name]}),!this.item.tipo&&this.campos.some(e=>e.name==="tipo"&&e.show)&&(this.item.tipo=(a=ee[0])==null?void 0:a.valor),localStorage.setItem("modalNovoItemCampos",JSON.stringify(this.campos)),await this.ajustarSecaoEstoque()},async ajustarSecaoEstoque(){const a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,e=this.campos.some(n=>n.name==="estoque"&&n.show);let r=e&&this.permissaoAjusteEstoque?this.estoque:[];if(e&&!r.length)for(const n of a)r.push({codigoEmpresa:n.codigoContato,idContatoEmpresa:n.id,contatoEmpresaApelido:n.apelido,saldo:0,readonly:null});$utils.tratamentoCompletoString(this.item.tipo)!=="servico"&&r.forEach(n=>{n.readonly=!1}),(!this.item.tipo||$utils.tratamentoCompletoString(this.item.tipo)==="servico")&&(r=[]),this.estoque=r},async verificarReferenciaExistente(a){const e=(a||"").trim().toLowerCase();return e&&(await $db.item.carregarMemoria(),$db.item.itens.some(n=>(n.referencia||"").trim().toLowerCase()===e))?"Refer\xEAncia j\xE1 existente":!0},async abrir(){var e;let a=setTimeout(()=>{$q.loading.show()},300);try{this.permissaoAjusteEstoque=await $db.permissao.objeto("item//estoque/ajuste_estoque"),this.item={tipo:(e=ee[0])==null?void 0:e.valor},this.estoque=[],this.ajustarExibicaoCampos(),await this.ajustarSecaoEstoque(),this.show=!0,this.interval=setInterval(()=>{const r=document.getElementsByClassName("input-descricao")[0],n=document.getElementsByClassName("input-referencia")[0],o=document.getElementsByClassName("input-codigoBarras")[0];r&&(r.style.cursor="text"),n&&(n.style.cursor="text"),o&&(o.style.cursor="text"),r&&n&&o&&clearInterval(this.interval)},100)}catch(r){console.error(r)}finally{clearTimeout(a),setTimeout(()=>{$q.loading.hide()},500)}},fechar(){this.$emit("update:modelValue",!1),clearInterval(this.interval)}},props:{modelValue:{default:!1,type:Boolean,required:!0}},watch:{modelValue(){this.modelValue&&this.abrir()}},unmounted(){clearInterval(this.interval)}};function aa(a,e,r,n,o,d){const f=y("campo"),p=y("SeletorCampoTabela"),x=y("Campo");return m(),C(Ge,{modelValue:o.show,"onUpdate:modelValue":e[10]||(e[10]=s=>o.show=s),onHide:d.fechar},{default:i(()=>[t(Me,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"500px"}},{default:i(()=>[t(ze,{onSubmit:d.salvar,ref:"formNovoItem"},{default:i(()=>[t(ce,{class:"bg-primary text-white"},{default:i(()=>[t(te,null,{default:i(()=>[t(me,null,{default:i(()=>[t(F,{name:"extension",size:"sm",class:"q-pr-sm"}),e[11]||(e[11]=h(" Cadastrar Produto "))]),_:1}),t(S,{icon:"more_vert",flat:"",round:""},{default:i(()=>[t(le,null,{default:i(()=>[T((m(),C(Z,{bordered:"",link:"",class:"bg-white rounded-borders"},{default:i(()=>[(m(!0),A(W,null,Y(o.campos,(s,b)=>(m(),A("div",{key:b,class:"itemHover"},[T((m(),C(U,{"manual-focus":"",class:"q-pa-sm items-center"},{default:i(()=>[t(c,{class:"col-shrink no-margin"},{default:i(()=>[t(Oe,{modelValue:s.show,"onUpdate:modelValue":[P=>s.show=P,d.exibicaoCampoAlterado],"checked-icon":"check",color:"primary","unchecked-icon":"clear",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(c,{class:"col-grow q-pl-sm no-margin"},{default:i(()=>[h(k(s.label),1)]),_:2},1024)]),_:2},1024)),[[ue]]),t(se)]))),128))]),_:1})),[[oe]])]),_:1})]),_:1})]),_:1})]),_:1}),t(fe,null,{default:i(()=>[t(pe,{class:"q-pa-md"},{default:i(()=>[t(Xe,{modelValue:o.item.imagem,"onUpdate:modelValue":[e[1]||(e[1]=s=>o.item.imagem=s),e[2]||(e[2]=()=>{o.fileError=!1})],onRejected:d.arquivoRejeitado,rules:[()=>!o.fileError||"JPEG, PNG (m\xE1x. 2MB)"],label:"Selecione a imagem",filled:"",counter:"","max-files":"1","max-file-size":"2097152",accept:".jpg, .png, image/jpeg, image/png",class:"q-mb-md"},{prepend:i(()=>[t(F,{name:"attach_file"})]),append:i(()=>[t(F,{onClick:e[0]||(e[0]=He(()=>{o.item.imagem=null},["stop","prevent"])),name:"close",class:"cursor-pointer"})]),hint:i(()=>e[12]||(e[12]=[h(" JPEG, PNG (m\xE1x. 2MB) ")])),_:1},8,["modelValue","onRejected","rules"]),t(f,{modelValue:o.item.descricao,"onUpdate:modelValue":e[3]||(e[3]=s=>o.item.descricao=s),rules:[s=>!!s||"Campo obrigat\xF3rio"],rotulo:"Descri\xE7\xE3o"},null,8,["modelValue","rules"]),T(t(f,{modelValue:o.item.referencia,"onUpdate:modelValue":e[4]||(e[4]=s=>o.item.referencia=s),rotulo:"Refer\xEAncia",rules:o.rules.referencia},null,8,["modelValue","rules"]),[[ae,d.showReferencia]]),T(t(f,{modelValue:o.item.codigoBarras,"onUpdate:modelValue":e[5]||(e[5]=s=>o.item.codigoBarras=s),rotulo:"C\xF3digo de Barras",class:"q-field--with-bottom"},null,8,["modelValue"]),[[ae,d.showCodigoBarras]]),T(t(p,{modelValue:o.item.marca,"onUpdate:modelValue":e[6]||(e[6]=s=>o.item.marca=s),buscarSemCaractere:!0,tabela:"item",campo:"marca",label:"Marca",enableAdd:""},null,8,["modelValue"]),[[ae,d.showMarca]]),t(x,{modelValue:o.item.valorCustoReposicao,"onUpdate:modelValue":e[7]||(e[7]=s=>o.item.valorCustoReposicao=s),rotulo:"Custo de Reposi\xE7\xE3o",tipo:"decimal",decimals:"4",zerosDireita:"2",rules:[s=>!d.totalEstoqueSaldo||Number(s==null?void 0:s.replace(/\./g,"").replace(",","."))>0||"Campo obrigat\xF3rio"]},null,8,["modelValue","rules"]),t(x,{modelValue:o.item.valorVenda,"onUpdate:modelValue":e[8]||(e[8]=s=>o.item.valorVenda=s),rotulo:"Valor de Venda",tipo:"decimal",decimals:"4",zerosDireita:"2",class:"q-field--with-bottom"},null,8,["modelValue"]),t(f,{"onUpdate:modelValue":[d.tipoSelecionado,e[9]||(e[9]=s=>o.item.tipo=s)],modelValue:o.item.tipo,opcoes:d.opcoesTipo,rotuloFixo:"Tipo",tipo:"seletor",class:"q-field--with-bottom"},null,8,["onUpdate:modelValue","modelValue","opcoes"]),(m(!0),A(W,null,Y(o.estoque,s=>(m(),C(x,{key:s.idContatoEmpresa,modelValue:s.saldo,"onUpdate:modelValue":b=>s.saldo=b,rotulo:`Estoque (${s.contatoEmpresaApelido})`,somenteLeitura:s.readonly,tipo:"quantidade",min:"0",decimals:"4",zerosDireita:"0",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","rotulo","somenteLeitura"]))),128))]),_:1})]),_:1}),t(he,{class:"bg-light"},{default:i(()=>[t(te,null,{default:i(()=>[t(S,{unelevated:"",label:"Salvar e continuar",name:"salvarContinuar",color:"primary",type:"submit",class:"text-white float-left"}),t(ge),T(t(S,{label:"Cancelar",color:"tertiary",flat:"",class:"q-mr-xs"},null,512),[[oe]]),t(S,{type:"submit",label:"Salvar",color:"primary",unelevated:""})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue","onHide"])}var ta=ie(ea,[["render",aa]]);const oa={components:{EtiquetaAdicionar:Ye,EtiquetaNovoItem:ta,PromptCodigoBarras:Je},data(){return{usuario:"",clienteSistema:"",lista:[],item:{},quantidade:1,totalEtiquetas:0,cameraTimeout:null,promptCodigoBarras:!1,opcoesModelo:[],modeloSelecionado:"",emBranco:0,opcoesEmpresas:[],empresaSelecionada:"",tabelasPreco:[],opcoesTabelasPreco:[],tabelaPrecoSelecionada:"",opcoesPlanoConta:[],etiquetaNovoItem:!1,campos:{codigoBarras:{db:"item",value:null,isLoading:!1,showing:!1,chave:"descricaoConcatenada",chaveCadastro:"descricao",searches:[],columns:[{name:"codigoItem",label:"Codigo",align:"left",field:a=>a.codigoItem,format:a=>`${a}`,sortable:!0},{name:"descricao",label:"Descri\xE7\xE3o",align:"left",field:a=>a.descricaoConcatenada,format:a=>`${a}`,sortable:!0}]}}}},methods:{abrirPromptCodigoBarras(){this.promptCodigoBarras=!0,window.scrollTo(0,0)},async onDetected(a){clearTimeout(this.cameraTimeout),this.cameraTimeout=setTimeout(async()=>{this.$refs.etiquetaAdicionar.campo.value=a,await this.$refs.etiquetaAdicionar.buscarItens(),this.$refs.etiquetaAdicionar.$refs.adicionarProduto.focus()},200)},async listar(){try{$q.loading.show();const a=(await $db.etiqueta.ler({cpfUsuarioLogado:this.usuario.numeroDocumentoNacional})).sort((o,d)=>o.dataHoraEmissao>d.dataHoraEmissao?-1:1),e=$utils.clonar(a),r=(await $db.item.ler({filtros:{ids:e.map(o=>o.idItem)}})).data;let n={};for(const o of r)n[o.id]=o;this.item=n,this.listaOriginal=a,this.lista=e,this.totalEtiquetas=this.lista.reduce((o,d)=>{const f=d.quantidadeEtiquetas<0?0:d.quantidadeEtiquetas;return o+f},0)}catch(a){this.$q.notifyError("Erro ao obter dados.",a)}finally{$q.loading.hide()}},async adicionar(a){var r;let e=this.lista.find(n=>n.idItem===a.id);if(e){const n={nomeProduto:a.descricaoConcatenada,valor:a.valorVenda||0,quantidadeEtiquetas:e.quantidadeEtiquetas+this.quantidade};await this.atualizar({...e,...n}),e.nomeProduto=n.nomeProduto,e.valor=n.valor,e.quantidadeEtiquetas=n.quantidadeEtiquetas;return}try{$q.loading.show(),e={id:$utils.uuid(),idItem:a.id,nomeProduto:a.descricaoConcatenada,valor:(r=a.valorVenda)!=null?r:0,quantidadeEtiquetas:this.quantidade,cpfUsuarioLogado:this.usuario.numeroDocumentoNacional,dataHoraEmissao:$utils.dataAtual()},await $db.etiqueta.gravar({atual:e}),await this.listar(),await this.carregarValores(),$q.notify({message:"Etiqueta adicionada com sucesso.",type:"positive"})}catch(n){this.$q.notifyError("Erro ao inserir etiqueta.",n)}finally{$q.loading.hide()}},async atualizar(a){try{$q.loading.show();const e=this.listaOriginal.find(r=>r.id===a.id);await $db.etiqueta.gravar({atual:a,original:e}),await this.listar(),await this.carregarValores(),$q.notify({message:"Etiqueta atualizada com sucesso.",type:"positive"})}catch(e){this.$q.notifyError("Erro ao atualizar etiqueta.",e)}finally{$q.loading.hide()}},async carregarTabelaPreco(){this.tabelaPrecoSelecionada?await this.carregarValores():this.lista=$utils.clonar(this.listaOriginal)},async carregarValores(){for(const a of this.lista){const e=await $erp().item.get(a.idItem);let r,n;!e||(this.tabelaPrecoSelecionada&&(r=this.tabelasPreco.filter(o=>o.id===this.tabelaPrecoSelecionada)[0],n=await $db.itemTabelaPreco.obterValores(r,e,4)),n&&(a.valor=n.valorVenda||0))}},async remover(a){try{await $db.etiqueta.remover(a.id),await this.listar(),$q.notify({message:"Etiqueta removida com sucesso.",type:"positive"})}catch(e){this.$q.notifyError("Erro ao remover etiqueta.",e)}},removerTodas(){$q.dialog({title:"Tem certeza?",message:"Esta a\xE7\xE3o ir\xE1 remover as etiquetas da lista.",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Remover",push:!0,class:"bg-red-7",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();for(const a of this.lista)await $db.etiqueta.remover(a.id);await this.listar(),$q.notify({message:"Etiquetas removidas com sucesso.",type:"positive"})}catch(a){this.$q.notifyError("Erro ao remover etiquetas.",a)}finally{$q.loading.hide()}})},async abrirEtiquetaNovoItem(){this.etiquetaNovoItem=!0},async incluirItem(a,e){const r=await $erp().item.get(a);e&&(this.quantidade=e),r&&this.adicionar(r),this.quantidade=1},async abrirEtiquetaAdicionar(){try{this.$refs.etiquetaAdicionar.campo.value="",await this.$refs.etiquetaAdicionar.buscarItens()}catch(a){console.error("Erro ao abrir adicionar etiqueta.",a)}},async configuraEtiqueta(){const a=await $db.configuracoes.le({nome:"impressao.etiqueta"});this.opcoesModelo=[],a.length?a.forEach(e=>{this.opcoesModelo.push({rotulo:e.texto,valor:e.observacao&&e.observacao.trim()!==""?e.observacao:e.valor,modelo:e.valor})}):this.opcoesModelo.push({rotulo:"Etiqueta Carta (EBF-23)",valor:"etiqueta-carta-ebf23",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila Joias",valor:"etiqueta-fila-joias",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila 3 Colunas",valor:"etiqueta-fila-3colunas",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Pimaco (A4 96)",valor:"etiqueta-pimaco-a496",modelo:"imprimir-etiquetas"}),this.opcoesModelo=[...this.opcoesModelo,{rotulo:"Modelos antigos:",value:"modelos-antigos",disable:!0},{rotulo:"Folha Argox",valor:"etiqueta-fila"},{rotulo:"Folha Carta",valor:"etiqueta-carta"},{rotulo:"Folha Pimaco",valor:"EtiquetaPimaco6Col"},{rotulo:"Personaliz\xE1vel",valor:"etiqueta_generica_ajustavel"},{rotulo:"Etiqueta Fila",valor:"etiquetaFila",modelo:"etiquetaFila"}],this.modeloSelecionado=this.opcoesModelo[0].valor},async configuraEmpresas(){const a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.opcoesEmpresas=a.map(e=>({rotulo:e.apelido||e.nome,valor:e.id,codigoEmpresa:e.codigoContato})),this.empresaSelecionada=""},async configuraTabelasPreco(){this.tabelasPreco=await $db.itemTabelaPreco.le({ativo:!0,tabelaMaster:!0})||[],this.opcoesTabelasPreco=this.tabelasPreco.map(a=>({rotulo:a.descricao,valor:a.id,codigoItemTabelaPreco:a.codigoItemTabelaPreco})),this.tabelaPrecoSelecionada=""},async configuraPlanoConta(){const a=(await $db.configuracoes.le()).filter(e=>e.nome==="item.estoque.ajuste").sort((e,r)=>e.texto.localeCompare(r.texto));this.opcoesPlanoConta=[{rotulo:"-",valor:""},...a.map(e=>({rotulo:(e.texto||"").trim(),valor:e.valor})),{rotulo:"Especificar Contas",valor:"0"}]},imprimir(a){var e;if(a==="etiqueta_generica_ajustavel"||a==="etiqueta-fila"||a==="etiqueta-carta"||a==="EtiquetaPimaco6Col"){const r=a==="etiqueta_generica_ajustavel"?"":"OptiSoul/";this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/${r}${a}.html
            ?Banco=${this.clienteSistema.bancoDeDados}
            &URLServidor=${this.clienteSistema.urlServidor}
            &CodigoUsuario=${this.usuario.codigoUsuario}
            &EmBranco=${this.emBranco}
            &TabelaPreco=${this.tabelaPrecoSelecionada?this.opcoesTabelasPreco.find(n=>n.valor===this.tabelaPrecoSelecionada).codigoItemTabelaPreco:""}
            &CodigoContatoEmpresa=${this.empresaSelecionada?this.opcoesEmpresas.find(n=>n.valor===this.empresaSelecionada).codigoEmpresa:""}
            &cpfUsuarioLogado=${this.usuario.cpf}
            &hfCodigoSistema={
              data:{
                CodigoUsuario:${this.usuario.codigoUsuario},
                CodigoSistema:${this.clienteSistema.codigoSistema},
                CodigoClienteSistema:${this.clienteSistema.codigoClienteSistema},
                Sistema:${this.clienteSistema.sistema},
                URLServidor:${this.clienteSistema.urlServidor},
                BancoDeDados:${this.clienteSistema.bancoDeDados},
                CodigoCliente:${this.clienteSistema.codigoCliente},
                Cliente:${this.clienteSistema.cliente},
                Administrador:${this.clienteSistema.administrador},
                GrupoInterno:${this.clienteSistema.grupoInterno}
              }
            }
          `)}else{const r=(e=this.opcoesModelo)==null?void 0:e.find(d=>d.valor===a),n=(r==null?void 0:r.modelo)||"",o=(r==null?void 0:r.valor)||"";$imprimir(n,{impressao:"etiquetas"},{modelo:o,idEmpresa:this.empresaSelecionada,idTabelaPreco:this.tabelaPrecoSelecionada,emBranco:this.emBranco})}},abrirImpressao(a){window.open(a.replace(/[\s\n]/g,""),"_blank").focus()}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.clienteSistema=JSON.parse(localStorage.getItem("clienteSistema")),await this.configuraEtiqueta(),await this.configuraEmpresas(),await this.configuraTabelasPreco(),await this.configuraPlanoConta(),await this.listar(),await this.carregarValores()}},ia={id:"EtiquetaLista"},la={class:"mw80 text-center"},sa={class:"col col-md-auto q-my-xs"};function ra(a,e,r,n,o,d){const f=y("barraTopo"),p=y("campo"),x=y("EtiquetaAdicionar"),s=y("g-label"),b=y("g-col"),P=y("g-row"),z=y("BadgeCopiarUid"),O=y("avatar"),H=y("badge"),g=y("EtiquetaNovoItem"),G=y("promptCodigoBarras");return m(),A("div",ia,[t(ce,{elevated:"",class:"bg-gradiente text-white"},{default:i(()=>[t(f),t(te,{class:"q-px-sm"},{default:i(()=>[t(F,{name:"mdi-tag-plus",size:"sm",class:"q-mr-sm etiquetalista-hideonmobile"}),t(me,{class:"etiquetalista-hideonmobile"},{default:i(()=>e[12]||(e[12]=[h("Imprimir Etiquetas")])),_:1}),t(ge,{class:"etiquetalista-desktop"}),t(p,{modelValue:o.quantidade,"onUpdate:modelValue":e[0]||(e[0]=l=>o.quantidade=l),min:1,dense:"",outlined:"",dark:"",color:"white",tipo:"quantidade",rotulo:"Quantidade",class:"q-ml-sm etiquetalista-QtdAddEtq"},null,8,["modelValue"]),t(x,{onClick:e[1]||(e[1]=l=>d.abrirEtiquetaAdicionar()),onKeyup:e[2]||(e[2]=Ke(l=>d.abrirEtiquetaAdicionar(),["enter"])),onAddEtiqueta:d.adicionar,campo:o.campos.codigoBarras,dense:"",outlined:"",clearable:"",dark:"",ref:"etiquetaAdicionar",cor:"white",class:"q-ml-sm etiquetalista-selectAddEtq"},null,8,["onAddEtiqueta","campo"]),t(S,{onClick:d.abrirPromptCodigoBarras,flat:"",round:"",icon:"mdi-barcode-scan",color:"white",size:"md",class:"q-ml-sm hideonmobile"},null,8,["onClick"]),t(S,{onClick:e[3]||(e[3]=l=>d.listar()),flat:"",round:"",icon:"refresh",color:"white",size:"md",class:"q-ml-xs hideonmobile"}),t(S,{icon:"more_vert",flat:"",round:"",dense:"",class:"q-ml-xs"},{default:i(()=>[t(le,null,{default:i(()=>[T((m(),C(Z,{link:"","no-border":""},{default:i(()=>[t(U,{onClick:d.abrirEtiquetaNovoItem,clickable:""},{default:i(()=>[t(c,{avatar:""},{default:i(()=>[t(F,{name:"add",size:"sm"})]),_:1}),t(c,null,{default:i(()=>e[13]||(e[13]=[h("Adicionar")])),_:1})]),_:1},8,["onClick"]),t(U,{onClick:d.abrirPromptCodigoBarras,clickable:"",class:"hideondesktop"},{default:i(()=>[t(c,{avatar:""},{default:i(()=>[t(F,{name:"mdi-barcode-scan",size:"sm"})]),_:1}),t(c,null,{default:i(()=>e[14]||(e[14]=[h("C\xF3digo de Barras")])),_:1})]),_:1},8,["onClick"]),t(U,{onClick:d.removerTodas,clickable:""},{default:i(()=>[t(c,{avatar:""},{default:i(()=>[t(F,{name:"delete",size:"sm"})]),_:1}),t(c,null,{default:i(()=>e[15]||(e[15]=[h("Limpar")])),_:1})]),_:1},8,["onClick"])]),_:1})),[[oe]])]),_:1})]),_:1})]),_:1})]),_:1}),t(fe,null,{default:i(()=>[t(pe,null,{default:i(()=>[t(P,null,{default:i(()=>[o.lista.length===0?(m(),C(b,{key:0,col:"grow",class:"q-px-xs"},{default:i(()=>[t(P,{justify:"center",bg:"bg-white",minHeight:"calc(100vh - 210px)!important"},{default:i(()=>[t(b,{self:"center"},{default:i(()=>[t(s,{text:"caption center medium"},{default:i(()=>e[16]||(e[16]=[h("Nenhum item a ser listado.")])),_:1})]),_:1})]),_:1})]),_:1})):(m(),C(b,{key:1,col:"grow",class:"q-px-xs"},{default:i(()=>[t(Z,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:i(()=>[(m(!0),A(W,null,Y(o.lista,l=>(m(),A("div",{key:l.idItem,class:"itemHover"},[t(U,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:i(()=>[t(c,{class:"col-auto no-margin hideonmobile"},{default:i(()=>{var q,v;return[E("div",la,[t(z,{id:l==null?void 0:l.idItem,numero:(q=o.item[l==null?void 0:l.idItem])==null?void 0:q.codigoItem,cor:(v=o.item[l==null?void 0:l.idItem])!=null&&v.ativo?"positive":"tertiary",escuro:"",dica:"C\xF3digo Item"},null,8,["id","numero","cor"])])]}),_:2},1024),t(c,{class:"col-xs q-pl-sm no-margin"},{default:i(()=>[t(U,{class:"q-pa-none"},{default:i(()=>[t(c,{top:"",class:"col-auto items-center hideondesktop"},{default:i(()=>{var q,v;return[t(O,{imagem:(q=o.item[l.idItem])==null?void 0:q.imagem,style:{display:"flex","align-self":"center"},rotulo:(v=o.item[l.idItem])==null?void 0:v.descricaoConcatenada,tamanho:"40"},null,8,["imagem","rotulo"])]}),_:2},1024),t(c,{class:"col-auto items-center hideonmobile"},{default:i(()=>{var q,v;return[t(O,{imagem:(q=o.item[l.idItem])==null?void 0:q.imagem,style:{display:"flex","align-self":"center"},rotulo:(v=o.item[l.idItem])==null?void 0:v.descricaoConcatenada,tamanho:"40"},null,8,["imagem","rotulo"])]}),_:2},1024),t(c,{class:"col"},{default:i(()=>{var q;return[t(M,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines caption"},{default:i(()=>{var v;return[E("span",null,[h(k((v=o.item[l.idItem])==null?void 0:v.descricaoConcatenada)+" ",1),t(j,{anchor:"bottom middle",self:"center middle"},{default:i(()=>e[17]||(e[17]=[h("Descri\xE7\xE3o")])),_:1})])]}),_:2},1024),(q=o.item[l.idItem])!=null&&q.marca?(m(),C(M,{key:0,caption:"",lines:"1",class:"text-tertiary ellipsis caption"},{default:i(()=>{var v,N,R,B,I;return[E("span",null,[h(k((v=o.item[l.idItem])==null?void 0:v.marca)+" ",1),t(j,{anchor:"bottom middle",self:"center middle"},{default:i(()=>e[18]||(e[18]=[h("Marca")])),_:1})]),E("span",null,[h(k((N=o.item[l.idItem])!=null&&N.grupo?" | "+((R=o.item[l.idItem])==null?void 0:R.grupo):"")+" ",1),t(j,{anchor:"bottom middle",self:"center middle"},{default:i(()=>e[19]||(e[19]=[h("Grupo")])),_:1})]),E("span",null,[h(k((B=o.item[l.idItem])!=null&&B.subGrupo?" | "+((I=o.item[l.idItem])==null?void 0:I.subGrupo):"")+" ",1),t(j,{anchor:"bottom middle",self:"center middle"},{default:i(()=>e[20]||(e[20]=[h("Subgrupo")])),_:1})])]}),_:2},1024)):L("",!0),t(c,{class:"q-mt-sm"},{default:i(()=>{var v,N,R,B,I,J;return[E("div",null,[t(z,{id:l==null?void 0:l.idItem,numero:(v=o.item[l==null?void 0:l.idItem])==null?void 0:v.codigoItem,cor:(N=o.item[l==null?void 0:l.idItem])!=null&&N.ativo?"positive":"tertiary",escuro:"",class:"q-mr-xs hideondesktop",dica:"C\xF3digo Item"},null,8,["id","numero","cor"]),(R=o.item[l==null?void 0:l.idItem])!=null&&R.referencia?(m(),C(H,{key:0,rotulo:(B=o.item[l==null?void 0:l.idItem])==null?void 0:B.referencia,escuro:"",cor:"tertiary",dica:"Refer\xEAncia",class:"q-mr-xs"},null,8,["rotulo"])):L("",!0),(I=o.item[l==null?void 0:l.idItem])!=null&&I.codigoBarras?(m(),C(H,{key:1,rotulo:(J=o.item[l==null?void 0:l.idItem])==null?void 0:J.codigoBarras,cor:"light",dica:"C\xF3digo de Barras",class:"q-mr-xs"},null,8,["rotulo"])):L("",!0)]),t(c,{class:"q-pt-sm text-tertiary text-weight-bold hideondesktop"},{default:i(()=>[h(" R$ "+k(a.$filters.numero(l.valor,2))+" ",1),t(j,null,{default:i(()=>e[21]||(e[21]=[h("Valor de venda")])),_:1})]),_:2},1024),t(U,{class:"q-pa-none q-pt-sm hideondesktop"},{default:i(()=>[t(c,{top:"",class:"col"},{default:i(()=>[t(p,{modelValue:l.quantidadeEtiquetas,"onUpdate:modelValue":[D=>l.quantidadeEtiquetas=D,D=>d.atualizar(l)],avisoRotulo:`Em estoque: ${o.item[l.idItem].quantidadeDisponivel}`,debounce:500,min:0,dense:"",outlined:"",aviso:"",rotulo:"Quantidade",tipo:"quantidade",color:"tertiary"},null,8,["modelValue","onUpdate:modelValue","avisoRotulo"])]),_:2},1024),t(c,{top:"",class:"col-shrink q-pt-xs q-px-sm"},{default:i(()=>[t(S,{onClick:D=>d.remover(l),dense:"",round:"",flat:"",icon:"delete",size:"md",color:"tertiary",class:"buttons"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]}),_:2},1024)]}),_:2},1024)]),_:2},1024)]),_:2},1024),t(c,{class:"col maxw160 q-pl-sm no-margin hideonmobile"},{default:i(()=>[E("div",sa,[t(M,null,{default:i(()=>[t(p,{modelValue:l.quantidadeEtiquetas,"onUpdate:modelValue":[q=>l.quantidadeEtiquetas=q,q=>d.atualizar(l)],avisoRotulo:`Em estoque: ${o.item[l.idItem].quantidadeDisponivel}`,debounce:500,min:0,dense:"",outlined:"",aviso:"",tipo:"quantidade",rotulo:"Quantidade",color:"tertiary"},null,8,["modelValue","onUpdate:modelValue","avisoRotulo"])]),_:2},1024)])]),_:2},1024),t(c,{class:"col maxw100 q-pl-sm no-margin hideonmobile"},{default:i(()=>[t(M,{caption:"",class:"text-tertiary text-weight-bold text-right caption"},{default:i(()=>[E("span",null,[h(k(a.$filters.numeroZerosDireita(l.valor,4,2))+" ",1),t(j,{anchor:"bottom middle",self:"center middle"},{default:i(()=>e[22]||(e[22]=[h("Valor de venda")])),_:1})])]),_:2},1024)]),_:2},1024),t(c,{class:"col-shrink q-pl-sm no-margin hideonmobile"},{default:i(()=>[t(S,{onClick:q=>d.remover(l),dense:"",flat:"",round:"",color:"tertiary",icon:"delete",class:"buttons"},null,8,["onClick"])]),_:2},1024)]),_:2},1024),t(se)]))),128))]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),t(he,{class:"bg-white text-tertiary shadow-up-5"},{default:i(()=>[t(P,{gutter:"sm",items:"center"},{default:i(()=>[t(b,{col:"4 sm"},{default:i(()=>[t(p,{modelValue:o.modeloSelecionado,"onUpdate:modelValue":e[4]||(e[4]=l=>o.modeloSelecionado=l),opcoes:o.opcoesModelo,dense:"",filled:"",tipo:"seletor",rotulo:"Modelo",cor:"white",class:"etiquetalista-seletor","popup-content-class":"etiquetalista-modeloSelecionado"},null,8,["modelValue","opcoes"])]),_:1}),t(b,{col:"4 sm"},{default:i(()=>[t(p,{modelValue:o.empresaSelecionada,"onUpdate:modelValue":e[5]||(e[5]=l=>o.empresaSelecionada=l),opcoes:o.opcoesEmpresas,dense:"",filled:"",clearable:"",tipo:"seletor",rotulo:"Empresa",color:"tertiary",class:"etiquetalista-seletor"},null,8,["modelValue","opcoes"])]),_:1}),t(b,{col:"4 sm"},{default:i(()=>[t(p,{modelValue:o.tabelaPrecoSelecionada,"onUpdate:modelValue":[e[6]||(e[6]=l=>o.tabelaPrecoSelecionada=l),d.carregarTabelaPreco],dense:"",filled:"",clearable:"",opcoes:o.opcoesTabelasPreco,tipo:"seletor",rotulo:"Tabela de Pre\xE7o",color:"tertiary",class:"etiquetalista-seletor"},null,8,["modelValue","onUpdate:modelValue","opcoes"])]),_:1}),t(b,{col:"xs"},{default:i(()=>[t(p,{modelValue:o.emBranco,"onUpdate:modelValue":e[7]||(e[7]=l=>o.emBranco=l),min:0,tipo:"quantidade",dense:"",filled:"",rotulo:"Etiquetas em branco",color:"tertiary","text-color":"red"},null,8,["modelValue"])]),_:1}),t(b,{col:"xs sm-shrink text-center"},{default:i(()=>[t(p,{modelValue:o.totalEtiquetas,"onUpdate:modelValue":e[8]||(e[8]=l=>o.totalEtiquetas=l),disable:"",filled:"",rotulo:"Quantidade etiquetas",class:"etiquetalista-QtdTotalEtq",style:{"max-width":"132px"}},null,8,["modelValue"])]),_:1}),t(b,{col:"shrink text-center"},{default:i(()=>[t(S,{onClick:e[9]||(e[9]=l=>d.imprimir(o.modeloSelecionado)),flat:"",color:"primary"},{default:i(()=>[t(F,{name:"print",size:"sm"}),e[23]||(e[23]=E("span",{class:"q-ml-xs hideonmobile"},"Imprimir",-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(g,{modelValue:o.etiquetaNovoItem,"onUpdate:modelValue":e[10]||(e[10]=l=>o.etiquetaNovoItem=l),onSalvar:d.incluirItem,onSalvarContinuar:d.incluirItem},null,8,["modelValue","onSalvar","onSalvarContinuar"]),t(G,{modelValue:o.promptCodigoBarras,"onUpdate:modelValue":e[11]||(e[11]=l=>o.promptCodigoBarras=l),onEscanear:d.onDetected,useQuagga:!0},null,8,["modelValue","onEscanear"])])}var ua=ie(oa,[["render",ra]]);export{ua as default};
