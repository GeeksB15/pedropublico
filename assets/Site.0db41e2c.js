import{_ as E,c2 as A,r as b,o as c,n as _,f as a,w as l,h as S,j as y,i as k,k as V,E as D,I as T,B as r,q as u,U as p,z as g,d as q,e as U,F as w,s as x,aW as Q,t as C,Q as P,O as B,R as z,S as j,T as F,H as I,a_ as H,J as L}from"./index.353e304f.js";var N="/pedropublico/assets/imagem-modelo-carrossel.98567798.jpg";const M={components:{Arquivo:A},computed:{estaoTodasEmpresasComSiteAtivo:{get(){for(const o in this.empresas)if(!this.empresas[o].principal&&!this.empresas[o].ativoSite)return!1;return!0},set(o){for(const s in this.empresas)this.empresas[s].principal||(this.empresas[s].ativoSite=o)}},estaoTodasFormasDePagamentoComSiteAtivo:{get(){for(const o in this.formasPagamento)if(!this.formasPagamento[o].ativoSite)return!1;return!0},set(o){for(const s in this.formasPagamento)this.formasPagamento[s].ativoSite=o}}},data(){return{tabsSite:"home",empresas:[],formasPagamentoParaSincronizar:[],formasPagamento:[],empresaPrincipal:"",json:{siteUrl:"",ativo:!0,empresas:{},carrossel:[],slogan:"",descricao:"",formasPagamento:{},marketingDigital:{codigoTagHead:"",codigoTagBody:""}},arquivo:[]}},methods:{async atualizar(){var o,s,n,m,t;try{let i=await this.$utils.geeksApi({site:{funcao:"84C328A7-CEA7-4762-A703-C59DE8D53BF5"}});if(i=i.data.site,((o=i==null?void 0:i.carrossel)==null?void 0:o.length)&&this.tabsSite!=="produtos"&&(this.arquivo=i.carrossel.map(e=>({id:e.id,dataCriacao:$utils.dataAtual(),nome:e.nome,arquivo:e.imagemB64}))),this.empresas=await $db.empresa.le(),this.empresas=this.empresas.reduce((e,d)=>(e[d.id]={id:d.id,idContato:d.idContato,nome:d.nome,ativoSite:!1,principal:!1},e),{}),!$lodash.isEmpty(i.empresas)){this.json=i;for(let e in this.empresas)this.empresas[e].principal=!!((s=this.json.empresas[e])!=null&&s.principal),this.empresas[e].ativoSite=!!((n=this.json.empresas[e])!=null&&n.ativoSite),(m=this.json.empresas[e])!=null&&m.principal&&(this.empresaPrincipal=this.json.empresas[e].id);await this.sincronizarFormasDePagamento(!0)}if($lodash.isEmpty(i.empresas)){const e=Object.keys(this.empresas);e.length===1&&(this.empresaPrincipal=e[0],this.empresas[e[0]].ativoSite=!0),await this.sincronizarFormasDePagamento(!1)}let h=localStorage.getItem("bancoDeDados"),f=await $db.vitrine.ler(),v=((t=(await $db.vitrine.ler()).find(e=>e.banco===h))==null?void 0:t.url)||h;this.json.siteUrl=v}catch(i){this.$q.notifyError("Erro ao consultar banco",i)}},async salvar(){if(!this.empresaPrincipal){this.$q.notifyError("Selecione ao menos uma empresa principal");return}this.json.empresas=this.empresas,this.json.formasPagamento=this.formasPagamento,this.json.empresas[this.empresaPrincipal].principal=!0;let o=$utils.clonarV2(this.json);await this.$utils.geeksApi({site:{funcao:"E981897C-A205-441E-99DE-BECD16CB261A",...o}}),this.$q.notifyPositive("Salvo com sucesso!")},carrosselAtualizar(){this.json.carrossel=[];for(const o of this.$refs.arquivo.arquivo)this.json.carrossel.push({imagemB64:o.arquivo,nome:o.nome,id:o.id})},async baixarImagemModeloCarrossel(){const o=document.createElement("a");o.href=N,o.download="imagem-modelo.jpg",o.click()},async mudarEmpresaPrincipal(o){for(const s in this.empresas)o===s?(this.empresas[s].principal=!0,this.empresas[s].ativoSite=!0):this.empresas[s].principal=!1;await this.sincronizarFormasDePagamento(!0)},async sincronizarFormasDePagamento(o){this.formasPagamento=[];const s=this.empresas[this.empresaPrincipal];for(const n of this.formasPagamentoParaSincronizar){if(!n.ativo||n.idContatoEmpresa&&s&&n.idContatoEmpresa!==s.idContato)continue;const m={id:n.id,descricao:n.descricao,ativoSite:!1},t=o?this.json.formasPagamento.find(i=>i.id===n.id):null;m.ativoSite=t?t.ativoSite:!1,this.formasPagamento.push(m)}this.formasPagamento.sort(function(n,m){return n.descricao<m.descricao?-1:n.descricao>m.descricao?1:0})}},async created(){this.formasPagamentoParaSincronizar=await $db.formaPagamento.le(),await this.atualizar()}},O={id:"SiteConfiguracao"},R={class:"q-card bg-white q-px-md no-shadow"},J={class:"row items-center"},G={class:"col"},W={class:"col-auto text-right"},K={class:"q-card bg-white q-my-md no-shadow"},X={class:"q-px-md"},Y=r("div",{class:"col-6 col-md-1"},"Principal",-1),Z=r("div",{class:"col-6 col-md-1"},"Ativo",-1),$=r("div",{class:"col-12 col-md"},"Empresa",-1),ee={class:"col-6 col-md-1"},ae={class:"col-6 col-md-1"},se={class:"col-12 col-md"},oe={class:"q-card bg-white q-my-md no-shadow"},te={class:"q-px-md q-pb-md"},ie={class:"row justify-end"},re={class:"q-card bg-white q-my-md no-shadow"},le={class:"q-px-md q-pb-md"},ne={class:"q-card bg-white q-my-md no-shadow"},de={class:"q-px-md q-pb-md"},me={class:"q-card bg-white no-shadow"},ce={class:"q-px-md q-pb-md"};function ue(o,s,n,m,t,i){const h=b("barraTopo"),f=b("row"),v=b("Arquivo");return c(),_("div",O,[a(D,null,{default:l(()=>[a(h),a(S,{class:"bg-transparent q-px-sm"},{default:l(()=>[a(y,{name:"mdi-earth",size:"sm"}),a(k,null,{default:l(()=>[V("Site")]),_:1})]),_:1})]),_:1}),a(I,null,{default:l(()=>[a(T,{class:"u-container"},{default:l(()=>[r("div",R,[r("div",J,[r("div",G,[a(u,{readonly:"",type:"text",prefix:"b15.app/",label:"URL do Site",modelValue:t.json.siteUrl,"onUpdate:modelValue":s[0]||(s[0]=e=>t.json.siteUrl=e)},{prepend:l(()=>[a(y,{name:"mdi-earth",size:"32px"})]),_:1},8,["modelValue"])]),r("div",W,[a(p,{modelValue:t.json.ativo,"onUpdate:modelValue":s[1]||(s[1]=e=>t.json.ativo=e),label:"Ativo",class:"q-ma-md"},null,8,["modelValue"])])])]),r("div",K,[a(g,{group:"somegroup",icon:"business",label:"Empresas",class:"border-1","header-class":"bg-white text-tertiary","exact-active-class":"bg-white text-tertiary"},{default:l(()=>[Object.keys(t.empresas).length>1?(c(),q(p,{key:0,modelValue:i.estaoTodasEmpresasComSiteAtivo,"onUpdate:modelValue":s[2]||(s[2]=e=>i.estaoTodasEmpresasComSiteAtivo=e),label:"Selecionar todos"},null,8,["modelValue"])):U("",!0),r("div",X,[a(f,{class:"items-center borderBottom"},{default:l(()=>[Y,Z,$]),_:1}),(c(!0),_(w,null,x(t.empresas,e=>(c(),q(f,{class:"items-center borderBottom",key:e.id},{default:l(()=>[r("div",ee,[a(Q,{modelValue:t.empresaPrincipal,"onUpdate:modelValue":[s[3]||(s[3]=d=>t.empresaPrincipal=d),i.mudarEmpresaPrincipal],val:e.id},null,8,["modelValue","val","onUpdate:modelValue"])]),r("div",ae,[a(p,{modelValue:e.ativoSite,"onUpdate:modelValue":d=>e.ativoSite=d,class:"col",disable:t.empresaPrincipal==e.id},null,8,["modelValue","onUpdate:modelValue","disable"])]),r("div",se,C(e.nome),1)]),_:2},1024))),128))])]),_:1})]),r("div",oe,[a(g,{group:"somegroup",icon:"mdi-view-carousel",label:"Carrossel",class:"border-1","header-class":"bg-white text-tertiary"},{default:l(()=>[r("div",te,[r("div",ie,[a(P,{flat:"",color:"primary",label:"Baixar imagem modelo",onClick:i.baixarImagemModeloCarrossel},null,8,["onClick"])]),a(v,{ref:"arquivo",onAtualizar:i.carrosselAtualizar,arquivo:t.arquivo},null,8,["onAtualizar","arquivo"])])]),_:1})]),r("div",re,[a(g,{group:"somegroup",icon:"mdi-format-title",label:"Textos",class:"border-1","header-class":"bg-white text-tertiary"},{default:l(()=>[r("div",le,[a(u,{label:"Slogan",class:"q-mb-sm",modelValue:t.json.slogan,"onUpdate:modelValue":s[4]||(s[4]=e=>t.json.slogan=e)},null,8,["modelValue"]),a(u,{class:"bg-light q-px-sm",label:"Descri\xE7\xE3o",rows:"3",type:"textarea",modelValue:t.json.descricao,"onUpdate:modelValue":s[5]||(s[5]=e=>t.json.descricao=e)},null,8,["modelValue"])])]),_:1})]),r("div",ne,[a(g,{group:"somegroup",icon:"credit_card",label:"Formas de pagamento",class:"border-1","header-class":"bg-white text-tertiary"},{default:l(()=>[r("div",de,[a(B,{highlight:"","no-border":"",separator:"",class:"q-pt-none"},{default:l(()=>[a(p,{modelValue:i.estaoTodasFormasDePagamentoComSiteAtivo,"onUpdate:modelValue":s[6]||(s[6]=e=>i.estaoTodasFormasDePagamentoComSiteAtivo=e),label:"Selecionar todos"},null,8,["modelValue"]),(c(!0),_(w,null,x(t.formasPagamento,e=>(c(),q(z,{key:e.id,class:"q-pa-xs itemlista"},{default:l(()=>[a(j,{avatar:""},{default:l(()=>[a(p,{modelValue:e.ativoSite,"onUpdate:modelValue":d=>e.ativoSite=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(j,null,{default:l(()=>[a(F,null,{default:l(()=>[V(C(e.descricao),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1})]),r("div",me,[a(g,{group:"somegroup",icon:"mdi-code-tags",label:"C\xF3digos marketing digital",class:"border-1","header-class":"bg-white text-tertiary"},{default:l(()=>[r("div",ce,[a(u,{class:"bg-light q-px-md q-mb-md",label:"C\xF3digo na tag head",rows:"10",type:"textarea",modelValue:t.json.marketingDigital.codigoTagHead,"onUpdate:modelValue":s[7]||(s[7]=e=>t.json.marketingDigital.codigoTagHead=e)},null,8,["modelValue"]),a(u,{class:"bg-light q-px-md",label:"C\xF3digo ap\xF3s a tag de abertura body",rows:"10",type:"textarea",modelValue:t.json.marketingDigital.codigoTagBody,"onUpdate:modelValue":s[8]||(s[8]=e=>t.json.marketingDigital.codigoTagBody=e)},null,8,["modelValue"])])]),_:1})])]),_:1})]),_:1}),a(L,{class:"bg-light border-top",reveal:""},{default:l(()=>[a(S,{class:"u-container q-px-sm"},{default:l(()=>[a(H),a(P,{label:"Cancelar",color:"tertiary",flat:"",class:"q-ml-sm"}),a(P,{onClick:i.salvar,label:"Salvar",color:"primary",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})])}var ge=E(M,[["render",ue]]);export{ge as default};
