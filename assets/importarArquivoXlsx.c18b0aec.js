import{bU as N,bV as b,bW as L,a5 as D}from"./index.094a6fb0.js";import{x as C}from"./xlsx.6cceadb4.js";const T=function(e){return typeof e=="string"&&(e=L(e,"DD/MM/YYYY HH:mm:ss.SSS")),typeof e=="number"&&(e=new Date((e-25569)*24*60*60*1e3+new Date().getTimezoneOffset()*60*1e3)),!e||isNaN(e)?"":D.formatDate(e)},E=function(e,t=!1){return e==null?t:typeof e=="boolean"?e:typeof e=="string"?e.trim().toUpperCase()==="NULL"?t:["SIM","1"].includes(e.trim().toUpperCase())?!0:["N\xC3O","NAO","0"].includes(e.trim().toUpperCase())?!1:t:typeof e=="number"?e!==0:t},x=function(e,t=0){return e==null?t:typeof e=="number"?e:typeof e=="string"?e.trim().toUpperCase()==="NULL"?t:+e||t:t},d=function(e,t=""){return e==null?t:typeof e=="number"?e.toString():typeof e=="string"?e.trim().toUpperCase()==="NULL"?t:e.trim():t},P=function(e){let t=e?String(e).trim():"";return(t.toUpperCase()==="NULL"||t.length!==36)&&(t=""),t},O=function(e,t){switch(t.tipo||"texto"){case"decimal":case"dinheiro":case"numerico":case"quantidade":return x(e,t.valorInicial);case"seletor":return t.tipo2==="numerico"?x(e,t.valorInicial):d(e,t.valorInicial);case"texto":case"textoArea":return d(e,t.valorInicial);case"id":return P(e);case"dataHora":return T(e);case"logico":return E(e,t.valorInicial)}return null},y=function(e,t){const c=e.Sheets[t],u=c["!ref"];let f=Number(u.match(/\d+/g)[1]),i=2;for(const n in c){const r=Number((n.match(/\d+/g)||["0"])[0]);r>i&&(i=r)}c["!ref"]=u.replace(String(f),String(i));const s=C.utils.sheet_to_json(c,{header:1});if(!s||s.length===0)throw new N(`Planilha inv\xE1lida! N\xE3o possui aba ${t}.`);const o=s[0].map(U);let a=[];for(let n in s)if(n!=="0"){var m={};for(let r in s[n])m[o[r]]=s[n][r];a.push(m)}return a},A=async function(e,t,c,u,f){let i;try{i=C.read(e,{type:"binary"})}catch{throw new N("Planilha inv\xE1lida! N\xE3o possui formato xlsx v\xE1lido.")}const s=y(i,"Config"),o=y(i,"Dados"),a=b(s.filter(n=>n.Importar==="Sim"),"Operacao"),m=s.filter(n=>n.Importar==="Sim"&&n.Chave==="Sim").map(n=>S(n.CampoTabela));for(const n in o)try{let r=!1;const p={chaves:m};for(const w in a){const g=b(a[w],"Tabela");for(const l in g){const h=H(o[n],g[l],t[l]||{});h.incluir&&(p[l]=[...p[l]||[],h.campos],r=!0)}}r&&await c(p)}catch(r){let p="Erro na importa\xE7\xE3o";r.name&&r.message&&r.name==="ErroValidacao"?p=r.message:console.error(r),await u((+n||0)+2,p)}await f()},H=function(e,t,c){const u={};let f=!1;for(const i of t){const s=S(i.CampoTabela);let o=null;if(i.Tipo==="Fixo")o=i.CampoExcel;else{const a=U(d(i.CampoExcel));a&&a in e&&(o=e[a],f=!0)}o!==null&&(u[s]=O(o,c[s]||{}))}return{incluir:f,campos:u}},S=e=>e===e.toUpperCase()?e:e[0].toLowerCase()+e.substring(1),U=e=>e.replace(/ /g,"");export{A as i};
