import{_ as P,Z as Q,bj as G,r as z,o as i,d as m,w as a,f as e,B as f,h as W,i as R,T as k,k as r,t as u,d0 as F,j as p,G as C,d1 as A,e as h,m as I,l as H,O,n as g,F as w,s as E,R as b,S as l,Q as x,az as S,M as q,y as B}from"./index.353e304f.js";import{D as U}from"./DocumentosFiscais.630b5e8b.js";import{M as j}from"./ModalHistoricoStatus.875151c0.js";import{e as K}from"./emitirNFe.35117289.js";const L={components:{Avatar:Q,DocumentosFiscais:U,VendaModal:G,ModalHistoricoStatus:j},computed:{config(){return $db.configuracoes.valores},podeMigrarFatura(){return!~["Aguardando Estoque","Aguardando Financeiro","Aguardando Aprova\xE7\xE3o","Aguardando Pagamento","Cancelado","N\xE3o Aprovado","Or\xE7amento","Faturado"].indexOf(this.dados.venda.status)}},data(){return{dbUsuario:$db.usuario,dados:{venda:{}},fatura:{},contatos:{},faturasAbertas:[],detalhesVisivel:!1,visibilidade:{botao:{editar:!1,remover:!1}},modalDevolucaoGarantia:{visivel:!1,item:{},orcamento:{}},sistemaPai:"",configImpressaoOrcamento:[],configImpressosWhatsapp:[],documentoItemKit:{}}},emits:["executar"],methods:{async duplicarVenda(){try{await new Promise((o,s)=>{this.$q.dialog({message:"Duplicar este pedido?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{o()}).onCancel(()=>{s()})})}catch{return}try{const o=await $db.venda.duplicarVenda(this.id);this.$refs.vendaModal.mostrar({id:o}),this.$q.notify({type:"positive",message:"Pedido duplicado"})}catch(o){let s="N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o";/^GError:.+/.test(o.message)&&(s=o.message.slice(7)),this.$q.notify({type:"negative",message:s}),console.error(o)}},irParaAtendimentoFatura(o){this.$router.push({name:"AtendimentoFatura",params:{id:o}})},async migrarFatura(o){try{await new Promise((s,_)=>{this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 migrar esta venda para outra fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{s()}).onCancel(()=>{_()})})}catch{return}o||(o=$db.fatura.criar(this.dados.venda),await $db.fatura.grava({fatura:o})),o.id?(await $db.documento.grava({atual:{id:this.dados.venda.id,idFatura:o.id},original:{id:this.dados.venda.id}}),localStorage.setItem("idFatura",o.id),this.dados.venda.idContato&&(this.$emit("executar","atualizar"),this.irParaAtendimentoFatura(this.dados.venda.idContato))):this.$q.notify("N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o")},alternarDetalhes(){this.detalhesVisivel=!this.detalhesVisivel},async atualizar(){var _;const o=await $db.venda.leCompleto(this.id);o.carrinho.sort((d,t)=>new Date(d.dataHoraEmissao)<new Date(t.dataHoraEmissao)?-1:1),o.oss.sort((d,t)=>new Date(d.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1),o.customs.sort((d,t)=>new Date(d.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1),o.kits.sort((d,t)=>new Date(d.documento.dataHoraEmissao)<new Date(t.documento.dataHoraEmissao)?-1:1),(_=o.venda)!=null&&_.idFatura&&(this.fatura=await $db.hibrido.le({table:"documento",id:o.venda.idFatura}));for(const d of o.kits){const t=d.documentosItem.find(c=>c.operacaoFator===-1&&c.operacao!=="Manipula\xE7\xE3o");this.documentoItemKit[d.documento.id]=t}if((o.venda||{}).idContato&&(o.venda||{}).idEmpresa){let d=[];d=await $db.fatura.obterAbertas(o.venda.idContato,o.venda.idEmpresa),this.faturasAbertas=d.sort((t,c)=>!t.numero||t.numero<c.numero?-1:1)}const s={};if(o.venda.idContato){const d=o.venda.idContato;s[d]||(s[d]=await $db.contato.le({id:d}))}if(o.venda.idContatoVendedor){const d=o.venda.idContatoVendedor;s[d]||(s[d]=await $db.contato.le({id:d}))}this.configuraImpressaoOrcamento(o.venda.idEmpresa),this.configuraImpressosWhatsapp(o.venda),this.contatos=s,this.dados=o,await this.$nextTick(),o.venda.id===localStorage.getItem("idVenda")&&(this.$refs.vendaModal.mostrar({id:o.venda.id}),localStorage.removeItem("idVenda"))},async atualizarComDados(){var s,_,d,t;const o=await $db.venda.preparaDados(this.dadosVenda);o.carrinho.sort((c,y)=>new Date(c.dataHoraEmissao)<new Date(y.dataHoraEmissao)?-1:1),o.oss.sort((c,y)=>new Date(c.documento.dataHoraEmissao)<new Date(y.documento.dataHoraEmissao)?-1:1),o.customs.sort((c,y)=>new Date(c.documento.dataHoraEmissao)<new Date(y.documento.dataHoraEmissao)?-1:1),o.kits.sort((c,y)=>new Date(c.documento.dataHoraEmissao)<new Date(y.documento.dataHoraEmissao)?-1:1),(s=o.venda)!=null&&s.idFatura&&(this.fatura=await $db.hibrido.le({table:"documento",id:o.venda.idFatura}));for(const c of o.kits){const y=c.documentosItem.find(D=>D.operacaoFator===-1&&D.operacao!=="Manipula\xE7\xE3o");this.documentoItemKit[c.documento.id]=y}this.faturasAbertas=((d=(_=this.vendasCompletas)==null?void 0:_.faturasAbertas)==null?void 0:d.filter(c=>c.idEmpresa===o.venda.idEmpresa))||[],this.configuraImpressaoOrcamento(o.venda.idEmpresa),this.configuraImpressosWhatsapp(o.venda),this.contatos=((t=this.vendasCompletas)==null?void 0:t.dadosContatos)||{},this.dados=o,await this.$nextTick(),o.venda.id===localStorage.getItem("idVenda")&&(this.$refs.vendaModal.mostrar({id:o.venda.id}),localStorage.removeItem("idVenda"))},async configuraImpressaoOrcamento(o){const s=await $db.configuracoes.porNome("impressao.venda",o);this.configImpressaoOrcamento=[...s.length?s.map(_=>({texto:"Imprimir Or\xE7amento",..._})):[{valor:"invoice",texto:"Or\xE7amento/Venda (Invoice)"},this.sistemaPai==="optisoul"?{valor:"orcamento",texto:"Or\xE7amento (Antigo)"}:{},this.sistemaPai==="optisoul"?{valor:"termoGarantia",texto:"Termo de Garantia"}:{}]]},async configuraImpressosWhatsapp(o){const s=await $db.configuracoes.le({prefixoNome:"venda.whatsapp.enviar.",idEmpresa:o.idEmpresa});this.configImpressosWhatsapp=s.map(_=>({..._,idVenda:o.id}))},async dialogEnviar(o){var s,_;try{const d=await $db.hibrido.le({table:"documento",id:o.idVenda});$utils.verificarErro(!(d!=null&&d.id),"Erro ao obter dados");const t=await $db.contato.leCompleto(d.idContato),c=(((s=t==null?void 0:t.telefone)==null?void 0:s.find(y=>y.tipoTelefone==="WhatsApp"))||((_=t==null?void 0:t.telefone)==null?void 0:_.find(y=>y.tipoTelefone==="Principal"))||(t==null?void 0:t.telefone[0])||{}).telefone.trim()||"";$q.dialog({title:"Enviar impresso pelo Whatsapp?",preventClose:!0,prompt:{label:"Enviar para este n\xFAmero:",model:c||"",hint:"Ou adicione um novo n\xFAmero, ex: 19988776655",isValid:y=>y.length>0,type:"text"},cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async y=>{var N;d.telefoneContato=y.replace(/\D/g,"");const D=await $db.venda.enviaImpressaoPdfwhatsapp({documento:d,nomeImpresso:o.nome.replace("venda.whatsapp.enviar.",""),mensagem:(N=o.texto)!=null?N:`Voc\xEA est\xE1 recebendo o ${o.valor} da empresa ${d.descricaoEmpresa} (${d.numeroDocumentoEmpresa}).`})})}catch{$q.notifyError("Erro ao enviar.",erro)}},copiarUid(){const o=this.$refs.uid;o.type="text";try{o.select(),document.execCommand("copy"),this.$q.notify({message:"UID copiado para a \xE1rea de transfer\xEAncia.",type:"info"})}catch{this.$q.notify("Erro ao copiar.")}o.type="hidden",window.getSelection().removeAllRanges()},async devolucaoGarantia(o){let s=await $db.hibrido.lista({table:"documento",where:{idContato:$db.contato.selecionado.id,tipo:"Venda",status:"Or\xE7amento"}});if(s=$lodash.orderBy(s,"dataHoraEmissao","desc"),!s.length){this.$q.notify({message:"Crie um or\xE7amento para inclus\xE3o de devolu\xE7\xE3o/garantia.",type:"info"});return}this.modalDevolucaoGarantia={visivel:!0,item:o,orcamento:s[0]}},editar(){this.$refs.vendaModal.mostrar({id:this.dados.venda.id})},executar(o){switch(o){case"atualizar":this.atualizar();break;case"cancelar":case"finalizar":case"reprovar":this.$emit("executar","atualizar");break;case"retornarOrcamento":this.$emit("executar",o);break}},async finalizaDevolucaoGarantia(o,s,_){const d=$utils.clonar(o);s==="devolucao"&&(d.operacao="Devolu\xE7\xE3o de Venda"),s==="garantia"&&(d.operacao="Garantia de Venda",d.motivo=_),d.idDocumentoItemVenda=d.id,d.idDocumentoVenda=d.idDocumento,d.id=$utils.uuid(),d.idDocumento=this.modalDevolucaoGarantia.orcamento.id,d.status="Or\xE7amento",d.operacaoFator=1,d.codigoCfop=20,d.idCfop=(await $db.cfop.le({codigoCfop:20}))[0].id,d.dataHoraEmissao=$utils.dataAtual(),d.dataHoraFinalizado="",d.subTotal=d.subTotal*-1,d.total=d.total*-1,d.valorItem=d.valorItem*-1,d.descontoSubTotal=0,delete d.codigoCfop,delete d.codigoDocumento,delete d.codigoDocumentoItem,delete d.codigoItem,delete d.codigoPlanoContaDestino,delete d.codigoPlanoContaEstoque,await $db.documentoItem.grava({atual:d}),this.$q.notify({message:"Item adicionado ao or\xE7amento.",type:"positive"}),localStorage.setItem("idVenda",this.modalDevolucaoGarantia.orcamento.id),this.$emit("executar","atualizar")},async remover(){this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 remover esta venda da fatura",title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{await $db.venda.checarConflitoStatus({id:this.dados.venda.id,status:this.dados.venda.status})}catch(o){return $q.notifyError(o.message),!1}await $db.documento.grava({atual:{id:this.dados.venda.id,idFatura:""},original:{id:this.dados.venda.id}}),this.$emit("executar","remover")})}},mixins:[K],props:{id:{required:!0,type:String},dadosVenda:{required:!1,type:Object},vendasCompletas:{required:!1,type:Object},resetarEnvio:{required:!1,type:Function}},watch:{async dados(o){var _;this.visibilidade.botao.editar=!1,this.visibilidade.botao.visualizar=!1,this.visibilidade.botao.remover=!1;let s=(_=this.vendasCompletas)==null?void 0:_.contatosEmpresa;if(!s){const t=(await $db.hibrido.lista({table:"empresa",columns:["idContato"],whereFilter:{ativo:!0}})).map(({idContato:c})=>c);s=await $db.hibrido.lista({table:"contato",columns:["id"],whereIn:{id:t},whereFilter:{ativo:!0}})}!s.find(d=>d.id===o.venda.idEmpresa)||(o.venda.idFatura&&this.faturasAbertas.find(d=>d.id===o.venda.idFatura)&&(this.visibilidade.botao.remover=await $db.permissao.objeto("Diretiva_Vendas_RemoverVendaFatura")),!~["Cancelado","N\xE3o Aprovado"].indexOf(o.venda.status)&&!o.venda.idFatura&&(this.visibilidade.botao.editar=!0),this.visibilidade.botao.editar||(this.visibilidade.botao.visualizar=!0))}},mounted(){this.sistemaPai=$utils.sistemaPai(),this.dadosVenda&&this.vendasCompletas?this.atualizarComDados():this.atualizar()}},J={class:"col-12 col-md-6 q-pl-none"},Z={class:"q-item-section"},X={class:"col-6 col-md hideonmobile"},Y={class:"text-left q-my-none"},$={class:"col-4 col-md hideonmobile"},ee={class:"text-left q-my-none"},ae={class:"col-4 col-md hideonmobile"},te={class:"text-left q-my-none"},oe={class:"col-6 col-md hideonmobile"},de={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},se={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},ie={class:"col-12 hideondesktop"},ne={class:"text-left q-my-none"},re={class:"col-12 col-md-6"},le={class:"col-12 col-md-6 full-height items-end hideonmobile"},ue={class:"col-6"},ce={class:"text-left q-my-none"},me={class:"text-left q-my-none"},fe={class:"col-6"},ve={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},pe={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},he={class:"col-12 full-height items-end"},_e={class:"col-12 col-md-6"},be={class:"text-subtitle1 text-weight-bold q-ma-none items-center"},ye={class:"q-ma-none"},ke={key:0},ge={class:"col-6 col-md-4"},Ce=f("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Faturamento ",-1),we={class:"q-ma-none"},qe={class:"col-6 col-md-2 text-right"},xe=f("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1),Ve={class:"q-ma-none"};function Ee(o,s,_,d,t,c){const y=z("avatar"),D=z("row"),N=z("documentos-fiscais"),M=z("VendaModal"),T=z("modal-historico-status");return t.dados.venda.id?(i(),m(B,{key:0,id:"VendaCard",class:"extratoItem bg-white q-pa-sm no-shadow"},{default:a(()=>[e(D,{class:"items-center justify-between q-mx-none q-px-none q-mb-sm"},{default:a(()=>{var v;return[f("div",J,[e(W,{class:"q-pa-none"},{default:a(()=>{var n;return[e(y,{imagem:(n=t.contatos[t.dados.venda.idContato])==null?void 0:n.imagem,rotulo:t.dados.venda.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"]),e(R,null,{default:a(()=>[f("div",Z,[e(k,null,{default:a(()=>{var V;return[r(u((V=t.contatos[t.dados.venda.idContato])==null?void 0:V.apelido),1)]}),_:1}),e(k,{caption:""},{default:a(()=>{var V;return[r(u((V=t.contatos[t.dados.venda.idContato])==null?void 0:V.nome),1)]}),_:1})])]),_:1}),e(F,{rounded:"",color:"tertiary",small:""},{default:a(()=>[r(u(t.dados.venda.status),1)]),_:1}),e(F,{class:"q-ml-sm",color:"positive",escuro:"",onClick:c.copiarUid},{default:a(()=>[r(" #"+u(parseInt(t.dados.venda.numero)||(t.dados.venda.id||"").slice(-6))+" ",1),e(p,{class:"q-ml-sm",name:"shopping_cart"}),C(f("input",{type:"hidden","onUpdate:modelValue":s[0]||(s[0]=V=>t.dados.venda.id=V),ref:"uid"},null,512),[[A,t.dados.venda.id]])]),_:1},8,["onClick"])]}),_:1})]),f("div",X,[f("p",Y,[t.contatos[t.dados.venda.idContatoVendedor]?(i(),m(p,{key:0,name:"mdi-account-tie"})):h("",!0),r(" "+u((v=t.contatos[t.dados.venda.idContatoVendedor])==null?void 0:v.apelido)+" ",1),e(I,null,{default:a(()=>[r(" Vendedor(a) ")]),_:1})])]),f("div",$,[f("p",ee,[t.dados.venda.dataHoraEmissao?(i(),m(p,{key:0,name:"mdi-calendar-today "})):h("",!0),r(" "+u(o.$filters.data(t.dados.venda.dataHoraEmissao))+" ",1),e(I,null,{default:a(()=>[r(" Emiss\xE3o ")]),_:1})])]),f("div",ae,[f("p",te,[t.dados.venda.dataHoraFinalizado?(i(),m(p,{key:0,name:"mdi-calendar-check"})):h("",!0),r(" "+u(o.$filters.data(t.dados.venda.dataHoraFinalizado))+" ",1),t.dados.venda.dataHoraFinalizado?(i(),m(I,{key:1},{default:a(()=>[r(" Finalizado ")]),_:1})):h("",!0)])]),f("div",oe,[f("p",de,u(o.$filters.numero(t.dados.venda.totalDocumento,2)),1),f("p",se,u(o.$filters.numero(t.dados.venda.subTotal,2)),1)])]}),_:1}),e(H,{class:"hideondesktop q-mb-sm"}),e(D,{class:"q-mx-none q-px-none items-center"},{default:a(()=>{var v;return[f("div",ie,[f("p",ne,[t.contatos[t.dados.venda.idContatoVendedor]?(i(),m(p,{key:0,name:"mdi-account-tie"})):h("",!0),r(" "+u((v=t.contatos[t.dados.venda.idContatoVendedor])==null?void 0:v.apelido)+" ",1),e(I,null,{default:a(()=>[r(" Vendedor(a) ")]),_:1})])]),f("div",re,[e(O,{class:"no-border text-tertiary"},{default:a(()=>[(i(!0),g(w,null,E(t.dados.carrinho,n=>(i(),m(b,{key:n.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(l,{avatar:"",class:"mw80"},{default:a(()=>[e(k,null,{default:a(()=>[r(u(n.quantidade)+"x",1)]),_:2},1024)]),_:2},1024),e(l,null,{default:a(()=>[e(k,null,{default:a(()=>[r(u(n.descricaoItem),1)]),_:2},1024)]),_:2},1024),e(l,{side:"",top:""},{default:a(()=>[e(k,null,{default:a(()=>[r(u(o.$filters.numero(n.total,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),(i(!0),g(w,null,E(t.dados.customs,n=>(i(),m(b,{key:n.documento.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(l,{avatar:"",class:"mw80"},{default:a(()=>[e(k,null,{default:a(()=>[r(u(n.documento.numero)+"x ",1)]),_:2},1024)]),_:2},1024),e(l,null,{default:a(()=>[e(k,null,{default:a(()=>[r(u(n.documento.descricao),1)]),_:2},1024)]),_:2},1024),e(l,{side:"",top:""},{default:a(()=>[e(k,null,{default:a(()=>[r(u(o.$filters.numero(n.documento.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),(i(!0),g(w,null,E(t.dados.oss,n=>(i(),m(b,{key:n.documento.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(l,{avatar:"",class:"mw80"},{default:a(()=>[e(k,null,{default:a(()=>[r(" OS "),e(F,{color:"tertiary",small:""},{default:a(()=>[r("#"+u(n.documento.numero),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(l,null,{default:a(()=>[e(k,null,{default:a(()=>[r(u(n.documento.descricao),1)]),_:2},1024)]),_:2},1024),e(l,{avatar:"",class:"mw50"},{default:a(()=>[n.documento.status!=="Or\xE7amento"?(i(),m(F,{key:0,rounded:"",color:"tertiary",small:""},{default:a(()=>[r(u(n.documento.status),1)]),_:2},1024)):h("",!0)]),_:2},1024),e(l,{right:"",top:""},{default:a(()=>[e(k,null,{default:a(()=>[r(u(o.$filters.numero(n.documento.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),(i(!0),g(w,null,E(t.dados.kits,n=>(i(),m(b,{key:n.documento.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:a(()=>[e(l,{avatar:"",class:"mw80"},{default:a(()=>[e(k,null,{default:a(()=>[r(u(o.$filters.numero(t.documentoItemKit[n.documento.id].quantidade,4))+"x",1)]),_:2},1024)]),_:2},1024),e(l,null,{default:a(()=>[e(k,null,{default:a(()=>[r(u(t.documentoItemKit[n.documento.id].descricaoItem),1)]),_:2},1024)]),_:2},1024),e(l,{side:"",top:""},{default:a(()=>[e(k,null,{default:a(()=>[r(u(o.$filters.numero(t.documentoItemKit[n.documento.id].total,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),f("div",le,[e(H,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(x,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(S,null,{default:a(()=>[C((i(),m(O,{link:"",separator:""},{default:a(()=>[o.$utils.mapearStatus(t.dados.venda).permiteNota?(i(),g(w,{key:0},[C((i(),m(b,{clickable:"",onClick:s[1]||(s[1]=n=>o.emitirNFeV2({idVenda:t.dados.venda.id},1,"Venda"))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"account_balance"})]),_:1}),e(l,null,{default:a(()=>[r("NFe de Sa\xEDda/Venda")]),_:1})]),_:1})),[[q]]),C((i(),m(b,{clickable:"",onClick:s[2]||(s[2]=n=>o.emitirNFeV2({idVenda:t.dados.venda.id},0,"Devolu\xE7\xE3o"))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"account_balance"})]),_:1}),e(l,null,{default:a(()=>[r("NFe de Entrada/Devolu\xE7\xE3o")]),_:1})]),_:1})),[[q]]),C((i(),m(b,{clickable:"",onClick:s[3]||(s[3]=n=>o.emitirNFeV2({idVenda:t.dados.venda.id},1,"Remessa"))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"account_balance"})]),_:1}),e(l,null,{default:a(()=>[r("NFe de Remessa")]),_:1})]),_:1})),[[q]])],64)):h("",!0),c.podeMigrarFatura?(i(),g(w,{key:1},[(i(!0),g(w,null,E(t.faturasAbertas.filter(n=>n.id!==t.dados.venda.idFatura),n=>C((i(),m(b,{clickable:"",key:n.id,onClick:V=>c.migrarFatura(n)},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"mdi-folder-move"})]),_:1}),e(l,null,{default:a(()=>[r(u("Migrar para fatura #"+(n.numero||n.id.slice(-6))),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[q]])),128)),C((i(),m(b,{clickable:"",onClick:s[4]||(s[4]=n=>c.migrarFatura())},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"mdi-folder-move"})]),_:1}),e(l,null,{default:a(()=>[r("Migrar para nova fatura")]),_:1})]),_:1})),[[q]])],64)):h("",!0),e(b,{clickable:"",onClick:s[5]||(s[5]=n=>o.$refs.modalHistoricoStatus.mostrar({idDocumento:t.dados.venda.id}))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"history"})]),_:1}),e(l,null,{default:a(()=>[r("Hist\xF3rico do Status")]),_:1})]),_:1}),e(b,{clickable:"",onClick:c.duplicarVenda},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"mdi-content-duplicate"})]),_:1}),e(l,null,{default:a(()=>[r("Duplicar Pedido")]),_:1})]),_:1},8,["onClick"]),(i(!0),g(w,null,E(t.configImpressosWhatsapp.filter(n=>n.valor),n=>(i(),m(b,{clickable:"",key:n.valor,onClick:V=>c.dialogEnviar(n)},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"mdi-whatsapp"})]),_:1}),e(l,null,{default:a(()=>[r(u(n.valor),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),_.resetarEnvio&&t.dados.venda.rotaJson&&t.dados.venda.rotaJson.length>0?(i(),m(b,{key:2,clickable:"",onClick:s[6]||(s[6]=n=>_.resetarEnvio(t.dados.venda))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"restart_alt"})]),_:1}),e(l,null,{default:a(()=>[r("Resetar Envio")]),_:1})]),_:1})):h("",!0)]),_:1})),[[q]])]),_:1})]),_:1}),t.visibilidade.botao.remover?(i(),m(x,{key:0,rounded:"",dense:"",flat:"",icon:"clear",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",onClick:c.remover,style:{float:"right"}},null,8,["onClick"])):h("",!0),t.visibilidade.botao.editar?(i(),m(x,{key:1,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-mx-xs",size:"md",onClick:c.editar,style:{float:"right"}},null,8,["onClick"])):h("",!0),t.visibilidade.botao.visualizar?(i(),m(x,{key:2,rounded:"",dense:"",flat:"",icon:"remove_red_eye",color:"primary",class:"no-shadow q-mx-xs",size:"md",onClick:c.editar,style:{float:"right"}},null,8,["onClick"])):h("",!0),e(x,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(S,null,{default:a(()=>[e(O,{link:"",separator:""},{default:a(()=>[(i(!0),g(w,null,E(t.configImpressaoOrcamento.filter(n=>n.valor),n=>(i(),m(b,{clickable:"",key:n.valor,onClick:V=>o.$imprimir(n.valor,{id:(t.dados.venda||{}).id||"0",Oculto:"0"})},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"print"})]),_:1}),e(l,null,{default:a(()=>[e(k,null,{default:a(()=>[r(u(n.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),e(x,{rounded:"",dense:"",flat:"",icon:t.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-mx-xs",color:"tertiary",style:{float:"right"},onClick:c.alternarDetalhes},null,8,["icon","onClick"])])]}),_:1}),e(H,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(D,{class:"q-mx-none q-px-none hideondesktop"},{default:a(()=>[f("div",ue,[f("p",ce,[t.dados.venda.dataHoraEmissao?(i(),m(p,{key:0,name:"mdi-calendar-today"})):h("",!0),r(" "+u(o.$filters.data(t.dados.venda.dataHoraEmissao))+" ",1),e(I,null,{default:a(()=>[r(" Emiss\xE3o ")]),_:1})]),f("p",me,[t.dados.venda.dataHoraFinalizado?(i(),m(p,{key:0,name:"mdi-calendar-check"})):h("",!0),r(" "+u(o.$filters.data(t.dados.venda.dataHoraFinalizado))+" ",1),t.dados.venda.dataHoraFinalizado?(i(),m(I,{key:1},{default:a(()=>[r(" Finalizado ")]),_:1})):h("",!0)])]),f("div",fe,[f("p",ve,u(o.$filters.numero(t.dados.venda.subTotal,2)),1),f("p",pe,u(o.$filters.numero(t.dados.venda.totalDocumento,2)),1)]),f("div",he,[e(H,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(x,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(S,null,{default:a(()=>[C((i(),m(O,{link:"",separator:""},{default:a(()=>[o.$utils.mapearStatus(t.dados.venda).permiteNota?(i(),g(w,{key:0},[C((i(),m(b,{clickable:"",onClick:s[7]||(s[7]=v=>o.emitirNFeV2({idVenda:t.dados.venda.id},1,"Venda"))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"account_balance"})]),_:1}),e(l,null,{default:a(()=>[r("NFe de Sa\xEDda/Venda")]),_:1})]),_:1})),[[q]]),C((i(),m(b,{clickable:"",onClick:s[8]||(s[8]=v=>o.emitirNFeV2({idVenda:t.dados.venda.id},0,"Devolu\xE7\xE3o"))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"account_balance"})]),_:1}),e(l,null,{default:a(()=>[r("NFe de Entrada/Devolu\xE7\xE3o")]),_:1})]),_:1})),[[q]]),C((i(),m(b,{clickable:"",onClick:s[9]||(s[9]=v=>o.emitirNFeV2({idVenda:t.dados.venda.id},1,"Remessa"))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"account_balance"})]),_:1}),e(l,null,{default:a(()=>[r("NFe de Remessa")]),_:1})]),_:1})),[[q]])],64)):h("",!0),c.podeMigrarFatura?(i(),g(w,{key:1},[(i(!0),g(w,null,E(t.faturasAbertas.filter(v=>v.id!==t.dados.venda.idFatura),v=>C((i(),m(b,{key:v.id,onClick:n=>c.migrarFatura(v)},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"mdi-folder-move"})]),_:1}),e(l,null,{default:a(()=>[r(u("Migrar para fatura #"+(v.numero||v.id.slice(-6))),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[q]])),128)),C((i(),m(b,{onClick:s[10]||(s[10]=v=>c.migrarFatura())},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"mdi-folder-move"})]),_:1}),e(l,null,{default:a(()=>[r("Migrar para nova fatura")]),_:1})]),_:1})),[[q]])],64)):h("",!0),e(b,{clickable:"",onClick:s[11]||(s[11]=v=>o.$refs.modalHistoricoStatus.mostrar({idDocumento:t.dados.venda.id}))},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"history"})]),_:1}),e(l,null,{default:a(()=>[r("Hist\xF3rico do Status")]),_:1})]),_:1}),(i(!0),g(w,null,E(t.configImpressosWhatsapp.filter(v=>v.valor),v=>(i(),m(b,{clickable:"",key:v.valor,onClick:n=>c.dialogEnviar(v)},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"mdi-whatsapp"})]),_:1}),e(l,null,{default:a(()=>[r(u(v.valor),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})),[[q]])]),_:1})]),_:1}),t.visibilidade.botao.remover?(i(),m(x,{key:0,rounded:"",dense:"",flat:"",icon:"clear",color:"tertiary",class:"no-shadow q-mx-xs",size:"md",onClick:c.remover,style:{float:"right"}},null,8,["onClick"])):h("",!0),t.visibilidade.botao.editar?(i(),m(x,{key:1,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-mx-xs",size:"md",onClick:c.editar,style:{float:"right"}},null,8,["onClick"])):h("",!0),e(x,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:a(()=>[e(S,null,{default:a(()=>[e(O,{link:"",separator:""},{default:a(()=>[(i(!0),g(w,null,E(t.configImpressaoOrcamento.filter(v=>v.valor),v=>(i(),m(b,{clickable:"",key:v.valor,onClick:n=>o.$imprimir(v.valor,{id:(t.dados.venda||{}).id||"0",Oculto:"0"})},{default:a(()=>[e(l,{avatar:""},{default:a(()=>[e(p,{name:"print"})]),_:1}),e(l,null,{default:a(()=>[e(k,null,{default:a(()=>[r(u(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),e(x,{rounded:"",dense:"",flat:"",icon:t.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-mx-xs",color:"tertiary",style:{float:"right"},onClick:c.alternarDetalhes},null,8,["icon","onClick"])])]),_:1}),t.detalhesVisivel?(i(),m(H,{key:0,class:"hideondesktop q-my-sm"})):h("",!0),t.detalhesVisivel?(i(),m(D,{key:1,class:"items-start q-mx-none q-px-none q-mt-md"},{default:a(()=>[f("div",_e,[f("p",be,[e(p,{name:"business"}),r(" "+u(t.dados.venda.descricaoEmpresa),1)]),f("div",ye,[t.fatura.id?(i(),g("div",ke,[r(" Fatura "),e(F,{color:"positive",escuro:"",onClick:c.copiarUid},{default:a(()=>[r(" #"+u(parseInt(t.fatura.numero)||(t.fatura.id||"").slice(-6))+" ",1),e(p,{class:"q-ml-sm",name:"mdi-glasses"}),C(f("input",{type:"hidden","onUpdate:modelValue":s[12]||(s[12]=v=>t.fatura.id=v),ref:"uid"},null,512),[[A,t.fatura.id]])]),_:1},8,["onClick"]),e(F,{class:"q-ml-sm",rounded:"",color:"tertiary",small:""},{default:a(()=>[r(u(t.fatura.status),1)]),_:1})])):h("",!0),f("div",null,u(t.dados.venda.observacao),1),f("div",null,u(t.dados.venda.observacaoInterna),1),f("div",null,u(t.dados.venda.motivoCancelamento),1),f("div",null,u(t.dados.venda.observacaoCancelamento),1)]),e(N,{idVenda:t.dados.venda.id},null,8,["idVenda"])]),f("div",ge,[Ce,f("div",we,u(t.dados.venda.observacaoFaturamento),1)]),f("div",qe,[xe,f("p",Ve,u(o.$filters.numero(t.dados.venda.totalDesconto,2)),1)])]),_:1})):h("",!0),e(M,{ref:"vendaModal",onExecutar:c.executar},null,8,["onExecutar"]),e(T,{ref:"modalHistoricoStatus"},null,512)]),_:1})):h("",!0)}var He=P(L,[["render",Ee]]);export{He as V};
