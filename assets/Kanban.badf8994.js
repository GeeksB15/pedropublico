import{_ as P,cc as E,c7 as u,aE as v,bi as y,bZ as q,cI as U,p as D,o as g,i as F,w as i,f as s,B as O,E as _,e as f,s as z,x as r,D as k,Q as R,a6 as H,d as h,F as w,r as A,t as m,l as V,n as B,M as x,a4 as N,H as T}from"./index.88955961.js";import{C as I}from"./Campo.f6ac7f57.js";import{d as Q}from"./vuedraggable.umd.a5595037.js";const M={components:{Campo:I,draggable:Q},data(){return{empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date(E()).toDateString()),entregueFim:new Date(new Date(E()).toDateString()),fraseFiltro:"",listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeOS"},{label:"Entrega para esta semana",value:"bordaAmarelaOS"},{label:"Entrega atrasada",value:"bordaVermelhaOS"}]}},methods:{async eventoEnd(){for(const t in this.listas)for(const a of this.listas[t])if(a.status!==t){u.log("AdmOS","eventoEnd De:",a.status,"Para:",t,"codigo:",a.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:a.codigoContatoResponsavel,codigoDocumento:a.codigoDocumento,codigoUsuario:null,nomeCliente:a.nomeCliente,observacao:"",statusAtual:a.status,statusNovo:t},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(t){u.log("AdmOS","eventoConfirmaTroca",{...t}),this.$q.loading.show();try{let a;$db.usuario.logado.cpf&&(a=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(o=>{var e;return o.numeroDocumentoNacional.replace(/\D/g,"")===((e=$db.usuario.logado.cpf)==null?void 0:e.replace(/\D/g,""))})),t.cpfUsuario=a==null?void 0:a.numeroDocumentoNacional,await v.os.trocaStatusOnline(t),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(a){this.$q.notifyError("Erro na troca de status",a)}finally{this.$q.loading.hide()}},eventoCancelarTroca(t){u.log("AdmOS","eventoCancelarTroca",t),this.atualiza()},async empresaOpcoesCarregar(){u.log("AdmOS","empresaOpcoesCarregar()"),this.empresaOpcoes=(await v.empresa.leOnline()).map(t=>({label:t.nome,value:t.codigoContato}))},filtraDebounce(){y.exports.debounce(this.refazFiltro,700)()},refazFiltro(){u.log("AdmOSs","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const t=q(this.fraseFiltro.toUpperCase()).split(" ").filter(a=>a!=="");for(const a in this.listas)for(const n of this.listas[a]){const o=q(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroOS)+" ");let e=!0;for(const d of t)isNaN(Number(d))?e=e&&o.includes(d):e=e&&o.includes(" "+d+" ");this.empresaSelecionada&&(e=e&&this.empresaSelecionada===n.codigoEmpresa),n.mostra=e}},async atualiza(){try{const t=await v.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim});u.log("AdmOS","atualiza()",t.length),U(!t||!t.length,"N\xE3o h\xE1 ordens de servi\xE7o");let a=await v.configuracoes.le({nome:"vendas.os.status"});a=a.filter(o=>!["Processando","Entregue"].includes(o.texto));const n={Processando:[]};for(const o of y.exports.orderBy(a,"valor","asc").map(e=>e.texto))n[o]=[];n.Entregue=[];for(const o of t){let e="bordaVerdeOS";if(o.status==="Entregue"){if(!!o.dataHoraPrevisto&&!!o.dataHoraFinalizado){const S=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date(o.dataHoraFinalizado).toDateString())-S)/(1e3*60*60*24);e=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}}else if(o.dataHoraPrevisto){const S=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date().toDateString())-S)/(1e3*60*60*24);e=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}const d={id:o.id,codigoCompra:o.codigoCompra||"-",codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoEmpresa:o.codigoEmpresa,descricaoEmpresa:o.descricaoEmpresa,corBorda:e,dataHoraEmissao:new Date(o.dataHoraEmissao),dataHoraFinalizado:new Date(o.dataHoraFinalizado),dataHoraRetorno:new Date(o.dataHoraRetorno),dataHoraPrevisto:new Date(o.dataHoraPrevisto),mostra:!0,nomeCliente:o.nomeCliente||"-",nomeResponsavel:o.nomeResponsavel||"-",numeroVenda:o.numeroVenda||"-",numeroOS:o.numeroOS||"-",status:o.status};n[o.status]&&n[o.status].push(d)}this.listas=n,this.refazFiltro()}catch(t){this.$q.notifyError("Erro na consulta online de oss",t)}}},watch:{entregueInicio(){u.log("AdmOSs","entregueInicio"),this.atualiza()},entregueFim(){u.log("AdmOSs","entregueFim"),this.atualiza()}},created(){u.log("AdmOSs","created()"),this.atualiza()}},K={class:"filters row q-pa-sm q-ma-md bg-white",style:{"border-radius":"5px","min-height":"50px"}},L={class:"col-auto"},j={class:"col-10 col-md-5 q-ml-sm"},G={class:"col-6 col-md q-pl-none"},X={class:"col-6 col-md q-pl-none"},Z={class:"row overflowXOS"},J={class:"bg-white q-pa-xs"},W={key:0,class:"row"},Y={class:"col-12 q-pl-none"},$={style:{display:"block"}},aa={style:{display:"block"}},ea=r("br",null,null,-1),oa=r("br",null,null,-1),ta=r("br",null,null,-1),sa=r("br",null,null,-1);function ra(t,a,n,o,e,d){const S=D("campo"),b=D("draggable"),p=D("OS-trocar-status");return g(),F(T,{id:"Kanban",class:"AdmOS"},{default:i(()=>[s(O,{class:"q-py-sm q-my-sm",color:"none"},{default:i(()=>[s(_,null,{default:i(()=>[f("Kanban")]),_:1})]),_:1}),s(z,{class:"row no-shadow"},{default:i(()=>[s(O,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(_,{class:"q-pa-none"},{default:i(()=>[r("div",K,[r("div",L,[s(k,{icon:"filter_list",round:"",color:"tertiary",class:"no-shadow u-semClique"})]),r("div",j,[s(R,{debounce:500,modelValue:e.fraseFiltro,"onUpdate:modelValue":[a[0]||(a[0]=c=>e.fraseFiltro=c),d.filtraDebounce],placeholder:"Filtrar cliente ou respons\xE1vel"},null,8,["modelValue","onUpdate:modelValue"])]),r("div",G,[s(H,{modelValue:e.prazoSelecionado,"onUpdate:modelValue":a[1]||(a[1]=c=>e.prazoSelecionado=c),options:e.prazoOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por prazo"},null,8,["modelValue","options"])]),r("div",X,[s(H,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[a[2]||(a[2]=c=>e.empresaSelecionada=c),d.refazFiltro],options:e.empresaOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por empresa",onClick:d.empresaOpcoesCarregar},null,8,["modelValue","options","onClick","onUpdate:modelValue"])])])]),_:1})]),_:1})]),_:1}),r("div",Z,[(g(!0),h(w,null,A(e.listas,(c,C)=>(g(),h("div",{key:C,class:"no-shadow q-pa-sm col"},[r("div",J,[s(O,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(_,{class:"q-py-none"},{default:i(()=>[f(m(C),1)]),_:2},1024)]),_:2},1024),C==="Entregue"?(g(),h("div",W,[r("div",Y,[s(S,{modelValue:e.entregueInicio,"onUpdate:modelValue":a[3]||(a[3]=l=>e.entregueInicio=l),class:"q-mx-sm",rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),s(S,{modelValue:e.entregueFim,"onUpdate:modelValue":a[4]||(a[4]=l=>e.entregueFim=l),class:"q-mx-sm",rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])):V("",!0),s(b,{class:"dragAreaOS bg-white",delay:"400",list:c,group:"osGroup",draggable:".extratoOS",onEnd:d.eventoEnd},{default:i(()=>[t.os.mostra&&(e.prazoSelecionado===null||e.prazoSelecionado===t.os.corBorda)?(g(!0),h(w,{key:0},A(c,l=>(g(),F(z,{key:l.codigoDocumento,class:B(["q-pa-sm q-mb-md shadow-2 extratoOS",l.corBorda])},{default:i(()=>[s(x,{class:"q-py-none"},{right:i(()=>[r("div",null,[r("small",$,"Venda: "+m(l.numeroVenda),1),r("small",aa,"OS: "+m(l.numeroOS),1)])]),default:i(()=>[f(m(l.nomeCliente)+" ",1),r("span",null," Empresa: "+m(l.descricaoEmpresa),1)]),_:2},1024),s(N,{class:"q-my-sm"}),s(x,{class:"row q-py-none"},{default:i(()=>[f(" T\xE9cnico: "+m(l.nomeResponsavel),1),ea,f(" Data de Emissao: "+m(t.$filters.data(l.dataHoraEmissao)),1),oa,l.dataHoraRetorno?(g(),h(w,{key:0},[f("Data de Retorno: "+m(t.$filters.data(l.dataHoraRetorno)),1),ta],64)):V("",!0),f(" Previs\xE3o de Entrega: "+m(t.$filters.data(l.dataHoraPrevisto)),1),sa]),_:2},1024)]),_:2},1032,["class"]))),128)):V("",!0)]),_:2},1032,["list","onEnd"])])]))),128))]),s(p,{modelValue:e.trocarStatusModal,"onUpdate:modelValue":a[5]||(a[5]=c=>e.trocarStatusModal=c),dados:e.trocarStatusDados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"])]),_:1})}var da=P(M,[["render",ra]]);export{da as default};
