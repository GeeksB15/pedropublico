import{_ as U,a as j,bH as P,r as k,o as h,n as O,f as e,w as r,G as $,d as v,R as w,S as m,j as N,k as f,M as F,e as C,O as T,F as I,s as J,B as y,T as x,t as S,m as z,Q as V,az as X,l as H,y as B,h as Q,i as Y,N as G,D as Z,as as W,C as K}from"./index.9b156bba.js";import{X as A}from"./xlsx.d5d25b50.js";import{L as aa}from"./Lista.e33ba20c.js";import{N as oa}from"./Nfse.19afc56f.js";import{J as ta}from"./JsonViewer.522116ce.js";import"./QBtnDropdown.2d29d66b.js";import"./QBtnGroup.4d3a3d67.js";import"./QScrollArea.e1ed3c28.js";import"./optionsNfse.12d4a18d.js";const ea={components:{Lista:aa,Nfse:oa,JsonViewer:ta},data(){return{usuario:"",listaLayout:[],lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"mdi-file-replace-outline",titulo:"NFS-e",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!0,toolbarAdicao:!1,bannerMsg:""},busca:"",im:"",filtrosOriginal:{},filtros:{emitente:null,destinatario:null,numeroRps:null,numeroNfse:null,dataEmissaoNfseDe:null,dataEmissaoNfseAte:null,dataCriacaoRpsDe:null,dataCriacaoRpsAte:null},tabSelecionada:{valor:"Rascunho"},tabs:[{valor:"Rascunho",rotulo:"Rascunho"},{valor:"Protocolada",rotulo:"Protocoladas"},{valor:"Enviada",rotulo:"Enviadas"},{valor:"Cancelada",rotulo:"Canceladas"},{valor:"Todos",rotulo:"Todos"}],detalhes:!0,paginacao:{atual:1,maximo:1,total:1,limite:25,ordenacao:"dataEmissao",direcao:"desc"},dialogoSincronizarLote:{visivel:!1,empresa:null,listaEmpresas:[],periodoInicial:null,periodoFinal:null}}},computed:{ordenacaoOpcoes(){return[{value:"dataEmissao",label:"Data de emiss\xE3o"},{value:"dataHoraCriacao",label:"Data de cria\xE7\xE3o"},{value:"numeroRps",label:"RPS (Recibo provis\xF3rio)"},{value:"numeroNfse",label:"N\xFAmero NFS-e"},{value:"xNomeEmitente",label:"Emitente"},{value:"xNomeDestinatario",label:"Destinat\xE1rio"},{value:"valor",label:"Valor"}]},direcaoOpcoes(){return[{value:"asc",label:"Crescente"},{value:"desc",label:"Decrescente"}]}},methods:{async atualizar(i){var o,l,c,u,d,g,b,p,E,_,R;const a=$utils.logarIni("NfseLista");let s=(i==null?void 0:i.buscarDadosRecentes)||!1,t={};s&&(t=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"NfseLista_"+((o=this.usuario)==null?void 0:o.id)}),t!=null&&t._id&&(this.tabSelecionada.valor=t==null?void 0:t.tabSelecionada,this.busca=(t==null?void 0:t.busca)||"",this.filtros={emitente:((l=t==null?void 0:t.filtros)==null?void 0:l.emitente)||null,destinatario:((c=t==null?void 0:t.filtros)==null?void 0:c.destinatario)||null,numeroRps:((u=t==null?void 0:t.filtros)==null?void 0:u.numeroRps)||null,numeroNfse:((d=t==null?void 0:t.filtros)==null?void 0:d.numeroNfse)||null,dataEmissaoNfseDe:((g=t==null?void 0:t.filtros)==null?void 0:g.dataEmissaoNfseDe)||null,dataEmissaoNfseAte:((b=t==null?void 0:t.filtros)==null?void 0:b.dataEmissaoNfseAte)||null,dataCriacaoRpsDe:((p=t==null?void 0:t.filtros)==null?void 0:p.dataCriacaoRpsDe)||null,dataCriacaoRpsAte:((E=t==null?void 0:t.filtros)==null?void 0:E.dataCriacaoRpsAte)||null},this.compareObject(this.filtrosOriginal,this.filtros)&&(this.$refs.nfseLista.filtros=!0))),await $tryLoading(async()=>$db.hibrido.isOnline()?this.atualizarOnline(i):this.atualizarOffline(i)),t={_id:"NfseLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.busca,filtros:$utils.clonar(this.filtros)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:t}),$utils.logarFim(a,(R=(_=this.paginacao)==null?void 0:_.total)!=null?R:1)},async atualizarOffline(i){this.documentos=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}});for(const t of this.documentos){const{rps:o}=JSON.parse(t.json);t.rps=o}const a=this.paginacao.direcao==="asc"?1:-1,s={numeroRps:(t,o)=>{var l,c;return(Number(((l=t.rps.identificacaoRps)==null?void 0:l.numero)||0)-Number(((c=o.rps.identificacaoRps)==null?void 0:c.numero)||0))*a},numeroNfse:(t,o)=>(Number(t.rps.numero||0)-Number(o.rps.numero||0))*a,valor:(t,o)=>{var l,c,u,d;return(Number(((c=(l=t.rps.servico)==null?void 0:l.valores)==null?void 0:c.valorServicos)||0)-Number(((d=(u=o.rps.servico)==null?void 0:u.valores)==null?void 0:d.valorServicos)||0))*a},dataEmissao:(t,o)=>(new Date(t.rps.dataEmissao||0)-new Date(o.rps.dataEmissao||0))*a,dataHoraCriacao:(t,o)=>(new Date(t.rps.dataHoraCriacao||0)-new Date(o.rps.dataHoraCriacao||0))*a,xNomeEmitente:(t,o)=>String(t.xNomeEmitente).localeCompare(String(o.xNomeEmitente))*a,xNomeDestinatario:(t,o)=>String(t.xNomeDestinatario).localeCompare(String(o.xNomeDestinatario))*a}[this.paginacao.ordenacao];if(this.documentos=this.documentos.sort(s),(i==null?void 0:i.id)&&(i==null?void 0:i.situacaoNfse)==="Enviada"){await this.aplicarFiltrosEPaginacao(i);return}await this.aplicarFiltrosEPaginacao()},async atualizarOnline(i){this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor,this.filtros.situacao=this.tabSelecionada.valor==="Todos"?null:this.tabSelecionada.valor;const a={numeroRps:"cast(JSON_VALUE(json, '$.rps.identificacaoRps.numero') as int)",numeroNfse:"cast(JSON_VALUE(json, '$.rps.numero') as int)",dataEmissao:"JSON_VALUE(json, '$.rps.dataEmissao')",dataHoraCriacao:"JSON_VALUE(json, '$.rps.dataHoraCriacao')",valor:"cast(JSON_VALUE(json, '$.rps.servico.valores.valorServicos') as decimal(10,2))"}[this.paginacao.ordenacao]||this.paginacao.ordenacao,s=await $utils.geeksApi({listaNfse:{funcao:"C79B2497-0D9C-4971-8656-2C04FF41F247",where:{...this.filtros,destinatario:this.filtros.destinatario||this.busca,id:i==null?void 0:i.id},limit:this.paginacao.limite,page:this.paginacao.atual,sort:[a],dir:[this.paginacao.direcao]}}),{data:t,total:o,totalPages:l}=s.data.listaNfse;let c=!0;for(const u of t)this.listaLayout.hasOwnProperty(u.id)||(this.listaLayout[u.id]={detalhes:!1}),this.listaLayout[u.id].detalhes||(c=!1);this.$refs.nfseLista.detalhes=c,this.lista=t,this.paginacao.total=o,this.paginacao.maximo=l},async mostrarNfse(i){this.$router.replace({params:{id:i}}),await this.$refs.modalNfse.show(i)},async selecionarEmpresa(){let i;const a={ativo:!0,empresas:!0},s=await $g.promptContato.show({filtro:a,placeholder:"Selecione"});if(!s)throw new Error("Nenhum contato selecionado");s.nome||(i="\xC9 preciso informar a Raz\xE3o Social do Prestador"),!i&&!s.numeroDocumentoMunicipal&&(i="\xC9 preciso informar a inscri\xE7\xE3o municipal");const t=!s.numeroDocumentoNacional||s.numeroDocumentoNacional.length<14;if(!i&&t&&(i="\xC9 preciso informar o CNPJ do Prestador"),i)throw $q.notifyError(i),new Error(i);return s},async criarRps(){var i;try{const a=await this.selecionarEmpresa(),s=(await $db.empresa.le({idContato:a.id}))[0],t=await $db.contatoEndereco.leEnderecoPrincipal(a.id),o={documento:a.numeroDocumentoNacional.match(/\d+/g).join(""),nome:a.nome,inscricaoMunicipal:a.numeroDocumentoMunicipal,nfseOptanteSimples:(s==null?void 0:s.nfseOptanteSimples)||"",nfseIncentivadorCultural:(s==null?void 0:s.nfseIncentivadorCultural)||"",nfseNaturezaOperacao:(s==null?void 0:s.nfseNaturezaOperacao)||"",nfseRegimeTributario:(s==null?void 0:s.nfseRegimeTributario)||"",nfseDescricaoServico:(s==null?void 0:s.nfseDescricaoServico)||"",nfseCodigoServico:(s==null?void 0:s.nfseCodigoServico)||"",nfseAliquotaIss:s==null?void 0:s.nfseAliquotaIss,nfseItensListaDeServico:JSON.parse(s==null?void 0:s.nfseItensListaDeServico)||"",ibgeCod:(t==null?void 0:t.ibgeCod)||"",cidadeUf:(t==null?void 0:t.municipio)+"-"+(t==null?void 0:t.uf)};this.im=(i=a==null?void 0:a.numeroDocumentoMunicipal)!=null?i:"";const l=await this.obterNFSeRPSMaisRecente();$utils.gconsole.log("NfseLista",{im:this.im,nfseRPSMaisRecente:l}),this.$refs.modalNfse.show(null,o,l)}catch(a){console.log(a.message)}},async obterNFSeRPSMaisRecente(){var i,a;if($db.hibrido.isOnline()){const s=await $utils.geeksApi({listaNfse:{funcao:"C79B2497-0D9C-4971-8656-2C04FF41F247",where:{inscricaoMunicipal:this.im},limit:1,page:1,sort:["cast(JSON_VALUE(json, '$.rps.identificacaoRps.numero') as int)"],dir:["desc"]}}),{data:t}=s.data.listaNfse;return(i=t[0])!=null?i:null}else{let s;s=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}}),this.im&&(s=s.filter(o=>JSON.parse(o.json).rps.inscricaoMunicipal===this.im)),s.sort((o,l)=>{var d,g,b,p,E,_,R,q;const c=Number((p=(b=(g=JSON.parse((d=o.json)!=null?d:null))==null?void 0:g.rps)==null?void 0:b.identificacaoRps)==null?void 0:p.numero),u=Number((q=(R=(_=JSON.parse((E=l.json)!=null?E:null))==null?void 0:_.rps)==null?void 0:R.identificacaoRps)==null?void 0:q.numero);return c>u?-1:1});const t=(a=s[0])!=null?a:null;return t!=null&&t.json&&(t.rps=JSON.parse(t.json).rps),t}},async aplicarFiltrosEPaginacao(i){if(this.aplicarFiltroPelaTab({situacaoNfse:i==null?void 0:i.situacaoNfse}),i!=null&&i.id&&(this.busca=i==null?void 0:i.id),/^[A-F|0-9]{8}-[A-F|0-9]{4}-[A-F|0-9]{4}-[A-F|0-9]{4}-[A-F|0-9]{12}$/.test(this.busca)){this.paginacao.atual=1,this.paginacao.maximo=1,this.paginacao.total=1,this.listaTmp=this.listaTmp.filter(o=>o.id===this.busca),this.lista=this.listaTmp;return}if(this.filtros.emitente){const o=new RegExp(this.filtros.emitente,"i");this.listaTmp=this.listaTmp.filter(l=>o.test(l.xNomeEmitente))}if(this.filtros.destinatario||this.busca){const o=this.busca||this.filtros.destinatario,l=new RegExp(o,"i");this.listaTmp=this.listaTmp.filter(c=>l.test(c.xNomeDestinatario))}if(this.filtros.numeroRps){const o=new RegExp(this.filtros.numeroRps);this.listaTmp=this.listaTmp.filter(l=>o.test(l.rps.identificacaoRps.numero))}if(this.filtros.numeroNfse&&(this.listaTmp=this.listaTmp.filter(o=>o.rps.numero===this.filtros.numeroNfse)),this.filtros.dataEmissaoNfseDe&&this.filtros.dataEmissaoNfseDe.length===10){const o=this.filtros.dataEmissaoNfseDe.split("/"),l=new Date(Number(o[2]),Number(o[1])-1,Number(o[0]));this.listaTmp=this.listaTmp.filter(c=>new Date(new Date(c.rps.dataEmissao).toDateString())>=l)}if(this.filtros.dataEmissaoNfseAte&&this.filtros.dataEmissaoNfseAte.length===10){const o=this.filtros.dataEmissaoNfseAte.split("/"),l=new Date(Number(o[2]),Number(o[1])-1,Number(o[0]));this.listaTmp=this.listaTmp.filter(c=>new Date(new Date(c.rps.dataEmissao).toDateString())<=l)}if(this.filtros.dataCriacaoRpsDe&&this.filtros.dataCriacaoRpsDe.length===10){const o=this.filtros.dataCriacaoRpsDe.split("/"),l=new Date(Number(o[2]),Number(o[1])-1,Number(o[0]));this.listaTmp=this.listaTmp.filter(c=>new Date(new Date(c.rps.dataHoraCriacao).toDateString())>=l)}if(this.filtros.dataCriacaoRpsAte&&this.filtros.dataCriacaoRpsAte.length===10){const o=this.filtros.dataCriacaoRpsAte.split("/"),l=new Date(Number(o[2]),Number(o[1])-1,Number(o[0]));this.listaTmp=this.listaTmp.filter(c=>new Date(new Date(c.rps.dataHoraCriacao).toDateString())<=l)}this.setupPaginacao();const a=this.paginacao.atual*this.paginacao.limite-this.paginacao.limite,s=this.paginacao.atual*this.paginacao.limite;this.lista=this.listaTmp.slice(a,s);let t=!0;for(const o of this.lista)this.listaLayout.hasOwnProperty(o.id)||(this.listaLayout[o.id]={detalhes:!1}),this.listaLayout[o.id].detalhes||(t=!1);this.$refs.nfseLista.detalhes=t},aplicarFiltroPelaTab(i){if(this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor,i!=null&&i.situacaoNfse&&(this.tabSelecionada={valor:i.situacaoNfse}),this.tabSelecionada.valor==="Todos"){this.listaTmp=this.documentos;return}const a=this.tabSelecionada.valor;this.listaTmp=this.documentos.filter(s=>s.situacao===a)},setupPaginacao(){const i=Math.ceil(this.listaTmp.length/this.paginacao.limite);this.paginacao.atual=this.paginacao.atual>i?i:this.paginacao.atual,this.paginacao.total=this.listaTmp.length,this.paginacao.maximo=i},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},detalhesClick(){this.detalhes=!this.detalhes,this.lista.forEach(i=>{this.abrirDetalhes(i,this.detalhes)})},async abrirDetalhes(i,a){this.listaLayout[i.id].detalhes=a||!this.listaLayout[i.id].detalhes,this.verificarListaLayout("detalhes")},verificarListaLayout(i){{let a=!0;for(const s of this.lista)this.listaLayout[s.id].detalhes||(a=!1);this.detalhes=a,this.$refs.nfseLista.detalhes=a}},async exportaXLSClick(){try{$q.loading.show();const i=$utils.eliminarVazios(this.filtros);delete i.ativo,this.tabSelecionada.valor==="Ativos"&&(i.ativo=!0),this.tabSelecionada.valor==="Excluidos"&&(i.ativo=!1);const a=await $db.item.leRefatorado({filtros:i,limit:999999,page:1,sort:"descricao"}),s=A.utils.book_new(),t=A.utils.json_to_sheet(a.data,{header:Object.keys(a.data[0])});A.utils.book_append_sheet(s,t,"itens"),A.writeFile(s,"itens.xlsx")}catch(i){$q.notifyError("Erro iniciar",i)}finally{$q.loading.hide()}},abrirModalDeCancelamento(i){$q.dialog({title:"Cancelar NFS-e",message:"Qual o motivo do cancelamento?",prompt:{model:"",isValid:a=>!!a},cancel:!0,persistent:!0}).onOk(async a=>{const{rps:s}=i,t={numero:s.numero,motivoCancelamento:a,inscricaoMunicipal:s.prestador.inscricaoMunicipal,cnpj:s.prestador.documento,codigoMunicipio:s.servico.municipioPrestacaoServico,codigoCancelamento:5};await this.cancelarNfse(t,i)})},async cancelarNfse(i,a){var s,t,o,l,c;this.$q.loading.show();try{if((s=a.rps)!=null&&s.plugNotasConsulta){console.log("cancelamento via plugNotas");const u={motivo:i.motivoCancelamento},d=await $api.plugnotas.nfse.solicitarCancelamentoNFSe((t=a.rps.plugNotasConsulta)==null?void 0:t.id,u);if((d==null?void 0:d.message)==="Cancelamento em processamento"&&((o=d==null?void 0:d.data)==null?void 0:o.protocol))if((await $api.plugnotas.nfse.consultarCancelamentoNFSe((l=d==null?void 0:d.data)==null?void 0:l.protocol)).data.status==="CONCLUIDO"){a.rps.motivoCancelamento=i.motivoCancelamento,a.rps.status="2";const b={...a,situacao:"Cancelada",json:JSON.stringify({rps:a.rps})};await $db.documentoFiscalEletronico.grava({atual:b,original:a});let p={};b.id&&(p=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:b.id}}))[0],await $db.documentoFiscalEletronicoXml.grava({atual:{...p,situacao:b.situacao},original:p})),$q.notifyPositive("NFS-e cancelada!")}else $q.notifyError("N\xE3o foi poss\xEDvel realizar o cancelamento, por favor tente novamente!")}if(!((c=a.rps)!=null&&c.plugNotasConsulta))if((await j.post("https://api.b15.com.br/integradorjs/nfse/cancelar",{jsonParaXML:i})).data.xmlPassou){$q.notifyPositive("NFS-e cancelada!"),a.rps.motivoCancelamento=i.motivoCancelamento,a.rps.status="2";const d={...a,situacao:"Cancelada",json:JSON.stringify({rps:a.rps})};await $db.documentoFiscalEletronico.grava({atual:d,original:a});let g={};d.id&&(g=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:d.id}}))[0],await $db.documentoFiscalEletronicoXml.grava({atual:{...g,situacao:d.situacao},original:g}))}else $q.notifyError("N\xE3o foi poss\xEDvel realizar o cancelamento, por favor tente novamente!")}catch{$q.notifyError("Falha ao enviar XML")}await this.atualizar(),this.$q.loading.hide()},confirmarExclusaoNfse(i){$q.dialog({title:"Remover NFS-e",message:"Deseja remover esta NFS-e?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{await $db.documentoFiscalEletronico.remove(i),$q.notifyPositive("NFS-e removida com sucesso")}catch{$q.notifyError("Falha ao remover NFS-e")}await this.atualizar()})},async downloadPDF(i){var t;let a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:i}),s=JSON.parse((t=a==null?void 0:a.json)!=null?t:null);try{$q.loading.show({message:"Solicitando URL...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),s.rps.pdf=await $db.nfse.solicitarURLImpressao(i);let o=document.createElement("a");o.href=s.rps.pdf,o.download=`nfse-${s.rps.identificacaoRps.numero}.pdf`,o.click()}catch(o){console.error(o.message)}finally{$q.loading.hide()}},async solicitarURLImpressao(i){var o,l,c;let a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:i}),s=JSON.parse((o=a==null?void 0:a.json)!=null?o:null),t;try{$q.loading.show({message:"Solicitando URL...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),t=await $db.nfse.solicitarURLImpressao(i),(l=s==null?void 0:s.rps)!=null&&l.plugNotasConsulta&&window.open("","_blank").document.write(`<iframe width='100%' height='100%' src='${t}'></iframe>`),(c=s==null?void 0:s.rps)!=null&&c.plugNotasConsulta||window.open(t,"_blank"),await this.atualizar()}catch(u){let d=u.message.replace("db.nfse.sincronizarLote: ","");d.length!==u.message&&$q.notifyError(d),d.length===u.message&&console.error(u.message)}finally{$q.loading.hide()}},async solicitarURLImpressaoEmLote(){var a;const i=$utils.clonarV2(this.lista.filter(s=>s.situacao==="Enviada"));i.sort((s,t)=>{var c,u,d,g;const o=(u=(c=s==null?void 0:s.rps)==null?void 0:c.identificacaoRps)==null?void 0:u.numero,l=(g=(d=t==null?void 0:t.rps)==null?void 0:d.identificacaoRps)==null?void 0:g.numero;return o>l?1:-1});for(const s of i)try{let t=await $db.hibrido.le({table:"documentoFiscalEletronico",id:s.id}),o=JSON.parse((a=t==null?void 0:t.json)!=null?a:null),l;l=await $db.nfse.solicitarURLImpressao(s.id)}catch(t){console.log(t.message)}},async baixarXml(i){var t,o;let{xml:a}=i.rps;if((!a||/^https:\/\/.+$/.test(a))&&((o=(t=i.rps)==null?void 0:t.plugNotasConsulta)==null?void 0:o.xml)){const l=i.rps.plugNotasConsulta.xml;a=await $api.plugnotas.nfse.baixarXmlNFSe(l,i)}if(a){const l=document.createElement("a");var s=new Blob([a],{type:"text/plain"});l.setAttribute("href",window.URL.createObjectURL(s)),l.setAttribute("download",`${i.rps.identificacaoRps.numero}.xml`),l.dataset.downloadurl=["text/plain",l.download,l.href].join(":"),l.click()}a||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async recarregarPDF(i){var o,l,c;let a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:i}),s=$utils.clonarV2(a),t=JSON.parse((o=a==null?void 0:a.json)!=null?o:null);(l=t.rps.plugNotasConsulta)!=null&&l.pdf&&((c=t.rps.plugNotasConsulta)==null||delete c.pdf),t.rps.pdf&&delete t.rps.pdf,a.json=t,await $db.documentoFiscalEletronico.grava({atual:a,original:s}),this.solicitarURLImpressao(i)},async enviarEmailNfse(i){var a,s;try{if(this.$q.loading.show(),!i.cpfCnpjDestinatario||!i.id)return;const t=await $db.hibrido.le({table:"documentoFiscalEletronico",id:i.id});if(!(t!=null&&t.id))return;const l=(await $db.contato.ler({filtros:{termoBusca:t.cpfCnpjDestinatario,ativo:!0}})).data.find(b=>{var p;return((p=b.numeroDocumentoNacional)!=null?p:"").replace(/\D/g,"")===t.cpfCnpjDestinatario}),c=(s=JSON.parse((a=t.json)!=null?a:null))==null?void 0:s.rps;if(!c)return;let u;this.$q.loading.hide();try{u=await new Promise((b,p)=>{var E;$q.dialog({title:"Informe o e-mail",message:"E-mail do destinat\xE1rio",prompt:{model:(E=l==null?void 0:l.email)!=null?E:"",isValid:_=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(_.toLowerCase()),type:"text"},cancel:!0,persistent:!1}).onOk(_=>{b(_)}).onCancel(()=>{p("Cancelado pelo usu\xE1rio")}).onDismiss(()=>{p("Cancelado pelo usu\xE1rio")})}).catch(b=>{throw new Error(b)})}catch(b){console.log(b.message);return}this.$q.loading.show();const d=[{name:"nfse.xml",content:c.xml}];c.link&&d.push({name:"nfse.pdf",url:c.link,method:"url2pdf"});const g={host:"smtp.gmail.com",port:587,ssl:!0,auth:{user:"auto@geekssolucoes.com.br",pass:"xpto@9@9"},from:"Geeks Solu\xE7\xF5es <auto@geekssolucoes.com.br>",to:u,subject:`Nota Fiscal Eletr\xF4nica de Servi\xE7os N\xBA ${c.numero}`,text:`Voc\xEA est\xE1 recebendo os arquivos digitais NFS-e (Nota Fiscal Eletr\xF4nica de Servi\xE7os) da empresa ${t.xNomeEmitente}`,attachments:d};await j({baseURL:"https://api.b15.com.br",method:"post",url:"/email/v2",data:g}),this.$q.notifyPositive("E-mail enviado com sucesso")}catch{this.$q.notifyError("Erro ao enviar email")}finally{this.$q.loading.hide()}},async enviarLote(){var i,a;try{$q.loading.show({message:"Preparando envio do lote...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const s=$utils.clonarV2(this.lista.filter(t=>t.situacao==="Rascunho"));$utils.gconsole.log("NFSeEnviaLote",`Inicio envio de lote com ${s.length} notas`);for(const t of s){const o=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:t.id}}))[0],l=t.rps;l!=null&&l.dataEmissao||(l.dataEmissao=$utils.dataAtual()),$q.loading.show({message:`Enviando...
                <br /><br />
                <strong>Lote</strong> ${l.numeroLote}<br />
                <strong>RPS</strong> ${l.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${l.identificacaoRps.serie}<br />
                <br />
                ${l.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),$utils.gconsole.log("NFSeEnviaLote",`rps:${(i=l==null?void 0:l.identificacaoRps)==null?void 0:i.numero} tomador:${l.tomador.razaoSocial}`);const{nfse:c,situacao:u}=await $db.nfse.emitir({nfse:l,aguardarRetorno:!1}),d={id:t.id,tipo:"NFSe",tpAmb:"2",situacao:u,mod:"",serie:"",nNF:"",chNFe:"",vNF:0,dhEmi:P.formatarDataNFe(new Date((a=this.nfse)==null?void 0:a.dataEmissao)),cpfCnpjEmitente:c.prestador.documento,xNomeEmitente:c.prestador.razaoSocial,cpfCnpjDestinatario:c.tomador.documento,xNomeDestinatario:c.tomador.razaoSocial,dataHoraEmissao:c==null?void 0:c.dataEmissao,dataHoraCriacao:t.dataHoraCriacao||$utils.dataAtual(),json:JSON.stringify({rps:c})},g={id:(o==null?void 0:o.id)||$utils.uuid(),tipo:d.tipo,situacao:u,tpAmb:d.tpAmb,dataHoraEnvio:c==null?void 0:c.dataEmissao,cpfCnpjEmitente:c.prestador.documento,xmlEnvio:c.xml,idDocumentoFiscalEletronico:d.id};await $db.documentoFiscalEletronico.grava({atual:d,original:t}),await $db.documentoFiscalEletronicoXml.grava({atual:g,original:o})}await this.atualizar()}catch(s){console.log(s.message)}finally{$q.loading.hide()}},async protocolarLote(){var i;try{$q.loading.show({message:"Preparando envio do lote...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const a=$utils.clonarV2(this.lista.filter(s=>s.situacao==="Protocolada"));a.sort((s,t)=>{var c,u,d,g;const o=(u=(c=s==null?void 0:s.rps)==null?void 0:c.identificacaoRps)==null?void 0:u.numero,l=(g=(d=t==null?void 0:t.rps)==null?void 0:d.identificacaoRps)==null?void 0:g.numero;return o>l?1:-1});for(const s of a){const t=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:s.id}}))[0],o=s==null?void 0:s.rps;o!=null&&o.dataEmissao||(o.dataEmissao=$utils.dataAtual()),$q.loading.show({message:`Enviando...
                <br /><br />
                <strong>Lote</strong> ${o.numeroLote}<br />
                <strong>RPS</strong> ${o.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${o.identificacaoRps.serie}<br />
                <br />
                ${o.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const{nfse:l,situacao:c}=await $db.nfse.emitir({nfse:o,aguardarRetorno:!1}),u={id:s.id,tipo:"NFSe",tpAmb:"2",situacao:c,mod:"",serie:"",nNF:"",chNFe:"",vNF:0,dhEmi:P.formatarDataNFe(new Date((i=this.nfse)==null?void 0:i.dataEmissao)),cpfCnpjEmitente:l.prestador.documento,xNomeEmitente:l.prestador.razaoSocial,cpfCnpjDestinatario:l.tomador.documento,xNomeDestinatario:l.tomador.razaoSocial,dataHoraEmissao:l==null?void 0:l.dataEmissao,dataHoraCriacao:s.dataHoraCriacao||$utils.dataAtual(),json:JSON.stringify({rps:l})},d={id:(t==null?void 0:t.id)||$utils.uuid(),tipo:u.tipo,situacao:c,tpAmb:u.tpAmb,dataHoraEnvio:l==null?void 0:l.dataEmissao,cpfCnpjEmitente:l.prestador.documento,xmlEnvio:l.xml,idDocumentoFiscalEletronico:u.id};await $db.documentoFiscalEletronico.grava({atual:u,original:s}),await $db.documentoFiscalEletronicoXml.grava({atual:d,original:t})}await this.atualizar()}catch(a){console.log(a.message)}finally{$q.loading.hide()}},async abrirDialogoSincronizarLote(){const i=new Date,a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.dialogoSincronizarLote.listaEmpresas=a.map(s=>({value:s.id,label:s.nome+" - "+s.numeroDocumentoNacional,cnpj:s.numeroDocumentoNacional,inscricaoMunicipal:s.numeroDocumentoMunicipal})),this.dialogoSincronizarLote.empresa=this.dialogoSincronizarLote.listaEmpresas[0],this.dialogoSincronizarLote.periodoInicial=i,this.dialogoSincronizarLote.periodoFinal=i,this.dialogoSincronizarLote.visivel=!0},async sincronizarLote(){try{$q.loading.show({message:"Obtendo dados do servidor...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),await $db.nfse.sincronizarLote({inscricaoMunicipal:this.dialogoSincronizarLote.empresa.inscricaoMunicipal,cnpj:this.dialogoSincronizarLote.empresa.cnpj,periodo:{inicial:this.dialogoSincronizarLote.periodoInicial,final:this.dialogoSincronizarLote.periodoFinal}},(i,a)=>$q.loading.show({message:`${a}...
                <br /><br />
                <strong>Lote</strong> ${i.numeroLote}<br />
                <strong>RPS</strong> ${i.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${i.identificacaoRps.serie}<br />
                <br />
                ${i.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})),this.dialogoSincronizarLote.visivel=!1,await this.atualizar()}catch(i){let a=i.message.replace("db.nfse.sincronizarLote: ","");a.length!==i.message&&$q.notifyError(a),a.length===i.message&&console.error(i.message)}finally{$q.loading.hide()}},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)},formatarDocumento(i){const a=i.replace(/\D/g,"");return a.length===11?a.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):a.length===14?a.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/,"$1.$2.$3/$4-$5"):a},compareObject(i,a,s=[]){const t=Object.keys(i);for(const o of t)if(!s.includes(o)){if(typeof i[o]=="object"&&i[o]!==null){if(!this.compareObject(i[o],a[o],s))continue;return!0}else if(i[o]!==a[o])return!0}return!1}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),this.$route.params.id&&this.$route.params.id.length?(await this.atualizar(),this.mostrarNfse(this.$route.params.id)):await this.atualizar({buscarDadosRecentes:!0})}},ia={id:"NfseLista"},sa={class:"mw100 text-center"},la=y("span",{style:{"font-size":"9.5px","margin-left":"3px"}},"RPS",-1),ra=y("span",{style:{"font-size":"9.5px","margin-left":"3px"}},"RPS",-1),na={class:"text-weight-bold"},ca={class:"text-weight-medium"},da={class:"text-weight-medium"},ua={class:"col-12"},ma={class:"col"},fa=y("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[y("label",null,"at\xE9")],-1),pa={class:"col"},ha={class:"q-mt-lg text-right"};function ga(i,a,s,t,o,l){const c=k("campo"),u=k("g-label"),d=k("BadgeCopiarUid"),g=k("avatar"),b=k("badge"),p=k("g-col"),E=k("g-row"),_=k("Lista"),R=k("Nfse"),q=k("JsonViewer"),M=k("row");return h(),O("div",ia,[e(_,{ref:"nfseLista",busca:o.busca,"onUpdate:busca":a[16]||(a[16]=n=>o.busca=n),onAtualizar:l.atualizar,onCriarClick:l.criarRps,onLimparFiltrosClick:l.limparFiltrosClick,onDetalhesClick:l.detalhesClick,onExportaXLSClick:l.exportaXLSClick,lista:o.lista,permissao:!0,tabSelecionada:o.tabSelecionada,tabs:o.tabs,paginacao:o.paginacao,mostrar:o.mostrar},{menuExtras:r(()=>[$((h(),v(w,{onClick:a[0]||(a[0]=n=>l.enviarLote()),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(m,null,{default:r(()=>[f("Enviar Lote")]),_:1})]),_:1})),[[F]]),$((h(),v(w,{onClick:a[1]||(a[1]=n=>l.protocolarLote()),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(m,null,{default:r(()=>[f("Protocolar Lote")]),_:1})]),_:1})),[[F]]),$((h(),v(w,{onClick:a[2]||(a[2]=n=>l.solicitarURLImpressaoEmLote()),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(m,null,{default:r(()=>[f("Solicitar PDF Lote")]),_:1})]),_:1})),[[F]]),$((h(),v(w,{onClick:a[3]||(a[3]=n=>l.abrirDialogoSincronizarLote()),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(m,null,{default:r(()=>[f("Sincronizar Lote")]),_:1})]),_:1})),[[F]]),i.$db.usuario.desenvolvedor()?$((h(),v(w,{key:0,onClick:a[4]||(a[4]=n=>l.mostrarJsonViewer()),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(m,null,{default:r(()=>[f("Ver Objeto")]),_:1})]),_:1})),[[F]]):C("",!0)]),filtroCampos:r(()=>[e(c,{modelValue:o.filtros.emitente,"onUpdate:modelValue":a[5]||(a[5]=n=>o.filtros.emitente=n),dense:"",rotulo:"Emitente",class:"col-12 q-mt-md"},null,8,["modelValue"]),e(c,{modelValue:o.filtros.destinatario,"onUpdate:modelValue":a[6]||(a[6]=n=>o.filtros.destinatario=n),dense:"",rotulo:"Destinat\xE1rio",class:"col-12 q-mt-lg"},null,8,["modelValue"]),e(c,{modelValue:o.filtros.numeroRps,"onUpdate:modelValue":a[7]||(a[7]=n=>o.filtros.numeroRps=n),rotulo:"RPS (Recibo provis\xF3rio)",dense:"",class:"col-12 q-mt-lg"},null,8,["modelValue"]),e(c,{modelValue:o.filtros.numeroNfse,"onUpdate:modelValue":a[8]||(a[8]=n=>o.filtros.numeroNfse=n),dense:"",rotulo:"N\xFAmero NFS-e",class:"col-12 q-mt-lg"},null,8,["modelValue"]),e(u,{class:"q-mt-xl",caption:""},{default:r(()=>[f("Data de emiss\xE3o")]),_:1}),e(c,{modelValue:o.filtros.dataEmissaoNfseDe,"onUpdate:modelValue":a[9]||(a[9]=n=>o.filtros.dataEmissaoNfseDe=n),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"De",class:"col-12"},null,8,["modelValue"]),e(c,{modelValue:o.filtros.dataEmissaoNfseAte,"onUpdate:modelValue":a[10]||(a[10]=n=>o.filtros.dataEmissaoNfseAte=n),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"At\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),e(u,{class:"q-mt-xl",caption:""},{default:r(()=>[f("Data de cria\xE7\xE3o RPS")]),_:1}),e(c,{modelValue:o.filtros.dataCriacaoRpsDe,"onUpdate:modelValue":a[11]||(a[11]=n=>o.filtros.dataCriacaoRpsDe=n),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"De",class:"col-12"},null,8,["modelValue"]),e(c,{modelValue:o.filtros.dataCriacaoRpsAte,"onUpdate:modelValue":a[12]||(a[12]=n=>o.filtros.dataCriacaoRpsAte=n),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"At\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),e(c,{modelValue:o.paginacao.ordenacao,"onUpdate:modelValue":a[13]||(a[13]=n=>o.paginacao.ordenacao=n),options:l.ordenacaoOpcoes,dense:"",tipo:"seletor",rotulo:"Ordena\xE7\xE3o",class:"col-12 q-mt-xl"},null,8,["modelValue","options"]),e(c,{modelValue:o.paginacao.direcao,"onUpdate:modelValue":a[14]||(a[14]=n=>o.paginacao.direcao=n),options:l.direcaoOpcoes,dense:"",tipo:"seletor",rotulo:"Dire\xE7\xE3o",class:"col-12 q-mt-xs"},null,8,["modelValue","options"]),e(c,{modelValue:o.paginacao.limite,"onUpdate:modelValue":a[15]||(a[15]=n=>o.paginacao.limite=n),tipo:"quantidade",min:"1",rotulo:"Quantidade por p\xE1gina",class:"col-12 q-mt-xl"},null,8,["modelValue"])]),itemLista:r(()=>[e(T,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:r(()=>[(h(!0),O(I,null,J(o.lista,n=>(h(),O("div",{key:n,class:"itemHover"},[n?(h(),v(w,{key:0,"manual-focus":"",clickable:"",class:"q-py-sm q-px-xs items-center"},{default:r(()=>[e(m,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:r(()=>[y("div",sa,[n.rps.identificacaoRps.numero?(h(),v(x,{key:0},{default:r(()=>[e(d,{cor:"tertiary",dica:"Recibo provis\xF3rio",numero:String(n.rps.identificacaoRps.numero||0),id:String(n.rps.identificacaoRps.numero||0)},{default:r(()=>[la]),_:2},1032,["numero","id"])]),_:2},1024)):C("",!0),e(x,null,{default:r(()=>[e(d,{numero:String(n.rps.numero),id:n.id,cor:"positive",dica:"N\xBA Nota"},null,8,["numero","id"])]),_:2},1024)])]),_:2},1024),e(m,{class:"col-md col-lg col-xl no-margin"},{default:r(()=>[e(w,{class:"q-pa-none"},{default:r(()=>[e(m,{class:"col-auto items-center"},{default:r(()=>[e(g,{rotulo:n==null?void 0:n.xNomeDestinatario,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["rotulo"])]),_:2},1024),e(m,{onClick:D=>l.mostrarNfse(n.id),class:"col"},{default:r(()=>[e(x,{class:"text-weight-bold"},{default:r(()=>[y("span",null,[f(S(n.xNomeDestinatario)+" ",1),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[f(" Destinat\xE1rio ")]),_:1})])]),_:2},1024),e(x,{caption:""},{default:r(()=>[y("span",null,[f(S(l.formatarDocumento(n.cpfCnpjDestinatario))+" ",1),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[f(" CPF/CNPJ ")]),_:1})])]),_:2},1024),e(m,{class:"hideondesktop q-mt-sm"},{default:r(()=>[e(x,null,{default:r(()=>[e(d,{cor:"tertiary",dica:"Recibo provis\xF3rio",numero:String(n.rps.identificacaoRps.numero||0),id:String(n.rps.identificacaoRps.numero||0)},{default:r(()=>[ra]),_:2},1032,["numero","id"]),e(d,{numero:String(n.rps.numero),id:n.id,cor:"positive",dica:"N\xBA Nota"},null,8,["numero","id"]),e(b,{rotulo:n.situacao,escuro:"",cor:"tertiary"},null,8,["rotulo"])]),_:2},1024),e(x,{caption:"",class:"q-pt-xs"},{default:r(()=>[e(N,{name:"mdi-calendar-today",size:"xs"}),y("span",na,S(i.$filters.data(n.rps.dataEmissao)),1),f(" "+S(i.$filters.hora(n.rps.dataEmissao)),1)]),_:2},1024),e(w,{class:"q-pa-none",style:{"min-height":"36px!important"}},{default:r(()=>[e(m,{class:"col-shrink no-margin"},{default:r(()=>[n.rps.mensagemDeRetorno?(h(),v(N,{key:0,name:"report",size:"sm",color:"red-7"},{default:r(()=>[e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[f(S(n.rps.mensagemDeRetorno),1)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1024),e(m,{class:"no-margin"},{default:r(()=>[e(x,{class:"text-weight-bold text-right"},{default:r(()=>[f(S(i.$filters.numero(n.rps.servico.valores.valorServicos,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(m,{onClick:D=>l.mostrarNfse(n.id),style:{width:"35px"},class:"hideonmobile col-shrink q-pl-sm no-margin"},{default:r(()=>[n.rps.mensagemDeRetorno?(h(),v(N,{key:0,name:"report",size:"md",color:"red-7"},{default:r(()=>[e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[f(S(n.rps.mensagemDeRetorno),1)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1032,["onClick"]),e(m,{onClick:D=>l.mostrarNfse(n.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:r(()=>[e(b,{rotulo:n.situacao,escuro:"",cor:"tertiary",dica:"Situa\xE7\xE3o",class:"col-auto q-mx-auto"},null,8,["rotulo"])]),_:2},1032,["onClick"]),e(m,{onClick:D=>l.mostrarNfse(n.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:r(()=>[e(w,{class:"q-pa-none"},{default:r(()=>[e(m,{side:"",class:"q-pr-xs text-center"},{default:r(()=>[e(N,{name:"mdi-calendar-today",size:"xs"})]),_:1}),e(m,null,{default:r(()=>[e(x,{caption:"",class:"text-weight-bold"},{default:r(()=>[f(S(i.$filters.data(n.rps.dataEmissao)),1)]),_:2},1024),e(x,{caption:""},{default:r(()=>[f(S(i.$filters.hora(n.rps.dataEmissao)),1)]),_:2},1024)]),_:2},1024),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[f(" Data de emiss\xE3o ")]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),e(m,{onClick:D=>l.mostrarNfse(n.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:r(()=>[e(x,{caption:"",class:"text-weight-bold text-right"},{default:r(()=>[y("span",null,[f(S(i.$filters.numero(n.rps.servico.valores.valorServicos,2))+" ",1),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[f(" Valor dos Servi\xE7os ")]),_:1})])]),_:2},1024)]),_:2},1032,["onClick"]),e(m,{class:"col-auto q-pl-sm no-margin"},{default:r(()=>[e(w,{class:"q-pa-none"},{default:r(()=>[e(m,{class:"no-margin hideonmobile",style:{width:"32px"}},{default:r(()=>[e(V,{onClick:D=>l.abrirDetalhes(n),flat:"",round:"",dense:"",color:"tertiary",size:"md",icon:o.listaLayout[n==null?void 0:n.id].detalhes?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["onClick","icon"])]),_:2},1024),e(m,{class:"no-margin hideonmobile",style:{width:"32px"}},{default:r(()=>[e(V,{onClick:D=>l.mostrarNfse(n.id),dense:"",flat:"",round:"",icon:"edit",size:"md",color:"primary"},null,8,["onClick"])]),_:2},1024),n.situacao==="Enviada"||n.situacao==="Rascunho"?(h(),v(m,{key:0,class:"no-margin",style:{width:"32px"}},{default:r(()=>[e(V,{icon:"more_vert",size:"md",dense:"",flat:"",round:""},{default:r(()=>[e(X,null,{default:r(()=>[$((h(),v(T,{link:"","no-border":"",separator:""},{default:r(()=>{var D;return[e(w,{onClick:L=>l.abrirDetalhes(n),clickable:"",class:"hideondesktop"},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:o.listaLayout[n==null?void 0:n.id].detalhes?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]),_:2},1024),e(m,null,{default:r(()=>[f("Ver Detalhes")]),_:1})]),_:2},1032,["onClick"]),e(w,{onClick:L=>l.mostrarNfse(n.id),clickable:"",class:"hideondesktop"},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"edit"})]),_:1}),e(m,null,{default:r(()=>[f("Editar")]),_:1})]),_:2},1032,["onClick"]),n.situacao==="Rascunho"?(h(),v(w,{key:0,onClick:L=>l.confirmarExclusaoNfse(n.id),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"delete"})]),_:1}),e(m,null,{default:r(()=>[f("Remover")]),_:1})]),_:2},1032,["onClick"])):C("",!0),n.situacao==="Enviada"&&n.id?(h(),v(w,{key:1,onClick:L=>l.solicitarURLImpressao(n.id),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"print"})]),_:1}),e(m,null,{default:r(()=>[f("Imprimir")]),_:1})]),_:2},1032,["onClick"])):C("",!0),n.situacao==="Enviada"&&((D=n.rps)==null?void 0:D.plugNotasConsulta)?(h(),v(w,{key:2,onClick:L=>l.downloadPDF(n.id),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"download_for_offline"})]),_:1}),e(m,null,{default:r(()=>[f("Download PDF")]),_:1})]),_:2},1032,["onClick"])):C("",!0),n.situacao==="Enviada"&&n.id?(h(),v(w,{key:3,onClick:L=>l.recarregarPDF(n.id),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"download_for_offline"})]),_:1}),e(m,null,{default:r(()=>[f("Recarregar PDF")]),_:1})]),_:2},1032,["onClick"])):C("",!0),n.situacao==="Enviada"&&n.rps.numero?(h(),v(w,{key:4,onClick:L=>l.abrirModalDeCancelamento(n),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"delete"})]),_:1}),e(m,null,{default:r(()=>[f("Cancelar")]),_:1})]),_:2},1032,["onClick"])):C("",!0),n.situacao==="Enviada"&&n.rps.xml?(h(),v(w,{key:5,onClick:L=>l.baixarXml(n),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"mdi-download"})]),_:1}),e(m,null,{default:r(()=>[f("Baixar XML")]),_:1})]),_:2},1032,["onClick"])):C("",!0),n.situacao==="Enviada"&&n.rps.xml?(h(),v(w,{key:6,onClick:L=>l.enviarEmailNfse(n),clickable:""},{default:r(()=>[e(m,{avatar:""},{default:r(()=>[e(N,{name:"mail"})]),_:1}),e(m,null,{default:r(()=>[f("Enviar por email")]),_:1})]),_:2},1032,["onClick"])):C("",!0)]}),_:2},1024)),[[F]])]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0),o.listaLayout[n==null?void 0:n.id].detalhes?(h(),v(E,{key:1,gutter:"md-x lg-y",items:"center",justify:"center"},{default:r(()=>[e(p,{col:"xs12 md4",bordered:""},{default:r(()=>[e(u,{caption:"",class:"text-tertiary"},{default:r(()=>[f("Emitente")]),_:1}),e(u,{text:"medium"},{default:r(()=>[f(S(n.xNomeEmitente),1)]),_:2},1024)]),_:2},1024),e(p,{col:"xs12 md4",bordered:""},{default:r(()=>[e(E,{items:"center",justify:"center"},{default:r(()=>[e(p,{col:"shrink"},{default:r(()=>[e(N,{name:"event",size:"sm"})]),_:1}),e(p,{col:"grow"},{default:r(()=>[e(u,{caption:""},{default:r(()=>[f("Cria\xE7\xE3o RPS")]),_:1}),e(u,null,{default:r(()=>[y("span",ca,S(i.$filters.data(n.rps.dataHoraCriacao)),1),f(" "+S(i.$filters.hora(n.rps.dataHoraCriacao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(p,{col:"xs12 md4",bordered:""},{default:r(()=>[e(E,{items:"center",justify:"center"},{default:r(()=>[e(p,{col:"shrink"},{default:r(()=>[e(N,{name:"today",size:"sm"})]),_:1}),e(p,{col:"grow"},{default:r(()=>[e(u,{caption:""},{default:r(()=>[f("Emiss\xE3o NFS-e")]),_:1}),e(u,null,{default:r(()=>[y("span",da,S(i.$filters.data(n.rps.dataEmissao)),1),f(" "+S(i.$filters.hora(n.rps.dataEmissao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0),n?(h(),v(H,{key:2})):C("",!0)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onCriarClick","onLimparFiltrosClick","onDetalhesClick","onExportaXLSClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),e(R,{onAtualizar:l.atualizar,ref:"modalNfse"},null,8,["onAtualizar"]),e(q,{ref:"jsonViewer"},null,512),e(K,{modelValue:o.dialogoSincronizarLote.visivel,"onUpdate:modelValue":a[20]||(a[20]=n=>o.dialogoSincronizarLote.visivel=n),"content-css":{minWidth:"50vw"}},{default:r(()=>[e(B,null,{default:r(()=>[e(Q,{class:"bg-primary text-white"},{default:r(()=>[e(Y,null,{default:r(()=>[f("Sincronizar Lote")]),_:1}),$(e(V,{dense:"",flat:"",icon:"close",round:""},null,512),[[F]])]),_:1}),e(G,null,{default:r(()=>[e(Z,{onSubmit:l.sincronizarLote},{default:r(()=>[e(M,{class:"q-col-gutter-md"},{default:r(()=>[y("div",ua,[e(W,{modelValue:o.dialogoSincronizarLote.empresa,"onUpdate:modelValue":a[17]||(a[17]=n=>o.dialogoSincronizarLote.empresa=n),label:"Empresa",options:o.dialogoSincronizarLote.listaEmpresas,"option-value":"id","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","options"])]),y("div",ma,[e(c,{modelValue:o.dialogoSincronizarLote.periodoInicial,"onUpdate:modelValue":a[18]||(a[18]=n=>o.dialogoSincronizarLote.periodoInicial=n),tipo:"data",dense:"",outlined:""},null,8,["modelValue"])]),fa,y("div",pa,[e(c,{modelValue:o.dialogoSincronizarLote.periodoFinal,"onUpdate:modelValue":a[19]||(a[19]=n=>o.dialogoSincronizarLote.periodoFinal=n),tipo:"data",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),y("div",ha,[$(e(V,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[F]]),e(V,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Sincronizar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var ka=U(ea,[["render",ga]]);export{ka as default};
