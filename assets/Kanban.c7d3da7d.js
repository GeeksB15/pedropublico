import{_ as P,bQ as y,bL as u,ay as v,b4 as E,bE as q,ch as U,r as O,o as g,d as F,w as i,f as s,h as D,i as _,k as f,z,C as r,Q as k,s as R,au as A,p as S,F as w,u as H,t as m,e as V,v as B,O as x,l as N,J as Q}from"./index.a1a1867c.js";import{C as T}from"./Campo.5cd61c3c.js";import{d as I}from"./vuedraggable.umd.3e5fe9dd.js";const M={components:{Campo:T,draggable:I},data(){return{empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date(y()).toDateString()),entregueFim:new Date(new Date(y()).toDateString()),fraseFiltro:"",listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeOS"},{label:"Entrega para esta semana",value:"bordaAmarelaOS"},{label:"Entrega atrasada",value:"bordaVermelhaOS"}]}},methods:{async eventoEnd(){for(const t in this.listas)for(const e of this.listas[t])if(e.status!==t){u.log("AdmOS","eventoEnd De:",e.status,"Para:",t,"codigo:",e.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.status,statusNovo:t},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(t){u.log("AdmOS","eventoConfirmaTroca",{...t}),this.$q.loading.show();try{let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(o=>{var a;return o.numeroDocumentoNacional.replace(/\D/g,"")===((a=$db.usuario.logado.cpf)==null?void 0:a.replace(/\D/g,""))})),t.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await v.os.trocaStatusOnline(t),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(e){this.$q.notifyError("Erro na troca de status",e)}finally{this.$q.loading.hide()}},eventoCancelarTroca(t){u.log("AdmOS","eventoCancelarTroca",t),this.atualiza()},async empresaOpcoesCarregar(){u.log("AdmOS","empresaOpcoesCarregar()"),this.empresaOpcoes=(await v.empresa.leOnline()).map(t=>({label:t.nome,value:t.codigoContato}))},filtraDebounce(){E.exports.debounce(this.refazFiltro,700)()},refazFiltro(){u.log("AdmOSs","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const t=q(this.fraseFiltro.toUpperCase()).split(" ").filter(e=>e!=="");for(const e in this.listas)for(const n of this.listas[e]){const o=q(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroOS)+" ");let a=!0;for(const d of t)isNaN(Number(d))?a=a&&o.includes(d):a=a&&o.includes(" "+d+" ");this.empresaSelecionada&&(a=a&&this.empresaSelecionada===n.codigoEmpresa),n.mostra=a}},async atualiza(){try{const t=await v.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim});u.log("AdmOS","atualiza()",t.length),U(!t||!t.length,"N\xE3o h\xE1 ordens de servi\xE7o");let e=await v.configuracoes.le({nome:"vendas.os.status"});e=e.filter(o=>!["Processando","Entregue"].includes(o.texto));const n={Processando:[]};for(const o of E.exports.orderBy(e,"valor","asc").map(a=>a.texto))n[o]=[];n.Entregue=[];for(const o of t){let a="bordaVerdeOS";if(o.status==="Entregue"){if(!!o.dataHoraPrevisto&&!!o.dataHoraFinalizado){const h=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date(o.dataHoraFinalizado).toDateString())-h)/(1e3*60*60*24);a=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}}else if(o.dataHoraPrevisto){const h=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date().toDateString())-h)/(1e3*60*60*24);a=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}const d={id:o.id,codigoCompra:o.codigoCompra||"-",codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoEmpresa:o.codigoEmpresa,descricaoEmpresa:o.descricaoEmpresa,corBorda:a,dataHoraEmissao:new Date(o.dataHoraEmissao),dataHoraFinalizado:new Date(o.dataHoraFinalizado),dataHoraRetorno:new Date(o.dataHoraRetorno),dataHoraPrevisto:new Date(o.dataHoraPrevisto),mostra:!0,nomeCliente:o.nomeCliente||"-",nomeResponsavel:o.nomeResponsavel||"-",numeroVenda:o.numeroVenda||"-",numeroOS:o.numeroOS||"-",status:o.status};n[o.status]&&n[o.status].push(d)}this.listas=n,this.refazFiltro()}catch(t){this.$q.notifyError("Erro na consulta online de oss",t)}}},watch:{entregueInicio(){u.log("AdmOSs","entregueInicio"),this.atualiza()},entregueFim(){u.log("AdmOSs","entregueFim"),this.atualiza()}},created(){u.log("AdmOSs","created()"),this.atualiza()}},K={class:"filters row q-pa-sm q-ma-md bg-white",style:{"border-radius":"5px","min-height":"50px"}},L={class:"col-auto"},j={class:"col-10 col-md-5 q-ml-sm"},G={class:"col-6 col-md q-pl-none"},J={class:"col-6 col-md q-pl-none"},X={class:"row overflowXOS"},W={class:"bg-white q-pa-xs"},Y={key:0,class:"row"},Z={class:"col-12 q-pl-none"},$={style:{display:"block"}},ee={style:{display:"block"}},ae=r("br",null,null,-1),oe=r("br",null,null,-1),te=r("br",null,null,-1),se=r("br",null,null,-1);function re(t,e,n,o,a,d){const h=O("campo"),b=O("draggable"),p=O("OS-trocar-status");return g(),F(Q,{id:"Kanban",class:"AdmOS"},{default:i(()=>[s(D,{class:"q-py-sm q-my-sm",color:"none"},{default:i(()=>[s(_,null,{default:i(()=>[f("Kanban")]),_:1})]),_:1}),s(z,{class:"row no-shadow"},{default:i(()=>[s(D,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(_,{class:"q-pa-none"},{default:i(()=>[r("div",K,[r("div",L,[s(k,{icon:"filter_list",round:"",color:"tertiary",class:"no-shadow u-semClique"})]),r("div",j,[s(R,{debounce:500,modelValue:a.fraseFiltro,"onUpdate:modelValue":[e[0]||(e[0]=c=>a.fraseFiltro=c),d.filtraDebounce],placeholder:"Filtrar cliente ou respons\xE1vel"},null,8,["modelValue","onUpdate:modelValue"])]),r("div",G,[s(A,{modelValue:a.prazoSelecionado,"onUpdate:modelValue":e[1]||(e[1]=c=>a.prazoSelecionado=c),options:a.prazoOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por prazo"},null,8,["modelValue","options"])]),r("div",J,[s(A,{modelValue:a.empresaSelecionada,"onUpdate:modelValue":[e[2]||(e[2]=c=>a.empresaSelecionada=c),d.refazFiltro],options:a.empresaOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por empresa",onClick:d.empresaOpcoesCarregar},null,8,["modelValue","options","onClick","onUpdate:modelValue"])])])]),_:1})]),_:1})]),_:1}),r("div",X,[(g(!0),S(w,null,H(a.listas,(c,C)=>(g(),S("div",{key:C,class:"no-shadow q-pa-sm col"},[r("div",W,[s(D,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(_,{class:"q-py-none"},{default:i(()=>[f(m(C),1)]),_:2},1024)]),_:2},1024),C==="Entregue"?(g(),S("div",Y,[r("div",Z,[s(h,{modelValue:a.entregueInicio,"onUpdate:modelValue":e[3]||(e[3]=l=>a.entregueInicio=l),class:"q-mx-sm",rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),s(h,{modelValue:a.entregueFim,"onUpdate:modelValue":e[4]||(e[4]=l=>a.entregueFim=l),class:"q-mx-sm",rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])):V("",!0),s(b,{class:"dragAreaOS bg-white",delay:"400",list:c,group:"osGroup",draggable:".extratoOS",onEnd:d.eventoEnd},{default:i(()=>[t.os.mostra&&(a.prazoSelecionado===null||a.prazoSelecionado===t.os.corBorda)?(g(!0),S(w,{key:0},H(c,l=>(g(),F(z,{key:l.codigoDocumento,class:B(["q-pa-sm q-mb-md shadow-2 extratoOS",l.corBorda])},{default:i(()=>[s(x,{class:"q-py-none"},{right:i(()=>[r("div",null,[r("small",$,"Venda: "+m(l.numeroVenda),1),r("small",ee,"OS: "+m(l.numeroOS),1)])]),default:i(()=>[f(m(l.nomeCliente)+" ",1),r("span",null," Empresa: "+m(l.descricaoEmpresa),1)]),_:2},1024),s(N,{class:"q-my-sm"}),s(x,{class:"row q-py-none"},{default:i(()=>[f(" T\xE9cnico: "+m(l.nomeResponsavel),1),ae,f(" Data de Emissao: "+m(t.$filters.data(l.dataHoraEmissao)),1),oe,l.dataHoraRetorno?(g(),S(w,{key:0},[f("Data de Retorno: "+m(t.$filters.data(l.dataHoraRetorno)),1),te],64)):V("",!0),f(" Previs\xE3o de Entrega: "+m(t.$filters.data(l.dataHoraPrevisto)),1),se]),_:2},1024)]),_:2},1032,["class"]))),128)):V("",!0)]),_:2},1032,["list","onEnd"])])]))),128))]),s(p,{modelValue:a.trocarStatusModal,"onUpdate:modelValue":e[5]||(e[5]=c=>a.trocarStatusModal=c),dados:a.trocarStatusDados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"])]),_:1})}var de=P(M,[["render",re]]);export{de as default};
