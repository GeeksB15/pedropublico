import{_ as y,o as d,d as f,w as a,f as e,z as M,h as k,i as D,k as m,H as F,Q as z,N,C as r,dg as S,p as _,F as I,u as C,t as c,D as $,M as V,G as L,s as R,I as j,J as P,B as O,P as Q,S as x,T as p,U as h,bn as v,e as g,X as U,c6 as K,aZ as G,bo as J,r as b,m as X,aP as A,j as w}from"./index.a1a1867c.js";import{n as Z}from"./nfeInutilizacao.da70e674.js";import"./compactarValidarNFe.b0a0ca66.js";const W={data:function(){return{idEmitente:"",inutilizadas:[]}},methods:{async abrirModalfaixasInutilizadas(){$utils.gconsole.log("ConfiguracoesDocumentosFiscais","abrirModalFaixasInutilizadas"),this.$refs.dialogFaixasInutilizadas.show()},async selecionarEmpresaInutilizacao(s){try{const o=s.id;if(!o)return;let l=await $db.contato.le({id:o});this.idEmpresa=o,$utils.verificarErro(!l||!l.id,"N\xE3o foi poss\xEDvel recuperar os dados da empresa."),$utils.verificarErro(!l.numeroDocumentoNacional,"Empresa emitente sem CNPJ cadastrado")}catch(o){this.$q.notifyError("Erro ao selecionar a empresa.",o)}}},async created(){const s=await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{situacao:"Inutilizado"}});this.inutilizadas=[];for(let o in s){const l=new DOMParser().parseFromString(s[o].xmlEnvio,"text/xml"),u=l.getElementsByTagName("nNFIni")[0].innerHTML,i=l.getElementsByTagName("nNFFin")[0].innerHTML,n=(await $db.empresa.le()).filter(t=>{if($utils.filtrarDigitos(t.numeroDocumentoNacional)===$utils.filtrarDigitos(s[o].cpfCnpjEmitente))return t});this.inutilizadas.push({dataHoraEnvio:new Date(s[o].dataHoraEnvio),emitente:`${n[0].apelido}`,operacao:s[o].operacao,status:s[o].status,nNFIni:u,nNFFin:i})}}},Y={class:"layout-padding"},ee=r("thead",null,[r("tr",null,[r("th",{class:"text-left"},"Data"),r("th",{class:"text-left"},"Emitente"),r("th",{class:"text-right"},"Numera\xE7\xE3o Inicial"),r("th",{class:"text-right"},"Numera\xE7\xE3o Final"),r("th",{class:"text-right"},"Opera\xE7\xE3o"),r("th",{class:"text-right"},"Status")])],-1),te={class:"text-left"},ae={class:"text-left"},oe={class:"text-right"},se={class:"text-right"},ne={class:"text-right"},ie={class:"text-right"};function re(s,o,l,u,i,n){return d(),f($,{ref:"dialogFaixasInutilizadas","full-width":""},{default:a(()=>[e(M,{class:"q-dialog-plugin"},{default:a(()=>[e(k,{class:"bg-primary text-white"},{default:a(()=>[e(D,null,{default:a(()=>[m("Relat\xF3rio de faixas Inutilizadas")]),_:1}),F(e(z,{dense:"",flat:"",icon:"close",round:""},null,512),[[N]])]),_:1}),r("div",Y,[e(S,null,{default:a(()=>[ee,r("tbody",null,[(d(!0),_(I,null,C(s.inutilizadas,t=>(d(),_("tr",{key:t.id},[r("td",te,c(t.dataHoraEnvio),1),r("td",ae,c(t.emitente),1),r("td",oe,c(t.nNFIni),1),r("td",se,c(t.nNFFin),1),r("td",ne,c(t.operacao),1),r("td",ie,c(t.status),1)]))),128))])]),_:1})])]),_:1})]),_:1},512)}var le=y(W,[["render",re]]);const ce={components:{},computed:{documentosEncontrados(){return this.documentos.length>0}},data(){return{contatos:{},carregando:!1,documentos:[],termoBusca:null}},emits:["idDocumentoSelecionado"],methods:{async atualizar(){try{const s={},o=[],l=[];let u=[],i=this.termoBusca;this.carregando=!0,/^#\d+$/g.test(this.termoBusca)&&(i=this.termoBusca.slice(1));for(const n of this.componentProps.documentos){const t=await $db.hibrido.lista({table:"documento",where:n});u=u.concat(t)}for(const n of u)i&&Number(i)!==Number(n.numero)&&Number(i)!==Number(n.codigoDocumento)||(o.push(n),l.push(n.idContato),l.push(n.idEmpresa));o.sort((n,t)=>new Date(n.dataHoraFinalizado)>new Date(t.dataHoraFinalizado)?-1:1);for(const n of Array.from(new Set(l))){const t=await $db.contato.le({id:n});!(t!=null&&t.id)||(s[t.id]=t)}this.contatos=s,this.documentos=o.slice(0,30)}catch(s){console.log(s.message)}finally{this.carregando=!1}},hide(){this.componentProps.visivel=!1},selecionar(s){this.$emit("idDocumentoSelecionado",s)}},props:{componentProps:{default:()=>({visivel:!1,documentos:[]}),required:!0,type:Object}},watch:{"componentProps.visivel"(s){if(s){const o=setInterval(()=>{this.$refs.search&&(this.$refs.search.focus(),clearInterval(o))},100);this.atualizar()}s||(this.contatos={},this.carregando=!1,this.documentos=[],this.termoBusca=null)}}},de={class:"col-xs-12 col-sm-12"},ue={key:0,class:"q-px-sm"},me={class:"text-h6"},fe=r("span",{class:"text-weight-bold"},"Emitente",-1),pe=r("span",{class:"text-weight-bold"},"Destinat\xE1rio",-1),_e=r("span",{class:"text-weight-bold"},"Emiss\xE3o",-1),he=r("span",{class:"text-weight-bold"},"Finaliza\xE7\xE3o",-1),ge={key:1,class:"row justify-center q-pt-sm"},be={key:2,class:"bg-light q-pa-lg round-borders text-black text-center"};function Fe(s,o,l,u,i,n){return d(),f($,{modelValue:l.componentProps.visivel,"onUpdate:modelValue":o[1]||(o[1]=t=>l.componentProps.visivel=t),persistent:"",maximized:"",onKeyup:G(n.hide,["esc"])},{default:a(()=>[e(V,{class:"bg-white",container:"",view:"hHr lpR fFr"},{default:a(()=>[e(L,null,{default:a(()=>[e(k,null,{default:a(()=>[e(z,{dense:"",flat:"",icon:"arrow_back",round:"",onClick:n.hide},null,8,["onClick"]),e(D,{class:"row"},{default:a(()=>[r("div",de,[e(R,{modelValue:i.termoBusca,"onUpdate:modelValue":[o[0]||(o[0]=t=>i.termoBusca=t),n.atualizar],color:"none",ref:"search",dark:"",dense:"",placeholder:"Filtre pelo n\xFAmero ou c\xF3digo",debounce:"600",clearable:"","clear-icon":"close"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1})]),_:1}),e(j,null,{default:a(()=>[e(P,null,{default:a(()=>[!i.carregando&&n.documentosEncontrados?(d(),_("div",ue,[O(s.$slots,"content",{documentos:i.documentos,contatos:i.contatos},()=>[e(Q,{separator:""},{default:a(()=>[(d(!0),_(I,null,C(i.documentos,t=>F((d(),f(x,{key:t.id,clickable:"",onClick:E=>n.selecionar(t.id)},{default:a(()=>[e(p,{"no-wrap":""},{default:a(()=>[e(h,{caption:"",lines:"1"},{default:a(()=>[r("span",me,c(t.operacao),1)]),_:2},1024),e(h,{caption:"",lines:"4"},{default:a(()=>[fe,m(" "+c(i.contatos[t.idEmpresa].nome)+" - "+c(i.contatos[t.idEmpresa].numeroDocumentoNacional),1)]),_:2},1024),e(h,{caption:"",lines:"4"},{default:a(()=>[pe,m(" "+c(i.contatos[t.idContato].nome)+" - "+c(i.contatos[t.idContato].numeroDocumentoNacional),1)]),_:2},1024)]),_:2},1024),e(p,{"no-wrap":"",side:""},{default:a(()=>[e(h,{caption:"",lines:"1"},{default:a(()=>[t.numero&&t.codigoDocumento?(d(),_(I,{key:0},[e(v,{class:"q-ml-sm",color:"positive",escuro:""},{default:a(()=>[m(" N\xFAm. #"+c(parseInt(t.numero)),1)]),_:2},1024),e(v,{class:"q-ml-sm",color:"positive",escuro:""},{default:a(()=>[m(" C\xF3d. #"+c(parseInt(t.codigoDocumento)),1)]),_:2},1024)],64)):g("",!0),t.numero&&t.codigoDocumento?g("",!0):(d(),f(v,{key:1,class:"q-ml-sm",color:"positive",escuro:""},{default:a(()=>[m(" ID #"+c(t.id.slice(-6)),1)]),_:2},1024))]),_:2},1024),e(h,{caption:"",lines:"1"},{default:a(()=>[e(v,{rounded:"",color:"tertiary",small:""},{default:a(()=>[m(c(t.status),1)]),_:2},1024)]),_:2},1024),e(h,{caption:"",lines:"2"},{default:a(()=>[_e,m(" "+c(s.$filters.dataHora(t.dataHoraEmissao)),1)]),_:2},1024),t.dataHoraFinalizado?(d(),f(h,{key:0,caption:"",lines:"2"},{default:a(()=>[he,m(" "+c(s.$filters.dataHora(t.dataHoraFinalizado)),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1032,["onClick"])),[[U]])),128))]),_:1})])])):g("",!0),i.carregando?(d(),_("div",ge,[e(K,{color:"faded",size:50})])):g("",!0),!i.carregando&&!n.documentosEncontrados?(d(),_("div",be," N\xE3o foram encontrados registros com os crit\xE9rios selecionados. ")):g("",!0)]),_:3})]),_:3})]),_:3})]),_:3},8,["modelValue","onKeyup"])}var Ne=y(ce,[["render",Fe]]);const ve={components:{nfeInutilizacao:Z,nfeFaixasInutilizadas:le,PromptDocumento:Ne,Tutorial:J},data(){return{promptDocumentoProps:{}}},methods:{abrirModalInutilizacao(){this.$refs.modalNFeInutilizacao.abrirModalInutilizacao()},abrirPromptDocumento(){this.promptDocumentoProps={visivel:!0,documentos:[{tipo:"Transfer\xEAncia",status:"Finalizado"},{tipo:"Transfer\xEAncia",status:"Enviado"},{tipo:"Remessa",status:"Finalizado"}]}},adicionarNFe(){$utils.gconsole.log("NFeLayout","adicionarNFe()"),$utils.emitter.emit("adicionarNFe")},async checarNota(s){let o,l,u;if(o=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:s}}),l=o.find(i=>i.situacao!=="Cancelado"),o||(u="Falha na consulta das notas",$q.notifyError(u)),u)throw new Error(u);return l},async gerarNFe(s){try{const o=await this.checarNota(s);this.promptDocumentoProps.visivel=!1;const l=await $db.hibrido.le({table:"documento",id:s}),u=l==null?void 0:l.operacao;if(!u)return;o||$utils.emitter.emit("gerarNFe",s,1,u),o&&$utils.emitter.emit("abrirNFe",o.id)}catch(o){console.log(o.message)}},abrirModalFaixasInutilizadas(){this.$refs.modalNFeFaixasInutilizadas.abrirModalfaixasInutilizadas()}},async created(){$utils.gconsole.log("NFeLayout","created()")}},xe={class:"u-container"};function ze(s,o,l,u,i,n){const t=b("Tutorial"),E=b("row"),B=b("router-view"),T=b("nfeInutilizacao"),q=b("nfeFaixasInutilizadas"),H=b("PromptDocumento");return d(),_("div",null,[e(P,null,{default:a(()=>[e(k,{class:"bg-gradiente text-white q-mb-md"},{default:a(()=>[r("div",xe,[e(E,{class:"items-center q-mx-none q-px-none q-py-xs"},{default:a(()=>[e(D,null,{default:a(()=>[m("Nota fiscal")]),_:1}),e(t,{componente:"nfeLayout"}),e(z,{flat:"",dense:"",icon:"add",round:"",size:"md",onClick:n.adicionarNFe},{default:a(()=>[e(X,null,{default:a(()=>[m("Criar nota")]),_:1})]),_:1},8,["onClick"]),e(z,{rounded:"",dense:"",flat:"",icon:"more_vert",class:"no-shadow q-mx-xs",size:"md"},{default:a(()=>[e(A,null,{default:a(()=>[F((d(),f(Q,{link:"",separator:""},{default:a(()=>[F((d(),f(x,{clickable:"",onClick:n.abrirModalInutilizacao},{default:a(()=>[e(p,{avatar:""},{default:a(()=>[e(w,{name:"healing"})]),_:1}),e(p,null,{default:a(()=>[m("Inutiliza\xE7\xE3o de n\xFAmero NFe/NFCe")]),_:1})]),_:1},8,["onClick"])),[[N]]),F((d(),f(x,{clickable:"",onClick:n.abrirModalFaixasInutilizadas},{default:a(()=>[e(p,{avatar:""},{default:a(()=>[e(w,{name:"healing"})]),_:1}),e(p,null,{default:a(()=>[m("Relat\xF3rio de faixas Inutilizadas")]),_:1})]),_:1},8,["onClick"])),[[N]]),F((d(),f(x,{clickable:"",onClick:n.abrirPromptDocumento},{default:a(()=>[e(p,{avatar:""},{default:a(()=>[e(w,{name:"account_balance"})]),_:1}),e(p,null,{default:a(()=>[m("Gerar NF-e")]),_:1})]),_:1},8,["onClick"])),[[N]])]),_:1})),[[N]])]),_:1})]),_:1})]),_:1})])]),_:1}),e(B)]),_:1}),e(T,{ref:"modalNFeInutilizacao"},null,512),e(q,{ref:"modalNFeFaixasInutilizadas"},null,512),e(H,{componentProps:i.promptDocumentoProps,onIdDocumentoSelecionado:n.gerarNFe},null,8,["componentProps","onIdDocumentoSelecionado"])])}var ke=y(ve,[["render",ze]]);export{ke as default};
