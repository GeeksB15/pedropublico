import{_ as Q,$ as G,r as E,o as f,d as x,w as i,f as e,L as Z,E as W,h as U,G as X,Q as w,M as K,i as P,k as h,H as Y,I as aa,B as r,j,t as m,as as oa,n as y,aX as ta,e as b,N as k,m as z,u as O,y as I,P as N,O as V,F as A,s as $,R as M,J as ea,a_ as ia,C as sa,Z as ra,d1 as B,az as na,S as T,T as R,z as J}from"./index.9b156bba.js";import{C as la}from"./CaixaFechar.b2e76747.js";import{G as da}from"./GChipsV2.cdff2fe0.js";const ca={components:{Badge:G,CaixaFechar:la},data(){return{documentoCaixa:{},mostrarDinheiro:!1,documentoStatusSelecionado:{},documentoStatus:[],caixa:{},campos:{},dinheiro:{},acertoDinheiro:0,acertos:[],totalAcertos:0,totalDinheiro:0,formasPagamento:[],totaisFormasPagamento:{},outrasFormasPagamento:{},condicoesPagamentoFechamento:{},valorAberturaSistema:0,valorFundoCaixa:0,valorFundoCaixaSistema:0,valorFechamento:0,diferencaFundo:0,diferencaAbertura:0,contatos:{},usuarios:{},documentos:{},mostrarSangrias:!1,sangrias:[],totalSangrias:0,mostrarSangriaFinal:!1,sangriaFinal:[],totalSangriaFinal:0,observacoesSangrias:{},mostrarDespesas:!1,despesas:[],totalDespesas:0,mostrarSuprimentos:!1,suprimentos:[],totalSuprimentos:0,visivel:!1,edicao:!1,carregando:!0,faturaModal:{visivel:!1,id:""},vendaModal:{visivel:!1,id:""},visibilidade:{botao:{reabrir:!1,finalizar:!1}},atualizarAoFecharModal:!1}},emits:["executar","update:modelValue"],methods:{aoFecharModal(){this.atualizarAoFecharModal&&this.$emit("executar","atualizar")},obterDivergencias(){let l=[],s=$utils.arredondar(-this.diferencaFundo);if(s){let g=this.formasPagamento.filter(_=>_.tipo===1);g.length&&(g=g[0],l.push({...g,diferenca:s}))}for(const g of this.formasPagamento.filter(_=>_.tipo!==1&&_.tipoFinanceiro==="T\xEDtulo Liquidado")){let _=(this.totaisFormasPagamento[g.id]||{}).totalSistema||0,a=(this.totaisFormasPagamento[g.id]||{}).totalInformadoUsuario||0;s=$utils.arredondar(_-a),s&&l.push({...g,diferenca:s})}return l},cor(l,s,g){let _=(this.totaisFormasPagamento[g]||{}).totalSistema||0,a=(this.totaisFormasPagamento[g]||{}).totalInformadoUsuario||0,p=$utils.arredondar(_-a);if(s==="card"){switch(l){case"outraFormaPagamento":if(p)return"itemError";break}return"itemOk"}switch(l){case"abertura":if(this.diferencaAbertura)return"text-negative";break;case"fundo":if(this.diferencaFundo)return"text-negative";break;case"outraFormaPagamento":if(p)return"text-negative";break}return"text-blue-8"},async atualizar(){var l;try{this.$q.loading.show({message:"Processando..."}),this.documentoCaixa=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa}),this.caixa=await $db.caixa.leCache({id:this.documentoCaixa.idCaixa});const s=await $db.contato.le({id:this.documentoCaixa.idEmpresa}),g=await $db.hibrido.le({table:"contato",id:this.documentoCaixa.idContato});let _=await $db.documentoStatus.le({idDocumento:this.documentoCaixa.id});switch(_=$lodash.orderBy(_,"dataHoraEmissao","desc"),_.pop(),this.visibilidade={botao:{reabrir:!1,finalizar:!1,fechar:!1}},_[0].statusFinalizado){case"Aguardando Confer\xEAncia":this.visibilidade.botao.reabrir=!0,this.visibilidade.botao.finalizar=!0;break;case"Reaberto":this.visibilidade.botao.fechar=!0;break;case"Fechado":this.visibilidade.botao.reabrir=!0;break}let a={};this.documentoStatus=[];for(let t of _){const d=await $db.contatoCpf.leCache(t.cpfUsuario);this.documentoStatus.push({label:`${t.statusFinalizado} - ${this.$filters.dataHora(t.dataHoraEmissao)} - ${(l=d==null?void 0:d.nome)!=null?l:"Usu\xE1rio n\xE3o identificado"}`,value:t.id,statusFinalizado:t.statusFinalizado})}this.documentoStatusSelecionado=this.documentoStatus[0],this.campos.caixaEmpresaNome=s.nome,this.campos.dataHoraAbertura=this.documentoCaixa.dataHoraEmissao,this.campos.nomeUsuarioAbertura=g.nome,this.valorAberturaSistema=0;const p=`declare @codigoFinanceiroPlanoConta int = (select codigoFinanceiroPlanoConta from financeiroPlanoConta where id = ${$utils.sqlStr(this.caixa.idPlanoConta)})
            declare @codigoEmpresa int = (select codigoEmpresa from documento where id = ${$utils.sqlStr(this.documentoCaixa.id)})
            declare @dataAbertura varchar(10) = (select format(cast(dataHoraEmissao as date), 'dd/MM/yyyy') dataAbertura from documento where id = ${$utils.sqlStr(this.documentoCaixa.id)})

          if (@codigoFinanceiroPlanoConta is not null and @codigoEmpresa is not null and @dataAbertura is not null)
          begin
            exec sp_financeiroMovimentacao_calcula_saldoPeriodo @codigoFinanceiroPlanoConta, @codigoEmpresa, 'DataPagamento', @dataAbertura, @dataAbertura, 0
          end`;let n=new Date(this.documentoCaixa.dataHoraEmissao).setMilliseconds(0);n=new Date(n);let u=await $utils.executarSql(p);u=$lodash.orderBy(u,"Ordem","asc"),u=u.filter(t=>!t.DataMovimento||new Date(t.DataMovimento)<n);const C=u[u.length-1];this.valorAberturaSistema=$utils.arredondar(C.ValorSaldo||0),this.diferencaAbertura=$utils.arredondar(((this.documentoCaixa||{}).valorAbertura||0)-this.valorAberturaSistema),this.$q.loading.hide(),this.visivel=!0,this.preencherConferencia()}catch(s){this.$q.notifyError("N\xE3o foi poss\xEDvel abrir a confer\xEAncia.",s)}finally{this.$q.loading.hide()}},fechar(){this.$refs.Fechar.mostrar({idDocumentoCaixa:this.documentoCaixa.id})},async finalizar(){var l,s;try{let g=this.obterDivergencias(),_="Deseja finalizar a confer\xEAncia?",a="Deseja finalizar a confer\xEAncia e lan\xE7ar movimenta\xE7\xF5es financeiras para acertar as diverg\xEAncias?";try{await new Promise((F,S)=>{this.$q.dialog({message:g.length?a:_,noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{F()}).onCancel(()=>{S()})}),this.$q.loading.show({message:"Processando..."})}catch{return}const p=$utils.dataAtual(),n=[],u=[];if(g.length){let F=await $db.documentoStatus.le({idDocumento:this.documentoCaixa.id});F=F.filter(q=>q.operacao==="Fechamento Caixa"&&q.statusFinalizado==="Aguardando Confer\xEAncia"&&q.statusOriginal==="Aberto");const S=F.length?F[0].dataHoraEmissao:p;let H=await $db.configuracoes.le({nome:"financeiro.planocontas.diferencacaixa"});if(H.length){const q=parseInt(H[0].valor);Number.isInteger(q)&&(H=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:q}))}if(!(H||{}).id){this.$q.notify("Faltando par\xE2metro da conta Diferen\xE7a de Caixa.");return}for(const q of g){const o=$utils.uuid();u.push(o),n.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:o,idEmpresa:this.documentoCaixa.idEmpresa,idContato:$db.usuario.logado.id,idFinanceiroPlanoConta:H.id,valorDebito:q.diferenca>0?q.diferenca:0,valorCredito:q.diferenca<0?Math.abs(q.diferenca):0,dataEmissao:p,dataCompetencia:S,dataVencimento:S,dataMovimento:S,descricao:`Acerto do caixa #${this.documentoCaixa.id} Conta ${q.descricao}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id}),n.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:o,idEmpresa:this.documentoCaixa.idEmpresa,idContato:$db.usuario.logado.id,idFinanceiroPlanoConta:q.tipo===1?this.documentoCaixa.idFinanceiroPlanoContaCaixa:q.idFinanceiroPlanoConta,valorDebito:q.diferenca<0?Math.abs(q.diferenca):0,valorCredito:q.diferenca>0?q.diferenca:0,dataEmissao:p,dataCompetencia:S,dataVencimento:S,dataMovimento:S,descricao:`Acerto do caixa #${this.documentoCaixa.id} Conta ${q.descricao}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id})}}const C={id:$utils.uuid(),idDocumento:this.documentoCaixa.id,operacao:"Confer\xEAncia Finalizada",statusOriginal:"Aguardando Confer\xEAncia",statusFinalizado:"Fechado",dataHoraEmissao:p,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:this.documentoCaixa.id};let t=$utils.clonar(this.documentoCaixa);t.status="Fechado";let d,v=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:this.documentoStatus[0].value}});((l=v==null?void 0:v[0])==null?void 0:l.tabela)==="caixaCompleto"?(d=JSON.parse((s=v[0])==null?void 0:s.json),d.acertos=d.acertos||[],console.log("Finalizando",$utils.clonarV2(d))):v=v.map(F=>({...F,id:$utils.uuid(),idDocumentoStatus:C.id,dataHoraEmissao:p})),await $db.documento.grava({atual:t,original:this.documentoCaixa}),await $db.documentoStatus.grava({atual:C});for(const F of u)await $db.financeiroMovimentacaoN.grava({atual:{id:F}});for(const F of n)d?d.acertos.push(F):v.push({id:$utils.uuid(),idDocumentoCaixa:t.id,idDocumentoStatus:C.id,tabela:"financeiroMovimentacao",idTabela:F.id,json:JSON.stringify(F),dataHoraEmissao:p}),await $db.financeiroMovimentacao.grava({atual:F});if(d){console.log("Finalizado",$utils.clonarV2(d));const F={id:$utils.uuid(),idDocumentoCaixa:t.id,idDocumentoStatus:C.id,tabela:"caixaCompleto",json:JSON.stringify(d),dataHoraEmissao:p};await $db.hibrido.grava("caixaConsolidacao2",{atual:F})}else for(const F of v)await $db.hibrido.grava("caixaConsolidacao2",{atual:F});this.$q.loading.hide(),this.$emit("executar","atualizar"),this.visivel=!1,this.$q.notify({message:"Confer\xEAncia finalizada.",type:"positive"})}catch(g){this.$q.notifyError("N\xE3o foi poss\xEDvel finalizar a confer\xEAncia.",g)}finally{this.$q.loading.hide()}},async preencherConferencia(){var S,H,q;this.carregando=!0,await $utils.dormir(500),this.refreshData();const l=this.documentoStatusSelecionado.value;let s=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:l}});if(((S=s[0])==null?void 0:S.tabela)==="caixaCompleto")return this.preencherConferenciaNew(s);if(!s.length)try{const o=await $utils.geeksApi({caixaConsolidacao2:{funcao:"6B2B2761-B645-4818-BAC0-5DB6D946FDA1",idDocumentoStatus:l}});s=(H=o==null?void 0:o.data)==null?void 0:H.caixaConsolidacao2}catch(o){$q.notify({message:"N\xE3o foi poss\xEDvel obter informa\xE7\xF5es do servidor. Por favor, verifique sua conex\xE3o e tente novamente.",type:"negative"}),console.error(o)}s=s.map(o=>({...o,json:JSON.parse(o.json)}));let g={},_={};for(let o of s)if((q=o.json)!=null&&q.idContato){const c=await $db.contato.le({id:o.json.idContato}),D=await $db.usuario.le({id:o.json.idContato});c!=null&&c.id&&(g[c.id]=c),D!=null&&D.id&&(_[D.id]=D)}this.contatos=g,this.usuarios=_;let a=s.filter(o=>o.tabela==="financeiroMovimentacao"&&o.json.documentoTipo==="Acerto").map(o=>o.json);const p=s.filter(o=>o.tabela==="financeiroTitulo").map(o=>o.json),n=s.filter(o=>o.tabela==="financeiroMovimentacao").map(o=>o.json);this.sangrias=n.filter(o=>["Sangria"].includes(o.documentoTipo)&&o.valorCredito>0),this.totalSangrias=$utils.arredondar(this.sangrias.reduce((o,c)=>o+(c.valorCredito||0),0)),this.sangriaFinal=n.filter(o=>["Sangria Final"].includes(o.documentoTipo)&&o.valorCredito>0),this.totalSangriaFinal=$utils.arredondar(this.sangriaFinal.reduce((o,c)=>o+(c.valorCredito||0),0)),this.carregarObservacoesSangrias(),this.suprimentos=n.filter(o=>o.documentoTipo==="Suprimento"&&o.valorDebito>0),this.totalSuprimentos=$utils.arredondar(this.suprimentos.reduce((o,c)=>o+(c.valorDebito||0),0));const u=n.filter(o=>o.documentoTipo==="DespesaSimples"&&o.valorCredito>0);this.despesas=p.filter(o=>u.find(c=>c.idFinanceiroMovimentacaoN===o.idFinanceiroMovimentacaoAgrupamento)),this.totalDespesas=$utils.arredondar(this.despesas.reduce((o,c)=>o+(c.valorRealizado||0),0)),this.formasPagamento=(await $db.formaPagamento.listaCache()).map(o=>({id:o.id,idFinanceiroPlanoConta:o.idFinanceiroPlanoConta,tipoFinanceiro:o.tipoFinanceiro,tipo:o.tipo,descricao:o.descricao,mostrar:!1}));const C=s.filter(o=>o.tabela==="documentoCondicaoPagamento"&&o.json.ordem).map(o=>o.json);this.valorFechamento=$utils.arredondar(C.reduce((o,c)=>(this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&(o+=c.valor||0),o),0)),this.condicoesPagamentoFechamento=C.reduce((o,c)=>(o[c.idFormaPagamento]=c,o),{});let t=s.filter(o=>o.tabela==="documentoCondicaoPagamento"&&!o.json.ordem).map(o=>o.json);this.dinheiro=t.reduce((o,c)=>(this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&o.push(c),o),[]),this.totalDinheiro=$utils.arredondar(this.dinheiro.reduce((o,c)=>o+(c.valor||0),0)),this.valorFundoCaixa=$utils.arredondar(this.valorFechamento-this.sangriaFinal.filter(o=>o.documentoTipo==="Sangria Final").reduce((o,c)=>o+(c.valorCredito||0),0));const d=this.valorAberturaSistema+this.totalDinheiro-this.totalSangrias-this.totalSangriaFinal-this.totalDespesas+this.totalSuprimentos;this.diferencaFundo=$utils.arredondar(this.valorFundoCaixa-d),this.acertoDinheiro=a.filter(o=>o.idFinanceiroPlanoConta===this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((o,c)=>o+(c.valorDebito||0)-(c.valorCredito||0),0),this.valorFundoCaixaSistema=$utils.arredondar(d+this.acertoDinheiro),this.acertoDinheiro=$utils.arredondar(this.acertoDinheiro*-1),this.outrasFormasPagamento=t.reduce((o,c)=>(!o[c.idFormaPagamento]&&this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta!==this.caixa.idPlanoConta)&&(o[c.idFormaPagamento]=[]),o[c.idFormaPagamento]&&o[c.idFormaPagamento].push(c),o),{});let v=t.reduce((o,c)=>(o[c.idFormaPagamento]||(o[c.idFormaPagamento]={totalInformadoUsuario:0}),o[c.idFormaPagamento]&&(o[c.idFormaPagamento].totalSistema===void 0?o[c.idFormaPagamento].totalSistema=c.valor||0:o[c.idFormaPagamento].totalSistema+=c.valor||0),o),{});v=C.reduce((o,c)=>(o[c.idFormaPagamento]||(o[c.idFormaPagamento]={totalSistema:0}),o[c.idFormaPagamento]&&(o[c.idFormaPagamento].totalInformadoUsuario===void 0?o[c.idFormaPagamento].totalInformadoUsuario=c.valor||0:o[c.idFormaPagamento].totalInformadoUsuario+=c.valor||0),o),v);for(const o in v)v[o].totalSistema=$utils.arredondar(v[o].totalSistema),v[o].totalInformadoUsuario=$utils.arredondar(v[o].totalInformadoUsuario);this.totaisFormasPagamento=v;let F=t.reduce((o,c)=>(o[c.idDocumento]||(o[c.idDocumento]={}),o),{});for(let o in F)F[o]=await $db.hibrido.le({table:"documento",id:o});this.documentos=F,this.acertos=a.filter(o=>o.idFinanceiroPlanoConta!==this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((o,c)=>{const D=this.formasPagamento.find(L=>L.idFinanceiroPlanoConta===c.idFinanceiroPlanoConta);return D&&o.push({descricao:D.descricao,valor:$utils.arredondar((c.valorCredito||0)-(c.valorDebito||0))}),o},[]),this.totalAcertos=$utils.arredondar(this.acertos.reduce((o,c)=>o+c.valor,0)),this.carregando=!1},async preencherConferenciaNew(l){var p;const s=JSON.parse((p=l[0])==null?void 0:p.json);console.log("PreencherConferencia",$utils.clonarV2(s));let g=s.acertos||[];this.sangrias=s.sangrias,this.totalSangrias=s.totalSangrias,this.sangriaFinal=(s.sangriaFinal||[]).filter(n=>n.valorCredito>0),this.totalSangriaFinal=$utils.arredondar($utils.somar(this.sangriaFinal,"valorCredito")),this.suprimentos=s.suprimentos,this.totalSuprimentos=s.totalSuprimentos,this.despesas=s.despesas,this.totalDespesas=s.totalDespesas,this.formasPagamento=(await $db.formaPagamento.listaCache()).map(n=>({...n,mostrar:!1})),l.filter(n=>n.tabela==="documentoCondicaoPagamento"&&n.json.ordem).map(n=>n.json),this.valorFechamento=s.campos.fechamento,this.dinheiro=s.pagamentos.reduce((n,u)=>(this.formasPagamento.find(C=>C.id===u.idFormaPagamento&&C.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&n.push(u),n),[]),this.totalDinheiro=$utils.arredondar(this.dinheiro.reduce((n,u)=>n+(u.valor||0),0)),this.valorFundoCaixa=s.campos.fundoCaixa;const _=this.valorAberturaSistema+this.totalDinheiro-this.totalSangrias-this.totalSangriaFinal-this.totalDespesas+this.totalSuprimentos;this.diferencaFundo=$utils.arredondar(this.valorFundoCaixa-_),this.acertoDinheiro=g.filter(n=>n.idFinanceiroPlanoConta===this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((n,u)=>n+(u.valorDebito||0)-(u.valorCredito||0),0),this.valorFundoCaixaSistema=$utils.arredondar(_+this.acertoDinheiro),this.acertoDinheiro=$utils.arredondar(this.acertoDinheiro*-1),this.outrasFormasPagamento=s.pagamentos.reduce((n,u)=>(!n[u.idFormaPagamento]&&this.formasPagamento.find(C=>C.id===u.idFormaPagamento&&C.idFinanceiroPlanoConta!==this.caixa.idPlanoConta)&&(n[u.idFormaPagamento]=[]),n[u.idFormaPagamento]&&n[u.idFormaPagamento].push(u),n),{});const a={};for(const n of s.valoresDigitados)a[n.id]={totalSistema:(n==null?void 0:n.totalSistema)||0,totalInformadoUsuario:(n==null?void 0:n.valor)||0};for(const n of s.condicaoPagamentoDinheiro)a[n.id]={totalSistema:(n==null?void 0:n.totalSistema)||0};this.totaisFormasPagamento=a,this.documentos=s.faturas.reduce((n,u)=>(n[u.id]=u,n),{}),this.acertos=g.filter(n=>n.idFinanceiroPlanoConta!==this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((n,u)=>{const C=this.formasPagamento.find(t=>t.idFinanceiroPlanoConta===u.idFinanceiroPlanoConta);return C&&n.push({descricao:C.descricao,valor:$utils.arredondar((u.valorCredito||0)-(u.valorDebito||0))}),n},[]),this.totalAcertos=$utils.arredondar(this.acertos.reduce((n,u)=>n+u.valor,0)),this.carregando=!1},async reabrir(){var l,s;try{try{await new Promise((d,v)=>{this.$q.dialog({message:"Deseja reabrir o caixa para corre\xE7\xE3o?",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{d()}).onCancel(()=>{v()})}),this.$q.loading.show({message:"Processando..."})}catch{return}const g=$utils.dataAtual();let _=$utils.clonar(this.documentoCaixa),a,p=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:this.documentoStatus[0].value}});((l=p==null?void 0:p[0])==null?void 0:l.tabela)==="caixaCompleto"?(a=JSON.parse((s=p[0])==null?void 0:s.json),console.log("Reabrindo",$utils.clonarV2(a))):p=p.map(d=>({...d,json:JSON.parse(d.json)}));let n,u;if(a)n=a.sangriaFinal||[],u=a.acertos||[];else{let d=p.filter(v=>v.tabela==="financeiroMovimentacao").map(v=>v.json);n=d.filter(v=>v.documentoTipo==="Sangria Final"),u=d.filter(v=>v.documentoTipo==="Acerto")}const C=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{idDocumentoCaixa:_.id,documentoTipo:"Acerto"}});u=u.concat(C);const t={id:$utils.uuid(),idDocumento:_.id,operacao:"Fechamento Caixa",statusOriginal:this.documentoStatus[0].statusFinalizado,statusFinalizado:"Reaberto",dataHoraEmissao:g,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:_.id};a?a.acertos=[]:(p=p.filter(d=>!["Sangria Final","Acerto"].includes(d.json.documentoTipo)),p=p.map(d=>({...d,id:$utils.uuid(),idDocumentoStatus:t.id,dataHoraEmissao:g,json:JSON.stringify(d.json)}))),_.status="Reaberto",_.dataHoraFinalizado="",await $db.documento.grava({atual:_,original:this.documentoCaixa}),await $db.documentoStatus.grava({atual:t}),await $db.financeiroMovimentacao.remove(u);for(const d of n)await $db.hibrido.grava("financeiroMovimentacao",{atual:{...d,valorCredito:0,valorDebito:0},original:d});if(a){a.sangriaFinal=await $db.caixa.leSangriaFinal(this.idDocumentoCaixa),console.log("Reaberto",$utils.clonarV2(a));const d={id:$utils.uuid(),idDocumentoCaixa:_.id,idDocumentoStatus:t.id,tabela:"caixaCompleto",json:JSON.stringify(a),dataHoraEmissao:g};await $db.hibrido.grava("caixaConsolidacao2",{atual:d})}else for(const d of p)await $db.hibrido.grava("caixaConsolidacao2",{atual:d});this.atualizar(),this.atualizarAoFecharModal=!0,this.$q.loading.hide()}catch(g){this.$q.notifyError("N\xE3o foi poss\xEDvel abrir a confer\xEAncia.",g)}finally{this.$q.loading.hide()}},refreshData(){this.mostrarDinheiro=!1,this.dinheiro={},this.acertoDinheiro=0,this.acertos=[],this.totalAcertos=0,this.formasPagamento=[],this.totaisFormasPagamento={},this.outrasFormasPagamento={},this.condicoesPagamentoFechamento={},this.valorFechamento=0,this.diferencaFundo=0,this.contatos={},this.usuarios={},this.documentos={},this.mostrarSangrias=!1,this.sangrias=[],this.totalSangrias=0,this.mostrarSangriaFinal=!1,this.sangriaFinal=[],this.totalSangriaFinal=0,this.mostrarDespesas=!1,this.despesas=[],this.totalDespesas=0,this.mostrarSuprimentos=!1,this.suprimentos=[],this.totalSuprimentos=0,this.mostrarDivergencias=!1,this.divergencias=[],this.totalDivergencias=0,this.edicao=!1,this.faturaModal={visivel:!1,id:""},this.vendaModal={visivel:!1,id:""}},async carregarObservacoesSangrias(){let l=await $db.hibrido.lista({table:"documento",whereIn:{id:this.sangrias.map(s=>s.documentoId)}});for(const s of l)this.observacoesSangrias[s.id]=s.observacao;l=await $db.hibrido.lista({table:"documento",whereIn:{id:this.sangriaFinal.map(s=>s.documentoId)}});for(const s of l)this.observacoesSangrias[s.id]=s.observacao}},props:{idDocumentoCaixa:{required:!0,type:String},modelValue:{required:!0,type:Boolean}},watch:{modelValue(l){l&&(this.atualizar(),this.refreshData())},visivel(l){this.$emit("update:modelValue",l)}}},ma={class:"layout-padding q-pa-none q-pb-md"},ua={class:"q-pt-md"},ha={class:"bg-white round-borders q-pa-md"},fa={class:"col-12 col-lg-8 text-tertiary"},pa={class:"Faturamento-historico col-12 col-lg-4 text-caption text-tertiary text-right"},ga=r("br",null,null,-1),va={key:0,class:"q-mt-lg text-center"},_a={key:1},ba={class:"col-auto"},Ca={class:"col-auto"},xa={key:0,class:"col-auto"},Fa={class:"col-auto"},ya={class:"q-pr-md q-pl-xs q-pt-md"},qa={class:"row"},wa={class:"q-pa-xs"},Sa={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Da={key:0,class:"q-px-md q-pb-md"},Pa={class:"col-9 col-lg-10 q-pl-sm"},ka={class:"row"},za={class:"col-12 col-sm"},Aa={class:"col-12 col-sm"},$a={class:"col-12 col-sm"},Va={class:"col-12 col-sm"},Ea={class:"q-pr-md q-pl-xs q-pt-md"},Ia={class:"row"},Ma={class:"q-pa-xs"},ja={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Ha={key:0,class:"q-px-md q-pb-md"},Na={class:"col-9 col-lg-10 q-pl-sm"},Oa={class:"row"},Ta={class:"col-12 col-sm"},Ua={class:"col-12 col-sm"},Qa={class:"col-12 col-sm"},Ba={class:"col-12 col-sm"},Ra={class:"q-pr-md q-pl-xs q-pt-md"},Ja={class:"row"},La={class:"q-pa-xs"},Ga={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Za={key:1,class:"q-px-md q-pb-md"},Wa={class:"col-9 col-lg-10 q-pl-sm"},Xa={class:"row"},Ka={class:"col-12 col-sm"},Ya=r("div",{class:"col-12 col-sm"}," Dinheiro ",-1),ao={class:"col-12 col-sm"},oo={class:"col-12 col-sm"},to={class:"q-pr-md q-pl-xs q-pt-md"},eo={class:"row"},io={class:"q-pa-xs"},so={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},ro={key:0,class:"q-px-md q-pb-md"},no={class:"col-9 col-lg-10 q-pl-sm"},lo={class:"row"},co={class:"col-12 col-sm"},mo={class:"col-12 col-sm"},uo={class:"col-12 col-sm"},ho={class:"col-12 col-sm"},fo={class:"col-12 col-sm"},po={class:"q-pr-md q-pl-xs q-pt-md"},go={class:"row"},vo={class:"q-pa-xs"},_o={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},bo={key:0,class:"q-px-md q-pb-md"},Co={class:"col-9 col-lg-10 q-pl-sm"},xo={class:"row"},Fo={class:"col-12 col-sm"},yo={class:"col-12 col-sm"},qo={class:"col-12 col-sm"},wo={class:"col-12 col-sm"},So={class:"col-12 col-sm"},Do={key:4,class:"q-title"},Po={class:"q-pr-md q-pl-xs q-pt-md"},ko={class:"row"},zo={class:"text-right text-h5 text-warning text-weight-bold q-mb-sm"},Ao={class:"q-px-md q-pb-md"},$o={class:"col-9 col-lg-10 q-pl-sm"},Vo={class:"row"},Eo={class:"col-12 col-sm"},Io={class:"col-12 col-sm"},Mo={class:"q-pr-md q-pl-xs q-pt-md"},jo={class:"row"},Ho={class:"q-pa-xs"},No={class:"text-weight-normal text-tertiary text-body2 q-pa-none q-ma-none"},Oo={key:1,class:"q-px-md q-pb-md"},To={class:"col-9 col-lg-10 q-pl-sm"},Uo={class:"row"},Qo={class:"col-12 col-sm"},Bo={class:"col-12 col-sm"},Ro={class:"col-12 col-sm"};function Jo(l,s,g,_,a,p){const n=E("row"),u=E("badge"),C=E("CaixaFechar");return f(),x(sa,{modelValue:a.visivel,"onUpdate:modelValue":s[11]||(s[11]=t=>a.visivel=t),onHide:p.aoFecharModal,maximized:"",class:"caixaconferir"},{default:i(()=>[e(Z,{view:"hHh LpR fFf",container:"",class:"bg-light"},{default:i(()=>[e(W,null,{default:i(()=>[e(U,{class:"bg-primary text-white"},{default:i(()=>[X(e(w,{icon:"arrow_back",round:"",flat:"",dense:""},null,512),[[K]]),e(P,null,{default:i(()=>[h("Conferir caixa")]),_:1})]),_:1})]),_:1}),e(Y,null,{default:i(()=>[e(aa,{class:"u-container"},{default:i(()=>[r("div",ma,[r("div",ua,[r("div",ha,[e(n,{class:"items-center q-col-gutter-md"},{default:i(()=>[r("div",fa,[e(j,{name:"place"}),h(" "+m(a.campos.caixaEmpresaNome),1)]),r("div",pa,[r("div",null,[h(m(l.$filters.dataHora(a.campos.dataHoraAbertura))+" ",1),e(j,{name:"calendar_today"}),ga,h(" "+m(a.campos.nomeUsuarioAbertura)+" ",1),e(j,{name:"person"})])]),e(oa,{modelValue:a.documentoStatusSelecionado,"onUpdate:modelValue":[s[0]||(s[0]=t=>a.documentoStatusSelecionado=t),p.preencherConferencia],label:"Hist\xF3rico",options:a.documentoStatus,filter:"",style:{"white-space":"pre-wrap !important"}},null,8,["modelValue","options","onUpdate:modelValue"])]),_:1}),a.carregando?(f(),y("div",va,[e(ta,{color:"tertiary",size:50})])):b("",!0),a.carregando?b("",!0):(f(),y("div",_a,[e(n,{class:"q-col-gutter-md justify-around"},{default:i(()=>[r("div",ba,[e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(m(l.$filters.numero(a.valorAberturaSistema,2))+" ",1),e(z,null,{default:i(()=>[h("Valor no sistema")]),_:1})]),_:1}),e(P,{class:O(["q-display-1 text-weight-bold text-center",p.cor("abertura")])},{default:i(()=>[h(m(l.$filters.numero(a.documentoCaixa.valorAbertura,2))+" ",1),e(z,null,{default:i(()=>[h("Valor digitado pelo usu\xE1rio")]),_:1})]),_:1},8,["class"]),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(m(l.$filters.numero(a.diferencaAbertura,2))+" ",1),e(z,null,{default:i(()=>[h("Diferen\xE7a")]),_:1})]),_:1}),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(" Abertura ")]),_:1})]),r("div",Ca,[e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h("\xA0")]),_:1}),e(P,{class:O(["q-display-1 text-weight-bold text-center",p.cor("fundo")])},{default:i(()=>[h(m(l.$filters.numero(a.valorFechamento,2))+" ",1),e(z,null,{default:i(()=>[h("Valor digitado pelo usu\xE1rio")]),_:1})]),_:1},8,["class"]),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h("\xA0")]),_:1}),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(" Fechamento ")]),_:1})]),a.acertoDinheiro?(f(),y("div",xa,[e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h("\xA0")]),_:1}),e(P,{class:"q-display-1 text-weight-bold text-center text-warning"},{default:i(()=>[h(m(l.$filters.numero(a.acertoDinheiro,2)),1)]),_:1}),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h("\xA0")]),_:1}),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(" Acerto ")]),_:1})])):b("",!0),r("div",Fa,[e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(m(l.$filters.numero(a.valorFundoCaixaSistema,2))+" ",1),e(z,null,{default:i(()=>[h("Valor no sistema")]),_:1})]),_:1}),e(P,{class:O(["q-display-1 text-weight-bold text-center",p.cor("fundo")])},{default:i(()=>[h(m(l.$filters.numero(a.valorFundoCaixa,2)),1)]),_:1},8,["class"]),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(m(l.$filters.numero(a.diferencaFundo,2))+" ",1),e(z,null,{default:i(()=>[h("Diferen\xE7a")]),_:1})]),_:1}),e(k,{class:"q-pa-none text-tertiary text-center"},{default:i(()=>[h(" Fundo Caixa ")]),_:1})])]),_:1}),a.suprimentos.length?(f(),x(I,{key:0,class:"itemOk q-mt-md"},{default:i(()=>[r("div",ya,[r("div",qa,[e(P,null,{default:i(()=>[h(" Suprimentos ")]),_:1}),r("div",wa,[e(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:i(()=>[h(m(a.suprimentos.length),1)]),_:1})]),r("div",Sa,m(l.$filters.numero(a.totalSuprimentos,2)),1)])]),e(N,{class:"content-center justify-center q-mt-lg"},{default:i(()=>[a.mostrarSuprimentos?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:s[1]||(s[1]=t=>a.mostrarSuprimentos=!a.mostrarSuprimentos)})):b("",!0),a.mostrarSuprimentos?b("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:s[2]||(s[2]=t=>a.mostrarSuprimentos=!a.mostrarSuprimentos)}))]),_:1}),a.mostrarSuprimentos?(f(),y("div",Da,[e(V,{highlight:"",class:"q-pa-none"},{default:i(()=>[(f(!0),y(A,null,$(a.suprimentos,t=>(f(),x(M,{key:t.id,class:"row u-separador q-my-none q-pa-xs"},{default:i(()=>{var d,v;return[r("div",Pa,[r("div",ka,[r("div",za,m(t.nomeContato||((d=a.contatos[t.idContato])==null?void 0:d.nome)||((v=a.usuarios[t.idContato])==null?void 0:v.nome)||"Nome n\xE3o encontrado"),1),r("div",Aa,m(t.documentoTipo),1),r("div",$a,m(l.$filters.numero(t.valorDebito,2)),1),r("div",Va,m(l.$filters.dataHora(t.dataMovimento)),1)])])]}),_:2},1024))),128))]),_:1})])):b("",!0)]),_:1})):b("",!0),a.despesas.length?(f(),x(I,{key:1,class:"itemOk q-mt-md"},{default:i(()=>[r("div",Ea,[r("div",Ia,[e(P,null,{default:i(()=>[h(" Despesas ")]),_:1}),r("div",Ma,[e(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:i(()=>[h(m(a.despesas.length),1)]),_:1})]),r("div",ja,m(l.$filters.numero(a.totalDespesas,2)),1)])]),e(N,{class:"content-center justify-center q-mt-lg"},{default:i(()=>[a.mostrarDespesas?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:s[3]||(s[3]=t=>a.mostrarDespesas=!a.mostrarDespesas)})):b("",!0),a.mostrarDespesas?b("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:s[4]||(s[4]=t=>a.mostrarDespesas=!a.mostrarDespesas)}))]),_:1}),a.mostrarDespesas?(f(),y("div",Ha,[e(V,{highlight:"",class:"q-pa-none"},{default:i(()=>[(f(!0),y(A,null,$(a.despesas,t=>(f(),x(M,{key:t.id,class:"row u-separador q-my-none q-pa-xs"},{default:i(()=>{var d;return[r("div",Na,[r("div",Oa,[r("div",Ta,m(t.nomeContato||((d=a.contatos[t.idContato])==null?void 0:d.nome)||"Nome n\xE3o encontrado"),1),r("div",Ua,m(t.documentoTipo),1),r("div",Qa,m(l.$filters.numero(t.valorRealizado,2)),1),r("div",Ba,m(l.$filters.dataHora(t.dataMovimento)),1)])])]}),_:2},1024))),128))]),_:1})])):b("",!0)]),_:1})):b("",!0),e(I,{class:"itemOk q-my-md"},{default:i(()=>{var t,d;return[r("div",Ra,[r("div",Ja,[e(P,null,{default:i(()=>[h(" Dinheiro ")]),_:1}),r("div",La,[e(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:i(()=>[h(m(a.dinheiro.length),1)]),_:1})]),r("div",Ga,m(l.$filters.numero((d=a.totaisFormasPagamento[(t=a.dinheiro[0])==null?void 0:t.idFormaPagamento])==null?void 0:d.totalSistema,2)),1)])]),a.dinheiro.length?(f(),x(N,{key:0,class:"content-center justify-center q-mt-lg"},{default:i(()=>[a.mostrarDinheiro?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:s[5]||(s[5]=v=>a.mostrarDinheiro=!a.mostrarDinheiro)})):b("",!0),a.mostrarDinheiro?b("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:s[6]||(s[6]=v=>a.mostrarDinheiro=!a.mostrarDinheiro)}))]),_:1})):b("",!0),a.mostrarDinheiro?(f(),y("div",Za,[e(V,{highlight:"",class:"q-pa-none"},{default:i(()=>[(f(!0),y(A,null,$(a.dinheiro,v=>(f(),x(M,{key:v.id,class:"row u-separador q-my-none q-pa-xs"},{default:i(()=>{var F;return[r("div",Wa,[r("div",Xa,[r("div",Ka,[h(m((F=a.documentos[v.idDocumento])==null?void 0:F.descricaoContato)+" ",1),e(u,{cor:"primary",escuro:"",class:"q-mx-sm"},{default:i(()=>{var S;return[h("#"+m((S=a.documentos[v.idDocumento])==null?void 0:S.numero),1)]}),_:2},1024)]),Ya,r("div",ao,m(l.$filters.numero(v.valor,2)),1),r("div",oo,m(l.$filters.data(v.dataVencimento)),1)])])]}),_:2},1024))),128))]),_:1})])):b("",!0)]}),_:1}),a.sangrias.length?(f(),x(I,{key:2,class:"itemOk q-my-md q-mb-xl"},{default:i(()=>[r("div",to,[r("div",eo,[e(P,null,{default:i(()=>[h(" Sangrias ")]),_:1}),r("div",io,[e(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:i(()=>[h(m(a.sangrias.length),1)]),_:1})]),r("div",so,m(l.$filters.numero(a.totalSangrias,2)),1)])]),e(N,{class:"content-center justify-center q-mt-lg"},{default:i(()=>[a.mostrarSangrias?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:s[7]||(s[7]=t=>a.mostrarSangrias=!a.mostrarSangrias)})):b("",!0),a.mostrarSangrias?b("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:s[8]||(s[8]=t=>a.mostrarSangrias=!a.mostrarSangrias)}))]),_:1}),a.mostrarSangrias?(f(),y("div",ro,[e(V,{highlight:"",class:"q-pa-none"},{default:i(()=>[(f(!0),y(A,null,$(a.sangrias,t=>(f(),x(M,{key:t.id,class:"row u-separador q-my-none q-pa-xs"},{default:i(()=>{var d,v;return[r("div",no,[r("div",lo,[r("div",co,m(t.nomeContato||((d=a.contatos[t.idContato])==null?void 0:d.nome)||((v=a.usuarios[t.idContato])==null?void 0:v.nome)||"Nome n\xE3o encontrado"),1),r("div",mo,m(t.documentoTipo),1),r("div",uo,m(l.$filters.numero(t.valorCredito,2)),1),r("div",ho,m(l.$filters.dataHora(t.dataMovimento)),1),r("div",fo,m(t.documentoObservacao||a.observacoesSangrias[t.documentoId]),1)])])]}),_:2},1024))),128))]),_:1})])):b("",!0)]),_:1})):b("",!0),a.sangriaFinal.length?(f(),x(I,{key:3,class:"itemOk q-my-md q-mb-xl"},{default:i(()=>[r("div",po,[r("div",go,[e(P,null,{default:i(()=>[h(" Sangria Final ")]),_:1}),r("div",vo,[e(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:i(()=>[h(m(a.sangriaFinal.length),1)]),_:1})]),r("div",_o,m(l.$filters.numero(a.totalSangriaFinal,2)),1)])]),e(N,{class:"content-center justify-center q-mt-lg"},{default:i(()=>[a.mostrarSangriaFinal?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:s[9]||(s[9]=t=>a.mostrarSangriaFinal=!a.mostrarSangriaFinal)})):b("",!0),a.mostrarSangriaFinal?b("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:s[10]||(s[10]=t=>a.mostrarSangriaFinal=!a.mostrarSangriaFinal)}))]),_:1}),a.mostrarSangriaFinal?(f(),y("div",bo,[e(V,{highlight:"",class:"q-pa-none"},{default:i(()=>[(f(!0),y(A,null,$(a.sangriaFinal,t=>(f(),x(M,{key:t.id,class:"row u-separador q-my-none q-pa-xs"},{default:i(()=>{var d,v;return[r("div",Co,[r("div",xo,[r("div",Fo,m(t.nomeContato||((d=a.contatos[t.idContato])==null?void 0:d.nome)||((v=a.usuarios[t.idContato])==null?void 0:v.nome)||"Nome n\xE3o encontrado"),1),r("div",yo,m(t.documentoTipo),1),r("div",qo,m(l.$filters.numero(t.valorCredito,2)),1),r("div",wo,m(l.$filters.dataHora(t.dataMovimento)),1),r("div",So,m(t.documentoObservacao||a.observacoesSangrias[t.documentoId]),1)])])]}),_:2},1024))),128))]),_:1})])):b("",!0)]),_:1})):b("",!0),a.acertos.length||a.formasPagamento.filter(t=>t.tipo!==1&&(a.outrasFormasPagamento[t.id]||(a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario)).length?(f(),y("div",Do," Outras formas de pagamento ")):b("",!0),a.acertos.length?(f(),x(I,{key:5,class:"itemWarning q-mt-md"},{default:i(()=>[r("div",Po,[r("div",ko,[e(P,null,{default:i(()=>[h(" Acertos ")]),_:1}),r("div",zo,m(l.$filters.numero(a.totalAcertos,2)),1)])]),r("div",Ao,[e(V,{highlight:"",class:"q-pa-none"},{default:i(()=>[(f(!0),y(A,null,$(a.acertos,(t,d)=>(f(),x(M,{key:d,class:"row u-separador q-my-none q-pa-xs"},{default:i(()=>[r("div",$o,[r("div",Vo,[r("div",Eo,m(t.descricao),1),r("div",Io,m(l.$filters.numero(t.valor,2)),1)])])]),_:2},1024))),128))]),_:1})])]),_:1})):b("",!0),(f(!0),y(A,null,$(a.formasPagamento.filter(t=>t.tipo!==1&&(a.outrasFormasPagamento[t.id]||(a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario)),t=>(f(),x(I,{key:t.id,class:O(["q-mt-md",p.cor("outraFormaPagamento","card",t.id)])},{default:i(()=>[r("div",Mo,[r("div",jo,[e(P,null,{default:i(()=>[h(m(t.descricao),1)]),_:2},1024),r("div",Ho,[e(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:i(()=>[h(m(a.outrasFormasPagamento[t.id]?(a.outrasFormasPagamento[t.id]||[]).length:0),1)]),_:2},1024)]),r("div",{class:O(["text-right text-h5 text-weight-bold q-mb-sm",p.cor("outraFormaPagamento","",t.id)])},[r("span",null,[h(m(l.$filters.numero((a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario,2))+" ",1),e(z,null,{default:i(()=>[h("Digitado pelo usu\xE1rio")]),_:1})]),r("p",No,[h(m(l.$filters.numero((a.totaisFormasPagamento[t.id]||{}).totalSistema-(a.totaisFormasPagamento[t.id]||{}).totalInformadoUsuario,2))+" ",1),e(z,null,{default:i(()=>[h("Diferen\xE7a")]),_:1})])],2)])]),a.outrasFormasPagamento[t.id]?(f(),x(N,{key:0,class:"content-center justify-center q-mt-lg"},{default:i(()=>[t.mostrar?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:d=>t.mostrar=!t.mostrar},null,8,["onClick"])):b("",!0),t.mostrar?b("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:d=>t.mostrar=!t.mostrar},null,8,["onClick"]))]),_:2},1024)):b("",!0),t.mostrar?(f(),y("div",Oo,[e(V,{highlight:"",class:"q-pa-none"},{default:i(()=>[(f(!0),y(A,null,$(a.outrasFormasPagamento[t.id],d=>(f(),x(M,{key:d.id,class:"row u-separador q-my-none q-pa-xs"},{default:i(()=>{var v;return[r("div",To,[r("div",Uo,[r("div",Qo,[h(m((v=a.documentos[d.idDocumento])==null?void 0:v.descricaoContato)+" ",1),e(u,{cor:"primary",escuro:"",class:"q-mx-sm"},{default:i(()=>{var F,S;return[h(" #"+m((S=(F=a.documentos[d.idDocumento])==null?void 0:F.id)==null?void 0:S.slice(-6)),1)]}),_:2},1024)]),r("div",Bo,m(l.$filters.numero(d.valor,2)),1),r("div",Ro,m(l.$filters.data(d.dataVencimento)),1)])])]}),_:2},1024))),128))]),_:2},1024)])):b("",!0)]),_:2},1032,["class"]))),128))]))])])])]),_:1})]),_:1}),e(ea,{class:"bg-light",bordered:""},{default:i(()=>[e(U,{class:"bg-light text-tertiary q-pa-sm u-container"},{default:i(()=>[e(ia),a.visibilidade.botao.reabrir?(f(),x(w,{key:0,onClick:p.reabrir,color:"negative",flat:"",label:"Reabrir",unelevated:""},null,8,["onClick"])):b("",!0),a.visibilidade.botao.finalizar?(f(),x(w,{key:1,onClick:p.finalizar,label:"finalizar",color:"primary",class:"q-ml-sm",unelevated:""},null,8,["onClick"])):b("",!0),a.visibilidade.botao.fechar?(f(),x(w,{key:2,onClick:p.fechar,color:"primary",label:"refechar caixa",class:"q-ml-sm",unelevated:""},null,8,["onClick"])):b("",!0)]),_:1})]),_:1})]),_:1}),e(C,{ref:"Fechar",onFechado:p.atualizar},null,8,["onFechado"])]),_:1},8,["modelValue","onHide"])}var Lo=Q(ca,[["render",Jo]]);const Go={components:{Avatar:ra,CaixaConferir:Lo},data(){return{empresa:{},contato:{},caixaConferirModal:{visivel:!1}}},emits:["atualizar"],methods:{abrirCaixaConferirModal(){this.caixaConferirModal.visivel=!0},async atualizar(){this.empresa=await $db.contato.le({id:this.documento.idEmpresa}),this.contato=await $db.contato.le({id:this.documento.idContato})},executar(l){switch(l){case"atualizar":this.atualizar(),this.$emit("atualizar")}}},props:{documento:{required:!0,type:Object}},mounted(){this.atualizar()}},Zo={id:"CaixaCard",class:"q-mb-md"},Wo={class:"col-12 col-md-6 q-pl-none"},Xo={class:"col-12 col-md"},Ko={class:"text-left q-my-none"},Yo={class:"text-weight-bold"},at=r("br",null,null,-1),ot={class:"col-6 col-md-auto"},tt={class:"text-left q-my-none"},et={class:"col-6 col-md-auto"},it={class:"text-left q-my-none"},st={class:"col-6 col-md"},rt={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},nt={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},lt={class:"col-6 col-md-auto"};function dt(l,s,g,_,a,p){const n=E("avatar"),u=E("row"),C=E("CaixaConferir");return f(),y("div",Zo,[e(I,{class:"extratoItem bg-white q-pa-sm no-shadow"},{default:i(()=>[e(u,{class:"items-center q-mx-none q-px-none q-mb-sm"},{default:i(()=>[r("div",Wo,[e(U,{class:"q-pa-none"},{default:i(()=>[e(n,{imagem:a.contato.imagem,rotulo:a.contato.nome,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"]),e(P,null,{default:i(()=>[h(m(a.contato.apelido),1)]),_:1}),e(B,{rounded:"",color:"grey",small:"",class:"q-ma-sm"},{default:i(()=>[h(m(g.documento.status),1)]),_:1}),e(B,{class:"q-mr-sm",rounded:"",color:"positive"},{default:i(()=>[h(" #"+m(parseInt(g.documento.numero)||(g.documento.id||"").slice(-6)),1)]),_:1})]),_:1})]),r("div",Xo,[r("p",Ko,[r("span",Yo,[e(j,{name:"business "}),h(" "+m(a.empresa.apelido),1)]),at,h(" "+m(a.empresa.nome),1)])]),r("div",ot,[r("p",tt,[g.documento.dataHoraEmissao?(f(),x(j,{key:0,name:"mdi-calendar-today "})):b("",!0),h(" "+m(l.$filters.data(g.documento.dataHoraEmissao))+" ",1),e(z,null,{default:i(()=>[h(" Abertura ")]),_:1})])]),r("div",et,[r("p",it,[g.documento.dataHoraEmissao?(f(),x(j,{key:0,name:"mdi-calendar-today"})):b("",!0),h(" "+m(l.$filters.data(g.documento.dataHoraFinalizado))+" ",1),e(z,null,{default:i(()=>[h(" Fechamento ")]),_:1})])]),r("div",st,[r("p",rt,m(l.$filters.numero(g.documento.totalDocumento,2)),1),r("p",nt,m(l.$filters.numero(g.documento.subTotal,2)),1)]),r("div",lt,[e(w,{rounded:"",dense:"",flat:"",icon:"edit",class:"no-shadow q-ma-xs",size:"md",color:"primary",style:{float:"right"},onClick:p.abrirCaixaConferirModal},{default:i(()=>[e(z,null,{default:i(()=>[h(" Abrir confer\xEAncia ")]),_:1})]),_:1},8,["onClick"]),e(w,{rounded:"",dense:"",flat:"",icon:"print",class:"no-shadow q-ma-xs",size:"md",color:"primary",style:{float:"right"}},{default:i(()=>[e(na,null,{default:i(()=>[e(V,{link:"",separator:""},{default:i(()=>[e(M,{clickable:"",onClick:s[0]||(s[0]=t=>{l.$imprimir("fechamento-de-caixa",g.documento.id)})},{default:i(()=>[e(T,{avatar:""},{default:i(()=>[e(j,{name:"print"})]),_:1}),e(T,null,{default:i(()=>[e(R,null,{default:i(()=>[h("Imprimir Fechamento")]),_:1})]),_:1})]),_:1}),e(M,{clickable:"",onClick:s[1]||(s[1]=t=>{l.$imprimir("conferencia-de-caixa",g.documento.id)})},{default:i(()=>[e(T,{avatar:""},{default:i(()=>[e(j,{name:"print"})]),_:1}),e(T,null,{default:i(()=>[e(R,null,{default:i(()=>[h("Imprimir Confer\xEAncia")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),e(C,{modelValue:a.caixaConferirModal.visivel,"onUpdate:modelValue":s[2]||(s[2]=t=>a.caixaConferirModal.visivel=t),idDocumentoCaixa:g.documento.id,onExecutar:p.executar},null,8,["modelValue","idDocumentoCaixa","onExecutar"])])}var ct=Q(Go,[["render",dt]]);const mt={components:{CaixaCard:ct,GChipsV2:da},data(){return{documentosCaixaConferencia:[],documentosCaixaFechado:[],dataIni:"",dataFim:"",termosPesquisa:[]}},methods:{async filtrar(){let l=[];const s=await $db.contatoEmpresa.listaCache();let g=new Date(new Date(this.dataIni).toDateString()),_=new Date(new Date(this.dataFim).toDateString());for(const n of s)(await $db.hibrido.lista({table:"documento",where:{tipo:"Caixa",idEmpresa:n.id}})).forEach(C=>{const t=new Date(new Date(C.dataHoraEmissao).toDateString());t<=_&&t>=g&&l.push(C)});l.sort((n,u)=>new Date(n.dataHoraEmissao)>new Date(u.dataHoraEmissao)?-1:1);for(let n of this.termosPesquisa)n=n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(),/^#\d+$/gi.test(n)?l=l.filter(u=>u.numero===Number(n.slice(1))):l=l.filter(u=>{const C=s.find(t=>t.id===u.idEmpresa);return((C.nome||"")+(C.apelido||"")).normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().search(n)!==-1});let a=l.filter(n=>n.status==="Aguardando Confer\xEAncia"),p=l.filter(n=>n.status==="Fechado");this.documentosCaixaConferencia=a,this.documentosCaixaFechado=p}},mounted(){const l=new Date(new Date().toDateString()),s=new Date(l);s.setDate(s.getDate()-7),this.dataIni=s,this.dataFim=l,this.filtrar()}},ut={class:"CaixaTesouraria"},ht={class:"col-12 col-md-6"},ft={class:"col"},pt=r("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[r("label",null,"at\xE9")],-1),gt={class:"col"},vt={class:"q-pa-sm"};function _t(l,s,g,_,a,p){const n=E("GChipsV2"),u=E("campo"),C=E("row"),t=E("caixa-card");return f(),y("div",ut,[e(I,{class:"q-pa-sm q-mx-sm no-shadow"},{default:i(()=>[e(C,{class:"items-center q-col-gutter-md"},{default:i(()=>[r("div",ht,[e(n,{modelValue:a.termosPesquisa,"onUpdate:modelValue":[s[0]||(s[0]=d=>a.termosPesquisa=d),p.filtrar],class:"q-px-none",placeholder:"Termo de pesquisa"},{prepend:i(()=>[e(j,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),r("div",ft,[e(u,{modelValue:a.dataIni,"onUpdate:modelValue":s[1]||(s[1]=d=>a.dataIni=d),tipo:"data",onInput:p.filtrar,dense:"",outlined:""},null,8,["modelValue","onInput"])]),pt,r("div",gt,[e(u,{modelValue:a.dataFim,"onUpdate:modelValue":s[2]||(s[2]=d=>a.dataFim=d),tipo:"data",onInput:p.filtrar,dense:"",outlined:""},null,8,["modelValue","onInput"])])]),_:1})]),_:1}),r("div",vt,[e(V,{class:"no-border"},{default:i(()=>[e(J,{"default-opened":"",label:"Aguardando Confer\xEAncia"},{default:i(()=>[(f(!0),y(A,null,$(a.documentosCaixaConferencia,d=>(f(),y("div",{key:d.id},[e(t,{documento:d,onAtualizar:p.filtrar},null,8,["documento","onAtualizar"])]))),128))]),_:1})]),_:1}),e(V,{class:"no-border"},{default:i(()=>[e(J,{"default-opened":"",label:"Fechado"},{default:i(()=>[(f(!0),y(A,null,$(a.documentosCaixaFechado,d=>(f(),y("div",{key:d.id},[e(t,{documento:d,onAtualizar:p.filtrar},null,8,["documento","onAtualizar"])]))),128))]),_:1})]),_:1})])])}var Ft=Q(mt,[["render",_t]]);export{Ft as default};
