import{_ as w,o as d,d as f,w as a,f as e,y as S,h as k,i as E,k as m,G as F,Q as v,M as N,B as r,ea as V,n as h,F as y,s as D,t as c,C as $,L as R,E as P,q as O,H as Q,I as B,A as j,O as T,R as I,S as p,T as _,d1 as z,e as g,W as K,aX as U,bF as A,cV as G,r as b,az as X,j as x}from"./index.9b156bba.js";import{n as J}from"./nfeInutilizacao.730bf063.js";import"./compactarValidarNFe.d3892009.js";const W={data:function(){return{idEmitente:"",inutilizadas:[]}},methods:{async abrirModalfaixasInutilizadas(){$utils.gconsole.log("ConfiguracoesDocumentosFiscais","abrirModalFaixasInutilizadas"),this.$refs.dialogFaixasInutilizadas.show()},async selecionarEmpresaInutilizacao(s){try{const o=s.id;if(!o)return;let l=await $db.contato.le({id:o});this.idEmpresa=o,$utils.verificarErro(!l||!l.id,"N\xE3o foi poss\xEDvel recuperar os dados da empresa."),$utils.verificarErro(!l.numeroDocumentoNacional,"Empresa emitente sem CNPJ cadastrado")}catch(o){this.$q.notifyError("Erro ao selecionar a empresa.",o)}}},async created(){const s=await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{situacao:"Inutilizado"}});this.inutilizadas=[];for(let o in s){const l=new DOMParser().parseFromString(s[o].xmlEnvio,"text/xml"),u=l.getElementsByTagName("nNFIni")[0].innerHTML,n=l.getElementsByTagName("nNFFin")[0].innerHTML,i=(await $db.empresa.le()).filter(t=>{if($utils.filtrarDigitos(t.numeroDocumentoNacional)===$utils.filtrarDigitos(s[o].cpfCnpjEmitente))return t});this.inutilizadas.push({dataHoraEnvio:new Date(s[o].dataHoraEnvio),emitente:`${i[0].apelido}`,operacao:s[o].operacao,status:s[o].status,nNFIni:u,nNFFin:n})}}},Y={class:"layout-padding"},Z=r("thead",null,[r("tr",null,[r("th",{class:"text-left"},"Data"),r("th",{class:"text-left"},"Emitente"),r("th",{class:"text-right"},"Numera\xE7\xE3o Inicial"),r("th",{class:"text-right"},"Numera\xE7\xE3o Final"),r("th",{class:"text-right"},"Opera\xE7\xE3o"),r("th",{class:"text-right"},"Status")])],-1),ee={class:"text-left"},te={class:"text-left"},ae={class:"text-right"},oe={class:"text-right"},se={class:"text-right"},ie={class:"text-right"};function ne(s,o,l,u,n,i){return d(),f($,{ref:"dialogFaixasInutilizadas","full-width":""},{default:a(()=>[e(S,{class:"q-dialog-plugin"},{default:a(()=>[e(k,{class:"bg-primary text-white"},{default:a(()=>[e(E,null,{default:a(()=>[m("Relat\xF3rio de faixas Inutilizadas")]),_:1}),F(e(v,{dense:"",flat:"",icon:"close",round:""},null,512),[[N]])]),_:1}),r("div",Y,[e(V,null,{default:a(()=>[Z,r("tbody",null,[(d(!0),h(y,null,D(s.inutilizadas,t=>(d(),h("tr",{key:t.id},[r("td",ee,c(t.dataHoraEnvio),1),r("td",te,c(t.emitente),1),r("td",ae,c(t.nNFIni),1),r("td",oe,c(t.nNFFin),1),r("td",se,c(t.operacao),1),r("td",ie,c(t.status),1)]))),128))])]),_:1})])]),_:1})]),_:1},512)}var le=w(W,[["render",ne]]);const re={components:{},computed:{documentosEncontrados(){return this.documentos.length>0}},data(){return{contatos:{},carregando:!1,documentos:[],termoBusca:null}},emits:["idDocumentoSelecionado"],methods:{async atualizar(){try{const s={},o=[],l=[];let u=[],n=this.termoBusca;this.carregando=!0,/^#\d+$/g.test(this.termoBusca)&&(n=this.termoBusca.slice(1));for(const i of this.componentProps.documentos){const t=await $db.hibrido.lista({table:"documento",where:i});u=u.concat(t)}for(const i of u)n&&Number(n)!==Number(i.numero)&&Number(n)!==Number(i.codigoDocumento)||(o.push(i),l.push(i.idContato),l.push(i.idEmpresa));o.sort((i,t)=>new Date(i.dataHoraFinalizado)>new Date(t.dataHoraFinalizado)?-1:1);for(const i of Array.from(new Set(l))){const t=await $db.contato.le({id:i});!(t!=null&&t.id)||(s[t.id]=t)}this.contatos=s,this.documentos=o.slice(0,30)}catch(s){console.log(s.message)}finally{this.carregando=!1}},hide(){this.componentProps.visivel=!1},selecionar(s){this.$emit("idDocumentoSelecionado",s)}},props:{componentProps:{default:()=>({visivel:!1,documentos:[]}),required:!0,type:Object}},watch:{"componentProps.visivel"(s){if(s){const o=setInterval(()=>{this.$refs.search&&(this.$refs.search.focus(),clearInterval(o))},100);this.atualizar()}s||(this.contatos={},this.carregando=!1,this.documentos=[],this.termoBusca=null)}}},ce={class:"col-xs-12 col-sm-12"},de={key:0,class:"q-px-sm"},ue={class:"text-h6"},me=r("span",{class:"text-weight-bold"},"Emitente",-1),fe=r("span",{class:"text-weight-bold"},"Destinat\xE1rio",-1),pe=r("span",{class:"text-weight-bold"},"Emiss\xE3o",-1),he=r("span",{class:"text-weight-bold"},"Finaliza\xE7\xE3o",-1),_e={key:1,class:"row justify-center q-pt-sm"},ge={key:2,class:"bg-light q-pa-lg round-borders text-black text-center"};function be(s,o,l,u,n,i){return d(),f($,{modelValue:l.componentProps.visivel,"onUpdate:modelValue":o[1]||(o[1]=t=>l.componentProps.visivel=t),persistent:"",maximized:"",onKeyup:A(i.hide,["esc"])},{default:a(()=>[e(R,{class:"bg-white",container:"",view:"hHr lpR fFr"},{default:a(()=>[e(P,null,{default:a(()=>[e(k,null,{default:a(()=>[e(v,{dense:"",flat:"",icon:"arrow_back",round:"",onClick:i.hide},null,8,["onClick"]),e(E,{class:"row"},{default:a(()=>[r("div",ce,[e(O,{modelValue:n.termoBusca,"onUpdate:modelValue":[o[0]||(o[0]=t=>n.termoBusca=t),i.atualizar],color:"none",ref:"search",dark:"",dense:"",placeholder:"Filtre pelo n\xFAmero ou c\xF3digo",debounce:"600",clearable:"","clear-icon":"close"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(B,null,{default:a(()=>[!n.carregando&&i.documentosEncontrados?(d(),h("div",de,[j(s.$slots,"content",{documentos:n.documentos,contatos:n.contatos},()=>[e(T,{separator:""},{default:a(()=>[(d(!0),h(y,null,D(n.documentos,t=>F((d(),f(I,{key:t.id,clickable:"",onClick:C=>i.selecionar(t.id)},{default:a(()=>[e(p,{"no-wrap":""},{default:a(()=>[e(_,{caption:"",lines:"1"},{default:a(()=>[r("span",ue,c(t.operacao),1)]),_:2},1024),e(_,{caption:"",lines:"4"},{default:a(()=>[me,m(" "+c(n.contatos[t.idEmpresa].nome)+" - "+c(n.contatos[t.idEmpresa].numeroDocumentoNacional),1)]),_:2},1024),e(_,{caption:"",lines:"4"},{default:a(()=>[fe,m(" "+c(n.contatos[t.idContato].nome)+" - "+c(n.contatos[t.idContato].numeroDocumentoNacional),1)]),_:2},1024)]),_:2},1024),e(p,{"no-wrap":"",side:""},{default:a(()=>[e(_,{caption:"",lines:"1"},{default:a(()=>[t.numero&&t.codigoDocumento?(d(),h(y,{key:0},[e(z,{class:"q-ml-sm",color:"positive",escuro:""},{default:a(()=>[m(" N\xFAm. #"+c(parseInt(t.numero)),1)]),_:2},1024),e(z,{class:"q-ml-sm",color:"positive",escuro:""},{default:a(()=>[m(" C\xF3d. #"+c(parseInt(t.codigoDocumento)),1)]),_:2},1024)],64)):g("",!0),t.numero&&t.codigoDocumento?g("",!0):(d(),f(z,{key:1,class:"q-ml-sm",color:"positive",escuro:""},{default:a(()=>[m(" ID #"+c(t.id.slice(-6)),1)]),_:2},1024))]),_:2},1024),e(_,{caption:"",lines:"1"},{default:a(()=>[e(z,{rounded:"",color:"tertiary",small:""},{default:a(()=>[m(c(t.status),1)]),_:2},1024)]),_:2},1024),e(_,{caption:"",lines:"2"},{default:a(()=>[pe,m(" "+c(s.$filters.dataHora(t.dataHoraEmissao)),1)]),_:2},1024),t.dataHoraFinalizado?(d(),f(_,{key:0,caption:"",lines:"2"},{default:a(()=>[he,m(" "+c(s.$filters.dataHora(t.dataHoraFinalizado)),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1032,["onClick"])),[[K]])),128))]),_:1})])])):g("",!0),n.carregando?(d(),h("div",_e,[e(U,{color:"faded",size:50})])):g("",!0),!n.carregando&&!i.documentosEncontrados?(d(),h("div",ge," N\xE3o foram encontrados registros com os crit\xE9rios selecionados. ")):g("",!0)]),_:3})]),_:3})]),_:3})]),_:3},8,["modelValue","onKeyup"])}var Fe=w(re,[["render",be]]);const Ne={components:{nfeInutilizacao:J,nfeFaixasInutilizadas:le,PromptDocumento:Fe,Tutorial:G},data(){return{promptDocumentoProps:{}}},methods:{abrirModalInutilizacao(){this.$refs.modalNFeInutilizacao.abrirModalInutilizacao()},abrirPromptDocumento(){this.promptDocumentoProps={visivel:!0,documentos:[{tipo:"Transfer\xEAncia",status:"Finalizado"},{tipo:"Transfer\xEAncia",status:"Enviado"},{tipo:"Remessa",status:"Finalizado"}]}},adicionarNFe(){$utils.gconsole.log("NFeLayout","adicionarNFe()"),$utils.emitter.emit("adicionarNFe")},async checarNota(s){let o,l,u;if(o=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:s}}),l=o.find(n=>n.situacao!=="Cancelado"),o||(u="Falha na consulta das notas",$q.notifyError(u)),u)throw new Error(u);return l},async gerarNFe(s){try{const o=await this.checarNota(s);this.promptDocumentoProps.visivel=!1;const l=await $db.hibrido.le({table:"documento",id:s}),u=l==null?void 0:l.operacao;if(!u)return;o||$utils.emitter.emit("gerarNFe",s,1,u),o&&$utils.emitter.emit("abrirNFe",o.id)}catch(o){console.log(o.message)}},abrirModalFaixasInutilizadas(){this.$refs.modalNFeFaixasInutilizadas.abrirModalfaixasInutilizadas()}},async created(){$utils.gconsole.log("NFeLayout","created()")}},ve={id:"NFeLayout"};function ze(s,o,l,u,n,i){const t=b("barraTopo"),C=b("Tutorial"),H=b("router-view"),M=b("nfeInutilizacao"),q=b("nfeFaixasInutilizadas"),L=b("PromptDocumento");return d(),h("div",ve,[e(P,{elevated:"",class:"bg-gradiente text-white"},{default:a(()=>[e(t),e(k,{class:"q-px-sm"},{default:a(()=>[e(E,null,{default:a(()=>[m("Nota fiscal")]),_:1}),e(C,{componente:"nfeLayout"}),e(v,{onClick:i.adicionarNFe,icon:"add",label:"Novo",size:"md",flat:"",dense:"",round:"",class:"hideonmobile"},null,8,["onClick"]),e(v,{onClick:i.adicionarNFe,icon:"add",size:"md",flat:"",dense:"",round:"",class:"hideondesktop"},null,8,["onClick"]),e(v,{icon:"more_vert",size:"md",rounded:"",dense:"",flat:"",class:"q-ml-sm"},{default:a(()=>[e(X,null,{default:a(()=>[F((d(),f(T,{link:"",separator:""},{default:a(()=>[F((d(),f(I,{onClick:i.abrirModalInutilizacao,clickable:""},{default:a(()=>[e(p,{avatar:""},{default:a(()=>[e(x,{name:"healing"})]),_:1}),e(p,null,{default:a(()=>[m("Inutiliza\xE7\xE3o de n\xFAmero NFe/NFCe")]),_:1})]),_:1},8,["onClick"])),[[N]]),F((d(),f(I,{onClick:i.abrirModalFaixasInutilizadas,clickable:""},{default:a(()=>[e(p,{avatar:""},{default:a(()=>[e(x,{name:"healing"})]),_:1}),e(p,null,{default:a(()=>[m("Relat\xF3rio de faixas Inutilizadas")]),_:1})]),_:1},8,["onClick"])),[[N]]),F((d(),f(I,{onClick:i.abrirPromptDocumento,clickable:""},{default:a(()=>[e(p,{avatar:""},{default:a(()=>[e(x,{name:"account_balance"})]),_:1}),e(p,null,{default:a(()=>[m("Gerar NF-e")]),_:1})]),_:1},8,["onClick"])),[[N]])]),_:1})),[[N]])]),_:1})]),_:1})]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(B,null,{default:a(()=>[e(H)]),_:1})]),_:1}),e(M,{ref:"modalNFeInutilizacao"},null,512),e(q,{ref:"modalNFeFaixasInutilizadas"},null,512),e(L,{onIdDocumentoSelecionado:i.gerarNFe,componentProps:n.promptDocumentoProps},null,8,["onIdDocumentoSelecionado","componentProps"])])}var we=w(Ne,[["render",ze]]);export{we as default};
