import{_ as I,c7 as q,p as C,o as g,i as y,w as s,x as c,f as t,B as F,E as D,e as v,C as O,D as S,L as M,a7 as Q,y as L,Z as N,b6 as R,j as h,a6 as w,l as b,d as _,F as P,r as $,t as f,s as j,n as G,k as z,M as E,a4 as K,az as X,N as Z,P as U,R as x,S as T,H as J}from"./index.20d4d726.js";import{C as W}from"./Campo.193fa2ea.js";import{M as Y}from"./ModalHistoricoStatus.87043112.js";import{d as oo}from"./vuedraggable.umd.1c81300f.js";const eo={components:{Campo:W},data(){return{confirmado:!1}},emits:["cancelar","confirmar","update:modelValue"],methods:{eventoConfirmar(){q.log("CRMTrocarStatus","eventoConfirmar",this.dados),this.confirmado=!0,this.eventoInput(!1),this.$emit("confirmar",this.dados)},eventoCancelar(){q.log("CRMTrocarStatus","eventoCancelar",this.dados),this.confirmado=!1,this.eventoInput(!1)},eventoInput(a){this.$emit("update:modelValue",a)}},props:{modelValue:{required:!0,type:Boolean},dados:{required:!0,type:Object}},watch:{modelValue(a){a?this.confirmado=!1:this.confirmado||this.$emit("cancelar",this.dados)}}},to={container:"",class:"bg-white"};function ao(a,e,l,n,o,r){const i=C("campo"),p=C("row");return g(),y(L,{"model-value":l.modelValue,"onUpdate:modelValue":r.eventoInput},{default:s(()=>[c("div",to,[t(F,{class:"bg-primary text-white"},{default:s(()=>[t(D,null,{default:s(()=>[v("Trocar status")]),_:1}),O(t(S,{flat:"",round:"",dense:"",icon:"close"},null,512),[[M]])]),_:1}),c("form",{onSubmit:e[4]||(e[4]=Q((...m)=>r.eventoConfirmar&&r.eventoConfirmar(...m),["prevent"])),class:"q-pa-md"},[t(p,{class:"q-col-gutter-sm"},{default:s(()=>[t(i,{modelValue:l.dados.nomeCliente,"onUpdate:modelValue":e[0]||(e[0]=m=>l.dados.nomeCliente=m),somenteLeitura:"",class:"col-12",rotulo:"Cliente"},null,8,["modelValue"]),t(i,{modelValue:l.dados.statusAtual,"onUpdate:modelValue":e[1]||(e[1]=m=>l.dados.statusAtual=m),somenteLeitura:"",class:"col-12",rotulo:"De"},null,8,["modelValue"]),t(i,{modelValue:l.dados.statusNovo,"onUpdate:modelValue":e[2]||(e[2]=m=>l.dados.statusNovo=m),somenteLeitura:"",class:"col-12",rotulo:"Para"},null,8,["modelValue"]),t(i,{modelValue:l.dados.observacao,"onUpdate:modelValue":e[3]||(e[3]=m=>l.dados.observacao=m),modelModifiers:{trim:!0},class:"col-12",maxlength:"50",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:1}),t(F,{color:"light"},{default:s(()=>[t(D),t(S,{flat:"",color:"tertiary",onClick:r.eventoCancelar,label:"Cancelar"},null,8,["onClick"]),t(S,{unelevated:"",color:"primary",type:"submit",label:"Trocar"})]),_:1})],32)])]),_:1},8,["model-value","onUpdate:modelValue"])}var so=I(eo,[["render",ao]]);const k={Or\u00E7amento:[],Conclu\u00EDdo:[]},lo={components:{Badge:N,CrmTrocarStatus:so,ModalHistoricoStatus:Y,draggable:oo},data(){return{showfilters:!1,empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),fraseFiltro:"",listas:$utils.clonarV2(k),tamanhoLista:{},listasFiltradas:$utils.clonarV2(k),total:{},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeCRM"},{label:"Entrega para esta semana",value:"bordaAmarelaCRM"},{label:"Entrega atrasada",value:"bordaVermelhaCRM"}],vendedorDigitadorSelecionado:null,vendedoresDigitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1}},methods:{async eventoEnd(){for(const a in this.listasFiltradas)for(const e of this.listasFiltradas[a])if(e.crmFunilStatus!==a){$utils.gconsole.log("FunilVendas","eventoEnd De:",e.crmFunilStatus,"Para:",a,"codigo:",e.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.crmFunilStatus,statusNovo:a},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(a){$utils.gconsole.log("FunilVendas","eventoConfirmaTroca",{...a}),this.$q.loading.show();try{let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(n=>{var o;return n.numeroDocumentoNacional.replace(/\D/g,"")===((o=$db.usuario.logado.cpf)==null?void 0:o.replace(/\D/g,""))})),a.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await $db.crm.trocaStatusOnline(a),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(e){this.$q.notifyError("Erro na troca de status",e)}finally{this.$q.loading.hide()}},eventoCancelarTroca(a){$utils.gconsole.log("FunilVendas","eventoCancelarTroca",a),this.atualiza()},async empresaOpcoesCarregar(){const a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=a.map(e=>({label:e.nome,value:e.codigoContato,id:e.id}))},async irParaAtendimento(a){const e=await $erp().contato.where({codigoContato:a}).first()||{};e.id&&this.$router.push({name:"Atendimento",params:{id:e.id}})},filtraDebounce(){$lodash.debounce(this.refazFiltro,700)()},refazFiltro(){$utils.gconsole.log("FunilVendas","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const a=$utils.removerAcentos((this.fraseFiltro||"").toUpperCase()).split(" ").filter(n=>n!==""),e={};for(const n in this.listas)for(const o of this.listas[n]){const r=$utils.removerAcentos((o.id||"").toUpperCase()+(o.nomeCliente||"").toUpperCase()+(o.nomeDigitador||"").toUpperCase()+(o.nomeVendedor||"").toUpperCase()+" "+String(o.numeroVenda||"")+" ");let i=!0;for(const p of a)isNaN(Number(p))?i=i&&r.includes(p):i=i&&r.includes(" "+p+" ");this.empresaSelecionada&&(i=i&&this.empresaSelecionada.value===o.codigoEmpresa),this.vendedorDigitadorSelecionado&&(i=i&&(this.vendedorDigitadorSelecionado.value===o.codigoContatoDigitador||this.vendedorDigitadorSelecionado.value===o.codigoContatoVendedor)),o.mostra=i,o.mostra&&(e[o.crmFunilStatus]=(e[o.crmFunilStatus]||0)+(o.totalDocumento||0))}const l={};for(const n in this.listas)this.tamanhoLista[n]=10,l[n]=this.listas[n].filter(o=>o.mostra).slice(0,this.tamanhoLista[n]),document.getElementById(n);this.listasFiltradas=l,this.$nextTick(()=>{for(const n in this.listasFiltradas)document.getElementById(n).removeEventListener("scroll",this.scrollHandler),document.getElementById(n).addEventListener("scroll",this.scrollHandler)}),this.total=e},scrollHandler(a){const e=a.target.id;a.target.scrollHeight-a.target.scrollTop-a.target.offsetHeight<100&&(this.tamanhoLista[e]+=10,this.listasFiltradas[e]=this.listas[e].filter(n=>n.mostra).slice(0,this.tamanhoLista[e]))},async atualiza(){try{const a=await $db.crm.leOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,...this.diretivaContatosAcessaTodosContatos?{}:{codigoContato:$db.usuario.logado.codigoContato}});$utils.gconsole.log("FunilVendas","atualiza()",a.length),$utils.verificarAlerta(!a||!a.length,"N\xE3o h\xE1 or\xE7amentos");let e=await $db.configuracoes.le({nome:"vendas.crm.status"});e=e.filter(o=>!["Or\xE7amento","Conclu\xEDdo"].includes(o.texto));const l={Or\u00E7amento:[]};for(const o of $lodash.orderBy(e,"valor","asc").map(r=>r.texto))l[o]=[];l.Conclu\u00EDdo=[];const n={};for(const o of a){let r="bordaVerdeCRM";const i={id:o.id,codigoContatoDigitador:o.codigoContatoDigitador||0,codigoContatoVendedor:o.codigoContatoVendedor||0,codigoDocumento:o.codigoDocumento||0,codigoContato:o.codigoContato||0,codigoEmpresa:o.codigoEmpresa||0,descricaoEmpresa:o.descricaoEmpresa||"",corBorda:r,dataHoraEmissao:new Date(o.dataHoraEmissao||""),mostra:!0,nomeCliente:o.nomeCliente||"-",nomeVendedor:o.nomeVendedor||"-",nomeDigitador:o.nomeDigitador||"-",numeroVenda:o.numeroVenda||"-",status:o.status||"",crmFunilStatus:o.crmFunilStatus||"Or\xE7amento",totalDocumento:o.totalDocumento||0};l[i.crmFunilStatus]&&(l[i.crmFunilStatus].push(i),n[i.crmFunilStatus]=(n[i.crmFunilStatus]||0)+(i.totalDocumento||0))}this.listas=l,this.total=n,this.refazFiltro()}catch(a){this.$q.notifyError("Erro na consulta online de or\xE7amentos",a)}}},watch:{entregueInicio(){$utils.gconsole.log("FunilVendas","entregueInicio"),this.atualiza()},entregueFim(){$utils.gconsole.log("FunilVendas","entregueFim"),this.atualiza()}},created(){$utils.gconsole.log("FunilVendas","created()"),$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then(a=>{this.diretivaContatosAcessaTodosContatos=a,this.diretivaContatosAcessaTodosContatos&&(this.vendedoresDigitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then(e=>{e.forEach(l=>{l.codigo&&this.vendedoresDigitadoresOpcoes.push({label:l.nome,value:l.codigo})})})),this.empresaOpcoesCarregar(),this.atualiza()})},beforeUnmount(){for(const a in k)!document.getElementById(a)||document.getElementById(a).removeEventListener("scroll",this.scrollHandler)}},io={class:"q-pa-md"},no={class:"row overflowXCRM"},ro={class:"q-pa-none"},co={class:"float-left"},uo={key:0,class:"float-right text-body1"},mo={key:0,class:"row"},go={class:"col-12 q-pl-none"},po={class:"row q-mt-xs"},fo=c("div",{class:"col-6"},null,-1),ho={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},vo={class:"text-subtitle1"},Co={class:"col-11"},Vo={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},bo={class:"text-caption",style:{display:"inline-block","margin-right":"6px"}},_o={style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},yo={class:"text-caption",style:{display:"inline-block","margin-right":"6px"}},Fo={key:0,style:{background:"rgb(236, 239, 241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},Do={key:1,class:"text-caption",style:{display:"inline-block"}},So={class:"col-1 self-end"};function xo(a,e,l,n,o,r){const i=C("campo"),p=C("badge"),m=C("draggable"),A=C("crm-trocar-status"),B=C("modal-historico-status");return g(),y(J,{class:"FunilVendas",id:"FunilVendas"},{default:s(()=>[t(F,{class:"bg-gradiente text-white"},{default:s(()=>[t(D,null,{default:s(()=>[v("Funil de Vendas")]),_:1}),t(S,{icon:"mdi-filter",round:"",dense:"",flat:"",onClick:e[0]||(e[0]=u=>o.showfilters=!o.showfilters)})]),_:1}),t(R,{overlay:"",side:"right",modelValue:o.showfilters,"onUpdate:modelValue":e[6]||(e[6]=u=>o.showfilters=u)},{default:s(()=>[t(F,{color:"white",class:"text-tertiary"},{default:s(()=>[t(h,{class:"text-h5",name:"mdi-filter"}),t(D,null,{default:s(()=>[v("Filtro Avan\xE7ado")]),_:1}),t(S,{dense:"",flat:"",icon:"close",round:"",onClick:e[1]||(e[1]=u=>o.showfilters=!o.showfilters)})]),_:1}),c("div",io,[t(i,{modelValue:o.fraseFiltro,"onUpdate:modelValue":[e[2]||(e[2]=u=>o.fraseFiltro=u),r.filtraDebounce],rotulo:"Por cliente ou respons\xE1vel",dense:""},null,8,["modelValue","onUpdate:modelValue"]),o.diretivaContatosAcessaTodosContatos?(g(),y(w,{key:0,modelValue:o.vendedorDigitadorSelecionado,"onUpdate:modelValue":[e[3]||(e[3]=u=>o.vendedorDigitadorSelecionado=u),r.refazFiltro],options:o.vendedoresDigitadoresOpcoes,clearable:"",label:"Vendedor / Digitador"},null,8,["modelValue","options","onUpdate:modelValue"])):b("",!0),t(w,{modelValue:o.prazoSelecionado,"onUpdate:modelValue":e[4]||(e[4]=u=>o.prazoSelecionado=u),options:o.prazoOpcoes,clearable:"",label:"Por prazo"},null,8,["modelValue","options"]),t(w,{modelValue:o.empresaSelecionada,"onUpdate:modelValue":[e[5]||(e[5]=u=>o.empresaSelecionada=u),r.refazFiltro],options:o.empresaOpcoes,clearable:"",label:"Por empresa"},null,8,["modelValue","options","onUpdate:modelValue"])])]),_:1},8,["modelValue"]),c("div",no,[(g(!0),_(P,null,$(o.listasFiltradas,(u,V)=>(g(),_("div",{key:V,class:"no-shadow q-pa-none col coluna"},[c("div",ro,[t(F,{class:"no-shadow q-py-none q-px-sm text-white"},{default:s(()=>[t(D,{class:"q-py-none"},{default:s(()=>[c("div",co,f(V),1),o.total[V]?(g(),_("div",uo,f(a.$filters.numero(o.total[V],2)),1)):b("",!0)]),_:2},1024)]),_:2},1024),V==="Conclu\xEDdo"?(g(),_("div",mo,[c("div",go,[t(i,{modelValue:o.entregueInicio,"onUpdate:modelValue":e[7]||(e[7]=d=>o.entregueInicio=d),class:"q-mx-sm",rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),t(i,{modelValue:o.entregueFim,"onUpdate:modelValue":e[8]||(e[8]=d=>o.entregueFim=d),class:"q-mx-sm",rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])):b("",!0),t(m,{class:"dragAreaCRM",delay:"250",list:u,group:"osGroup",draggable:".extratoCRM",onEnd:r.eventoEnd,itemKey:"codigoDocumento",id:V},{item:s(({element:d})=>[d.mostra&&(o.prazoSelecionado===null||o.prazoSelecionado.value===d.corBorda)?(g(),y(j,{key:0,class:G(["q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 bg-white extratoCRM",d.corBorda])},{default:s(()=>[c("div",po,[fo,c("div",ho,[t(p,{cor:"grey-1",class:"q-mx-sm",icone:"shopping_cart",rotulo:a.$filters.numero(d.totalDocumento,2)},{default:s(()=>[t(z,null,{default:s(()=>[v(" Total: "+f(a.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024)]),_:2},1032,["rotulo"]),t(p,{cor:"grey-8",escuro:"",icone:"assignment_turned_in",rotulo:d.numeroVenda},{default:s(()=>[t(z,null,{default:s(()=>[v(" Vendas: "+f(a.$filters.numero(d.numeroVenda,2)),1)]),_:2},1024)]),_:2},1032,["rotulo"])])]),t(E,{class:"q-pa-xs"},{default:s(()=>[c("div",vo,f(d.nomeCliente),1)]),_:2},1024),t(E,{class:"row q-py-none"}),t(K,{class:"q-my-sm"}),t(E,{class:"row q-pa-none"},{default:s(()=>[c("div",Co,[c("div",Vo,[t(h,{name:"person",color:"grey-7",size:"14px"})]),c("div",bo,f(d.nomeVendedor),1),c("div",_o,[t(h,{name:"business",color:"grey-7",size:"14px"})]),c("div",yo,f(d.descricaoEmpresa),1),d.dataHoraEmissao?(g(),_("div",Fo,[t(h,{name:"calendar_today",color:"grey-7",size:"14px"})])):b("",!0),d.dataHoraEmissao?(g(),_("div",Do,f(a.$filters.data(d.dataHoraEmissao)),1)):b("",!0)]),c("div",So,[t(h,{name:"more_vert",style:{color:"grey",float:"right","text-align":"right","font-size":"1.2rem",cursor:"pointer"},onMouseOver:"this.style.color='black'",onMouseOut:"this.style.color='grey'"},{default:s(()=>[t(X,null,{default:s(()=>[O((g(),y(Z,{link:"",separator:""},{default:s(()=>[t(U,{clickable:"",onClick:H=>a.$refs.modalHistoricoStatus.mostrar({idDocumento:d.codigoDocumento})},{default:s(()=>[t(x,{avatar:""},{default:s(()=>[t(h,{name:"history"})]),_:1}),t(x,null,{default:s(()=>[t(T,null,{default:s(()=>[v("Hist\xF3rico do Status")]),_:1})]),_:1})]),_:2},1032,["onClick"]),t(U,{clickable:"",onClick:H=>r.irParaAtendimento(d.codigoContato)},{default:s(()=>[t(x,{avatar:""},{default:s(()=>[t(h,{name:"launch"})]),_:1}),t(x,null,{default:s(()=>[t(T,null,{default:s(()=>[v("Ir para o Atendimento")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[M]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["class"])):b("",!0)]),_:2},1032,["list","onEnd","id"])])]))),128))]),t(A,{modelValue:o.trocarStatusModal,"onUpdate:modelValue":e[9]||(e[9]=u=>o.trocarStatusModal=u),dados:o.trocarStatusDados,onConfirmar:r.eventoConfirmarTroca,onCancelar:r.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),t(B,{ref:"modalHistoricoStatus"},null,512)]),_:1})}var zo=I(lo,[["render",xo]]);export{zo as default};
