import{_ as Y,by as oe,bz as Q,bA as F,bB as D,bD as B,r as v,o as u,d as m,w as o,f as e,L as te,E as ae,h as J,Q as _,i as X,k as d,H as ie,I as le,t as x,n as A,e as g,F as O,az as R,O as U,s as M,R as S,S as b,T,B as L,m as y,l as ee,J as re,C as se,j as Z,as as H,aV as K,G as W,d1 as ne,bd as de,M as ue}from"./index.9b156bba.js";import{L as ce}from"./Lista.e33ba20c.js";import{P as me}from"./PromptContatoV2.2477df7d.js";import"./QBtnDropdown.2d29d66b.js";import"./QBtnGroup.4d3a3d67.js";import"./QScrollArea.e1ed3c28.js";const fe={components:{PromptItemV2:oe,PromptContatoV2:me},data(){return{visivel:!1,cliente:{},emitente:{},diaVencimento:"",documentoAnterior:{},documento:{id:Q(),dataHoraEmissao:F(),numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",numeroVolumeTransporte:"",status:"Ativo",tipo:"Contrato"},documentoItens:[],documentoItensAnterior:[],totalItens:0,itensModal:!1,contatosModal:!1,emitenteModal:!1,empresas:[],configImpressaoContrato:[]}},emits:["atualizar"],methods:{async atualizar(i){if($q.loading.show(),i=i||this.$route.params.id,i)this.documentoAnterior=await $db.hibrido.le({table:"documento",id:i}),this.documento=D(this.documentoAnterior),this.documentoItensAnterior=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:i}}),this.documentoItens=D(this.documentoItensAnterior),this.cliente.id=this.documento.idContato,this.cliente.nome=this.documento.descricaoContato,this.emitente.id=this.documento.idEmpresa,this.emitente.nome=this.documento.descricaoEmpresa,this.diaVencimento=this.documento.numeroVolumeTransporte;else{this.limparCampos(),this.documento.id=Q(),this.documento.dataHoraEmissao=F(),this.documento.status="Ativo",this.documento.tipo="Contrato";const a=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione"});this.emitente=D(a),this.documento.idEmpresa=this.emitente.id,this.documento.descricaoEmpresa=this.emitente.nome}this.empresas=await $db.hibrido.lista({table:"empresa"}),this.somarValorTotal(),this.configuraImpressaoContrato(this.documento.idEmpresa),$q.loading.hide()},fechar(){this.$router.replace({params:{id:""}}),this.limparCampos(),this.visivel=!1},limparCampos(){this.documentoAnterior={},this.documento={id:"",dataHoraEmissao:null,numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",numeroVolumeTransporte:"",status:"",tipo:""},this.documentoItensAnterior=[],this.documentoItens=[],this.cliente.id="",this.cliente.nome="",this.emitente.id="",this.emitente.nome="",this.diaVencimento=""},async configuraImpressaoContrato(i){const a=await $db.configuracoes.porNome("impressao.contrato",i);this.configImpressaoContrato=a},async abrirModal(i=""){let a={},c=[];i?c=this.documentoItens.filter(f=>f.idItem===i):c=this.documentoItens;for(const f of c)a[f.idItem]={item:await $db.hibrido.le({table:"item",id:f.idItem}),quantidade:f.quantidade};this.$refs.promptItem.itensSelecionados=a,this.$refs.promptItem.termo=i,this.$refs.promptItem.atualizar(),this.itensModal=!0},recalcularTotal(i){i.subTotal=B(i.quantidade*i.valorItem),i.total=B(i.quantidade*i.valorItem),this.somarValorTotal()},aoSelecionarCliente(i,a){},async selecionarCliente(){if(this.documento.status!=="Cancelado"){const i=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione"});this.cliente=D(i),this.contatosModal=!1,this.documento.idContato=this.cliente.id,this.documento.descricaoContato=this.cliente.nome}},async selecionarEmitente(i,a){if(!i){this.emitenteModal=!1;return}this.emitente=D(a),this.emitenteModal=!1,this.documento.idEmpresa=this.emitente.id,this.documento.descricaoEmpresa=this.emitente.nome},aoSelecionarVencimento(){this.documento.numeroVolumeTransporte=this.diaVencimento},selecionarItens:function(i){for(const a in i){const c=i[a].item||{},f=i[a].quantidade||0;let t=this.documentoItens.find(s=>s.idItem===a);t?(t.quantidade=f,t.quantidadeRealizado=f,t.total=B(f*c.valorVenda)):this.documentoItens.push({dataHoraEmissao:F(),descricaoItem:c.descricao,id:Q(),idDocumento:this.documento.id,idItem:c.id,operacao:"-",quantidade:f,unidade:c.unidade,quantidadeRealizado:f,tipoItem:c.tipo,total:B(f*c.valorVenda),valorItem:c.valorVenda})}this.somarValorTotal()},somarValorTotal(){this.totalItens=this.documentoItens.reduce((i,a)=>i+=a.total,0)},excluirItem(i){this.documentoItens=this.documentoItens.filter(a=>a.id!==i),this.somarValorTotal()},validaDia(){if(this.diaVencimento<1||this.diaVencimento>28){this.$q.notifyAlert("O dia deve ser um valor entre 1 e 28"),this.diaVencimento="";return}this.aoSelecionarVencimento()},async gravar(i=!1){if(!this.cliente.id){this.$q.notifyAlert("Selecione um Cliente");return}if(!this.emitente.id){this.$q.notifyAlert("Selecione um Emitente");return}if(!this.diaVencimento){this.$q.notifyAlert("Selecione um dia de Vencimento");return}if(!this.totalItens){this.$q.notifyAlert("Adicione alguns itens ao contrato");return}try{await $db.contrato.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens}),this.visivel=i,this.atualizar(this.documento.id),this.$emit("atualizar")}catch(a){this.$q.notifyError("Erro ao salvar",a)}},cancelar(){this.documento.status="Cancelado",this.documento.dataHoraFinalizado=F(),this.gravar(!0),$q.notifyPositive("Contrato Cancelado")},ativar(){this.documento.status="Ativo",this.documento.dataHoraFinalizado="",this.gravar(!0),$q.notifyPositive("Contrato Reativado")}}},pe={key:0},he={ref:"form"},be={class:"u-container"};function ve(i,a,c,f,t,s){const C=v("badge"),q=v("BadgeCopiarUid"),w=v("avatar"),r=v("g-col"),k=v("campo"),p=v("g-row"),l=v("g-label"),h=v("PromptItemV2"),E=v("PromptContatoV2");return u(),m(se,{modelValue:t.visivel,"onUpdate:modelValue":a[11]||(a[11]=n=>t.visivel=n),maximized:"",onHide:a[12]||(a[12]=n=>s.fechar())},{default:o(()=>[e(te,{view:"hHh LpR fFf",container:"",class:"bg-light"},{default:o(()=>[e(ae,null,{default:o(()=>[e(J,null,{default:o(()=>[e(_,{onClick:a[0]||(a[0]=n=>s.fechar()),icon:"arrow_back",round:"",dense:"",flat:""}),e(X,null,{default:o(()=>[d("Contrato")]),_:1}),e(_,{onClick:a[1]||(a[1]=n=>s.gravar(!1)),label:"Salvar",color:"white","text-color":"primary",unelevated:""})]),_:1})]),_:1}),e(ie,{class:"u-container"},{default:o(()=>[e(le,null,{default:o(()=>[e(J,{color:"transparent",class:"q-my-md"},{default:o(()=>[e(X,{class:"text-body2"},{default:o(()=>[d(" Emiss\xE3o: "+x(i.$filters.data(t.documento.dataHoraEmissao))+" ",1),t.documento.dataHoraFinalizado?(u(),A("span",pe,", Cancelamento: "+x(i.$filters.data(t.documento.dataHoraFinalizado)),1)):g("",!0)]),_:1}),t.documento.status?(u(),m(C,{key:0,rotulo:t.documento.status,escuro:"",dica:"Status",class:"q-ml-sm",cor:t.documento.status==="Ativo"?"primary":"tertiary"},null,8,["rotulo","cor"])):g("",!0),t.documento.numero?(u(),m(q,{key:1,id:t.documento.id,numero:t.documento.numero,cor:t.documento.status==="Ativo"?"positive":"tertiary",dica:"C\xF3digo: "+t.documento.codigoDocumento,class:"q-ml-sm"},null,8,["id","numero","cor","dica"])):g("",!0),t.documento.numero?(u(),A(O,{key:2},[t.configImpressaoContrato.length>1?(u(),m(_,{key:0,icon:"print",color:"primary",round:"",dense:"",flat:"",class:"q-ml-xs"},{default:o(()=>[e(R,{self:"top middle",anchor:"bottom middle"},{default:o(()=>[e(U,{link:"",separator:""},{default:o(()=>[(u(!0),A(O,null,M(t.configImpressaoContrato.filter(n=>n.valor),n=>(u(),m(S,{key:n.valor,onClick:z=>i.$imprimir(n.valor,{id:(t.documento||{}).id||"0",Oculto:"0"})},{default:o(()=>[e(b,{icon:"print"}),e(T,{label:n.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})):(u(),m(_,{key:1,icon:"print",color:"primary",round:"",dense:"",flat:"",class:"q-ml-xs",onClick:a[2]||(a[2]=n=>i.$imprimir(t.configImpressaoContrato[0].valor,{id:(t.documento||{}).id||"0",Oculto:"0"}))}))],64)):g("",!0)]),_:1}),L("form",he,[e(p,{gutter:"md",mg:"md-y",bg:"bg-white","rounded-borders":""},{default:o(()=>[e(r,{col:"12 sm"},{default:o(()=>[e(p,null,{default:o(()=>[e(r,{col:"shrink"},{default:o(()=>[e(w,{imagem:t.emitente.imagem,rotulo:t.emitente.nome,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"])]),_:1}),e(r,{col:"grow"},{default:o(()=>[e(k,{modelValue:t.emitente.nome,"onUpdate:modelValue":a[3]||(a[3]=n=>t.emitente.nome=n),rotulo:"Emitente",tipo:"texto",disable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{col:"12 sm"},{default:o(()=>[e(p,null,{default:o(()=>[e(r,{col:"shrink"},{default:o(()=>[e(w,{imagem:t.cliente.imagem,rotulo:t.cliente.nome,tamanho:"30",style:{float:"left"}},null,8,["imagem","rotulo"])]),_:1}),e(r,{col:"grow"},{default:o(()=>[e(k,{modelValue:t.cliente.nome,"onUpdate:modelValue":[a[4]||(a[4]=n=>t.cliente.nome=n),s.aoSelecionarCliente],onClick:s.selecionarCliente,after:[{icon:"edit",handler(){s.selecionarCliente()}}],somenteLeitura:t.documento.status==="Cancelado",placeholder:"Cliente",rotulo:"Cliente",tipo:"texto"},null,8,["modelValue","onUpdate:modelValue","onClick","after","somenteLeitura"])]),_:1})]),_:1})]),_:1}),e(r,{col:"12 sm"},{default:o(()=>[e(k,{modelValue:t.diaVencimento,"onUpdate:modelValue":a[5]||(a[5]=n=>t.diaVencimento=n),onBlur:s.validaDia,opcoes:{minimumValue:1,maximumValue:28},error:t.diaVencimento>28||t.diaVencimento<1,rotulo:"Dia de Vencimento",tipo:"numero",errorMessage:"Dia entre 1 e 28",placeholder:"Dia Vencimento"},null,8,["modelValue","onBlur","error"])]),_:1})]),_:1})],512),e(p,{gutter:"md",mg:"md-y",bg:"bg-white","rounded-borders":""},{default:o(()=>[e(r,{col:"grow"},{default:o(()=>[e(l,{icon:"shopping_cart sm tertiary left"},{default:o(()=>[d("Produtos e Servi\xE7os")]),_:1})]),_:1}),e(r,{col:"shrink"},{default:o(()=>[t.documento.status!=="Cancelado"?(u(),m(_,{key:0,onClick:a[6]||(a[6]=n=>s.abrirModal()),icon:"add",size:"md",color:"positive",round:"",dense:"",flat:""},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Adicionar Item")]),_:1})]),_:1})):g("",!0)]),_:1}),e(r,{col:"12"},{default:o(()=>[e(U,null,{default:o(()=>[e(p,{class:"hideonmobile",justify:"around",text:"bold"},{default:o(()=>[e(r,{col:"2 md"},{default:o(()=>[d("C\xF3digo")]),_:1}),e(r,{col:"10 md4 "},{default:o(()=>[d("Descri\xE7\xE3o")]),_:1}),e(r,{col:"6 md",text:"right"},{default:o(()=>[d("Quantidade")]),_:1}),e(r,{col:"6 md",text:"right"},{default:o(()=>[d("Valor")]),_:1}),e(r,{col:"6 md",text:"right"},{default:o(()=>[d("Total")]),_:1}),e(r,{col:"6 md1",text:"center"},{default:o(()=>[d("A\xE7\xF5es")]),_:1})]),_:1}),e(ee,{class:"q-mt-xs q-mb-sm"}),(u(!0),A(O,null,M(t.documentoItens,(n,z)=>(u(),m(p,{key:z,items:"center",justify:"center",bordered:"bottom"},{default:o(()=>[e(r,{col:"grow md",order:"xs0 sm0"},{default:o(()=>[e(p,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[d(" C\xF3d.: ")]),_:1}),e(r,{col:"grow"},{default:o(()=>[d(x(n.codigoItem||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md4",order:"xs2 sm1"},{default:o(()=>[e(p,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[d(" Desc.: ")]),_:1}),e(r,{col:"grow"},{default:o(()=>[d(x(n.descricaoItem||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md",order:"xs3 sm2"},{default:o(()=>[e(p,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[e(l,{class:"q-mr-xs"},{default:o(()=>[d("Qtd.:")]),_:1})]),_:1}),e(r,{col:"grow sm10",text:"right"},{default:o(()=>[e(k,{modelValue:n.quantidade,"onUpdate:modelValue":V=>n.quantidade=V,onBlur:V=>s.recalcularTotal(n),tipo:"decimal",decimals:"4",filled:""},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024),e(r,{col:"2",text:"center"},{default:o(()=>[e(l,null,{default:o(()=>[d(x(n.unidade||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md",order:"xs4 sm3"},{default:o(()=>[e(p,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[d(" Valor: ")]),_:1}),e(r,{col:"grow",text:"right"},{default:o(()=>[e(k,{modelValue:n.valorItem,"onUpdate:modelValue":V=>n.valorItem=V,onBlur:V=>s.recalcularTotal(n),tipo:"decimal",decimals:"4",filled:""},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md",order:"xs5 sm4"},{default:o(()=>[e(p,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[d(" Total: ")]),_:1}),e(r,{col:"grow",text:"right"},{default:o(()=>[d(x(i.$filters.numero(n.total,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"shrink md1",order:"xs1 sm5",text:"center"},{default:o(()=>[e(_,{onClick:V=>s.abrirModal(n.idItem),icon:"edit",round:"",dense:"",flat:""},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Editar")]),_:1})]),_:2},1032,["onClick"]),e(_,{onClick:V=>s.excluirItem(n.id),icon:"delete",round:"",dense:"",flat:""},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Excluir")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(p,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"grow md"},{default:o(()=>[d("\xA0")]),_:1}),e(r,{col:"10 md4"},{default:o(()=>[d("\xA0")]),_:1}),e(r,{col:"12 md",text:"right"},{default:o(()=>[d("\xA0")]),_:1}),e(r,{col:"12 md",text:"right"},{default:o(()=>[d("\xA0")]),_:1}),e(r,{col:"12 md",text:"right"},{default:o(()=>[d(x(i.$filters.numero(t.totalItens,2)),1)]),_:1}),e(r,{col:"12 md1",text:"right"},{default:o(()=>[d("\xA0")]),_:1})]),_:1}),e(p,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"12",text:"center"},{default:o(()=>[e(_,{onClick:a[7]||(a[7]=n=>s.abrirModal()),label:"Adicionar item",icon:"add",size:"xs",color:"positive",outline:"",class:"q-mx-auto"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(h,{modelValue:t.itensModal,"onUpdate:modelValue":a[8]||(a[8]=n=>t.itensModal=n),onSelecionarItens:s.selecionarItens,filtro:{ativo:!0,idEmpresa:t.documento.idEmpresa},habilitarQuantidade:!0,ref:"promptItem"},null,8,["modelValue","onSelecionarItens","filtro"]),e(E,{modelValue:t.contatosModal,"onUpdate:modelValue":a[9]||(a[9]=n=>t.contatosModal=n),onSelecionar:s.aoSelecionarCliente,filtro:{ativo:!0},placeholder:"Seleciona o Cliente"},null,8,["modelValue","onSelecionar"]),e(E,{modelValue:t.emitenteModal,"onUpdate:modelValue":a[10]||(a[10]=n=>t.emitenteModal=n),onSelecionar:s.selecionarEmitente,filtro:{ativo:!0,empresas:!0},placeholder:"Seleciona a empresa emitente"},null,8,["modelValue","onSelecionar"])]),_:1})]),_:1}),e(re,{class:"q-pa-sm bg-white text-right",bordered:""},{default:o(()=>[L("div",be,[t.documento.status==="Cancelado"?(u(),m(_,{key:0,onClick:s.ativar,label:"Ativar",color:"primary",unelevated:""},null,8,["onClick"])):g("",!0),t.documento.status==="Ativo"?(u(),m(_,{key:1,onClick:s.cancelar,label:"Cancelar",color:"negative",flat:""},null,8,["onClick"])):g("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ge=Y(fe,[["render",ve]]);const Ce={components:{Lista:ce,ContratoFicha:ge},data(){return{usuario:"",listaLayout:{},lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"gavel",titulo:"Contratos",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!0,btnRemover:!0,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!0,toolbarAdicao:!1,bannerMsg:""},busca:"",filtrosOriginal:{},filtros:{status:"Ativo",termoBusca:"",empresa:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},empresa:"",empresaOpcoes:[],sort:{value:"numero",label:"N\xFAmero Contrato"},sortOpcoes:[{value:"numero",label:"N\xFAmero Contrato"},{value:"codigoDocumento",label:"C\xF3digo Documento"},{value:"dataHoraEmissao",label:"Data emiss\xE3o"},{value:"codigoDocumento",label:"Data finaliza\xE7\xE3o"}],order:{value:"desc",label:"Decrescente"},orderOpcoes:[{value:"asc",label:"Crescente"},{value:"desc",label:"Decrescente"}],checkBox:!1,tabSelecionada:{valor:"Ativos"},tabs:[{valor:"Ativo",rotulo:"Ativos"},{valor:"Suspenso",rotulo:"Suspensos"},{valor:"Cancelado",rotulo:"Cancelados"},{valor:"Todos",rotulo:"Todos"}],paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(i){var c;const a=$utils.logarIni("ContratosLista");await $tryLoading(async()=>{var w,r,k,p,l,h,E,n,z,V,P,N,j,$,G;this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor;let{buscarDadosRecentes:f}=i!=null?i:{},t={},s={};f&&(t=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"ContratosLista_"+((w=this.usuario)==null?void 0:w.id)}),t!=null&&t._id&&(this.tabSelecionada.valor=t==null?void 0:t.tabSelecionada,this.busca=(t==null?void 0:t.busca)||"",this.filtros={termoBusca:((r=t==null?void 0:t.filtros)==null?void 0:r.termoBusca)||null,empresa:((k=t==null?void 0:t.filtros)==null?void 0:k.empresa)||null,periodoEmissao:{ini:((l=(p=t==null?void 0:t.filtros)==null?void 0:p.periodoEmissao)==null?void 0:l.ini)||"",fim:((E=(h=t==null?void 0:t.filtros)==null?void 0:h.periodoEmissao)==null?void 0:E.fim)||""},periodoFinalizado:{ini:((z=(n=t==null?void 0:t.filtros)==null?void 0:n.periodoFinalizado)==null?void 0:z.ini)||"",fim:((P=(V=t==null?void 0:t.filtros)==null?void 0:V.periodoFinalizado)==null?void 0:P.fim)||""}},this.compareObject(this.filtrosOriginal,this.filtros,["termoBusca"])&&(this.$refs.contratosLista.filtros=!0))),s=$utils.eliminarVazios(this.filtros),delete s.status,((N=this.tabSelecionada)==null?void 0:N.valor)!=="Todos"&&(s.status=(j=this.tabSelecionada)==null?void 0:j.valor),console.log("STATUS: ",s.status),this.empresa&&(s.empresa=(($=this.empresa)==null?void 0:$.value)||""),this.busca&&(s.termoBusca=this.busca||"");let C={data:[],totalPages:0,total:0};C=await $db.contrato.leListaCompleta({filtros:s,limit:this.paginacao.limite,page:this.paginacao.atual,sort:[this.sort.value],order:[this.order.value]});let q=!0;for(const I of C.data)this.listaLayout.hasOwnProperty(I.id)||($db.hibrido.isOnline()||(I.documentoItens=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:I.id}})),I.totalContrato=$utils.somar(I.documentoItens,"total"),this.listaLayout[I.id]={detalhes:!1,remover:!1}),this.listaLayout[I.id].remover||(q=!1);this.$refs.contratosLista.checkbox=q,this.lista=C.data,this.paginacao.total=C.total,this.paginacao.maximo=C.totalPages,t={_id:"ContratosLista_"+((G=this.usuario)==null?void 0:G.id),tabSelecionada:this.tabSelecionada.valor,busca:this.busca,filtros:$utils.clonar(s)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:t})}),$utils.logarFim(a,((c=this.paginacao)==null?void 0:c.total)||1)},async gerarLoteNFSe(){await this.$q.dialog({title:"Gerar lote de NFS-e",message:"Deseja gerar as notas de servi\xE7o a partir dos contratos?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async()=>{const i=$utils.logarIni("ContratosLista");await $tryLoading(async()=>{await $db.contrato.gerarNFSEapartirContrato(),$q.notifyPositive("Exporta\xE7\xE3o das notas finalizada.")},{mensagem:"Exportando Contratos para NFSe...",erro:"Ocorreu um erro ao exportar contratos"}),$utils.logarFim(i,1)}).onCancel(()=>{}).onDismiss(()=>{})},async criarClick(){await this.$refs.contrato.atualizar(),this.$refs.contrato.visivel=!0},async abrirItem(i){this.$router.replace({params:{id:i}}),await this.$refs.contrato.atualizar(i),this.$refs.contrato.visivel=!0},checkBoxClick(){for(const i of this.lista)this.listaLayout[i.id].remover=this.checkBox},verificarCheckbox(){let i=!0;for(const a of this.lista)this.listaLayout[a.id].remover||(i=!1);this.$refs.contratosLista.checkbox=i},async removerItem(i){$q.dialog({title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show(),await $db.contrato.remove(i.id),this.atualizar(),$q.notifyPositive("O contrato foi exclu\xEDdo com sucesso.")}catch(a){$q.notifyError("Ocorreu um erro ao remover contrato.",a)}finally{$q.loading.hide()}})},async removerTodos(){$q.dialog({title:"Remover contratos",message:"Deseja remover todos os contratos selecionados?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();for(let i of this.lista)if(this.listaLayout[i.id].remover)try{await $db.contrato.remove(i.id)}catch{$q.notify("Ocorreu um erro ao remover os contratos selecionados. Tente novamente.")}this.atualizar(),$q.notifyPositive("Os contratos foram removidos com sucesso.")}catch(i){$q.notifyError("Ocorreu um erro ao remover todos os contratos selecionados.",i)}finally{$q.loading.hide()}})},async limparFiltrosClick(){this.empresa="",this.sort={label:"N\xFAmero Contrato",value:"numero"},this.order={label:"Decrescente",value:"desc"},this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},compareObject(i,a,c=[]){const f=Object.keys(i);for(const t of f)if(!c.includes(t)){if(typeof i[t]=="object"&&i[t]!==null){if(!this.compareObject(i[t],a[t],c))continue;return!0}else if(i[t]!==a[t])return!0}return!1}},async mounted(){if(this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),$db.hibrido.isOnline()){const i=(await $db.hibrido.lista({table:"empresa",where:{ativo:!0}})).map(a=>(a.ordenar=this.$utils.removerCaracteresEspeciais(a.apelido),a)).sort((a,c)=>a.ordenar>c.ordenar?1:c.ordenar>a.ordenar?-1:0);for(const a of i)this.empresaOpcoes.push({label:a.apelido,value:a.idContato})}else{const i=(await $erp().empresa.toArray()).filter(a=>a.ativo===!0).map(a=>(a.ordenar=this.$utils.removerCaracteresEspeciais(a.apelido),a)).sort((a,c)=>a.ordenar>c.ordenar?1:c.ordenar>a.ordenar?-1:0);for(const a of i)this.empresaOpcoes.push({label:a.apelido,value:a.idContato})}await this.atualizar({buscarDadosRecentes:!0}),this.$route.params.id&&this.$route.params.id.length&&this.abrirItem(this.$route.params.id)}},_e={id:"ContratosLista"},ye={class:"mw80 text-center"},ke={class:"q-mt-sm"};function Ve(i,a,c,f,t,s){const C=v("campo"),q=v("BadgeCopiarUid"),w=v("avatar"),r=v("badge"),k=v("Lista"),p=v("ContratoFicha");return u(),A("div",_e,[e(k,{ref:"contratosLista",busca:t.busca,"onUpdate:busca":a[11]||(a[11]=l=>t.busca=l),checkBox:t.checkBox,"onUpdate:checkBox":a[12]||(a[12]=l=>t.checkBox=l),onAtualizar:s.atualizar,onCriarClick:s.criarClick,onRemoverClick:s.removerTodos,onCheckBoxClick:s.checkBoxClick,onLimparFiltrosClick:s.limparFiltrosClick,lista:t.lista,tabs:t.tabs,tabSelecionada:t.tabSelecionada,paginacao:t.paginacao,mostrar:t.mostrar},{menuExtras:o(()=>[e(S,{onClick:a[0]||(a[0]=l=>s.gerarLoteNFSe()),clickable:""},{default:o(()=>[e(b,{avatar:""},{default:o(()=>[e(Z,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(b,null,{default:o(()=>[d("Gerar notas de servi\xE7o")]),_:1})]),_:1})]),filtroCampos:o(()=>[e(H,{modelValue:t.empresa,"onUpdate:modelValue":a[1]||(a[1]=l=>t.empresa=l),options:t.empresaOpcoes,clearable:"",dense:"",label:"Por empresa",class:"q-mb-xl"},null,8,["modelValue","options"]),e(C,{modelValue:t.filtros.periodoEmissao.ini,"onUpdate:modelValue":a[2]||(a[2]=l=>t.filtros.periodoEmissao.ini=l),rotulo:"Data emiss\xE3o",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),e(C,{modelValue:t.filtros.periodoEmissao.fim,"onUpdate:modelValue":a[3]||(a[3]=l=>t.filtros.periodoEmissao.fim=l),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),e(C,{modelValue:t.filtros.periodoFinalizado.ini,"onUpdate:modelValue":a[4]||(a[4]=l=>t.filtros.periodoFinalizado.ini=l),rotulo:"Data finalizado",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),e(C,{modelValue:t.filtros.periodoFinalizado.fim,"onUpdate:modelValue":a[5]||(a[5]=l=>t.filtros.periodoFinalizado.fim=l),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),e(H,{modelValue:t.sort,"onUpdate:modelValue":a[6]||(a[6]=l=>t.sort=l),options:t.sortOpcoes,dense:"",label:"Ordenar por",class:"q-mb-xs"},null,8,["modelValue","options"]),e(H,{modelValue:t.order,"onUpdate:modelValue":a[7]||(a[7]=l=>t.order=l),options:t.orderOpcoes,dense:"",label:"Crescente/Decrescente",class:"q-mb-xl"},null,8,["modelValue","options"]),e(C,{modelValue:t.paginacao.limite,"onUpdate:modelValue":a[8]||(a[8]=l=>t.paginacao.limite=l),rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",min:"1",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:o(()=>[e(U,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:o(()=>[(u(!0),A(O,null,M(t.lista,l=>(u(),A("div",{key:l.id,class:"itemHover"},[e(S,{class:"items-center d-flex q-pa-xs",clickable:""},{default:o(()=>[e(b,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:o(()=>[e(S,{class:"q-pa-none"},{default:o(()=>[e(b,{side:"",class:"col-auto q-pa-none"},{default:o(()=>[e(K,{modelValue:t.listaLayout[l.id].remover,"onUpdate:modelValue":h=>t.listaLayout[l.id].remover=h,onClick:a[9]||(a[9]=h=>s.verificarCheckbox())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(b,{side:"",class:"col-auto q-pa-none"},{default:o(()=>[L("div",ye,[e(q,{id:l.id,numero:l.numero,cor:l.status==="Ativo"?"positive":"tertiary",class:"q-mr-sm hideonmobile"},null,8,["id","numero","cor"])])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(b,{class:"col no-margin"},{default:o(()=>[e(S,{class:"q-pa-none"},{default:o(()=>[e(b,{onClick:h=>s.abrirItem(l.id),class:"col-auto items-center"},{default:o(()=>[e(w,{rotulo:l.descricaoContato,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["rotulo"]),e(K,{modelValue:t.listaLayout[l.id].remover,"onUpdate:modelValue":h=>t.listaLayout[l.id].remover=h,onClick:a[10]||(a[10]=h=>s.verificarCheckbox()),class:"hideondesktop q-mt-md"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onClick"]),e(b,{onClick:h=>s.abrirItem(l.id),class:"col"},{default:o(()=>[l.descricaoContato?(u(),m(T,{key:0,lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:o(()=>[d(x(l.descricaoContato)+" ",1),e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Descri\xE7\xE3o")]),_:1})]),_:2},1024)):g("",!0),l.codigoDocumento?(u(),m(T,{key:1,caption:"",lines:"1",class:"text-tertiary ellipsis hideonmobile"},{default:o(()=>[e(r,{rotulo:"#"+l.codigoDocumento,cor:"light",class:"q-mr-xs"},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("C\xF3digo Documento")]),_:1})]),_:2},1032,["rotulo"])]),_:2},1024)):g("",!0),e(b,{class:"hideondesktop q-mt-sm"},{default:o(()=>[L("div",null,[e(q,{id:l.id,numero:l.numero,cor:l.status==="Ativo"?"positive":"tertiary",class:"q-mr-sm"},null,8,["id","numero","cor"]),e(r,{rotulo:"#"+l.codigoDocumento,cor:"light",class:"q-mr-sm"},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("C\xF3digo Documento")]),_:1})]),_:2},1032,["rotulo"])]),L("div",ke,[l.dataHoraEmissao?(u(),m(r,{key:0,rotulo:i.$filters.data(l.dataHoraEmissao),escuro:"",icone:"today",cor:"tertiary",class:"q-mr-xs"},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Data Emiss\xE3o")]),_:1})]),_:2},1032,["rotulo"])):g("",!0),l.dataHoraFinalizado?(u(),m(r,{key:1,rotulo:i.$filters.data(l.dataHoraFinalizado),escuro:"",icone:"today",cor:"tertiary"},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Data Finaliza\xE7\xE3o")]),_:1})]),_:2},1032,["rotulo"])):g("",!0)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),W(e(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:o(()=>[l.status?(u(),m(ne,{key:0,class:"col-auto q-mx-auto q-py-xs",color:l.status==="Ativo"?"primary":"tertiary"},{default:o(()=>[d(x(l.status)+" ",1),e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Status")]),_:1})]),_:2},1032,["color"])):g("",!0)]),_:2},1032,["onClick"]),[[de,t.tabSelecionada.valor!="Ativos"&&t.tabSelecionada.valor!="Cancelados"]]),e(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:o(()=>[l.dataHoraEmissao?(u(),m(r,{key:0,rotulo:i.$filters.data(l.dataHoraEmissao),icone:"today",cor:"transparent",class:"col-auto q-mx-auto q-py-xs"},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Data Emiss\xE3o")]),_:1})]),_:2},1032,["rotulo"])):g("",!0)]),_:2},1032,["onClick"]),e(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:o(()=>[l.dataHoraFinalizado?(u(),m(r,{key:0,rotulo:i.$filters.data(l.dataHoraFinalizado),icone:"today",cor:"transparent",class:"col-auto q-mx-auto q-py-xs"},{default:o(()=>[e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Data Finaliza\xE7\xE3o")]),_:1})]),_:2},1032,["rotulo"])):g("",!0)]),_:2},1032,["onClick"]),e(b,{onClick:h=>s.abrirItem(l.id),class:"hideonmobile maxw140 q-pl-sm no-margin"},{default:o(()=>[e(T,{class:"text-tertiary text-weight-bold text-right"},{default:o(()=>[d(x(i.$filters.numeroZerosDireita(l.totalContrato,4,2))+" ",1),e(y,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[d("Valor do Contrato")]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),e(b,{side:"",top:""},{default:o(()=>[e(S,{class:"q-pa-none"},{default:o(()=>[e(b,{class:"hideonmobile q-pr-sm no-margin"},{default:o(()=>[e(_,{onClick:h=>s.abrirItem(l.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024),e(_,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:o(()=>[e(R,null,{default:o(()=>[W((u(),m(U,{link:"","no-border":"",separator:""},{default:o(()=>[l.status==="Ativo"?(u(),m(S,{key:0,onClick:h=>s.removerItem(l),clickable:""},{default:o(()=>[e(b,{avatar:""},{default:o(()=>[e(Z,{name:"delete"})]),_:1}),e(b,null,{default:o(()=>[d("Remover")]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)),[[ue]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ee)]))),128))]),_:1})]),_:1},8,["busca","checkBox","onAtualizar","onCriarClick","onRemoverClick","onCheckBoxClick","onLimparFiltrosClick","lista","tabs","tabSelecionada","paginacao","mostrar"]),e(p,{onAtualizar:s.atualizar,ref:"contrato"},null,8,["onAtualizar"])])}var Ee=Y(Ce,[["render",Ve]]);export{Ee as default};
