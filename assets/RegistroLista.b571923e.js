import{_ as Y,a0 as $,$ as tt,by as ot,Z as et,bz as G,bA as A,bB as P,aE as L,bC as at,bD as D,r as b,o as d,n as f,f as t,w as i,L as it,H as st,E as lt,h as M,G as T,Q as y,M as Q,i as U,k as p,t as h,d as g,e as m,I as rt,y as W,B as c,j as S,m as R,O as B,R as x,S as v,T as q,l as H,F as z,s as N,J as nt,C as K,as as dt,az as X}from"./index.353e304f.js";import{l as ct}from"./listaV2.d8b0bde8.js";import{C as ut}from"./Campo.f3ecfc86.js";import{P as mt}from"./PromptContatoV2.b686aa28.js";import{e as ht}from"./emitirNFe.35117289.js";import{n as ft}from"./nfePrincipal.eb13b811.js";import"./QBreadcrumbs.62e7fc84.js";import"./xlsx.5197d0f9.js";import"./compactarValidarNFe.2b88d2f8.js";import"./obterItens.9fafaf2d.js";import"./codigosANP.a6c1a264.js";const pt={components:{BadgeCopiarUid:$,Badge:tt,Campo:ut,PromptItemV2:ot,Avatar:et,PromptContatoV2:mt},data(){return{cliente:{},emitente:{},diaVencimento:"",operacaoFator:-1,opcoesFator:[{rotulo:"Sa\xEDda",valor:-1},{rotulo:"Entrada",valor:1}],documentoAnterior:{},documentoItensAnterior:[],documento:{id:G(),dataHoraEmissao:A(),numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",status:"Digita\xE7\xE3o",tipo:"Registro",operacao:this.operacao,idContatoDigitador:null},documentoItens:[],totalItens:0,qtdItens:0,visibilidade:{modal:!1},itensModal:!1,carregando:!0,contatosModal:!1,emitenteModal:!1,empresas:[],configImpressaoRegistro:[],operacao:"",somenteLeitura:!1,ocultarValores:!0,modalItemSemEstoque:{},item:{}}},emits:["atualizar","tituloPagina"],methods:{async atualizar(a){var o;if(this.modalItemSemEstoque={},a){this.documentoAnterior=await $db.hibrido.le({table:"documento",id:a}),this.documento=P(this.documentoAnterior),this.documentoItensAnterior=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:a}});for(let n=0;n<this.documentoItensAnterior.length;n++)this.documentoItensAnterior[n];this.documentoItens=P(this.documentoItensAnterior),this.cliente.id=this.documento.idContato,this.cliente.nome=this.documento.descricaoContato,this.emitente.id=this.documento.idEmpresa,this.emitente.nome=this.documento.descricaoEmpresa,this.operacaoFator=null}else if(this.limparCampos(),this.empresas=await L.empresa.le(),this.empresas.length===1)this.emitente=P(this.empresas[0]),this.documento.idEmpresa=this.emitente.idContato,this.documento.descricaoEmpresa=this.emitente.nome;else{const n=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione"});if(!n){$q.notify({type:"negative",message:"Selecione a empresa"}),this.visibilidade.modal=!1;return}this.emitente=P(n),this.documento.idEmpresa=this.emitente.id,this.documento.descricaoEmpresa=this.emitente.nome}for(const n of this.documentoItens)this.item[n.idItem]=(o=await $db.item.ler({filtros:{id:n.idItem}}))==null?void 0:o.data[0],this.operacaoFator||(this.operacaoFator=n.operacaoFator);this.somarValorTotal(),this.configuraImpressaoContrato(this.documento.idEmpresa)},async mostrar(){await at(500),this.carregando=!1},async configuraImpressaoContrato(a){const o=await L.configuracoes.porNome("impressao.contrato",a);this.configImpressaoContrato=o},fechar(){this.operacaoFator=-1,this.carregando=!0,this.$router.replace({params:{id:""}})},limparCampos(){this.documentoAnterior={},this.documento={id:G(),dataHoraEmissao:A(),numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",status:"Digita\xE7\xE3o",tipo:"Registro",operacao:this.operacao},this.documentoItensAnterior=[],this.documentoItens=[],this.cliente.id="",this.cliente.nome="",this.emitente.id="",this.emitente.nome="",this.diaVencimento=""},capitalizeFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)},async abrirModal(a=""){let o={},n=[];a?n=this.documentoItens.filter(u=>u.idItem===a):n=this.documentoItens;for(const u of n)o[u.idItem]={item:await $db.hibrido.le({table:"item",id:u.idItem}),quantidade:u.quantidade},o[u.idItem].item.novoValorVenda=u.valorItem;this.$refs.promptItem.itensSelecionados=o,this.$refs.promptItem.termo=a,this.$refs.promptItem.atualizar(),this.itensModal=!0},recalcularTotal(a){a.subTotal=D(a.quantidade*a.valorItem),a.total=D(a.quantidade*a.valorItem),this.somarValorTotal()},async selecionarCliente(){if(this.documento.status==="Digita\xE7\xE3o"){const a=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione"});this.cliente=P(a),this.contatosModal=!1,this.documento.idContato=this.cliente.id,this.documento.descricaoContato=this.cliente.nome}},selecionarItens:async function(a){for(const o in a){const n=a[o].item||{},u=a[o].quantidade||0;this.item[o]=n;let e=this.documentoItens.find(l=>l.idItem===o);e?(e.quantidade=u,e.quantidadeRealizado=u,e.total=D(u*e.valorItem),e.subTotal=D(u*e.valorItem)):this.documentoItens.push({dataHoraEmissao:A(),descricaoItem:n.descricao,id:G(),idDocumento:this.documento.id,idItem:n.id,operacao:this.operacao,quantidade:u,unidade:n.unidade,quantidadeRealizado:u,tipoItem:n.tipo,total:D(u*n.valorVenda),subTotal:D(u*n.valorVenda),valorItem:n.valorVenda,operacaoFator:this.operacaoFator})}this.somarValorTotal()},somarValorTotal(){this.totalItens=this.documentoItens.reduce((a,o)=>a+=o.total,0),this.qtdItens=this.documentoItens.reduce((a,o)=>a+=o.quantidade,0)},excluirItem(a){this.documentoItens=this.documentoItens.filter(o=>o.id!==a),this.somarValorTotal()},async gravar(a=!1){if(!this.cliente.id){this.$q.notifyAlert("Selecione um Cliente");return}if(!this.emitente.id){this.$q.notifyAlert("Selecione um Emitente");return}if(!this.totalItens||!this.qtdItens){this.$q.notifyAlert(`Adicione alguns itens ao ${this.tituloPagina}`);return}try{if(!this.documento.codigoContatoDigitador){const o=await this.obterContatoUsuario();this.documento.idContatoDigitador=o.id,this.documento.codigoContatoDigitador=o.codigoContato}this.documento.totalDocumento=this.totalItens,this.documento.subTotal=this.totalItens,await L.registro.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens}),this.visibilidade.modal=a,this.atualizar(this.documento.id),this.$emit("atualizar")}catch(o){this.$q.notifyError("Erro ao salvar",o)}},async cancelar(){try{$q.loading.show(),this.documento.status="Cancelado",this.documento.dataHoraFinalizado=A(),await this.gravar(!0),this.visibilidade.modal=!1}catch(a){console.error(a)}finally{$q.loading.hide()}},async ativar(){try{$q.loading.show(),this.documento.status="Digita\xE7\xE3o",this.documento.dataHoraFinalizado="",this.documentoItens.forEach(a=>{a.status="Digita\xE7\xE3o",a.dataHoraFinalizado=""}),await this.gravar(!0),$q.notifyPositive(`${this.tituloPagina} Em Digita\xE7\xE3o`)}catch(a){console.error(a)}finally{$q.loading.hide()}},async finalizar(){var a,o,n;try{$q.loading.show();const u=A(),l=(await $db.configuracoes.porNome("vendas.checaestoque",this.emitente.id)).find(I=>parseInt(I.valor)===1)&&this.operacaoFator===-1;this.modalItemSemEstoque={};for(let I of this.documentoItens){if(l){const w=(o=(a=(await $db.estoqueSaldoProdutoEmpresa.leEstoquePorEmpresa(I.idItem,this.emitente.id))[0])==null?void 0:a.estoquePorLote)==null?void 0:o.find(k=>k.tipoEstoque==="Dispon\xEDvel");w&&!(w.saldo>0)&&(this.modalItemSemEstoque.itens||(this.modalItemSemEstoque.itens=[]),this.modalItemSemEstoque.itens.push({descricao:I.descricaoItem,saldo:w.saldo}))}I.status="Finalizado",I.dataHoraFinalizado=u}if((n=this.modalItemSemEstoque.itens)!=null&&n.length){this.modalItemSemEstoque.visivel=!0;return}this.documento.status="Finalizado",this.documento.dataHoraFinalizado=u,await this.gravar(!0),$q.notifyPositive(`${this.tituloPagina} finalizado`),this.visibilidade.modal=!1}catch(u){console.error(u)}finally{$q.loading.hide()}},async obterContatoUsuario(){const a=JSON.parse(localStorage.getItem("usuario"))||{};let o={};return a.codigoUsuario&&(o=(await $db.hibrido.lista({table:"contato",where:{codigoUsuario:a.codigoUsuario}})).find(n=>n.id)||{}),o},calcularQtdItem(){return this.documentoItens.length},calcularQtdItemBol(){let a=!1;return this.documentoItens.length&&(a=!0),a}},mounted(){this.operacao=this.capitalizeFirstLetter(this.$route.params.operacao),this.documento.operacao=this.operacao},computed:{tituloPagina(){return this.capitalizeFirstLetter(this.$route.params.operacao)}},async created(){const a=await $db.configuracoes.le({nome:`registro.${this.$route.params.operacao}.ocultarvalores`});this.ocultarValores=a.some(n=>Number(n.valor)===1),this.empresas=await L.empresa.le();const o=await this.obterContatoUsuario();this.documento.idContatoDigitador=o.id}},gt={key:0},_t={ref:"form"},vt={class:"col-12 col-md"},bt={class:"col-auto"},It={class:"col"},yt={class:"col-12 col-md"},Ct={class:"col-auto"},qt={class:"col"},kt={class:"col-8"},Vt={class:"col-4"},wt=c("div",{class:"col-2 col-md"},"Refer\xEAncia",-1),xt=c("div",{class:"col-10 col-md-4"},"Descri\xE7\xE3o",-1),zt=c("div",{class:"col-6 col-md text-right"},"\xA0",-1),Et=c("div",{class:"col-2 col-md text-right"},"\xA0",-1),Ft={key:0,class:"col-6 col-md text-right"},Dt={key:1,class:"col-6 col-md text-right"},St={key:2,class:"col-6 col-md text-right"},At={key:3,class:"col-6 col-md text-right"},Pt=c("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1),Ut={class:"col-2 col-md"},Lt={key:0},Mt={class:"col-10 col-md-4"},Tt={class:"col-6 col-md text-center row"},Qt={class:"col-2 col-md text-right row"},Ht={key:0,class:"col-6 col-md text-right"},Rt={key:1,class:"col-6 col-md text-right"},Bt={key:2,class:"col-6 col-md text-right"},Nt={key:3,class:"col-6 col-md text-right"},Ot={class:"col-6 col-md-1 text-right"},jt={class:"col-2 col-md"},Jt={key:0},Gt=c("div",{class:"col-10 col-md-4"},"\xA0",-1),Wt={class:"col-6 col-md text-center"},Zt=c("div",{class:"col-2 col-md text-right"},"\xA0",-1),Kt=c("div",{class:"col-6 col-md text-right"},"\xA0",-1),Xt={key:0,class:"col-6 col-md text-right"},Yt={key:1,class:"col-6 col-md text-right"},$t=c("div",{class:"col-6 col-md-1 text-right"},"\xA0",-1),te={class:"u-container relative-position"},ee={class:"layout-padding"},oe={class:"q-pa-md"},ae={class:"q-mt-lg text-right"};function ie(a,o,n,u,e,l){const I=b("badge"),E=b("BadgeCopiarUid"),w=b("avatar"),k=b("campo"),V=b("row"),O=b("PromptItemV2"),j=b("PromptContatoV2");return d(),f(z,null,[t(K,{modelValue:e.visibilidade.modal,"onUpdate:modelValue":o[9]||(o[9]=r=>e.visibilidade.modal=r),maximized:"",onShow:l.mostrar,onHide:l.fechar},{default:i(()=>[t(it,{class:"bg-light",container:""},{default:i(()=>[t(st,{class:"u-container"},{default:i(()=>[t(lt,null,{default:i(()=>[t(M,null,{default:i(()=>[T(t(y,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[Q]]),t(U,null,{default:i(()=>[p(h(l.tituloPagina),1)]),_:1}),e.documento.status==="Digita\xE7\xE3o"?(d(),g(y,{key:0,class:"no-shadow",unelevated:"",color:"white","text-color":"primary",label:"Salvar",onClick:o[0]||(o[0]=r=>l.gravar(!1))})):m("",!0)]),_:1})]),_:1}),t(rt,null,{default:i(()=>[t(M,{class:"q-pa-none q-ma-none q-my-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>{var r,C;return[t(U,{class:"text-black q-px-none text-body2"},{default:i(()=>[p("Emiss\xE3o: "+h(a.$filters.data(e.documento.dataHoraEmissao))+" ",1),e.documento.dataHoraFinalizado?(d(),f("span",gt,h(e.documento.status)+": "+h(a.$filters.data(e.documento.dataHoraFinalizado)),1)):m("",!0)]),_:1}),t(I,{cor:((r=[{status:"Digita\xE7\xE3o",cor:"positive"},{status:"Cancelado",cor:"negative"},{status:"Finalizado",cor:"tertiary"}].find(s=>s.status===e.documento.status))==null?void 0:r.cor)||"tertiary",class:"q-mx-xs",icone:"flag",escuro:""},{default:i(()=>[p(h(e.documento.status),1)]),_:1},8,["cor"]),t(E,{cor:((C=[{status:"Digita\xE7\xE3o",cor:"positive"},{status:"Cancelado",cor:"negative"},{status:"Finalizado",cor:"tertiary"}].find(s=>s.status===e.documento.status))==null?void 0:C.cor)||"tertiary",id:e.documento.id,numero:(e.documento.numero.toString()||e.documento.id).slice(-8)},null,8,["cor","id","numero"])]}),_:1}),t(W,{class:"bg-white q-pa-md q-mt-md no-shadow"},{default:i(()=>[c("form",_t,[t(V,{class:"q-col-gutter-sm"},{default:i(()=>[c("div",vt,[t(V,null,{default:i(()=>{var r;return[c("div",bt,[t(w,{imagem:((r=e.emitente)==null?void 0:r.imagem)||"",rotulo:e.emitente.nome,tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),c("div",It,[t(k,{rotulo:"Emitente",somenteLeitura:"",tipo:"texto",class:"col-10",modelValue:e.emitente.nome,"onUpdate:modelValue":o[1]||(o[1]=C=>e.emitente.nome=C)},null,8,["modelValue"])])]}),_:1})]),c("div",yt,[t(V,null,{default:i(()=>{var r;return[c("div",Ct,[t(w,{imagem:((r=e.cliente)==null?void 0:r.imagem)||"",rotulo:e.cliente.nome||"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),c("div",qt,[t(k,{placeholder:"Cliente",rotulo:"Cliente",tipo:"texto",after:[{icon:"search",handler(){l.selecionarCliente()}}],modelValue:e.cliente.nome,"onUpdate:modelValue":o[2]||(o[2]=C=>e.cliente.nome=C),somenteLeitura:""},null,8,["after","modelValue"])])]}),_:1})])]),_:1}),t(V,null,{default:i(()=>[c("div",kt,[t(k,{modelValue:e.documento.observacao,"onUpdate:modelValue":o[3]||(o[3]=r=>e.documento.observacao=r),rotulo:"Observa\xE7\xE3o",tipo:"texto"},null,8,["modelValue"])]),c("div",Vt,[t(k,{somenteLeitura:e.somenteLeitura||l.calcularQtdItemBol(),placeholder:"Fator Opera\xE7\xE3o",rotulo:"Fator Opera\xE7\xE3o",modelValue:e.operacaoFator,"onUpdate:modelValue":o[4]||(o[4]=r=>e.operacaoFator=r),opcoes:e.opcoesFator,tipo:"seletor"},null,8,["somenteLeitura","modelValue","opcoes"])])]),_:1})],512)]),_:1}),t(W,{class:"bg-white q-pa-md q-mt-md no-shadow"},{default:i(()=>[t(M,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[t(S,{name:"shopping_cart",size:"24px",style:{color:"#737373"}}),t(U,null,{default:i(()=>[p(" Produtos e Servi\xE7os ")]),_:1}),e.documento.status==="Digita\xE7\xE3o"?(d(),g(y,{key:0,color:"positive",flat:"",dense:"",icon:"add",round:"",size:"md",onClick:o[5]||(o[5]=r=>l.abrirModal())},{default:i(()=>[t(R,null,{default:i(()=>[p("Adicionar Item")]),_:1})]),_:1})):m("",!0)]),_:1}),t(B,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[t(x,{class:"q-pa-none"},{default:i(()=>[t(v,null,{default:i(()=>[t(q,null,{default:i(()=>[t(V,{class:"q-col-gutter-md text-weight-bold justify-around"},{default:i(()=>[wt,xt,zt,Et,e.ocultarValores?m("",!0):(d(),f("div",Ft,"Valor")),e.ocultarValores?m("",!0):(d(),f("div",Dt,"Total")),e.ocultarValores?(d(),f("div",St,"\xA0")):m("",!0),e.ocultarValores?(d(),f("div",At,"\xA0")):m("",!0),Pt]),_:1})]),_:1}),t(H,{class:"q-my-xs"}),(d(!0),f(z,null,N(e.documentoItens,(r,C)=>(d(),f(z,{key:C},[t(q,null,{default:i(()=>[t(V,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>{var s,_,J,Z;return[c("div",Ut,[((s=e.item[r.idItem])==null?void 0:s.referencia)||((_=e.item[r.idItem])==null?void 0:_.codigoItem)?(d(),f("span",Lt,h(((J=e.item[r.idItem])==null?void 0:J.referencia)||"#"+((Z=e.item[r.idItem])==null?void 0:Z.codigoItem)||"-"),1)):m("",!0)]),c("div",Mt,h(r.descricaoItem||"-"),1),c("div",Tt,[t(k,{somenteLeitura:e.somenteLeitura,tipo:"quantidade",modelValue:r.quantidade,"onUpdate:modelValue":F=>r.quantidade=F,min:1,rotulo:"Quantidade",dense:"",outlined:"",color:"tertiary",onBlur:F=>l.recalcularTotal(r)},null,8,["somenteLeitura","modelValue","onUpdate:modelValue","onBlur"])]),c("div",Qt,[c("span",null,h(r.unidade||"-"),1)]),e.ocultarValores?m("",!0):(d(),f("div",Ht,[t(k,{somenteLeitura:e.somenteLeitura,class:"col-10",modelValue:r.valorItem,"onUpdate:modelValue":F=>r.valorItem=F,tipo:"decimal",decimals:"4",onBlur:F=>l.recalcularTotal(r)},null,8,["somenteLeitura","modelValue","onUpdate:modelValue","onBlur"])])),e.ocultarValores?(d(),f("div",Rt,"\xA0")):m("",!0),e.ocultarValores?m("",!0):(d(),f("div",Bt,h(a.$filters.numero(r.total,2)),1)),e.ocultarValores?(d(),f("div",Nt,"\xA0")):m("",!0),c("div",Ot,[e.documento.status==="Digita\xE7\xE3o"?(d(),g(y,{key:0,flat:"",dense:"",icon:"delete",round:"",size:"md",onClick:F=>l.excluirItem(r.id)},{default:i(()=>[t(R,null,{default:i(()=>[p("Excluir")]),_:1})]),_:2},1032,["onClick"])):m("",!0)])]}),_:2},1024)]),_:2},1024),t(H,{class:"q-my-xs"})],64))),128))]),_:1})]),_:1}),t(x,{class:"q-px-none"},{default:i(()=>[t(v,null,{default:i(()=>[t(q,null,{default:i(()=>[t(V,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>[c("div",jt,[l.calcularQtdItem()?(d(),f("span",Jt,h(l.calcularQtdItem()),1)):m("",!0)]),Gt,c("div",Wt,h(a.$filters.numero(e.qtdItens,0)),1),Zt,Kt,e.ocultarValores?m("",!0):(d(),f("div",Xt,h(a.$filters.numero(e.totalItens,2)),1)),e.ocultarValores?(d(),f("div",Yt,"\xA0")):m("",!0),$t]),_:1})]),_:1})]),_:1})]),_:1}),t(x,{class:"q-px-none"},{default:i(()=>[t(v,null,{default:i(()=>[t(q,{class:"text-center"},{default:i(()=>[e.documento.status==="Digita\xE7\xE3o"?(d(),g(y,{key:0,color:"positive",icon:"add",class:"q-mx-auto",label:"Adicionar item",outline:"",size:"xs",onClick:o[6]||(o[6]=r=>l.abrirModal())})):m("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(O,{modelValue:e.itensModal,"onUpdate:modelValue":o[7]||(o[7]=r=>e.itensModal=r),filtro:{ativo:!0,idEmpresa:e.documento.idEmpresa},onSelecionarItens:l.selecionarItens,habilitarQuantidade:!0,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"]),t(j,{modelValue:e.contatosModal,"onUpdate:modelValue":o[8]||(o[8]=r=>e.contatosModal=r),filtro:{ativo:!0},placeholder:"Seleciona o Cliente"},null,8,["modelValue"])]),_:1}),t(nt,{class:"bg-light no-shadow q-pa-sm text-right",bordered:""},{default:i(()=>[c("div",te,[t(U,{class:"text-right"},{default:i(()=>[e.documento.status==="Digita\xE7\xE3o"?(d(),g(y,{key:0,class:"q-mx-md",color:"negative",flat:"",label:"Cancelar",onClick:l.cancelar},null,8,["onClick"])):m("",!0),e.documento.status!=="Digita\xE7\xE3o"?(d(),g(y,{key:1,color:"primary",label:"Reabrir",onClick:l.ativar},null,8,["onClick"])):m("",!0),e.documento.status==="Digita\xE7\xE3o"?(d(),g(y,{key:2,color:"primary",label:"Finalizar",onClick:l.finalizar},null,8,["onClick"])):m("",!0)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onShow","onHide"]),t(K,{modelValue:e.modalItemSemEstoque.visivel,"onUpdate:modelValue":o[10]||(o[10]=r=>e.modalItemSemEstoque.visivel=r),minimized:""},{default:i(()=>[t(W,{class:"q-dialog-plugin"},{default:i(()=>[t(M,{class:"bg-primary text-white"},{default:i(()=>[t(U,null,{default:i(()=>[p(h((e.modalItemSemEstoque.itens||[]).length>1?"Itens":"Item")+" sem estoque ",1)]),_:1}),T(t(y,{dense:"",flat:"",icon:"close",round:""},null,512),[[Q]])]),_:1}),c("div",ee,[c("form",oe,[t(B,{"no-border":"",dense:""},{default:i(()=>[(d(!0),f(z,null,N(e.modalItemSemEstoque.itens,(r,C)=>(d(),f(z,{key:C+r.descricao},[C?(d(),g(H,{key:0})):m("",!0),t(x,null,{default:i(()=>[t(v,{class:"q-py-sm"},{default:i(()=>[t(q,null,{default:i(()=>[p(h(r.descricao),1)]),_:2},1024),t(q,{caption:""},{default:i(()=>[p("Estoque: "+h(r.saldo),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)],64))),128))]),_:1}),c("div",ae,[T(t(y,{color:"tertiary",flat:"",label:"Ok"},null,512),[[Q]])])])])]),_:1})]),_:1},8,["modelValue"])],64)}var se=Y(pt,[["render",ie]]);const le={components:{Avatar:et,lista:ct,Badge:tt,RegistroModal:se,BadgeCopiarUid:$,NfePrincipal:ft},mixins:[ht],data(){return{paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25},contatosModal:!1,digitadorModal:!1,filtros:{tab:"Em Digita\xE7\xE3o",tipo:"Registro",operacao:this.capitalizeFirstLetter(this.$route.params.operacao),empresa:{selecionada:"",opcoes:[]},cliente:{id:"",nome:""},digitador:{id:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},digitadorSelecionado:null,digitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1,entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),documentos:[],tabs:[{rotulo:"Em Digita\xE7\xE3o",value:"Em Digita\xE7\xE3o"},{rotulo:"Finalizado",value:"Finalizado"},{rotulo:"Cancelado",value:"Cancelado"},{rotulo:"Todos",value:"Todos"}],tabSelecionada:{valor:"Em Digita\xE7\xE3o"},tabAtiva:"Em Digita\xE7\xE3o",checkboxModel:!1,listaItensLayout:{},configImpressaoRegistro:[],showFilters:!1,filtrosDrawer:{ativo:null,cliente:null,dataInicio:null,dataFim:null},buscaCampo:"",ocultarValores:!0}},computed:{tituloPagina(){return this.capitalizeFirstLetter(this.$route.params.operacao)}},methods:{async filtroCliente_click(){const a=await $g.promptContato.show({filtro:{ativo:!0}});a.nome&&(this.filtros.cliente.nome=a.nome,this.filtros.cliente.id=a.codigoContato)},limparFiltros_click(){this.filtros={tab:"Em Digita\xE7\xE3o",tipo:"Registro",operacao:this.capitalizeFirstLetter(this.$route.params.operacao),empresa:{selecionada:"",opcoes:[]},cliente:{id:""},digitador:{codigo:""},periodo:{emissao:{ini:"",fim:""},finalizado:{ini:"",fim:""}}},this.atualizar()},async atualizar(){this.filtros.tab=this.tabSelecionada.valor;try{this.$q.loading.show();const a=this.paginacao.limite,o=this.paginacao.atual;let n="";this.filtros.tab==="Em Digita\xE7\xE3o"?n="Digita\xE7\xE3o":this.filtros.tab!=="Todos"&&(n=this.filtros.tab);let u=this.filtros.empresa.selecionada.value||"";this.filtros.idEmpresa=u,this.digitadorSelecionado!==null&&(this.filtros.digitador.codigo=this.digitadorSelecionado.value);let e=this.$utils.eliminarVazios(this.filtros);this.buscaCampo&&(e.termoBusca=this.buscaCampo),e.status=n,e.operacao=this.capitalizeFirstLetter(this.$route.params.operacao);const l=await $db.registro.leListaCompleta({filtros:e,limit:a,page:o,sort:["dataHoraFinalizado","dataHoraEmissao"],dir:["desc","desc"]});this.documentos=l.data,this.paginacao.total=l.total,this.paginacao.maximo=l.totalPages,this.configuraImpressaoRegistro(l.idEmpresa)}catch(a){this.$q.notifyError("Erro iniciar",a)}finally{this.$q.loading.hide()}},criarItem(){this.$refs.registroModal.visibilidade.modal=!0,this.$refs.registroModal.atualizar()},capitalizeFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)},abrirItem(a,o=!1){this.$router.replace({params:{id:a}}).finally(()=>{this.$refs.registroModal.atualizar(a),this.$refs.registroModal.somenteLeitura=o,this.$refs.registroModal.visibilidade.modal=!0})},async removerItem(a){$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show(),await $db.registro.remove(a.id),this.atualizar(),$q.notifyPositive("O registro foi exclu\xEDdo com sucesso.")}catch(o){console.error(o),$q.notifyError("Ocorreu um erro ao remover o registro",o)}finally{$q.loading.hide()}}),this.atualizar()},async configuraImpressaoRegistro(a){const o=await $db.configuracoes.porNome("impressao.registro",a);this.configImpressaoRegistro=[...o.length?o.map(n=>({texto:`Imprimir ${this.tituloPagina}`,...n})):[{valor:"invoice",texto:`${this.tituloPagina}`},this.sistemaPai==="optisoul"?{valor:"registro",texto:"Registro"}:{}]]},async emitirNFeClick(a,o=1,n="Remessa"){await this.emitirNFeV2({idVenda:a},o,n)}},async created(){const a=await $db.configuracoes.le({nome:`registro.${this.$route.params.operacao}.ocultarValores`});this.ocultarValores=a.some(o=>Number(o.valor)===1),$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then(o=>{this.diretivaContatosAcessaTodosContatos=o,this.diretivaContatosAcessaTodosContatos&&(this.digitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then(n=>{n.forEach(u=>{u.codigo&&this.digitadoresOpcoes.push({label:u.nome,value:u.codigo})})}))}),this.atualizar()},mounted(){this.$route.params.id&&this.$route.params.id.length&&(this.$refs.registroModal.atualizar(this.$route.params.id),this.$refs.registroModal.visibilidade.modal=!0)}},re=c("span",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Emiss\xE3o",-1),ne=c("span",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Finaliza\xE7\xE3o",-1),de=["onClick"],ce=["onClick"],ue={class:"q-col-gutter-xs"};function me(a,o,n,u,e,l){const I=b("campo"),E=b("row"),w=b("Badge"),k=b("BadgeCopiarUid"),V=b("avatar"),O=b("badge"),j=b("lista"),r=b("RegistroModal"),C=b("NfePrincipal");return d(),f("div",null,[t(j,{titulo:l.tituloPagina,onCriar_click:l.criarItem,showAdd:!1,onFiltro_change:l.atualizar,onLimparFiltros_click:l.limparFiltros_click,icone:"description",tabSelecionada:e.tabSelecionada,tabs:e.tabs,showToolbar:!1,paginacao:e.paginacao,filtros:e.filtros,buscaCampo:e.buscaCampo,"onUpdate:buscaCampo":o[6]||(o[6]=s=>e.buscaCampo=s),checkboxModel:e.checkboxModel,"onUpdate:checkboxModel":o[7]||(o[7]=s=>e.checkboxModel=s)},{filtroCampos:i(()=>[t(I,{modelValue:e.filtros.cliente.nome,"onUpdate:modelValue":o[0]||(o[0]=s=>e.filtros.cliente.nome=s),before:[{icon:"search",handler:l.filtroCliente_click}],dense:"",rotulo:"Cliente"},null,8,["modelValue","before"]),e.diretivaContatosAcessaTodosContatos?(d(),g(dt,{key:0,modelValue:e.digitadorSelecionado,"onUpdate:modelValue":[o[1]||(o[1]=s=>e.digitadorSelecionado=s),l.atualizar],options:e.digitadoresOpcoes,clearable:"",label:"Digitador"},null,8,["modelValue","options","onUpdate:modelValue"])):m("",!0),t(E,{class:"q-col-gutter-md q-mt-md"},{default:i(()=>[re,t(I,{modelValue:e.filtros.periodo.emissao.ini,"onUpdate:modelValue":o[2]||(o[2]=s=>e.filtros.periodo.emissao.ini=s),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){e.filtros.periodo.emissao.ini=""}}],dense:""},null,8,["modelValue","after"]),t(I,{modelValue:e.filtros.periodo.emissao.fim,"onUpdate:modelValue":o[3]||(o[3]=s=>e.filtros.periodo.emissao.fim=s),tipo:"data",class:"no-shadow full-width",rotulo:"at\xE9",col:"12",after:[{icon:"mdi-close-circle",handler(){e.filtros.periodo.emissao.fim=""}}],dense:""},null,8,["modelValue","after"])]),_:1}),t(E,{class:"q-col-gutter-md q-mt-md"},{default:i(()=>[ne,t(I,{modelValue:e.filtros.periodo.finalizado.ini,"onUpdate:modelValue":o[4]||(o[4]=s=>e.filtros.periodo.finalizado.ini=s),tipo:"data",class:"no-shadow full-width",rotulo:"De",col:"12",after:[{icon:"mdi-close-circle",handler(){e.filtros.periodo.finalizado.ini=""}}],dense:""},null,8,["modelValue","after"]),t(I,{modelValue:e.filtros.periodo.finalizado.fim,"onUpdate:modelValue":o[5]||(o[5]=s=>e.filtros.periodo.finalizado.fim=s),tipo:"data",class:"no-shadow full-width",rotulo:"at\xE9",col:"12",after:[{icon:"mdi-close-circle",handler(){e.filtros.periodo.finalizado.fim=""}}],dense:""},null,8,["modelValue","after"])]),_:1})]),itemLista:i(()=>[t(B,{class:"bg-white"},{default:i(()=>[(d(!0),f(z,null,N(e.documentos,s=>(d(),f("div",{key:s,class:"itemHover fullWidth"},[t(x,{"manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:i(()=>[t(v,{avatar:"",center:"",class:"mw80 hideonmobile"},{default:i(()=>[Number(s.numero)?(d(),g(w,{key:0,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:i(()=>[p(" #"+h(String(s.numero).padStart(6,"0")),1)]),_:2},1024)):(d(),g(k,{key:1,id:s.id,numero:s.id.slice(-6),cor:"tertiary"},null,8,["id","numero"]))]),_:2},1024),t(v,{clickable:""},{default:i(()=>[t(E,{class:"items-center q-col-gutter-x-sm"},{default:i(()=>[c("div",{class:"col-auto items-center",onClick:_=>l.abrirItem(s.id)},[t(V,{imagem:s.imagem,tamanho:"40",rotulo:s.descricaoContato,style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])],8,de),c("div",{class:"col",onClick:_=>l.abrirItem(s.id)},[t(q,{class:"text-tertiary text-weight-bold"},{default:i(()=>[p(h(s.descricaoContato),1)]),_:2},1024)],8,ce)]),_:2},1024)]),_:2},1024),t(v,{onClick:_=>l.abrirItem(s.id),avatar:"",class:"mw100 hideonmobile"},{default:i(()=>[t(q,{class:"full-width"},{default:i(()=>[t(S,{name:"mdi-calendar-today"}),p(" "+h(a.$filters.data(s.dataHoraEmissao))+" ",1),t(R,null,{default:i(()=>[p(" Data Emiss\xE3o "+h(a.$filters.dataHora(s.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]),s.dataHoraFinalizado?(d(),g(v,{key:0,onClick:_=>l.abrirItem(s.id),avatar:"",class:"mw100 hideonmobile"},{default:i(()=>[t(q,{class:"full-width"},{default:i(()=>[t(S,{name:"mdi-calendar-check"}),p(h(a.$filters.data(s.dataHoraFinalizado))+" ",1),t(R,null,{default:i(()=>[p(" Data Finalizado "+h(a.$filters.dataHora(s.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])):m("",!0),t(v,{onClick:_=>l.abrirItem(s.id),avatar:"",class:"mw100 hideonmobile"},{default:i(()=>[t(O,{class:"q-mr-sm",cor:"primary",escuro:""},{default:i(()=>[p(h(s.status),1)]),_:2},1024)]),_:2},1032,["onClick"]),e.ocultarValores?m("",!0):(d(),g(v,{key:1,onClick:_=>l.abrirItem(s.id),avatar:"",class:"mw120 hideonmobile"},{default:i(()=>[t(q,{class:"text-right text-tertiary text-weight-bold"},{default:i(()=>[p(h(a.$filters.numero(s.totalDocumento,2)),1)]),_:2},1024),t(q,{caption:"",class:"text-right text-tertiary"},{default:i(()=>[p(h(s.documentoItens.length)+" Itens ",1)]),_:2},1024)]),_:2},1032,["onClick"])),t(v,{side:"",top:""},{default:i(()=>[c("div",ue,[s.status==="Digita\xE7\xE3o"?(d(),g(y,{key:0,class:"buttons",color:"primary",dense:"",flat:"",icon:"edit",round:"",size:"md",onClick:_=>l.abrirItem(s.id)},null,8,["onClick"])):(d(),g(y,{key:1,class:"buttons",color:"primary",dense:"",flat:"",icon:"visibility",round:"",size:"md",onClick:_=>l.abrirItem(s.id,!0)},null,8,["onClick"])),t(y,{rounded:"",dense:"",flat:"",icon:"print",color:"tertiary",unelevated:"",class:"hideonmobile q-mx-xs",size:"md"},{default:i(()=>[t(X,null,{default:i(()=>[(d(!0),f(z,null,N(e.configImpressaoRegistro.filter(_=>_.valor),_=>(d(),g(x,{clickable:"",key:_.valor,onClick:J=>a.$imprimir(_.valor,{id:(s||{}).id||"0",Oculto:"0"})},{default:i(()=>[t(v,{avatar:""},{default:i(()=>[t(S,{name:"print"})]),_:1}),t(v,null,{default:i(()=>[t(q,null,{default:i(()=>[p(h(_.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024),t(y,{dense:"",flat:"",icon:"more_vert",round:"",size:"md"},{default:i(()=>[t(X,null,{default:i(()=>[T((d(),g(B,{class:"q-py-none",link:"","no-border":"",separator:""},{default:i(()=>[s.status==="Digita\xE7\xE3o"?(d(),g(x,{key:0,clickable:"",onClick:_=>l.removerItem(s)},{default:i(()=>[t(v,{avatar:""},{default:i(()=>[t(S,{name:"delete"})]),_:1}),t(v,null,{default:i(()=>[p(" Remover")]),_:1})]),_:2},1032,["onClick"])):m("",!0),s.status==="Finalizado"?(d(),g(x,{key:1,clickable:"",onClick:_=>l.emitirNFeClick(s.id)},{default:i(()=>[t(v,{avatar:""},{default:i(()=>[t(S,{name:"upload"})]),_:1}),t(v,null,{default:i(()=>[p("Emitir Nota")]),_:1})]),_:2},1032,["onClick"])):m("",!0)]),_:2},1024)),[[Q]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1024),t(H)]))),128))]),_:1})]),_:1},8,["titulo","onCriar_click","onFiltro_change","onLimparFiltros_click","tabSelecionada","tabs","paginacao","filtros","buscaCampo","checkboxModel"]),t(r,{ref:"registroModal",onAtualizar:l.atualizar},null,8,["onAtualizar"]),t(C)])}var ke=Y(le,[["render",me]]);export{ke as default};
