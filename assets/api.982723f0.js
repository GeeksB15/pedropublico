import{a as $,an as N,aQ as x,b as E}from"./index.e0611938.js";const c="https://api.plugnotas.com.br",l=function(){const e=new Headers;return e.append("Content-Type","application/json; charset=utf-8"),e.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6"),e},P={async cadastrar(e,o){const a=new Headers;a.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");let t={};const r=new FormData;r.append("arquivo",e),r.append("senha",o);try{t=await fetch("https://api.plugnotas.com.br/certificado",{method:"POST",headers:a,body:r})}catch(d){console.log(d.message)}const{message:s,data:n,error:i}=await t.json();return{message:s,data:n,error:i}},async consultar(e=""){let o={},a=e?`certificado/${e}`:"certificado",t={};try{o=await fetch(`${c}/${a}`,{method:"GET",headers:l()}),t=await o.json()}catch(r){console.log(r.message)}return t}},O={async consultar(e){let o;try{o=await fetch(`${c}/empresa/${e}`,{method:"GET",headers:l()}),o=await o.json()}catch(a){console.error(a.message),o={error:{}},o.error.message="N\xE3o foi poss\xEDvel estabelecer conex\xE3o com o servidor"}return o},async cadastrar(e){let o;try{o=await fetch(`${c}/empresa`,{method:"POST",headers:l(),body:JSON.stringify(e)}),o=await o.json()}catch(a){console.error(a.message),o={error:{}},o.error.message="N\xE3o foi poss\xEDvel estabelecer conex\xE3o com o servidor"}return o},async alterar(e,o){let a;try{a=await fetch(`${c}/empresa/${e}`,{method:"PATCH",headers:l(),body:JSON.stringify(o)}),a=await a.json()}catch(t){console.error(t.message),a={error:{}},a.error.message="N\xE3o foi poss\xEDvel estabelecer conex\xE3o com o servidor"}return a}},k={async transmitir(e){try{const o=await fetch(`${c}/nfse`,{method:"POST",headers:l(),body:JSON.stringify([e])}),{documents:a,message:t,protocol:r}=await o.json();return{nfse:a,protocolo:r,mensagem:t}}catch(o){return console.log(o.message),{}}},async consultar(e){let o="",a=0,t={};for(;o!=="CONCLUIDO"&&a<12;){await $utils.dormir(5e3),console.log(`tentativa ${a}`);let r={};try{r=await fetch(`${c}/nfse/consultar/${e}`,{method:"GET",headers:l()}),t=await r.json(),t=t[0],o=t.situacao}catch(s){console.log(s.message)}a++}return t},async montarJsonParaPlugNotas(e){var a;let o={idIntegracao:e.id,prestador:{cpfCnpj:e.prestador.documento},servico:[{codigo:e.servico.itemListaServico,codigoTributacao:e.servico.codigoTributacaoMunicipio,discriminacao:e.servico.discriminacao,cnae:e.servico.codigoCnae,codigoCidadeIncidencia:`${e.servico.municipioPrestacaoServico}`,iss:{tipoTributacao:6,exigibilidade:1,retido:!1,aliquota:e.servico.valores.aliquota,valor:e.servico.valores.valorIss},valor:{servico:e.servico.valores.valorServicos,baseCalculo:e.servico.valores.baseCalculo,deducoes:"",descontoCondicionado:e.servico.valores.descontoCondicionado,descontoIncondicionado:e.servico.valores.descontoIncondicionado,liquido:e.servico.valores.valorLiquidoNfse},retencao:{pis:{valor:e.servico.valores.valorPis},cofins:{valor:e.servico.valores.valorCofins},csll:{valor:e.servico.valores.valorCsll},inss:{valor:e.servico.valores.valorInss},irrf:{valor:e.servico.valores.valorIr}},tributavel:!1}],naturezaTributacao:1,rps:{competencia:"",dataEmissao:e.dataEmissao,dataVencimento:"",serie:e.identificacaoRps.serie}};return(a=e.tomador)!=null&&a.documento?(o.tomador={},o.tomador={cpfCnpj:e.tomador.documento,razaoSocial:e.tomador.razaoSocial,endereco:{cep:e.tomador.endereco.cep,logradouro:e.tomador.endereco.rua,codigoCidade:`${e.tomador.endereco.cidade}`,estado:e.tomador.endereco.estado,numero:e.tomador.endereco.numero,bairro:e.tomador.endereco.bairro}}):console.log("NFSe sem tomador!"),o},async imprimirNFSe(e){const o=new Headers;o.append("Content-Type","application/pdf; charset=utf-8"),o.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");let a="";try{a=await fetch(`${c}/nfse/pdf/${e}`,{method:"GET",headers:o});const t=await a.blob();return await $utils.blobToBase64(t)}catch(t){console.error("Failed retrieving information",t.message)}return a},async baixarXmlNFSe(e,o){var n,i;let a,t,r;const s=new Headers;if(o!=null&&o.id&&(a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:o.id}),t=$utils.clonarV2(a)),!a.id)throw new Error("api.PlugNotas.baixarXMLNFSe: N\xE3o foi poss\xEDvel obter o documento fiscal");if(r=(i=JSON.parse((n=a.json)!=null?n:null))==null?void 0:i.rps,!r)throw new Error("api.PlugNotas.baixarXMLNFSe: Dados de RPS n\xE3o informados");s.append("Content-Type","application/xml; charset=utf-8"),s.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");try{const d=await fetch(e,{method:"GET",headers:s});r.xml=await(d==null?void 0:d.text()),t.json=JSON.stringify({rps:r}),await $db.documentoFiscalEletronico.grava({atual:t,original:a})}catch(d){console.log(d.message)}return r.xml},async solicitarCancelamentoNFSe(e,o){let a={};try{a=await fetch(`${c}/nfse/cancelar/${e}`,{method:"POST",headers:l(),body:JSON.stringify(o)});const{message:t,data:r}=await a.json();a={message:t,data:r}}catch(t){console.log(t.message)}return a},async consultarCancelamentoNFSe(e){let o="",a=0,t={},r={};for(;o!=="CONCLUIDO"&&a<12;){await $utils.dormir(1e4),console.log(`tentativa ${a}`);let s={};try{s=await fetch(`${c}/nfse/cancelar/status/${e}`,{method:"GET",headers:l()});const{message:n,data:i}=await s.json();o=(i==null?void 0:i.status)||"",t=n,r=i}catch(n){console.log(n.message)}a++}return{message:t,data:r}}},F={async solicitarCancelamentoNFSe(e="627571d0a5906b4da2b740de"){const o=new Headers;o.append("Content-Type","application/json; charset=utf-8"),o.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");let a={};try{a=await fetch(`${c}/nfse/cancelar/${e}`,{method:"POST",headers:o,body:JSON.stringify('{"motivo": "Teste de cancelamento via plugNotas"}')})}catch(t){console.log(t.message)}await a},async consultarCancelamentoNFSe(e="fdc6de1a-8c73-44b9-8bc6-0e9fdc9b27da"){const o=new Headers;o.append("Content-Type","application/json; charset=utf-8"),o.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");let a={};try{a=await fetch(`${c}/nfse/cancelar/status/${e}`,{method:"GET",headers:o})}catch(t){console.log(t.message)}await a.json()},async alterarEmpresa(){let e;const o=new Headers;o.append("Content-Type","application/json; charset=utf-8"),o.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");const a={nfse:{config:{producao:!0}}};try{e=await fetch(`${c}/empresa/07660198000189`,{method:"PATCH",headers:o,body:JSON.stringify(a)})}catch(t){console.log(t.message)}console.log(await e.json())},async transmitir(){const e=new Headers;e.append("Content-Type","application/json; charset=utf-8"),e.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");const o=[{idIntegracao:"GEEKS0000007",prestador:{cpfCnpj:"08187168000160"},tomador:{cpfCnpj:"99999999999999",razaoSocial:"Empresa de Teste LTDA",inscricaoMunicipal:"8214100099",email:"teste@plugnotas.com.br",endereco:{descricaoCidade:"Maringa",cep:"87020100",tipoLogradouro:"Rua",logradouro:"Barao do rio branco",tipoBairro:"Centro",codigoCidade:"4115200",complemento:"sala 01",estado:"PR",numero:"1001",bairro:"Centro"}},servico:[{codigo:"14.10",codigoTributacao:"14.10",discriminacao:"Descri\xE7\xE3o dos servi\xE7os prestados, utilize | para quebra de linha na impress\xE3o.",cnae:"7490104",iss:{tipoTributacao:7,exigibilidade:1,aliquota:3},valor:{servico:1,descontoCondicionado:0,descontoIncondicionado:0}}]}];let a={};try{a=await fetch(`${c}/nfse`,{method:"POST",headers:e,body:JSON.stringify(o)})}catch(t){console.log(t.message)}await a.json(),await a.json()},async consultar(e="d449ce0c-edee-4e1b-a2c7-0566ccb185ff"){const o=new Headers;o.append("Content-Type","application/json; charset=utf-8"),o.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");let a={};try{a=await fetch(`${c}/nfse/consultar/${e}`,{method:"GET",headers:o})}catch(r){console.log(r.message)}return(await a.json())[0]}};var G={nfse:k,nfseMocado:F,certificado:P,empresa:O};const p=function(e){const{name:o,message:a}=e!=null?e:{};this.name=o,this.message=a,this.stack=new Error().stack};p.prototype=Object.create(p.prototype);p.prototype.constructor=p;var H={send:async function(e,o){var d,g,f,b,y;let a,t,r,s=[],n,i;if(a=await $db.configuracoes.porNome("integracao.bten.business"),t=(g=(d=a[0])==null?void 0:d.valor)!=null?g:!1,a=await $db.configuracoes.porNome("integracao.bten.authorization"),r=(b=(f=a[0])==null?void 0:f.valor)!=null?b:!1,n=await $db.contatoTelefone.le({idContato:e.id,tipoTelefone:"Celular | WhatsApp | Principal"}),i={business:t,authorization:r},!t)throw new p({name:"GeeksException",message:"Token business n\xE3o configurado"});if(!r)throw new p({name:"GeeksException",message:"Token authorization n\xE3o configurado"});if(!(n.length>0))throw new p({name:"GeeksException",message:"Nenhum telefone encontrado"});for(const S of n){const h=(y=S.telefone)==null?void 0:y.replace(/\D/g,""),j={name:e.nome,contact:`55${h}`,description:o.id,channel:"WHATSAPP_MESSAGE"};(await $({method:"post",url:"https://api-gateway-eaglecatch.herokuapp.com/v1/transaction",validateStatus:v=>v>=200&&v<=500,timeout:3e4,headers:i,data:j})).status!==200?s.push({status:!1,telefone:h}):s.push({status:!0,telefone:h})}return s}};const m="https://aupk1256rl.execute-api.us-east-2.amazonaws.com/dev",u=function(){const e=new Headers;return e.append("Content-Type","application/json; charset=utf-8"),e.append("x-api-key","cxiFyUfcWB6qvY7Uoo9tu6MRJnm68o3o0FMwKRm9"),e.append("data-raw",""),e},z={async criar(e,o){let a={},t="pedidos/criar";try{a=await fetch(`${m}/${t}`,{mode:"no-cors",method:"POST",headers:u(),body:o})}catch(r){console.log(r.message)}},async consultar(e){let o={},a=`pedidos/cnpj/${e}/1`,t={};try{o=await fetch(`${m}/${a}`,{mode:"no-cors",method:"GET",headers:u()}),t=o}catch(r){console.log(r.message)}return t}},B={async consultar(e){let o={},a={};try{o=await fetch("https://aupk1256rl.execute-api.us-east-2.amazonaws.com/dev/produtos/lista/1/32648411000184",{mode:"no-cors",method:"GET",headers:u()}),a=await o}catch(t){console.log(t.message)}return a}},I={async consultar(e){let o={},a=`servicos/cnpj/${e}`,t={};try{o=await fetch(`${m}/${a}`,{method:"GET",headers:u()}),t=await o}catch(r){console.log(r.message)}return t},async consultarServicoFamilia(e){let o={},a=`servicos/1/686/${e}`,t={};try{o=await fetch(`${m}/${a}`,{method:"GET",headers:u()}),t=await o}catch(r){console.log(r.message)}return t}};var J={pedidos:z,lentes:B,servicos:I};const T=N([]);function A(e){return e.funcao="enviar mensagem",fetch("https://whats.b15.com.br/",{method:"POST",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8"}}).then(o=>o.json())}async function C(){try{const e=(await $.get("https://whats.b15.com.br/conectados")).data,a=(await x({listaPendentesWhatsapp:{funcao:"E475EA1C-80FB-43B2-B581-B75829FB36C3"}})).data.listaPendentesWhatsapp.filter(t=>{const r=e[t.conexao]||"Desconectado";return r==="Conectando"||r==="Desconectado"});T.value=a||[]}catch(e){console.error("Ocorreu um erro [API]: ",e)}}C();var D={envia:A,pendentes:T,listaPendentes:C};const w={plugnotas:G,bten:H,zeiss:J,whatsapp:D};var L=E(async({app:e})=>{e.config.globalProperties.$api=w,globalThis.$api=w});export{L as default};
