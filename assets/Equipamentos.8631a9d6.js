import{_ as z,$ as B,p as u,o as s,d as c,f as e,w as a,x as i,B as Q,E as O,e as m,bw as T,t as r,i as _,j as b,l as k,k as j,N as M,F as y,r as $,P as E,R as h,S as D,s as S,dg as L,dh as P,D as C,az as U,C as w,L as x}from"./index.094a6fb0.js";const A={components:{BadgeCopiarUid:B},data(){return{}},methods:{async atualizar(){this.os.id&&(this.os.itens=await $db.hibrido.lista({table:"documentoItem",where:{idDocumentoAdicional:this.os.id}}))}},props:{os:{type:Object,required:!0}},mounted(){this.atualizar()}},F={id:"OSCard"},H={class:"col-12 col-md-6"},R={class:"col-8 col-md"},G={class:"text-left q-my-none"},J={class:"col-auto text-right items-end justify-end"},K={class:"col-12"};function W(t,o,n,N,q,p){const g=u("BadgeCopiarUid"),v=u("row");return s(),c("div",F,[e(S,{class:"card-os q-pa-sm"},{default:a(()=>[e(v,{class:"items-center justify-between q-col-gutter-sm"},{default:a(()=>[i("div",H,[e(Q,{class:"q-pa-none"},{default:a(()=>[e(O,null,{default:a(()=>[m(" Ordem de servi\xE7o ")]),_:1}),e(T,{rounded:"",color:"tertiary",small:""},{default:a(()=>[m(r(n.os.status),1)]),_:1})]),_:1})]),i("div",R,[i("p",G,[n.os.dataHoraEmissao?(s(),_(b,{key:0,name:"mdi-calendar-today "})):k("",!0),m(" "+r(t.$filters.data(n.os.dataHoraEmissao))+" ",1),e(j,null,{default:a(()=>[m(" Emiss\xE3o ")]),_:1})])]),i("div",J,[e(g,{id:n.os.id,numero:n.os.numero,cor:"positive"},null,8,["id","numero"])])]),_:1}),e(v,{class:"items-center"},{default:a(()=>[i("div",K,[i("div",null,r(n.os.descricao),1),t.$lodash.get(n.os,"itens.length")?(s(),_(M,{key:0,class:"no-border"},{default:a(()=>[(s(!0),c(y,null,$(n.os.itens,d=>(s(),_(E,{key:d.id,class:"q-pa-none",style:{"min-height":"auto"}},{default:a(()=>[e(h,null,{default:a(()=>[i("small",null,r(d.quantidade)+"x",1)]),_:2},1024),e(D,null,{default:a(()=>[i("small",null,r(d.descricaoItem),1)]),_:2},1024),e(h,{right:""},{default:a(()=>[i("small",null,r(t.$filters.numero(d.total,2)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):k("",!0)])]),_:1})]),_:1})])}var X=z(A,[["render",W]]);const Y={components:{BadgeCopiarUid:B,EquipamentoCard:L,EquipamentoModal:P,OSCard:X},data(){return{contato:{},equipamentos:[]}},methods:{async atualizar(){try{this.idContato=this.contato.id,this.equipamentos=(await $db.equipamento.le({idContato:this.idContato})).sort((t,o)=>(t.dataCadastro||"z").localeCompare(o.dataCadastro||"z")),$utils.gconsole.log("Equipamentos","atualizar",this.equipamentos.length,"linhas");for(const t of this.equipamentos)t.oss=await $db.hibrido.lista({table:"documento",where:{idEquipamento:t.id}});console.log("this.equipamentos",this.equipamentos)}catch(t){this.$q.notifyError("Ocorreu erro ao consultar equipamentos",t)}},async abrirModalEquipamento(t){$utils.gconsole.log("Equipamentos","abrirModalEquipamento",{...t}),this.$refs.equipamento.campos=$utils.clonarV2(t),this.$refs.equipamento.original=$utils.clonarV2(t),this.$refs.equipamento.visivel=!0},async duplicarEquipamento(t){t||(t=this.$refs.equipamento.campos);const o=this.$utils.clonarV2(t);o.id=this.$utils.uuid(),delete o.dataCadastro,this.$refs.equipamento.original={},this.$refs.equipamento.campos=o,this.$refs.equipamento.visivel=!0,this.$q.notifyPositive("Equipamento duplicado com sucesso")},async removerEquipamento(t){$utils.gconsole.log("Equipamentos","removerEquipamento",{...t}),$q.dialog({title:"Tem certeza que deseja remover?",message:"Ao continuar voc\xEA ir\xE1 remover o equipamento",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{this.tryLoading(async()=>{await $db.equipamento.remove(t.id),await this.atualizar(),this.$q.notifyPositive("O equipamento foi removido com sucesso")},{erro:"Erro ao remover equipamento"})}).onCancel(()=>{console.log("Cancel")})}},watch:{"$route.params.id"(){const t=this.$route.params.id;!t||$db.contato.le({id:t}).then(o=>{this.contato=o,this.atualizar()}).catch(o=>{$q.notifyError("Ops! Ocorreu um erro",o)})}},mounted(){const t=this.$route.params.id;!t||$db.contato.le({id:t}).then(o=>{this.contato=o,this.atualizar()})}},Z={key:0,class:"bg-white q-pa-xl text-center"},ee=i("p",{class:"text-caption"},"Para incluir, utilize o bot\xE3o de adi\xE7\xE3o.",-1),te=i("div",{class:"q-ma-xl"},null,-1);function ae(t,o,n,N,q,p){const g=u("BadgeCopiarUid"),v=u("EquipamentoCard"),d=u("row"),V=u("OSCard"),I=u("EquipamentoModal");return s(),c("div",null,[q.equipamentos.length?(s(!0),c(y,{key:1},$(q.equipamentos,l=>(s(),_(S,{class:"q-px-md q-pb-md q-mb-md bg-white no-shadow rounded-borders",key:l.id},{default:a(()=>[e(Q,{class:"q-px-none items-center"},{default:a(()=>[e(O,{class:"q-px-none"},{default:a(()=>[m(r(l.tipo||"Equipamento"),1)]),_:2},1024),e(g,{id:l.id,numero:"",class:"q-my-none q-mr-sm",cor:"positive"},null,8,["id"]),e(C,{color:"primary",flat:"",icon:"edit",onClick:f=>p.abrirModalEquipamento(l),round:""},null,8,["onClick"]),e(C,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:a(()=>[e(U,null,{default:a(()=>[e(M,{link:"",separator:""},{default:a(()=>[w((s(),_(E,{clickable:"",onClick:f=>p.duplicarEquipamento(l)},{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(b,{name:"file_copy"})]),_:1}),e(h,null,{default:a(()=>[m(" Duplicar ")]),_:1})]),_:2},1032,["onClick"])),[[x]]),w((s(),_(E,{clickable:"",onClick:f=>p.removerEquipamento(l)},{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(b,{name:"delete"})]),_:1}),e(h,null,{default:a(()=>[m(" Remover ")]),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{class:"q-col-gutter-md"},{default:a(()=>[e(v,{equipamento:l},null,8,["equipamento"])]),_:2},1024),e(d,{class:"row"},{default:a(()=>[(s(!0),c(y,null,$(l.oss,f=>(s(),c("div",{key:f.id,class:"col-12 q-mt-lg"},[e(V,{os:f,class:"q-mb-md"},null,8,["os"])]))),128))]),_:2},1024)]),_:2},1024))),128)):(s(),c("div",Z,[i("p",null,"N\xE3o h\xE1 equipamentos cadastrados para o contato "+r((q.contato.nome||"").trim())+".",1),ee])),te,e(C,{round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},onClick:o[0]||(o[0]=l=>p.abrirModalEquipamento({}))}),e(I,{ref:"equipamento",onAtualizar:p.atualizar},null,8,["onAtualizar"])])}var se=z(Y,[["render",ae]]);export{se as default};
