import{_,r as p,o as s,n as l,f as n,w as m,B as u,j as A,y,d as x,z as P,bC as c,e as o,F as z,s as V,O as k}from"./index.f2a220da.js";import{F as v}from"./FaturaCard.b1c231c4.js";import{G as w}from"./GChipsV2.ac8e38be.js";import{n as q}from"./nfePrincipal.341dd0eb.js";import"./emitirNFe.35117289.js";import"./FaturaModal.1c7bcb45.js";import"./DocumentosFiscais.33fbcb1f.js";import"./Campo.22f0bacd.js";import"./compactarValidarNFe.97394362.js";import"./obterItens.d48753e1.js";import"./codigosANP.a6c1a264.js";import"./VendaCard.27ca8a76.js";import"./ModalHistoricoStatus.63e685c7.js";import"./EnvelopeCard.4a4cb843.js";import"./QSpinnerHourglass.e6da73ff.js";import"./QSpinnerDots.a1e87b38.js";const I={components:{FaturaCard:v,GChipsV2:w,nfePrincipal:q},computed:{temFaturasAbertas(){return!!this.faturasAbertas.length},temFaturasFinalizadas(){return!!this.faturasFinalizadas.length},temFaturasCanceladas(){return!!this.faturasCanceladas.length},temRegistros(){return this.temFaturasAbertas||this.temFaturasFinalizadas||this.temFaturasCanceladas}},data(){return{contato:null,grupos:[],faturasAbertas:[],faturasFinalizadas:[],faturasCanceladas:[],totalFaturasAbertas:0,totalFaturasCanceladas:0,totalFaturasFinalizadas:0,filtro:{},tipoData:"",tiposData:[{label:"Emiss\xE3o",value:"emissao"},{label:"Finalizado",value:"finalizado"}],dataIni:null,dataFim:null,carregando:!1,faturasPorSecao:"10",faturasPorSecaoOpts:[{value:"5",label:"5"},{value:"10",label:"10"},{value:"15",label:"15"},{value:"20",label:"20"},{value:"25",label:"25"},{value:"50",label:"50"}],faturaCardPagination:{maxPages:7,perPage:5,faturasAbertas:{page:1,min:1,max:1},faturasFinalizadas:{page:1,min:1,max:1},faturasCanceladas:{page:1,min:1,max:1}}}},methods:{async atualizar(){const i=$utils.logarIni("AtendimentoFatura");await $tryLoading(async()=>{await this.filtrar()},{mensagem:"Carregando faturas...",erro:"Ocorreu um erro ao consultar faturas",carregando:t=>this.carregando=t}),$utils.logarFim(i,1)},executar(i){this.atualizar()},fechouNFe(i){i&&$utils.emitter.emit("atualizarDocumentosFiscais")},async filtrar(){var b,a,e,C,g,F,f,h,r;let i,t,d;!this.contato.id||(i=await $db.fatura.filtrar({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"aberta",grupos:this.grupos},page:this.faturaCardPagination.faturasAbertas.page,limit:5}),t=await $db.fatura.filtrar({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"finalizada",grupos:this.grupos},page:this.faturaCardPagination.faturasFinalizadas.page,limit:5}),d=await $db.fatura.filtrar({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"cancelada",grupos:this.grupos},page:this.faturaCardPagination.faturasCanceladas.page,limit:5}),this.faturaCardPagination.faturasAbertas.max=(b=i.totalPages)!=null?b:0,this.faturaCardPagination.faturasFinalizadas.max=(a=t.totalPages)!=null?a:0,this.faturaCardPagination.faturasCanceladas.max=(e=d.totalPages)!=null?e:0,this.faturasAbertas=(C=i.data)!=null?C:[],this.faturasFinalizadas=(g=t.data)!=null?g:[],this.faturasCanceladas=(F=d.data)!=null?F:[],this.totalFaturasAbertas=$filters.numero((f=i.somaTotalDocumento)!=null?f:0,2),this.totalFaturasFinalizadas=$filters.numero((h=t.somaTotalDocumento)!=null?h:0,2),this.totalFaturasCanceladas=$filters.numero((r=d.somaTotalDocumento)!=null?r:0,2))},async limparFiltro(){this.grupos=[],this.dataFim=new Date;const i=new Date;if(i.setFullYear(i.getFullYear()-2),this.dataIni=i,this.contato.codigoContato){const t=await $db.configuracoes.leValorNumerico("venda.codigoconsumidor");this.contato.codigoContato===t&&(this.dataIni=this.dataFim)}}},watch:{"$route.params.id"(){const i=this.$route.params.id;!i||$db.contato.le({id:i}).then(t=>{this.contato=t,this.limparFiltro().then(()=>{this.atualizar()})})}},mounted(){$utils.emitter.off("atualizarAtendimentoFatura"),$utils.emitter.on("atualizarAtendimentoFatura",this.atualizar);const i=this.$route.params.id;!i||$db.contato.le({id:i}).then(t=>{this.contato=t,this.limparFiltro().then(()=>{this.atualizar()}).catch(d=>{$q.notifyError("Ops! Ocorreu um erro",d)})}).catch(t=>{$q.notifyError("Ops! Ocorreu um erro",t)})},unmounted(){$utils.emitter.off("atualizarAtendimentoFatura")}},E={class:"AtendimentoFatura q-pb-md"},U={class:"col-12 col-md-6"},B={class:"col"},D={class:"col"},j={key:0,class:"row justify-end q-mb-md"},N={class:"row"},O={key:1,class:"row justify-end q-mb-md"},R={key:0,class:"row justify-end q-mb-md"},T={class:"row"},Q={key:1,class:"row justify-end q-mb-md"},G={key:0,class:"row justify-end q-mb-md"},L={class:"row"},S={key:1,class:"row justify-end q-mb-md"},Y={key:1,class:"q-pa-lg text-center"};function H(i,t,d,b,a,e){const C=p("GChipsV2"),g=p("campo"),F=p("row"),f=p("fatura-card"),h=p("nfePrincipal");return s(),l("div",E,[n(y,{class:"q-pa-sm q-mx-sm no-shadow"},{default:m(()=>[n(F,{class:"items-center q-col-gutter-md"},{default:m(()=>[u("div",U,[n(C,{modelValue:a.grupos,"onUpdate:modelValue":[t[0]||(t[0]=r=>a.grupos=r),e.filtrar],class:"q-px-none",placeholder:"Filtre por C\xF3digo, N\xFAmero..."},{prepend:m(()=>[n(A,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),u("div",B,[n(g,{modelValue:a.dataIni,"onUpdate:modelValue":t[1]||(t[1]=r=>a.dataIni=r),tipo:"data",onBlur:e.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])]),t[9]||(t[9]=u("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[u("label",null,"at\xE9")],-1)),u("div",D,[n(g,{modelValue:a.dataFim,"onUpdate:modelValue":t[2]||(t[2]=r=>a.dataFim=r),tipo:"data",onBlur:e.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])])]),_:1})]),_:1}),!a.carregando&&e.temRegistros?(s(),x(k,{key:0,class:"no-border"},{default:m(()=>[e.temFaturasAbertas?(s(),x(P,{key:0,"default-opened":"",label:`Abertas (Total R$ ${a.totalFaturasAbertas})`,group:"faturasAbertas"},{default:m(()=>[a.faturaCardPagination.faturasAbertas.max>1?(s(),l("div",j,[n(c,{modelValue:a.faturaCardPagination.faturasAbertas.page,"onUpdate:modelValue":t[3]||(t[3]=r=>a.faturaCardPagination.faturasAbertas.page=r),min:a.faturaCardPagination.faturasAbertas.min,max:a.faturaCardPagination.faturasAbertas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:e.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0),u("div",N,[(s(!0),l(z,null,V(a.faturasAbertas,r=>(s(),l("div",{class:"q-px-sm full-width",key:r.id},[n(f,{id:r.id,onExecutar:e.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128))]),a.faturaCardPagination.faturasAbertas.max>1?(s(),l("div",O,[n(c,{modelValue:a.faturaCardPagination.faturasAbertas.page,"onUpdate:modelValue":t[4]||(t[4]=r=>a.faturaCardPagination.faturasAbertas.page=r),min:a.faturaCardPagination.faturasAbertas.min,max:a.faturaCardPagination.faturasAbertas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:e.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0)]),_:1},8,["label"])):o("",!0),e.temFaturasFinalizadas?(s(),x(P,{key:1,"default-opened":"",label:`Finalizadas (Total R$ ${a.totalFaturasFinalizadas})`,group:"faturasFinalizadas"},{default:m(()=>[a.faturaCardPagination.faturasFinalizadas.max>1?(s(),l("div",R,[n(c,{modelValue:a.faturaCardPagination.faturasFinalizadas.page,"onUpdate:modelValue":t[5]||(t[5]=r=>a.faturaCardPagination.faturasFinalizadas.page=r),min:a.faturaCardPagination.faturasFinalizadas.min,max:a.faturaCardPagination.faturasFinalizadas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:e.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0),u("div",T,[(s(!0),l(z,null,V(a.faturasFinalizadas,r=>(s(),l("div",{class:"q-px-sm full-width",key:r.id},[n(f,{id:r.id,onExecutar:e.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128))]),a.faturaCardPagination.faturasFinalizadas.max>1?(s(),l("div",Q,[n(c,{modelValue:a.faturaCardPagination.faturasFinalizadas.page,"onUpdate:modelValue":t[6]||(t[6]=r=>a.faturaCardPagination.faturasFinalizadas.page=r),min:a.faturaCardPagination.faturasFinalizadas.min,max:a.faturaCardPagination.faturasFinalizadas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:e.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0)]),_:1},8,["label"])):o("",!0),e.temFaturasCanceladas?(s(),x(P,{key:2,"default-opened":"",label:`Canceladas (Total R$ ${a.totalFaturasCanceladas})`,group:"faturasCanceladas"},{default:m(()=>[a.faturaCardPagination.faturasCanceladas.max>1?(s(),l("div",G,[n(c,{modelValue:a.faturaCardPagination.faturasCanceladas.page,"onUpdate:modelValue":t[7]||(t[7]=r=>a.faturaCardPagination.faturasCanceladas.page=r),min:a.faturaCardPagination.faturasCanceladas.min,max:a.faturaCardPagination.faturasCanceladas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:e.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0),u("div",L,[(s(!0),l(z,null,V(a.faturasCanceladas,r=>(s(),l("div",{class:"q-px-sm full-width",key:r.id},[n(f,{id:r.id,onExecutar:e.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128))]),a.faturaCardPagination.faturasCanceladas.max>1?(s(),l("div",S,[n(c,{modelValue:a.faturaCardPagination.faturasCanceladas.page,"onUpdate:modelValue":t[8]||(t[8]=r=>a.faturaCardPagination.faturasCanceladas.page=r),min:a.faturaCardPagination.faturasCanceladas.min,max:a.faturaCardPagination.faturasCanceladas.max,ellipses:"","max-pages":a.faturaCardPagination.maxPages,class:"float-right",onClick:e.filtrar},null,8,["modelValue","min","max","max-pages","onClick"])])):o("",!0)]),_:1},8,["label"])):o("",!0)]),_:1})):o("",!0),!a.carregando&&!e.temRegistros?(s(),l("div",Y,t[10]||(t[10]=[u("p",null,[u("small",null,"Registros n\xE3o encontrados")],-1)]))):o("",!0),n(h,{onFechar:e.fechouNFe},null,8,["onFechar"])])}var ua=_(I,[["render",H]]);export{ua as default};
