import{_ as H,cN as L,d5 as z,r as I,as as ie,o as C,d as N,w as r,f as i,y as Y,B as Z,ar as re,h as ee,G as j,Q as _,M as U,i as te,k as p,N as oe,n as k,F as A,aS as ne,q as se,e as D,C as ae,a0 as le,aD as E,s as M,bP as me,bK as m,bF as Q,bE as O,bj as v,bQ as ce,aC as q,bM as w,bL as x,aE as G,bN as ue,by as pe,bG as P,bH as T,bJ as S,cf as de,bs as fe,R as y,u as R,S as d,T as h,t as g,m as X,ax as B,O as $,j as J}from"./index.129a5639.js";import{C as Ce}from"./Campo.2ebba21e.js";import{c as K,a as V}from"./compactarValidarNFe.c3faa32e.js";import{a as he,g as ge,b as Ne,o as be,d as ve,e as Fe,c as we,f as Ee,h as Pe,i as ye,t as _e}from"./obterItens.7428dd74.js";const xe={components:{Campo:Ce},data(){return{cpfCnpjErro:!1,cpfCnpjInvalido:"",tipoCaixa:""}},emits:["confirmar","update:modelValue"],methods:{eventoConfirmar(){if(!this.dados.incluirCpfCnpjNoCupom)this.dados.cpfCnpj="",this.dados.nomeCliente="";else if(!!this.dados.cpfCnpj&&!L(this.dados.cpfCnpj)){this.cpfCnpjErro=!0,this.cpfCnpjInvalido="CPF / CNPJ Inv\xE1lido!";return}this.eventoInput(!1),this.$emit("confirmar",this.dados)},eventoInput(e){this.$emit("update:modelValue",e)},validaCpfCnpj(){if(!!this.dados.cpfCnpj&&!L(this.dados.cpfCnpj)){this.cpfCnpjErro=!0,this.cpfCnpjInvalido="CPF / CNPJ Inv\xE1lido!";return}}},watch:{async modelValue(){let e;!this.modelValue||(e=this.dados.tipoCaixa,e==="SAT"&&(e=await z.hwDest(this.dados.idEmpresa)),this.tipoCaixa=e,this.cpfCnpjErro=!1,this.cpfCnpjInvalido="")}},props:{modelValue:{required:!0,type:Boolean},dados:{required:!0,type:Object}}};function Se(e,o,a,n,t,s){const u=I("campo"),c=I("g-col"),f=I("g-row"),b=ie("mask");return C(),N(ae,{"model-value":a.modelValue,"onUpdate:modelValue":s.eventoInput},{default:r(()=>[i(Y,{class:"bg-white",style:{width:"450px"}},{default:r(()=>[Z("form",{onSubmit:o[4]||(o[4]=re((...l)=>s.eventoConfirmar&&s.eventoConfirmar(...l),["prevent"]))},[i(ee,{class:"bg-primary text-white q-pa-sm"},{default:r(()=>[j(i(_,{icon:"arrow_back",round:"",flat:"",dense:""},null,512),[[U]]),i(te,null,{default:r(()=>o[5]||(o[5]=[p("CPF/CNPJ no Cupom")])),_:1}),i(_,{type:"submit",label:`Emitir ${t.tipoCaixa}`,color:"white","text-color":"primary",unelevated:""},null,8,["label"])]),_:1}),i(oe,{class:"no-padding"},{default:r(()=>[i(f,{gutter:"md",mg:"xl-y"},{default:r(()=>[i(c,{col:"12"},{default:r(()=>[i(u,{modelValue:a.dados.incluirCpfCnpjNoCupom,"onUpdate:modelValue":o[0]||(o[0]=l=>a.dados.incluirCpfCnpjNoCupom=l),tipo:"logico",rotulo:"Incluir CPF/CNPJ no cupom"},null,8,["modelValue"])]),_:1}),a.dados.incluirCpfCnpjNoCupom?(C(),k(A,{key:0},[i(c,{col:"12"},{default:r(()=>[i(ne,{error:t.cpfCnpjErro,"error-label":"CPF/CNPJ inv\xE1lido"},{default:r(()=>[j(i(se,{modelValue:a.dados.cpfCnpj,"onUpdate:modelValue":[o[1]||(o[1]=l=>a.dados.cpfCnpj=l),o[2]||(o[2]=l=>t.cpfCnpjErro=!1)],label:"CPF / CNPJ",class:"hide-bottom-space",onChange:s.validaCpfCnpj},null,8,["modelValue","onChange"]),[[b,["###.###.###-##","##.###.###/####-##"]]])]),_:1},8,["error"])]),_:1}),i(c,{col:"12"},{default:r(()=>[i(u,{modelValue:a.dados.nomeCliente,"onUpdate:modelValue":o[3]||(o[3]=l=>a.dados.nomeCliente=l),rotulo:"Nome"},null,8,["modelValue"])]),_:1})],64)):D("",!0)]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])}var De=H(xe,[["render",Se]]);const Ie={components:{SeletorCest:le},computed:{campos(){return this.modal.campos}},data(){return{itens:[]}},emits:["confirmar"],methods:{async atualizar(){try{this.$lodash.get(this.campos,"ids.length")?(this.itens=await E().item.where("id").anyOf(this.campos.ids).toArray(),this.itensOriginal=this.$utils.clonarV2(this.itens)):this.itens=[]}catch(e){this.$q.notifyError("Erro ao carregar os dados",e)}},async confirmar(){this.$utils.gconsole.log("ItemTrocarCest","confirmar",this.itens);for(const e in this.itens)!!this.itens[e].cest&&this.itens[e].cest!==this.itensOriginal[e].cest&&$db.item.gravaItem({atual:this.itens[e],original:this.itensOriginal[e]});this.modal.visivel=!1,this.$emit("confirmar")}},props:{modal:{required:!0,type:Object}},watch:{"modal.visivel"(e){e&&this.atualizar()}},mounted(){this.atualizar()}},qe={class:"bg-white q-mx-md q-pa-md"};function ke(e,o,a,n,t,s){const u=I("campo"),c=I("SeletorCest");return C(),N(ae,{modelValue:a.modal.visivel,"onUpdate:modelValue":o[1]||(o[1]=f=>a.modal.visivel=f),maximized:""},{default:r(()=>[i(Y,null,{default:r(()=>[i(ee,{class:"bg-primary text-white"},{default:r(()=>[j(i(_,{flat:"",round:"",dense:"",icon:"arrow_back"},null,512),[[U]]),i(te,{class:"q-mx-sm"},{default:r(()=>o[2]||(o[2]=[p("Selecionar CEST para os itens")])),_:1}),i(_,{class:"q-ml-sm no-shadow",color:"white","text-color":"primary",label:"Salvar",onClick:o[0]||(o[0]=f=>e.tryLoading(s.confirmar,{erro:"Ocorreu erro ao salvar CEST"}))})]),_:1}),i(oe,{class:"text-body1 q-mx-lg q-my-sm"},{default:r(()=>[Z("div",qe,[(C(!0),k(A,null,M(t.itens,f=>(C(),k("div",{key:f.id,class:"q-col-gutter-x-sm items-baseline row"},[i(u,{"model-value":f.descricao,rotulo:"Descri\xE7\xE3o",class:"col-12 col-md-6","apenas-leitura":""},null,8,["model-value"]),i(u,{"model-value":f.ncm,rotulo:"NCM",class:"col-12 col-md-3","apenas-leitura":""},null,8,["model-value"]),i(c,{modelValue:f.cest,"onUpdate:modelValue":b=>f.cest=b,class:"col-12 col-md-3",ncm:f.ncm},null,8,["modelValue","onUpdate:modelValue","ncm"])]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Te=H(Ie,[["render",ke]]),W={tipo:"NFCe",serie:"nfce.padrao.serie",homologacao:"nfce.homologacao",usadesconto:"nfce.usadesconto",gerarAutorizacaoDownload:he,gerarConfiguracaoImposto:ge,gerarNumeroNFe:Ne,obterConfiguracaoImpostoV2:be,obterObservacoesFigurasFiscais:ve,obterValoresAproximadosTributos:Fe,obterFatura:we,obterFormasPagamento:Ee,obterFrete:Pe,obterItens:ye,async gerarJson(e,o,a){const n=me("gerarJsonNFCe",e,o,a);try{m(!e,"Fatura n\xE3o fornecida");const t=Q.iniciarCampos({idDocumento:e,cpfCnpjCliente:o,nomeCliente:a,totalDesconto:0,totalDevolucao:0,totalProdutos:0,totalServicos:0,alertas:[],erros:[],cache:{},outrosNFe:{},infNFe:K.executa(O.infNFe,{},"NFCe")},"gerarNFCeFatura");v.log("gerarJsonNFCeD","iniciarCampos",t),await this.acertoInicial(t),await this.obterFatura(t),await this.obterEmitente(t),await this.obterDestinatario(t,o,a);const s=[];if(await this.obterItens(t,s),s.length)throw $utils.emitter.emit("confrontarFigurasFiscais",s),new Error("Figura fiscal n\xE3o encontrada");return await this.obterFormasPagamento(t),await this.obterFrete(t),await this.gerarNumeroNFe(t.infNFe,t.outrosNFe.idContatoEmitente),await this.gerarAutorizacaoDownload(t.infNFe,t.outrosNFe.idContatoEmitente),_e.calculaTotais(t.infNFe,t.outrosNFe,O),this.obterObservacoesNFe(t),this.obterValoresAproximadosTributos(t),this.obterObservacoesFigurasFiscais(t),await Q.acertarDadosNFe(t.infNFe,t.outrosNFe,"NFCe"),t.infNFe=V.executa(O.infNFe,t.infNFe),t.erros=V.erros,v.log("gerarJsonNFCeD","infNFe",t.infNFe),v.log("gerarJsonNFCeD","compactarValidarNFe.erros",V.erros),t}finally{ce(n,1)}},async acertoInicial(e){var t;v.log("gerarJsonNFeD","acertoInicial"),e.infNFe.ide.tpNF="1",e.infNFe.ide.finNFe="1",e.infNFe.ide.tpAmb=await q.configuracoes.leValorNumerico(this.homologacao)===1?"2":"1",e.infNFe.ide.mod="65",e.infNFe.ide.tpImp="4",e.infNFe.ide.dhEmi=Q.formatarDataNFe(new Date),m(!e.idDocumento,"Ops! N\xE3o foi encontrado o c\xF3digo do documento (venda/fatura).");const o=await $db.hibrido.le({table:"documento",id:e.idDocumento});let a=[];o.tipo==="Venda"&&a.push(o),o.tipo==="Fatura"&&(a=await $db.hibrido.lista({table:"documento",where:{idFatura:e.idDocumento}}));let n;for(const s of a){const u=Number(s==null?void 0:s.codigoDocumentoOperacao);if(Number.isInteger(u)&&u>0){const c=await $db.hibrido.lista({table:"documentoOperacao",where:{codigoDocumentoOperacao:u}});n||(n=c[0]),m((n==null?void 0:n.finalidade)!==((t=c[0])==null?void 0:t.finalidade),"Vendas possuem opera\xE7\xF5es com finalidades diferentes.")}}e.idCfopVenda=n==null?void 0:n.idCfop,m(!e.idCfopVenda,"Erro na configura\xE7\xE3o do sistema. Sem defini\xE7\xE3o do CFOP de venda.")},async gerarJsonCancelamento(e){const o={infEvento:{cOrgao:e.infNFe.ide.cUF,tpAmb:e.infNFe.ide.tpAmb,escolhas:{valor_escolha:e.infNFe.emit.escolhas.valor_escolha,CNPJ:e.infNFe.emit.escolhas.CNPJ,CPF:e.infNFe.emit.escolhas.CPF},chNFe:e.outrosNFe.chNFe,dhEvento:Q.formatarDataNFe(new Date),nSeqEvento:"1",detEvento:{nProt:e.outrosNFe.nProt_emissao,xJust:"Nota cancelada devido divergencia de informacoes"}}};return o.infEvento=K.executa(O.infEvento,o.infEvento,"NFCe"),o.infEvento=V.executa(O.infEvento,o.infEvento),e.erros=V.erros,v.log("gerarJsonNFCeD","infNFe",e.infNFe),v.log("gerarJsonNFCeD","compactarValidarNFe.erros",V.erros),o.infEvento},obterObservacoesNFe(e){if(e.outrosNFe.dadosAdicionaisEmitente="",e.empresa.observacaoNFE){let o=w(e.empresa.observacaoNFE);o=`[${o}]`,e.outrosNFe.dadosAdicionaisEmitente+=o}},async obterConfiguracaoImposto(e){v.log("gerarJsonNFCeD","obterConfiguracaoImposto");const o=`Produto '${e.documentoItem.descricaoItem||""}'`;m(!e.item.ncm,`${o} sem cadastro de NCM`);const a=await E()._ncm.where("ncm").equals(e.item.ncm).first();m(!a,`${o} com NCM '${e.item.ncm||""}' inv\xE1lido`),e.documentoItem.idCfop||(e.documentoItem.idCfop=e.idCfopVenda);const n=await E().cfop.get(e.documentoItem.idCfop);m(!n,`${o} com CFOP inv\xE1lido`),v.log("gerarJsonNFCeD",`dadosNcm.id: ${a.id} dadosCfop.id: ${n.id} dados.empresa.id: ${e.empresa.id}`);const t=await E().impostoConfiguracao.where("idNcm").equals(a.id).filter(f=>f.idCfop===n.id&&f.idEmitente===e.empresa.id&&f.ufOrigem===e.empresa.enderecoPrincipal.uf&&f.ufDestino===e.empresa.enderecoPrincipal.uf).first();v.log("gerarJsonNFCeD","impostoConfiguracao",t);const s=`Verifique a configura\xE7\xE3o do imposto para NCM: ${e.item.ncm||""}, CFOP: ${n.cfop||""}, CNPJ: ${e.empresa.numeroDocumentoNacional||""}, UF origem: ${e.empresa.enderecoPrincipal.uf||""}, UF destino: ${e.empresa.enderecoPrincipal.uf||""}.`;m(!t,`${o} sem configura\xE7\xE3o de imposto. ${s}`);const u=e.det.prod,c=e.det.imposto;try{if(u.CFOP=(n.cfop||0).toString(),c.noXml_orig=await this.obterImpostoParametro(e,t.idOrigem),c.noXml_CST=c.noXml_CSOSN=await this.obterImpostoParametro(e,t.idCst),c.noXml_pICMS=t.aliqIcmsUFOrigem||t.aliqIcms||0,c.noXml_pRedBC=t.percRedBcIcms||0,c.noXml_pFCP=t.aliqFcp||0,c.noXml_CSTPis=await this.obterImpostoParametro(e,t.idTipoTribPis),c.noXml_pPIS=t.aliqPis||0,c.noXml_CSTCofins=await this.obterImpostoParametro(e,t.idTipoTribCofins),c.noXml_pCOFINS=t.aliqCofins||0,t.idCest){const f=await this.obterImpostoParametro(e,t.idCest);f&&(u.opcional.visivel=!0,u.opcional.CEST=x(f))}}catch(f){console.error(f),m(!0,`${o} com erro na configura\xE7\xE3o de imposto. ${s}`)}},async obterDestinatario(e,o,a){var u;if(e.destinatario={},!o){e.infNFe.dest.visivel=!1;return}const n=e.documentoFatura.idContato;n&&(e.destinatario=await E().contato.get(n),e.destinatario&&(e.destinatario.enderecos=await E().contatoEndereco.where("idContato").equals(n).toArray(),e.destinatario.enderecoPrincipal=e.destinatario.enderecos.find(c=>c.grupo==="Principal"),e.destinatario.enderecoPrincipal||(e.destinatario.enderecoPrincipal=e.destinatario.enderecos[0]||{}),e.destinatario.telefones=await E().contatoTelefone.where("idContato").equals(n).toArray(),e.destinatario.telefonePrincipal=e.destinatario.telefones.find(c=>c.grupo==="Principal"),e.destinatario.telefonePrincipal||(e.destinatario.telefonePrincipal=e.destinatario.telefones[0]||{}),v.log("gerarJsonNFCeD","dados.destinatario",e.destinatario)));const t=e.infNFe.dest;t.visivel=!0;const s=x(o);s.length===11?(t.escolhas.valor_escolha="CPF",t.escolhas.CPF=s,t.indIEDest="9"):s.length===14?(t.escolhas.valor_escolha="CNPJ",t.escolhas.CNPJ=s,t.indIEDest="9"):m(!0,"Destinatario com CPF/CNPJ inv\xE1lido"),s===x(e.destinatario.numeroDocumentoNacional)&&(t.escolhas.valor_escolha==="CNPJ"&&!!e.destinatario.numeroDocumentoEstadual&&(t.IE=x(e.destinatario.numeroDocumentoEstadual)),t.xNome=w(a||e.destinatario.nome),!(!e.destinatario.enderecoPrincipal.uf||!e.destinatario.enderecoPrincipal.ibgeCod)&&(t.enderDest.visivel=!0,t.email=(e.destinatario.emailNfe||e.destinatario.email||"").trim(),t.enderDest.fone=x(e.destinatario.telefonePrincipal.telefone||""),t.enderDest.xLgr=w(e.destinatario.enderecoPrincipal.logradouro),t.enderDest.nro=(e.destinatario.enderecoPrincipal.numero||"SN").trim(),t.enderDest.xCpl=w(e.destinatario.enderecoPrincipal.complemento),t.enderDest.xBairro=w(e.destinatario.enderecoPrincipal.bairro),t.enderDest.cMun=String(e.destinatario.enderecoPrincipal.ibgeCod||"").trim(),t.enderDest.xMun=w(e.destinatario.enderecoPrincipal.municipio),t.enderDest.UF=(e.destinatario.enderecoPrincipal.uf||"").trim(),t.enderDest.CEP=x(e.destinatario.enderecoPrincipal.cep||""),t.enderDest.cPais=String((u=e.destinatario.enderecoPrincipal.codigoPais)!=null?u:"")||"1058",t.enderDest.xPais=(e.destinatario.enderecoPrincipal.pais||"").trim()||"Brasil"))},async obterEmitente(e){var n;v.log("gerarJsonNFCeD","obterEmitente");const o=e.documentoFatura.idEmpresa;if(m(!o,"Fatura sem empresa emitente"),e.empresa=await E().contato.get(o),m(!e.empresa,"N\xE3o foi poss\xEDvel carregar a empresa emitente"),e.outrosNFe.idContatoEmitente=o,e.empresaPlat=await G.empresa.where({idContato:o}).first(),!e.empresaPlat){const t=JSON.parse(localStorage.getItem("clienteSistema"));e.empresaPlat=await G.empresa.where({codigoContato:e.empresa.codigoContato}).filter(s=>s.codigoClienteSistema===t.codigoClienteSistema).first()}m(!e.empresaPlat,"N\xE3o foi poss\xEDvel carregar a empresa emitente"),e.infNFe.ide.tpAmb==="1"?(m(!e.empresaPlat.hashCSCProducao,"Empresa emitente sem hashCSC de produ\xE7\xE3o cadastrado"),m(!e.empresaPlat.tokenCSCProducao,"Empresa emitente sem tokenCSC de produ\xE7\xE3o cadastrado"),e.empresaPlat.hashCSC=e.empresaPlat.hashCSCProducao,e.empresaPlat.tokenCSC=e.empresaPlat.tokenCSCProducao):(m(!e.empresaPlat.hashCSCHomologacao,"Empresa emitente sem hashCSC de homologa\xE7\xE3o cadastrado"),m(!e.empresaPlat.tokenCSCHomologacao,"Empresa emitente sem tokenCSC de homologa\xE7\xE3o cadastrado"),e.empresaPlat.hashCSC=e.empresaPlat.hashCSCHomologacao,e.empresaPlat.tokenCSC=e.empresaPlat.tokenCSCHomologacao),e.empresa.enderecos=await E().contatoEndereco.where("idContato").equals(o).toArray(),m(!e.empresa.enderecos||e.empresa.enderecos.length===0,"N\xE3o foi poss\xEDvel carregar o endere\xE7o da empresa emitente"),e.empresa.enderecoPrincipal=e.empresa.enderecos.find(t=>t.grupo==="Principal"),e.empresa.enderecoPrincipal||(e.empresa.enderecoPrincipal=e.empresa.enderecos[0]||{}),e.empresa.telefones=await E().contatoTelefone.where("idContato").equals(o).toArray()||[],e.empresa.telefonePrincipal=e.empresa.telefones.find(t=>t.grupo==="Principal"),e.empresa.telefonePrincipal||(e.empresa.telefonePrincipal=e.empresa.telefones[0]||{}),v.log("gerarJsonNFCeD","dados.empresa",e.empresa),m(!e.empresa.numeroDocumentoNacional,"Empresa emitente sem CNPJ cadastrado"),m(!e.empresa.numeroDocumentoEstadual,"Empresa emitente sem Inscri\xE7\xE3o Estadual cadastrado"),m(!e.empresa.nome,"Empresa emitente sem Raz\xE3o Social (nome) cadastrado"),m(!e.empresa.enderecoPrincipal.uf,"Empresa emitente sem UF cadastrado"),m(!e.empresa.enderecoPrincipal.ibgeCod,"Empresa emitente sem c\xF3digo do munic\xEDpio cadastrado"),m(!e.empresa.regime,"Empresa emitente sem regime cadastrado");const a=e.infNFe.emit;a.escolhas.CNPJ=x(e.empresa.numeroDocumentoNacional),a.IE=x(e.empresa.numeroDocumentoEstadual),a.CRT=e.empresa.regime==="SimplesNacional"?"1":e.empresa.regime==="MEI"?"4":"3",a.xNome=w(e.empresa.nome),a.xFant=w(e.empresa.apelido),a.email=(e.empresa.email||"").trim(),a.enderEmit.fone=x(e.empresa.telefonePrincipal.telefone),a.enderEmit.xLgr=w(e.empresa.enderecoPrincipal.logradouro),a.enderEmit.nro=(e.empresa.enderecoPrincipal.numero||"SN").trim(),a.enderEmit.xCpl=w(e.empresa.enderecoPrincipal.complemento),a.enderEmit.xBairro=w(e.empresa.enderecoPrincipal.bairro),a.enderEmit.cMun=String(e.empresa.enderecoPrincipal.ibgeCod||"").trim(),a.enderEmit.xMun=w(e.empresa.enderecoPrincipal.municipio),a.enderEmit.UF=(e.empresa.enderecoPrincipal.uf||"").trim(),a.enderEmit.CEP=x(e.empresa.enderecoPrincipal.cep),a.enderEmit.cPais=String((n=e.empresa.enderecoPrincipal.codigoPais)!=null?n:"")||"1058",a.enderEmit.xPais=w(e.empresa.enderecoPrincipal.pais||"Brasil"),e.infNFe.ide.cMunFG=a.enderEmit.cMun,e.infNFe.ide.cUF=String(ue[a.enderEmit.UF])},async obterImpostoParametro(e,o){m(!o,"Configura\xE7\xE3o de imposto sem informa\xE7\xE3o completa");let a=e.cache[o];if(!a){const n=await E().impostoParametro.get(o);a=n?n.numero.trim():void 0,e.cache[o]=a}return m(!a,"Configura\xE7\xE3o de imposto inv\xE1lida"),a},async obterMeioPagamento(e,o){v.log("gerarJsonNFCeD","obterMeioPagamento",o),m(!o,"Forma de pagamento inv\xE1lida");let a=e.cache[o];if(a)return a;const n=await E().formaPagamento.get(o);m(!n||!n.descricao,"N\xE3o foi poss\xEDvel carregar a forma de pagamento");const t=n.descricao.toLowerCase();return a=t.includes("dinheiro")?"01":t.includes("d\xE9bito")?"04":t.includes("cr\xE9dito de clientes")?"01":t.includes("cr\xE9dito")?"03":t.includes("cart\xE3o")&&Number(n.parcelamentoMaximo||0)===1?"04":t.includes("cart\xE3o")&&Number(n.parcelamentoMaximo||0)>1?"03":"99",e.cache[o]=a,console.log("codigoMeioPagamento: ",a),a},async obterAliquotasTributosIbpt(e,o){v.log("gerarJsonNFCeD","obterValorAproxTributos",o);const a=await E().nfeIbpt.where("codigo").equals(Number(o.prod.NCM)).toArray();if(this.verificarAlerta(!a||a.length===0,`N\xE3o encontrado al\xEDquotas para calculo do valor aproximado de tributos do NCM: ${o.prod.NCM}. Atualize sua tabela IBPT.`,e))return;const n=a.filter(u=>u.idContato===e.empresa.id),s=(n.length?n:a).reduce((u,c)=>!u||u.vigenciaFim<c.vigenciaFim?c:u,null);this.verificarAlerta(s.vigenciaFim<pe(),`Informa\xE7\xF5es vencidas para para o calculo do valor aproximado de tributos do NCM: ${o.prod.NCM}. Atualize sua tabela IBPT.`,e),o.imposto.noXml_pTribImp=Number(s.importadosFederal||0),o.imposto.noXml_pTribFed=Number(s.nacionalFederal||0),o.imposto.noXml_pTribEst=Number(s.estadual||0),o.imposto.noXml_pTribMun=Number(s.municipal||0)},verificarAlerta(e,o,a){return e&&(a.alertas||(a.alertas=[]),a.alertas.push(o),console.warn(o)),e}};const $e={components:{CpfCnpjNoCupom:De,ItemTrocarCest:Te},computed:{config(){return q.configuracoes.valores}},data(){return{width:0,configImpressaoNFe:[],documentosSat:[],documentosFiscais:[],documentosNFe:[],hwDest:"",modalItemTrocarCest:{visivel:!1,campos:{}},cpfCnpjNoCupom:{visivel:!1,incluirCpfCnpjNoCupom:!1,idEmpresa:"",cpfCnpj:"",nomeCliente:""},quantidadeDocumentos:0}},methods:{abrirNFe(e){$utils.emitter.emit("abrirNFe",e)},abrirNFSe(e){this.$router.push({name:"NFSe",params:{id:e!=null?e:null}})},async atualiza(){const e=this.idFatura||this.idVenda;if(e){const a=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:e}});this.documentosFiscais=a.sort((n,t)=>Number(t.nNF)-Number(n.nNF)),this.documentosSat=await $db.documentoSat.lista(e)}const o=await $db.hibrido.le({table:"documento",id:e});await this.configuraImpressao(o.idEmpresa),this.hwDest=await z.hwDest(o.idEmpresa)},async cancelarSat(e){try{await new Promise((a,n)=>{$q.dialog({title:"Tem certeza?",message:"Ao continuar voc\xEA ir\xE1 cancelar este cupom",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONFIRMAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{a()}).onCancel(()=>{n()})})}catch{return}let o="Erro no cupom";try{P.show({spinner:T,spinnerColor:"amber",message:"Cancelando o cupom"});const a=this.documentosSat.find(u=>u.id===e),n={NumeroPDV:1,ChaveAcessoCFe:a.chaveCupom,CPF_CNPJ:"",Total:a.valorTotal};o="Ocorreu um erro ao cancelar o cupom";const t=await $db.hibrido.le({table:"documento",id:a.idDocumento}),s=await S.cancelarSat(JSON.stringify(n),t);m(s.status==="Erro",s.mensagem),this.$q.notifyPositive(s.mensagem),o="Ocorreu um erro ao gravar os dados do cancelamento do cupom",await z.salvarRetornoCancelamento(this.idFatura,s.chaveCFe,s.xml),(s==null?void 0:s.versaoIntegrador)==="V2"&&await S.imprimirCancelamentoSat(s.xml,a.idEmpresa)}catch(a){this.$q.notifyError(o,a)}finally{P.hide(),this.atualiza()}},async cancelarNFCe(e){try{await new Promise((a,n)=>{this.$q.dialog({title:"Tem certeza?",message:"Ao continuar voc\xEA ir\xE1 cancelar este cupom",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONFIRMAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{a()}).onCancel(()=>{n()})})}catch{return}let o="Erro no NFCe";try{P.show({spinner:T,spinnerColor:"amber",message:"Selecionando Certificado e Cancelando NFCe"});const a=JSON.parse(this.documentosFiscais.find(t=>t.id===e).json);if(a.infEvento=await W.gerarJsonCancelamento(a),m(!a.infEvento,o),a.erros.length){$g.modalAlerta.show({titulo:"Erro de valida\xE7\xE3o",erros:a.erros});return}o="Ocorreu um erro ao cancelar o NFCe";const n=await S.cancelarNFCe(a);if(n.status==="Erro"){const t=[...(n.mensagem||"").split(`
`),...(n.complemento||"").split(`
`)];$g.modalAlerta.show({titulo:n.status,erros:t});return}this.$q.notifyPositive(n.mensagem)}catch(a){this.$q.notifyError(o,a)}finally{P.hide(),this.atualiza()}},async configuraImpressao(e){const o=await q.configuracoes.porNome("impressao.nfe",e);this.configImpressaoNFe=o.length?o.map(a=>({texto:"Imprimir DANFE",...a})):[{valor:"nfe-danfe",texto:"DANFE"},{valor:"nfe-danfe-simplificado",texto:"DANFE Simplificado"},{valor:"duplicata-mercantil",texto:"Duplicata Mercantil"}]},async emitirCupom(e,o){try{const a=await $db.hibrido.le({table:"documento",id:e});m(!a||!a.status,"Erro ao emitir cupom. Falha na consulta da fatura."),m(a.status!=="Finalizada","Cupom n\xE3o emitido. A Fatura n\xE3o foi finalizada.");const n=(await q.financeiroTitulo.le({documentoId:e}))[0];if(!n)return;let t;if(n.idDocumentoCaixa){const s=await $db.hibrido.le({table:"documento",id:n.idDocumentoCaixa});m(!s||!s.idCaixa,"Erro ao emitir cupom. Falha na consulta do documento Caixa.");const u=await q.caixa.le({id:s.idCaixa});m(!u||!u.tipo,"Erro ao emitir cupom. Falha na consulta do Caixa."),t=u.tipo}else{const s=await q.configuracoes.porNome("vendas.tipoPDV",a.idEmpresa);t=parseInt(((s||[]).find(u=>u.valor)||{}).valor)||4}if(t=q.caixa.tiposCaixa[t],m(!["SAT","NFCe"].includes(t),`Cupom n\xE3o emitido. Caixa configurado para ${t}.`),t==="SAT"){let s;try{s=(await $utils.geeksApi({listaHibrido:{funcao:"FCC75497-9CAD-4D28-AB39-F669142BE8A9",table:"documentoSat",where:{idDocumento:e}}})).data.listaHibrido}catch{m(!0,"Erro ao emitir cupom. Falha na consulta dos documentos.")}for(const b of await $erp().documentoSat.where({idDocumento:e}).toArray())s.some(l=>l.id===b.id)||s.push(b);const u=s.filter(b=>b.cancelamento).map(b=>b.chaveCupomCancelado),f=s.filter(b=>!u.includes(b.chaveCupom)).filter(b=>!b.cancelamento);m(f.length>0,"Cupom j\xE1 emitido para a fatura")}else if(t==="NFCe"){const s=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:e,situacao:"Emitido"}});m(!s,"Erro ao emitir cupom. Falha na consulta dos dados."),m(s.length>0,"Cupom j\xE1 emitido para a fatura")}await de(e),o&&(this.cpfCnpjNoCupom={visivel:!1,incluirCpfCnpjNoCupom:!1,idEmpresa:a.idEmpresa,cpfCnpj:a.numeroDocumentoContato,nomeCliente:a.descricaoContato,idFatura:e,tipoCaixa:t,concluir:null},await this.emitirCupomConfirma(this.cpfCnpjNoCupom)),o||(this.cpfCnpjNoCupom={visivel:!0,incluirCpfCnpjNoCupom:!1,idEmpresa:a.idEmpresa,cpfCnpj:a.numeroDocumentoContato,nomeCliente:a.descricaoContato,idFatura:e,tipoCaixa:t,concluir:null},await new Promise((s,u)=>{this.cpfCnpjNoCupom.concluir=s}),await this.$utils.dormir(500),this.modalItemTrocarCest.visivel&&await new Promise((s,u)=>{this.concluirItemTrocarCest=s}))}catch(a){this.$q.notifyError("Erro ao emitir cupom",a)}},async emitirCupomConfirma(e){return{SAT:this.emitirCupomSatConfirma,NFCe:this.emitirCupomNFCeConfirma}[e.tipoCaixa](e)},async emitirCupomSatConfirma(e){var a,n;let o="Erro desconhecido";try{P.show({spinner:T,spinnerColor:"amber",message:"Emitindo cupom"}),e.incluirCpfCnpjNoCupom||(e.idEmpresa="",e.cpfCnpj="",e.nomeCliente=""),o="Ocorreu um erro ao gerar o cupom";const{objetoJson:t,dados:s}=await z.gerar(e.idFatura,1,e.cpfCnpj,e.nomeCliente);m(!t,o);for(const f of s.alertas)this.$q.notify({message:f,textColor:"black",type:"warning"});o="Ocorreu um erro ao emitir o cupom";const u=[(a=s==null?void 0:s.documentoFatura)!=null?a:{},...(n=s==null?void 0:s.documentosVendas)!=null?n:[]].find(f=>f.id===s.idDocumento),c=await S.emitirSat(JSON.stringify(t),u);m(c.status==="Erro",c.mensagem),this.$q.notifyPositive(c.mensagem),o="Ocorreu um erro ao gravar os dados do cupom",await z.salvarRetornoEmissao(s,c.chaveCFe,c.xml),(c==null?void 0:c.versaoIntegrador)==="V2"&&await S.imprimirSat(c.xml,s.empresa.id)}catch(t){this.$q.notifyError(o,t)}finally{!this.modalItemTrocarCest.visivel&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null),await this.atualiza(),P.hide()}},async emitirCupomNFCeConfirma(e){let o="Erro ao emitir Cupom NFCe",a,n;try{if(P.show({spinner:T,spinnerColor:"amber",message:"Selecionando Certificado e Emitindo o Cupom NFCe"}),e.incluirCpfCnpjNoCupom||(e.idEmpresa="",e.cpfCnpj="",e.nomeCliente=""),o="Ocorreu um erro ao gerar o Cupom NFCe",n=await W.gerarJson(e.idFatura,e.cpfCnpj,e.nomeCliente),m(!n,o),n.erros.length){$g.modalAlerta.show({titulo:"Erro de valida\xE7\xE3o",erros:n.erros});return}if(await this.verificarCestEmST(n))return;for(const t of n.alertas)this.$q.notify({message:t,textColor:"black",type:"warning"});if(o="Ocorreu um erro ao emitir o Cupom NFCe",a=await S.emitirNFCe(n,n.empresaPlat.hashCSC,n.empresaPlat.tokenCSC),a.status==="Erro"){const t=[...(a.mensagem||"").split(`
`),...(a.complemento||"").split(`
`)];$g.modalAlerta.show({titulo:a.status,erros:t});return}this.$q.notifyPositive(a.mensagem)}catch(t){this.$q.notifyError(o,t);return}finally{P.hide(),!this.modalItemTrocarCest.visivel&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null),this.atualiza()}try{const t=await S.imprimirNFCe(a.xml,n.outrosNFe.idContatoEmitente);t.status==="Erro"&&console.error(`Erro ao imprimir NFCe
`,t.mensagem)}catch(t){console.error(`Erro ao imprimir NFCe
`,t.toString())}},async reimprimirSat(e){try{P.show({spinner:T,spinnerColor:"amber",message:"Imprimindo cupom"});const o=this.documentosSat.find(n=>n.id===e),a=o.cancelamento?await S.imprimirCancelamentoSat(o.xml,o.idEmpresa):await S.imprimirSat(o.xml,o.idEmpresa);m(a.status==="Erro",a.mensagem),this.$q.notifyPositive(a.mensagem)}catch(o){this.$q.notifyError("Ocorreu um erro ao imprimir o cupom",o)}finally{P.hide()}},async reimprimirNFCe(e){try{P.show({spinner:T,spinnerColor:"amber",message:"Imprimindo NFCe"});const o=await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:e,status:"Sucesso",situacao:"Emitido"}});m(!o||!o.length||!o[0].xmlProt,"Ocorreu um erro ao carregar o xml da NFCe");const a=JSON.parse(o[0].json),n=await S.imprimirNFCe(o[0].xmlProt,a.outrosNFe.idContatoEmitente);m(n.status==="Erro",n.mensagem),n.mensagem&&this.$q.notifyPositive(n.mensagem)}catch(o){this.$q.notifyError("Ocorreu um erro ao imprimir o NFCe",o)}finally{P.hide()}},async verificarCestEmST(e){if(await q.configuracoes.leValorNumerico("imposto.versao")!==2)return!1;const a=[];for(const n of e.infNFe.det){const t=$lodash.get(n,"prod.noXml_id"),s=$lodash.get(n,"prod.opcional.CEST"),u=$lodash.get(n,"imposto.noXml_CSOSN")||$lodash.get(n,"imposto.noXml_CST");["10","20","60","70","201","202","500"].includes(u)&&!s&&a.push(t)}return a.length===0?!1:(this.modalItemTrocarCest={visivel:!0,campos:{ids:a}},!0)},verNoSefaz(e){window.open(e,"_blank")},onResize(){this.width=window.innerWidth}},props:{idFatura:{required:!1,type:String},idVenda:{required:!1,type:String}},watch:{idFatura(){this.atualiza()},"cpfCnpjNoCupom.visivel"(e){!e&&this.cpfCnpjNoCupom.concluir&&(this.cpfCnpjNoCupom.concluir(),this.cpfCnpjNoCupom.concluir=null)},"modalItemTrocarCest.visivel"(e){!e&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null)}},async mounted(){$utils.emitter.on("atualizarDocumentosFiscais",this.atualiza),await this.atualiza(),this.quantidadeDocumentos=this.documentosSat.length+this.documentosFiscais.length+this.documentosNFe.length||0},beforeUnmount(){$utils.emitter.off("atualizarDocumentosFiscais",this.atualiza)}};function Ve(e,o,a,n,t,s){const u=I("g-label"),c=I("badge"),f=I("CpfCnpjNoCupom"),b=I("ItemTrocarCest");return C(),k("div",null,[i(fe,{onResize:s.onResize},null,8,["onResize"]),!!t.documentosSat.length||!!t.documentosFiscais.length||!!t.documentosNFe.length?(C(),N(u,{key:0,icon:`account_balance ${t.width<=992?"13px":"xs"} tertiary`,text:"sub2 medium",class:"q-mb-sm",caption:t.width<=992},{default:r(()=>o[2]||(o[2]=[p(" Documentos fiscais ")])),_:1},8,["icon","caption"])):D("",!0),t.documentosSat.length?(C(),N($,{key:1},{default:r(()=>[(C(!0),k(A,null,M(t.documentosSat,l=>(C(),N(y,{key:l.id,class:R([`${t.quantidadeDocumentos>1?"border-bottom":""}`,"q-px-sm q-py-none q-mb-md"])},{default:r(()=>[i(d,null,{default:r(()=>[i(h,{class:"text-weight-medium",caption:t.width<=992},{default:r(()=>[p(g(t.hwDest),1)]),_:1},8,["caption"]),i(h,{caption:t.width<=992},{default:r(()=>[i(c,{rotulo:"#"+l.numeroCupom,cor:"tertiary",escuro:"",class:"col-auto q-ml-auto q-mr-sm"},null,8,["rotulo"]),i(c,{rotulo:l.cancelamento?"Cancelado":"Emitido",cor:l.cancelamento?"tertiary":"positive",escuro:"",class:"col-auto q-mx-auto"},null,8,["rotulo","cor"])]),_:2},1032,["caption"]),i(d,{class:"hideondesktop"},{default:r(()=>[i(h,{caption:"",class:"text-weight-medium q-pt-sm"},{default:r(()=>[p(g(e.$filters.dataHora(l.dataHoraEmissao)),1)]),_:2},1024),i(h,{class:"text-weight-medium",caption:t.width<=992},{default:r(()=>[p(g(e.$filters.numero(l.valorTotal,2)),1)]),_:2},1032,["caption"])]),_:2},1024)]),_:2},1024),i(d,{class:"maxw100 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-medium",caption:t.width<=992},{default:r(()=>[p(g(e.$filters.data(l.dataHoraEmissao)),1)]),_:2},1032,["caption"]),i(h,{caption:""},{default:r(()=>[p(g(e.$filters.hora(l.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024),i(d,{class:"maxw120 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-bold text-right",caption:t.width<=992},{default:r(()=>[p(g(e.$filters.numero(l.valorTotal,2)),1)]),_:2},1032,["caption"])]),_:2},1024),i(d,{class:"col-auto"},{default:r(()=>[i(y,{class:"q-pa-none"},{default:r(()=>[i(d,{class:"no-margin",style:{"min-width":"36.6px"}},{default:r(()=>[l.cancelamento?D("",!0):(C(),N(_,{key:0,onClick:F=>s.cancelarSat(l.id),icon:"cancel",color:"primary",round:"",dense:"",flat:""},{default:r(()=>[i(X,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(" Cancelar "+g(t.hwDest),1)]),_:1})]),_:2},1032,["onClick"]))]),_:2},1024),i(d,{class:"no-margin"},{default:r(()=>[i(_,{icon:"print",flat:"",round:"",dense:""},{default:r(()=>[i(B,null,{default:r(()=>[j((C(),N($,{link:"",separator:""},{default:r(()=>[i(y,{onClick:F=>s.reimprimirSat(l.id),clickable:""},{default:r(()=>[i(d,{avatar:""},{default:r(()=>[i(J,{name:"mdi-printer"})]),_:1}),i(d,null,{default:r(()=>[i(h,null,{default:r(()=>o[3]||(o[3]=[p("Enviar para impressora")])),_:1})]),_:1})]),_:2},1032,["onClick"]),i(y,{clickable:"",onClick:F=>e.$imprimir(`${l.cancelamento?"cfe-extrato-cancelamento":"cfe-extrato"}`,l.id)},{default:r(()=>[i(d,{avatar:""},{default:r(()=>[i(J,{name:"mdi-printer"})]),_:1}),i(d,null,{default:r(()=>[i(h,null,{default:r(()=>o[4]||(o[4]=[p("Visualizar no navegador")])),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[U]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):D("",!0),t.documentosFiscais.length?(C(),N($,{key:2},{default:r(()=>[(C(!0),k(A,null,M(t.documentosFiscais,l=>(C(),N(y,{key:l.id,class:R([`${t.quantidadeDocumentos>1?"border-bottom":""}`,"q-px-sm q-py-none q-mb-md"])},{default:r(()=>[i(d,null,{default:r(()=>[i(h,{class:"text-weight-medium",caption:t.width<=992},{default:r(()=>[p(g(l.tipo),1)]),_:2},1032,["caption"]),i(h,{caption:t.width<=992},{default:r(()=>[i(c,{rotulo:"#"+l.nNF,cor:"tertiary",escuro:"",class:"col-auto q-ml-auto q-mr-sm"},null,8,["rotulo"]),p(" "+g(l.situacao)+" "+g(l.tpAmb==="2"?"em Homologa\xE7\xE3o":"")+" "+g(l.operacao?" - "+l.operacao:""),1)]),_:2},1032,["caption"]),i(d,{class:"hideondesktop"},{default:r(()=>[i(h,{caption:"",class:"text-weight-medium q-pt-sm"},{default:r(()=>[p(g(e.$filters.dataHora(l.dataHoraEmissao)),1)]),_:2},1024),i(h,{class:"text-weight-medium",caption:t.width<=992},{default:r(()=>[p(g(e.$filters.numero(l.vNF,2)),1)]),_:2},1032,["caption"])]),_:2},1024)]),_:2},1024),i(d,{class:"maxw100 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-medium",caption:t.width<=992},{default:r(()=>[p(g(e.$filters.data(l.dataHoraEmissao)),1)]),_:2},1032,["caption"]),i(h,{caption:""},{default:r(()=>[p(g(e.$filters.hora(l.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024),i(d,{class:"maxw120 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-bold text-right",caption:t.width<=992},{default:r(()=>[p(g(e.$filters.numero(l.vNF,2)),1)]),_:2},1032,["caption"])]),_:2},1024),i(d,{class:"col-auto"},{default:r(()=>[l.tipo==="NFCe"?(C(),N(y,{key:0,class:"q-pa-none"},{default:r(()=>[i(d,{class:"no-margin",style:{"min-width":"36.6px"}},{default:r(()=>[l.situacao==="Emitido"?(C(),N(_,{key:0,flat:"",round:"",dense:"",onClick:F=>s.cancelarNFCe(l.id),color:"primary",icon:"cancel"},{default:r(()=>[i(X,{anchor:"bottom middle",self:"center middle"},{default:r(()=>o[5]||(o[5]=[p(" Cancelar ")])),_:1})]),_:2},1032,["onClick"])):D("",!0)]),_:2},1024),i(d,{class:"no-margin",style:{"min-width":"36.6px"}},{default:r(()=>[l.situacao==="Emitido"?(C(),N(_,{key:0,icon:"print",flat:"",round:"",dense:""},{default:r(()=>[i(B,null,{default:r(()=>[j((C(),N($,{link:"",separator:""},{default:r(()=>[i(y,{onClick:F=>s.reimprimirNFCe(l.id),clickable:""},{default:r(()=>[i(d,{avatar:""},{default:r(()=>[i(J,{name:"mdi-printer"})]),_:1}),i(d,null,{default:r(()=>[i(h,null,{default:r(()=>o[6]||(o[6]=[p("Enviar para impressora")])),_:1})]),_:1})]),_:2},1032,["onClick"]),i(y,{onClick:F=>e.$imprimir("nfce-danfe",l.id),clickable:""},{default:r(()=>[i(d,{avatar:""},{default:r(()=>[i(J,{name:"mdi-printer"})]),_:1}),i(d,null,{default:r(()=>[i(h,null,{default:r(()=>o[7]||(o[7]=[p("Visualizar no navegador")])),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[U]])]),_:2},1024)]),_:2},1024)):D("",!0)]),_:2},1024),i(d,{class:"no-margin"},{default:r(()=>[i(_,{onClick:F=>s.verNoSefaz(l.qrCode),dense:"",flat:"",round:"",icon:"open_in_browser",color:"primary"},{default:r(()=>[i(X,{anchor:"bottom middle",self:"center middle"},{default:r(()=>o[8]||(o[8]=[p(" Ver no Sefaz ")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):l.tipo==="NFe"?(C(),N(y,{key:1,class:"q-pa-none"},{default:r(()=>[i(d,{class:"no-margin"},{default:r(()=>[i(_,{icon:"print",flat:"",round:"",dense:""},{default:r(()=>[i(B,null,{default:r(()=>[j((C(),N($,{link:"",separator:""},{default:r(()=>[(C(!0),k(A,null,M(t.configImpressaoNFe,F=>(C(),N(y,{key:F.valor,onClick:Ae=>e.$imprimir(F.valor,l.id),clickable:""},{default:r(()=>[i(d,{avatar:""},{default:r(()=>[i(J,{name:"mdi-printer"})]),_:1}),i(d,null,{default:r(()=>[i(h,null,{default:r(()=>[p(g(F.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[U]])]),_:2},1024)]),_:2},1024),i(_,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:F=>s.abrirNFe(l.id)},{default:r(()=>[i(X,null,{default:r(()=>o[9]||(o[9]=[p("Abrir")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):D("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):D("",!0),t.documentosNFe.length?(C(),N($,{key:3},{default:r(()=>[(C(!0),k(A,null,M(t.documentosNFe,(l,F)=>(C(),N(y,{key:F,class:R([`${t.quantidadeDocumentos>1?"border-bottom":""}`,"q-px-sm q-py-none q-mb-md"])},{default:r(()=>[i(d,null,{default:r(()=>[i(h,{class:"text-weight-medium"},{default:r(()=>o[10]||(o[10]=[p(" NFe ")])),_:1}),i(h,null,{default:r(()=>[i(c,{rotulo:"#"+l.noNota,cor:"tertiary",escuro:"",class:"col-auto q-ml-auto q-mr-sm"},null,8,["rotulo"]),i(c,{rotulo:l.nfeCanceladaEvento?"Cancelado":"Emitido",cor:l.nfeCanceladaEvento?"tertiary":"positive",escuro:"",class:"col-auto q-mx-auto"},null,8,["rotulo","cor"])]),_:2},1024),i(d,{class:"hideondesktop"},{default:r(()=>[i(h,{caption:"",class:"text-weight-medium q-pt-sm"},{default:r(()=>[p(g(e.$filters.dataHora(l.horaSaidaEntrada)),1)]),_:2},1024),i(h,{class:"text-weight-medium"},{default:r(()=>[p(g(e.$filters.numero(l.valTotNota,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),i(d,{class:"maxw100 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-medium"},{default:r(()=>[p(g(e.$filters.data(l.horaSaidaEntrada)),1)]),_:2},1024),i(h,{caption:""},{default:r(()=>[p(g(e.$filters.hora(l.horaSaidaEntrada)),1)]),_:2},1024)]),_:2},1024),i(d,{class:"maxw120 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-bold text-right"},{default:r(()=>[p(g(e.$filters.numero(l.valTotNota,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):D("",!0),!t.documentosSat.length&&!t.documentosFiscais.length&&!t.documentosNFe.length?(C(),N(u,{key:4,icon:`account_balance ${t.width<=992?"15px":"xs"} tertiary`,text:"sub2 medium",caption:t.width<=992},{default:r(()=>o[11]||(o[11]=[p(" N\xE3o h\xE1 documentos emitidos ")])),_:1},8,["icon","caption"])):D("",!0),i(f,{modelValue:t.cpfCnpjNoCupom.visivel,"onUpdate:modelValue":o[0]||(o[0]=l=>t.cpfCnpjNoCupom.visivel=l),onConfirmar:s.emitirCupomConfirma,dados:t.cpfCnpjNoCupom},null,8,["modelValue","onConfirmar","dados"]),i(b,{modal:t.modalItemTrocarCest,onConfirmar:o[1]||(o[1]=l=>s.emitirCupomConfirma(t.cpfCnpjNoCupom))},null,8,["modal"])])}var Me=H($e,[["render",Ve]]);export{De as C,Me as D};
