import{_ as P,bh as j,r as g,o as m,n as v,f as u,w as V,d as B,e as N,G as H,O as Q,F as G,s as J,bb as X}from"./index.f2a220da.js";import"./xlsx.ff88a118.js";import{L as K}from"./Lista.900a9772.js";import{V as W}from"./VendaCard.27ca8a76.js";import"./QBtnDropdown.4d567ca9.js";import"./QBtnGroup.9bb155bc.js";import"./QScrollArea.b85dc45a.js";import"./emitirNFe.35117289.js";import"./DocumentosFiscais.33fbcb1f.js";import"./Campo.22f0bacd.js";import"./compactarValidarNFe.97394362.js";import"./obterItens.d48753e1.js";import"./codigosANP.a6c1a264.js";import"./ModalHistoricoStatus.63e685c7.js";const Y={components:{Lista:K,VendaCard:W,VendaModal:j},data(){return{usuario:"",permissao:{vendedoresDigitadores:!1,outrasEmpresas:!1},usaExpedicao:!1,carregar:!1,listaLayout:[],lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"mdi-cart-arrow-up",titulo:"Vendas",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},busca:"",filtrosOriginal:{},filtros:{cliente:null,idEmpresa:null,idContatoVendedor:null,idContatoDigitador:null,statusEnvio:null,tipoData:"emissao",data:{ini:"",fim:""},valorTotal:0},empresaOpcoes:[],opcoesVendedores:[],statusEnvioOpcoes:[{value:"Enviados",label:"Enviados"},{value:"N\xE3o Enviados",label:"N\xE3o Enviados"}],dataOpcoes:[{value:"emissao",label:"Data Emiss\xE3o"},{value:"finalizado",label:"Data Finalizado"},{value:"faturado",label:"Data Faturado"}],tabSelecionada:{valor:""},tabs:[{valor:"Or\xE7amento",rotulo:"Or\xE7amento"},{valor:"Aguardando Estoque",rotulo:"Ag. Estoque"},{valor:"Aguardando Financeiro",rotulo:"Ag. Financeiro"},{valor:"Aguardando Libera\xE7\xE3o",rotulo:"Ag. Libera\xE7\xE3o"},{valor:"Aguardando Pagamento,Aguardando Faturamento",rotulo:"Ag. Pagamento"},{valor:"Finalizado,Faturado,Entregue",rotulo:"Finalizado"},{valor:"N\xE3o Aprovado",rotulo:"N\xE3o Aprovado"},{valor:"",rotulo:"Todas"}],detalhesVisivel:!1,paginacao:{atual:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(i){var t,s,l,a,r,n,c,p,h,e,C,E,L,y,D,A,w,q,S,F,k,O,x,z,I,M,T;try{$q.loading.show(),this.carregar=!1,this.qtdeItensCarregados=0,this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor;let{buscarDadosRecentes:U}=i!=null?i:{},o={},f={};U&&(o=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"VendaLista_"+((t=this.usuario)==null?void 0:t.id)}),o!=null&&o._id&&(this.tabSelecionada.valor=o==null?void 0:o.tabSelecionada,this.busca=(o==null?void 0:o.busca)||null,this.filtros={cliente:((s=o==null?void 0:o.filtros)==null?void 0:s.cliente)||null,idEmpresa:((l=o==null?void 0:o.filtros)==null?void 0:l.idEmpresa)||null,idContatoVendedor:((a=o==null?void 0:o.filtros)==null?void 0:a.idContatoVendedor)||null,idContatoDigitador:((r=o==null?void 0:o.filtros)==null?void 0:r.idContatoDigitador)||null,statusEnvio:((n=o==null?void 0:o.filtros)==null?void 0:n.statusEnvio)||null,tipoData:((c=o==null?void 0:o.filtros)==null?void 0:c.tipoData)||"emissao",data:{ini:((h=(p=o==null?void 0:o.filtros)==null?void 0:p.data)==null?void 0:h.ini)||"",fim:((C=(e=o==null?void 0:o.filtros)==null?void 0:e.data)==null?void 0:C.fim)||""},valorTotal:((E=o==null?void 0:o.filtros)==null?void 0:E.valorTotal)||0},this.compareObject(this.filtrosOriginal,this.filtros)&&(this.$refs.vendaLista.filtros=!0))),this.busca=((L=this.busca)==null?void 0:L.trim())||"",this.filtros.termoBusca=this.busca,this.filtros.cliente=(D=(y=this.filtros)==null?void 0:y.cliente)==null?void 0:D.trim(),this.filtros=$utils.eliminarVazios(this.filtros),this.filtros.status=this.tabSelecionada.valor,f=$utils.clonarV2(this.filtros),this.filtros.tipoData==="emissao"&&(f.emissao={ini:(w=(A=this.filtros)==null?void 0:A.data)==null?void 0:w.ini,fim:(S=(q=this.filtros)==null?void 0:q.data)==null?void 0:S.fim}),this.filtros.tipoData==="finalizado"&&(f.finalizado={ini:(k=(F=this.filtros)==null?void 0:F.data)==null?void 0:k.ini,fim:(x=(O=this.filtros)==null?void 0:O.data)==null?void 0:x.fim}),this.filtros.tipoData==="faturado"&&(f.faturado={ini:(I=(z=this.filtros)==null?void 0:z.data)==null?void 0:I.ini,fim:(T=(M=this.filtros)==null?void 0:M.data)==null?void 0:T.fim}),this.permissao.vendedoresDigitadores||(f.idContatoVendedor=this.usuario.id),delete f.tipoData,delete f.data,/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(this.busca)&&(delete f.termoBusca,this.tabSelecionada.valor="",this.paginacao.atual=1,this.filtros.status="",f.status="",f.idVenda=this.busca);const d=await $db.venda.leListaCompleta({filtros:f,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataHoraFinalizado","dataHoraEmissao"],dir:["desc","desc"]});let _=!0;for(const b of d==null?void 0:d.data)this.listaLayout.hasOwnProperty(b.id)||(this.listaLayout[b.id]={detalhes:!1}),this.listaLayout[b.id].detalhes||(_=!1);this.$refs.vendaLista.detalhes=_,this.lista=d==null?void 0:d.data,this.paginacao.total=d==null?void 0:d.total,this.paginacao.maximo=d==null?void 0:d.totalPages,o={_id:"VendaLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.busca,filtros:$utils.clonarV2(this.filtros)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:o})}catch{$q.notify({message:"Erro ao carregar vendas.",type:"negative"}),$q.loading.hide()}finally{this.lista.length===0&&$q.loading.hide()}},criarClick(){this.$refs.vendaModal.mostrar()},detalhesClick(){this.detalhesVisivel=!this.detalhesVisivel,this.lista.forEach(i=>{this.$refs[i.id][0].detalhesVisivel=this.detalhesVisivel,this.listaLayout[i.id].detalhes=this.detalhesVisivel})},verificarListaLayout(i){let{id:t,acao:s,estado:l}=i!=null?i:{};if(s="detalhes"){let a=!0;t&&(this.listaLayout[t].detalhes=l!=null?l:!this.listaLayout[t].detalhes);for(const r of this.lista)this.listaLayout[r.id].detalhes&&(this.$refs[r.id][0].detalhesVisivel=!0),this.listaLayout[r.id].detalhes||(a=!1);this.detalhesVisivel=a,this.$refs.vendaLista.detalhes=a}},async abrirModalContatos(){const i=await $g.promptContato.show({filtro:{ativo:!0}});!(i!=null&&i.id)||(this.filtros.cliente=i.nome)},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),this.paginacao.total=25,this.paginacao.maximo=1,await this.atualizar()},compareObject(i,t,s=[]){const l=Object.keys(i);for(const a of l)if(!s.includes(a)){if(typeof i[a]=="object"&&i[a]!==null){if(!this.compareObject(i[a],t[a],s))continue;return!0}else if(i[a]!==t[a])return!0}return!1},async configurarPermissao(){this.permissao={vendedoresDigitadores:await $db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos"),outrasEmpresas:await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")}},async configurarEmpresas(){const i=[];let t=[];if(!this.permissao.outrasEmpresas){t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;for(const s of t)i.push({label:s.nome,value:s.id})}if(this.permissao.outrasEmpresas){t=await $db.empresa.ler({filtro:{ativo:!0}});for(const s of t)i.push({label:s.nome,value:s.idContato})}this.empresaOpcoes=i==null?void 0:i.sort((s,l)=>{var a;return(a=s==null?void 0:s.label)==null?void 0:a.localeCompare(l==null?void 0:l.label)})},async configurarVendedores(){const i=(await $db.contato.ler({filtros:{ativo:!0,vendedores:!0}})).data;i==null||i.sort((t,s)=>{var l;return(l=t==null?void 0:t.nome)==null?void 0:l.localeCompare(s==null?void 0:s.nome)}),i.forEach(t=>{this.opcoesVendedores.push({label:t.nome,value:t.id})})},async configurarExpedicao(){var t;const i=await $db.configuracoes.le({nome:"vendas.usaExpedicao"});this.usaExpedicao=((t=i==null?void 0:i[0])==null?void 0:t.valor)==="1",this.usaExpedicao&&this.tabs.splice(4,0,{valor:"Aguardando Confer\xEAncia,Aguardando Corre\xE7\xE3o,Aguardando Embalagem,Aguardando Entrega,Aguardando Separa\xE7\xE3o,Em Confer\xEAncia,Em Embalagem,Em Separa\xE7\xE3o",rotulo:"Ag. Log\xEDstica"})},async abrirItem(i){this.$router.replace({params:{id:i}}).finally(()=>{this.$refs.vendaModal.mostrar({id:i})})},carregou(){this.qtdeItensCarregados=this.qtdeItensCarregados+1,this.qtdeItensCarregados===this.lista.length&&(this.carregar=!0,this.verificarListaLayout({acao:"detalhes"}),$q.loading.hide())}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),await this.configurarPermissao(),await this.configurarEmpresas(),await this.configurarVendedores(),await this.configurarExpedicao(),this.$route.params.id&&this.$route.params.id.length?(this.abrirItem(this.$route.params.id),this.busca=this.$route.params.id,await this.atualizar()):await this.atualizar({buscarDadosRecentes:!0})}},Z={id:"VendaLista"};function $(i,t,s,l,a,r){const n=g("campo"),c=g("VendaCard"),p=g("Lista"),h=g("VendaModal");return m(),v("div",Z,[u(p,{ref:"vendaLista",busca:a.busca,"onUpdate:busca":t[10]||(t[10]=e=>a.busca=e),onAtualizar:r.atualizar,onLimparFiltrosClick:r.limparFiltrosClick,onDetalhesClick:r.detalhesClick,onCriarClick:r.criarClick,lista:a.lista,tabSelecionada:a.tabSelecionada,tabs:a.tabs,paginacao:a.paginacao,mostrar:a.mostrar},{filtroCampos:V(()=>[u(n,{modelValue:a.filtros.cliente,"onUpdate:modelValue":t[0]||(t[0]=e=>a.filtros.cliente=e),debounce:500,dense:"",before:[{icon:"search",handler:r.abrirModalContatos}],rotulo:"Por cliente ou respons\xE1vel",class:"col-12 q-mt-md"},null,8,["modelValue","before"]),u(n,{modelValue:a.filtros.idEmpresa,"onUpdate:modelValue":t[1]||(t[1]=e=>a.filtros.idEmpresa=e),options:a.empresaOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Por empresa",class:"col-12 q-mt-lg"},null,8,["modelValue","options"]),a.permissao.vendedoresDigitadores?(m(),B(n,{key:0,modelValue:a.filtros.idContatoVendedor,"onUpdate:modelValue":t[2]||(t[2]=e=>a.filtros.idContatoVendedor=e),options:a.opcoesVendedores,clearable:"",dense:"",tipo:"seletor",rotulo:"Vendedor",class:"col-12 q-mt-lg"},null,8,["modelValue","options"])):N("",!0),a.permissao.vendedoresDigitadores?(m(),B(n,{key:1,modelValue:a.filtros.idContatoDigitador,"onUpdate:modelValue":t[3]||(t[3]=e=>a.filtros.idContatoDigitador=e),options:a.opcoesVendedores,clearable:"",dense:"",tipo:"seletor",rotulo:"Digitador",class:"col-12 q-mt-lg"},null,8,["modelValue","options"])):N("",!0),u(n,{modelValue:a.filtros.statusEnvio,"onUpdate:modelValue":t[4]||(t[4]=e=>a.filtros.statusEnvio=e),options:a.statusEnvioOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Status Envio",class:"col-12 q-mt-lg"},null,8,["modelValue","options"]),u(n,{modelValue:a.filtros.tipoData,"onUpdate:modelValue":t[5]||(t[5]=e=>a.filtros.tipoData=e),options:a.dataOpcoes,dense:"",tipo:"seletor",rotulo:"Selecione o tipo de data",class:"col-12 q-mt-xl"},null,8,["modelValue","options"]),u(n,{modelValue:a.filtros.data.ini,"onUpdate:modelValue":t[6]||(t[6]=e=>a.filtros.data.ini=e),clearable:"",dense:"",tipo:"data",rotulo:"De",class:"col-12 q-mt-md"},null,8,["modelValue"]),u(n,{modelValue:a.filtros.data.fim,"onUpdate:modelValue":t[7]||(t[7]=e=>a.filtros.data.fim=e),clearable:"",dense:"",tipo:"data",rotulo:"at\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),u(n,{modelValue:a.filtros.valorTotal,"onUpdate:modelValue":t[8]||(t[8]=e=>a.filtros.valorTotal=e),debounce:500,dense:"",tipo:"decimal",min:"0",decimals:"4",zerosDireita:"2",rotulo:"Valor total maior que",class:"col-12 q-mt-xl"},null,8,["modelValue"]),u(n,{modelValue:a.paginacao.limite,"onUpdate:modelValue":t[9]||(t[9]=e=>a.paginacao.limite=e),tipo:"quantidade",dense:"",min:"1",rotulo:"Quantidade por p\xE1gina",class:"col-12 q-mt-xl"},null,8,["modelValue"])]),itemLista:V(()=>[H(u(Q,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:V(()=>[(m(!0),v(G,null,J(a.lista,e=>(m(),v("div",{key:e.id,class:"itemHover"},[u(c,{onCarregou:r.carregou,ref_for:!0,ref:e.id,id:e.id,onVerificarListaLayout:r.verificarListaLayout,layout:"lista"},null,8,["onCarregou","id","onVerificarListaLayout"])]))),128))]),_:1},512),[[X,a.carregar]])]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onDetalhesClick","onCriarClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),u(h,{continueMesmaTela:!1,ref:"vendaModal"},null,512)])}var pa=P(Y,[["render",$]]);export{pa as default};
