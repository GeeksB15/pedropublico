import{_ as R,d8 as Q,r as v,o as u,n as x,f as a,w as o,as as P,O as S,F as w,s as I,R as E,S as d,B as N,T as C,k as n,t as m,m as b,d as g,e as _,j as z,dZ as O,Q as q,az as L,G as A,M as j,l as M}from"./index.9b156bba.js";import{L as G}from"./Lista.e33ba20c.js";import{F as J}from"./FaturaModal.c2a34fd1.js";import"./QBtnDropdown.2d29d66b.js";import"./QBtnGroup.4d3a3d67.js";import"./QScrollArea.e1ed3c28.js";import"./DocumentosFiscais.9a161678.js";import"./Campo.7909a0e7.js";import"./compactarValidarNFe.d3892009.js";import"./obterItens.68ea9ec4.js";import"./codigosANP.a6c1a264.js";import"./emitirNFe.35117289.js";import"./VendaCard.9cec35eb.js";import"./ModalHistoricoStatus.d2a763d2.js";import"./EnvelopeCard.c011f679.js";const X={components:{Lista:G,Envelope:Q,Fatura:J},data(){return{carregando:!1,lista:[],contatos:{},configImpressaoEnvelope:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"mdi-glasses",titulo:"Envelopes",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},tabSelecionada:{valor:"Todos"},tabs:[{valor:"Todos",rotulo:"Todos"},{valor:"Or\xE7amento",rotulo:"Or\xE7amento"},{valor:"Processando",rotulo:"Processando"},{valor:"Translado Loja para Pedido",rotulo:"Translado Loja para Pedido"},{valor:"Translado Pedido para Loja",rotulo:"Translado Pedido para Loja"},{valor:"Aguardando Retorno",rotulo:"Aguardando Retorno"},{valor:"Processando Montagem",rotulo:"Processando Montagem"},{valor:"Pronto para Entrega",rotulo:"Pronto para Entrega"},{valor:"Cliente Informado",rotulo:"Cliente Informado"},{valor:"Entregue",rotulo:"Entregues"}],busca:"",filtros:{termoBusca:null,frase:null,numeroEnvelope:null,numeroOrdemCompra:null,prazoSelecionado:null,empresaSelecionada:null,status:null,dataHoraEmissao:{ini:null,fim:null},dataHoraPrevisto:{ini:null,fim:null},dataHoraFinalizado:{ini:null,fim:null}},empresaOpcoes:[],prazoOpcoes:[{label:"Entrega para pr\xF3ximas semanas",value:"adiantadoEntrega"},{label:"Entrega para esta semana",value:"proximaEntrega"},{label:"Entrega atrasada",value:"atrasadoEntrega"}],paginacao:{atual:1,maximo:1,total:1,limite:25,ordenacao:["descricaoConcatenada"]}}},methods:{async atualizar(r){var p;const t=$utils.logarIni("EnvelopeLista");try{$q.loading.show(),this.carregando=!0,this.lista=[];const{tabSelecionada:i,buscarDadosRecentes:l}=r!=null?r:{};let s,c=["dataHoraEmissao","dataHoraFinalizado"],k=["desc","desc"];l&&(s=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"ListaDeEnvelopes"}),s!=null&&s._id&&(this.tabSelecionada.valor=s.tabSelecionada,this.filtros=s.filtros,this.busca=s.termoBusca,this.paginacao.limite=s.limit,c=s.sort,k=s.dir));let y=$utils.eliminarVazios(this.filtros);i!=null&&i.valor&&(this.tabSelecionada.valor=i.valor),y.status=this.tabSelecionada.valor,y.termoBusca=this.busca;const h=await $db.envelope.leListaCompleta({filtros:y,limit:this.paginacao.limite,page:this.paginacao.atual,sort:c,dir:k});this.lista=h.data.vendas,this.contatos=h.data.contatos,this.paginacao.total=h.total,this.paginacao.maximo=h.totalPages;const V=localStorage.getItem("idFatura");localStorage.removeItem("idFatura"),this.lista.some(F=>F.idFatura===V)&&this.abrirFatura(V),$db.hibrido.isOnline()&&this.carregarImagensContatos(this.contatos),s!=null&&s._id||(s={_id:"ListaDeEnvelopes",tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(y),termoBusca:this.busca,limit:this.paginacao.limite,sort:c,dir:k},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:s})),$utils.logarFim(t,((p=this.lista)==null?void 0:p.length)||0)}catch(i){$q.notifyError("Ocorreu um erro ao consultar envelopes."),console.error(i)}finally{$q.loading.hide(),this.carregando=!1}},async carregarImagensContatos(r){const t=Object.keys(r);if(!!t.length){await $utils.dormir(200);try{const p=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:t}});for(const i of p)r[i.id].imagem=i.imagem||""}catch(p){console.error("Erro ao carregar imagens de contatos - ",p)}}},async configuraImpressoes(r){await this.configuraImpressaoEnvelope(r)},imprimir(r,t){$imprimir(r,t.id),this.configImpressaoEnvelope=[]},async configuraImpressaoEnvelope(r){const t=await $db.configuracoes.porNome("impressao.envelope",r.idEmpresa);this.configImpressaoEnvelope=[...t.length?t.map(p=>({texto:"Imprimir Envelope",...p})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async empresaOpcoesCarregar(){const r=JSON.parse(localStorage.getItem("clienteSistema"));$utils.verificarErro(!r,"Ocorreu erro ao consultar clienteSistema");const t=await $db.empresa.leOnlinePlat({codigoClienteSistema:r.codigoClienteSistema});for(const i of t){const l=await $db.contato.leOnline({codigoContato:i.codigoContato});i.contato=l[0]||{}}let p=[];for(const i of t)i.sigla&&p.push({nome:`${i.sigla} - ${i.contato.apelido}`,codigoContato:i.contato.codigoContato,id:i.contato.id}),i.sigla||p.push({nome:`${i.contato.apelido} - ${i.contato.numeroDocumentoNacional}`,codigoContato:i.contato.codigoContato,id:i.contato.id});this.empresaOpcoes=p.map(i=>({label:i.nome,value:i.codigoContato,id:i.id}))},async abrirEnvelope(r){await this.$refs.envelope.mostrar({idEnvelope:r}),r&&this.$router.push({params:{id:r}})},abrirFatura(r){this.$refs.fatura.mostrar({id:r})},limparRota(){this.$router.push({params:{id:""}})},limparFiltrosClick(){this.filtros={termoBusca:null,frase:null,numeroEnvelope:null,numeroOrdemCompra:null,prazoSelecionado:null,empresaSelecionada:null,status:null,dataHoraEmissao:{ini:null,fim:null},dataHoraPrevisto:{ini:null,fim:null},dataHoraFinalizado:{ini:null,fim:null}},this.atualizar()}},async mounted(){this.empresaOpcoesCarregar(),this.atualizar({buscarDadosRecentes:!0}),this.$route.params.id&&await this.abrirEnvelope(this.$route.params.id)}},Z={id:"EnvelopeLista"},K={class:"mw80 text-center"};function W(r,t,p,i,l,s){const c=v("campo"),k=v("badgeCopiarUid"),y=v("avatar"),h=v("g-col"),V=v("badge"),F=v("g-row"),H=v("g-label"),T=v("Lista"),U=v("Envelope"),B=v("Fatura");return u(),x("div",Z,[a(T,{busca:l.busca,"onUpdate:busca":t[12]||(t[12]=e=>l.busca=e),onAtualizar:s.atualizar,onCriarClick:s.abrirEnvelope,onLimparFiltrosClick:s.limparFiltrosClick,carregando:l.carregando,lista:l.lista,tabSelecionada:l.tabSelecionada,tabs:l.tabs,paginacao:l.paginacao,mostrar:l.mostrar},{filtroCampos:o(()=>[a(c,{modelValue:l.filtros.frase,"onUpdate:modelValue":t[0]||(t[0]=e=>l.filtros.frase=e),rotulo:"Por cliente, paciente ou respons\xE1vel",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(c,{modelValue:l.filtros.numeroEnvelope,"onUpdate:modelValue":t[1]||(t[1]=e=>l.filtros.numeroEnvelope=e),rotulo:"N\xFAmero Envelope",dense:"",tipo:"decimal",decimals:"0",zerosDireita:"0",class:"q-field--with-bottom"},null,8,["modelValue"]),a(c,{modelValue:l.filtros.numeroOrdemCompra,"onUpdate:modelValue":t[2]||(t[2]=e=>l.filtros.numeroOrdemCompra=e),rotulo:"N\xFAmero Ordem Compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(P,{modelValue:l.filtros.prazoSelecionado,"onUpdate:modelValue":t[3]||(t[3]=e=>l.filtros.prazoSelecionado=e),options:l.prazoOpcoes,clearable:"",dense:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","options"]),a(P,{modelValue:l.filtros.empresaSelecionada,"onUpdate:modelValue":t[4]||(t[4]=e=>l.filtros.empresaSelecionada=e),options:l.empresaOpcoes,label:"Por empresa",clearable:"",dense:"",class:"q-mb-xl"},null,8,["modelValue","options"]),a(c,{modelValue:l.filtros.dataHoraEmissao.ini,"onUpdate:modelValue":t[5]||(t[5]=e=>l.filtros.dataHoraEmissao.ini=e),rotulo:"Data cria\xE7\xE3o",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),a(c,{modelValue:l.filtros.dataHoraEmissao.fim,"onUpdate:modelValue":t[6]||(t[6]=e=>l.filtros.dataHoraEmissao.fim=e),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),a(c,{modelValue:l.filtros.dataHoraPrevisto.ini,"onUpdate:modelValue":t[7]||(t[7]=e=>l.filtros.dataHoraPrevisto.ini=e),rotulo:"Data previs\xE3o",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),a(c,{modelValue:l.filtros.dataHoraPrevisto.fim,"onUpdate:modelValue":t[8]||(t[8]=e=>l.filtros.dataHoraPrevisto.fim=e),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),a(c,{modelValue:l.filtros.dataHoraFinalizado.ini,"onUpdate:modelValue":t[9]||(t[9]=e=>l.filtros.dataHoraFinalizado.ini=e),rotulo:`Data
          finalizado`,tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),a(c,{modelValue:l.filtros.dataHoraFinalizado.fim,"onUpdate:modelValue":t[10]||(t[10]=e=>l.filtros.dataHoraFinalizado.fim=e),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),a(c,{modelValue:l.paginacao.limite,"onUpdate:modelValue":t[11]||(t[11]=e=>l.paginacao.limite=e),rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",min:"1",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:o(()=>[a(S,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:o(()=>[(u(!0),x(w,null,I(l.lista,e=>(u(),x("div",{key:e.id,class:"itemHover"},[a(E,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:o(()=>[a(d,{class:"hideonmobile col-auto q-pa-none"},{default:o(()=>[N("div",K,[a(k,{id:e.id,numero:e.numero,cor:"positive",dica:"N\xFAmero Envelope"},null,8,["id","numero"])])]),_:2},1024),a(d,{class:"col-md col-lg col-xl no-margin"},{default:o(()=>[a(E,{class:"q-pa-none"},{default:o(()=>[a(d,{class:"col-auto items-center"},{default:o(()=>[a(y,{imagem:(l.contatos[e.idContato]||{}).imagem,rotulo:e.descricaoContato,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1024),a(d,{class:"col"},{default:o(()=>[a(C,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:o(()=>[n(m(e.descricaoContato)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Paciente")]),_:1})]),_:2},1024),e.idContatoResponsavel!==e.idContato&&l.contatos[e.idContatoResponsavel]?(u(),g(C,{key:0,lines:"2",class:"text-weight-medium ellipsis-2-lines",caption:""},{default:o(()=>[n(m(l.contatos[e.idContatoResponsavel].nome)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Respons\xE1vel")]),_:1})]),_:2},1024)):_("",!0),a(d,{class:"hideondesktop q-mt-sm"},{default:o(()=>[a(F,{mg:"xs-b"},{default:o(()=>[a(h,{col:"sm-shrink"},{default:o(()=>[a(k,{id:e.id,numero:e.numero,cor:"positive",dica:"N\xFAmero Envelope",class:"q-mr-sm"},null,8,["id","numero"])]),_:2},1024),a(h,{col:"sm-shrink"},{default:o(()=>[a(V,{cor:e.status==="Entregue"?"positive":"light",escuro:e.status==="Entregue",class:"q-mr-sm"},{default:o(()=>[n(m(e.status)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Status")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1024)]),_:2},1024),a(F,{mg:"xs-b"},{default:o(()=>[a(h,{col:"xs12 sm-shrink"},{default:o(()=>[e.dataHoraEmissao?(u(),g(H,{key:0,inline:"",tip:"Empresa",icon:"business xs tertiary left"},{default:o(()=>[n(m(e.descricaoEmpresa),1)]),_:2},1024)):_("",!0)]),_:2},1024),a(h,{col:"xs12",mg:"xs-t"},{default:o(()=>[e.dataHoraEmissao?(u(),g(H,{key:0,tip:`Criado \xE1s ${r.$filters.hora(e.dataHoraEmissao)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:o(()=>[n(m(r.$filters.data(e.dataHoraEmissao)),1)]),_:2},1032,["tip"])):_("",!0),e.dataHoraPrevisto?(u(),g(H,{key:1,tip:"Previs\xE3o para entrega",icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:o(()=>[n(m(r.$filters.data(e.dataHoraPrevisto)),1)]),_:2},1024)):_("",!0),e.dataHoraFinalizado?(u(),g(H,{key:2,tip:`Finalizado \xE1s ${r.$filters.hora(e.dataHoraFinalizado)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:o(()=>[n(m(r.$filters.data(e.dataHoraFinalizado)),1)]),_:2},1032,["tip"])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:o(()=>[e.dataHoraEmissao?(u(),g(C,{key:0,color:"tertiary",lines:"1",class:"ellipsis"},{default:o(()=>[a(z,{name:"mdi-calendar-today"}),n(" "+m(r.$filters.data(e.dataHoraEmissao))+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n(" Criado \xE1s "+m(r.$filters.hora(e.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1024),a(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:o(()=>[e.dataHoraPrevisto?(u(),g(C,{key:0,color:"tertiary",lines:"1",class:"ellipsis"},{default:o(()=>[a(z,{name:"mdi-calendar-today"}),n(" "+m(r.$filters.data(e.dataHoraPrevisto))+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Previs\xE3o para entrega")]),_:1})]),_:2},1024)):_("",!0)]),_:2},1024),a(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:o(()=>[e.dataHoraFinalizado?(u(),g(C,{key:0,color:"tertiary",lines:"1",class:"ellipsis"},{default:o(()=>[a(z,{name:"mdi-calendar-today"}),n(" "+m(r.$filters.data(e.dataHoraFinalizado))+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n(" Finalizado \xE1s "+m(r.$filters.hora(e.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1024),a(d,{class:"hideonmobile maxw170 q-pl-sm no-margin"},{default:o(()=>[a(V,{cor:e.status==="Entregue"?"positive":"light",escuro:e.status==="Entregue",class:"col-auto q-mx-auto"},{default:o(()=>[n(m(e.status)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Status")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1024),a(d,{class:"hideonmobile col-shrink q-pl-sm no-margin"},{default:o(()=>[a(E,{class:"q-pa-none"},{default:o(()=>[a(d,{class:"col-shrink"},{default:o(()=>[a(O,{color:"light","text-color":"tertiary",icon:"business",size:"md"},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n(" Empresa: "+m(e.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"col-shrink"},{default:o(()=>[a(O,{color:"light","text-color":"tertiary",icon:"person",size:"md"},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>{var f;return[n(" Respons\xE1vel: "+m(((f=l.contatos[e.idContatoResponsavel])==null?void 0:f.nome)||""),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"hideonmobile col-shrink q-pl-sm no-margin"},{default:o(()=>[a(E,{class:"q-pa-none"},{default:o(()=>[a(d,{style:{width:"32px"}},{default:o(()=>[a(q,{onClick:f=>s.abrirEnvelope(e.id),size:"md",color:"primary",round:"",flat:"",dense:"",icon:e.dataHoraFinalizado?"remove_red_eye":"edit"},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Editar")]),_:1})]),_:2},1032,["onClick","icon"])]),_:2},1024),a(d,{style:{width:"32px"}},{default:o(()=>[a(q,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",size:"md",onClick:s.configuraImpressoes},{default:o(()=>[a(L,null,{default:o(()=>[a(S,{link:"",separator:""},{default:o(()=>[(u(!0),x(w,null,I(l.configImpressaoEnvelope,f=>(u(),g(E,{key:f.valor,onClick:D=>s.imprimir(f.valor,e),clickable:""},{default:o(()=>[a(d,{avatar:""},{default:o(()=>[a(z,{name:"print"})]),_:1}),a(d,null,{default:o(()=>[a(C,null,{default:o(()=>[n(m(f.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024),a(d,{style:{width:"32px"}},{default:o(()=>[e.idFatura?(u(),g(q,{key:0,onClick:f=>s.abrirFatura(e.idFatura),icon:"how_to_vote",size:"md",color:"primary",round:"",flat:"",dense:""},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Fatura")]),_:1})]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:o(()=>[a(E,{class:"q-pa-none"},{default:o(()=>[a(d,{class:"no-margin"},{default:o(()=>[a(q,{icon:"more_vert",size:"md",round:"",flat:"",dense:"",onClick:s.configuraImpressoes},{default:o(()=>[a(L,null,{default:o(()=>[A((u(),g(S,{link:"","no-border":"",separator:""},{default:o(()=>[a(E,{clickable:"",onClick:f=>s.abrirEnvelope(e.id)},{default:o(()=>[a(d,{avatar:""},{default:o(()=>[a(z,{name:"edit"})]),_:1}),a(d,null,{default:o(()=>[n("Editar")]),_:1})]),_:2},1032,["onClick"]),(u(!0),x(w,null,I(l.configImpressaoEnvelope,f=>(u(),g(E,{clickable:"",key:f.valor,onClick:D=>s.imprimir(f.valor,e)},{default:o(()=>[a(d,{avatar:""},{default:o(()=>[a(z,{name:"print"})]),_:1}),a(d,null,{default:o(()=>[a(C,null,{default:o(()=>[n(m(f.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[j]])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(M)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onCriarClick","onLimparFiltrosClick","carregando","lista","tabSelecionada","tabs","paginacao","mostrar"]),a(U,{onAtualizar:t[13]||(t[13]=e=>s.atualizar({tabSelecionada:{valor:"Todos"}})),onFechou:s.limparRota,ref:"envelope"},null,8,["onFechou"]),a(B,{onExecutar:t[14]||(t[14]=e=>s.atualizar({tabSelecionada:{valor:"Todos"}})),ref:"fatura"},null,512)])}var pa=R(X,[["render",W]]);export{pa as default};
