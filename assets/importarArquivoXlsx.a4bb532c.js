import{c9 as N,cb as b,c4 as U,ap as D}from"./index.129a5639.js";import{X as S}from"./xlsx.38714f5b.js";const T=function(e){return typeof e=="string"&&(e=U(e,"DD/MM/YYYY HH:mm:ss.SSS")),typeof e=="number"&&(e=new Date((e-25569)*24*60*60*1e3+new Date().getTimezoneOffset()*60*1e3)),!e||isNaN(e)?"":D.formatDate(e)},E=function(e,t=!1){return e==null?t:typeof e=="boolean"?e:typeof e=="string"?e.trim().toUpperCase()==="NULL"?t:["SIM","1"].includes(e.trim().toUpperCase())?!0:["N\xC3O","NAO","0"].includes(e.trim().toUpperCase())?!1:t:typeof e=="number"?e!==0:t},x=function(e,t=0){return e==null?t:typeof e=="number"?e:typeof e=="string"?e.trim().toUpperCase()==="NULL"?t:+e||t:t},d=function(e,t=""){return e==null?t:typeof e=="number"?e.toString():typeof e=="string"?e.trim().toUpperCase()==="NULL"?t:e.trim():t},P=function(e){let t=e?String(e).trim():"";return(t.toUpperCase()==="NULL"||t.length!==36)&&(t=""),t},X=function(e,t){switch(t.tipo||"texto"){case"decimal":case"dinheiro":case"numerico":case"quantidade":return x(e,t.valorInicial);case"seletor":return t.tipo2==="numerico"?x(e,t.valorInicial):d(e,t.valorInicial);case"texto":case"textoArea":return d(e,t.valorInicial);case"id":return P(e);case"dataHora":return T(e);case"logico":return E(e,t.valorInicial)}return null},y=function(e,t){const c=e.Sheets[t],u=c["!ref"];let f=Number(u.match(/\d+/g)[1]),i=2;for(const n in c){const r=Number((n.match(/\d+/g)||["0"])[0]);r>i&&(i=r)}c["!ref"]=u.replace(String(f),String(i));const o=S.utils.sheet_to_json(c,{header:1});if(!o||o.length===0)throw new N(`Planilha inv\xE1lida! N\xE3o possui aba ${t}.`);const s=o[0].map(L);let a=[];for(let n in o)if(n!=="0"){var m={};for(let r in o[n])m[s[r]]=o[n][r];a.push(m)}return a},Y=async function(e,t,c,u,f){let i;try{i=S.read(e,{type:"binary"})}catch{throw new N("Planilha inv\xE1lida! N\xE3o possui formato xlsx v\xE1lido.")}const o=y(i,"Config"),s=y(i,"Dados"),a=b(o.filter(n=>n.Importar==="Sim"),"Operacao"),m=o.filter(n=>n.Importar==="Sim"&&n.Chave==="Sim").map(n=>C(n.CampoTabela));for(const n in s)try{let r=!1;const p={chaves:m};for(const w in a){const g=b(a[w],"Tabela");for(const l in g){const h=O(s[n],g[l],t[l]||{});h.incluir&&(p[l]=[...p[l]||[],h.campos],r=!0)}}r&&await c(p)}catch(r){let p="Erro na importa\xE7\xE3o";r.name&&r.message&&r.name==="ErroValidacao"?p=r.message:console.error(r),await u((+n||0)+2,p)}await f()},O=function(e,t,c){const u={};let f=!1;for(const i of t){const o=C(i.CampoTabela);let s=null;if(i.Tipo==="Fixo")s=i.CampoExcel;else{const a=L(d(i.CampoExcel));a&&a in e&&(s=e[a],f=!0)}s!==null&&(u[o]=X(s,c[o]||{}))}return{incluir:f,campos:u}},C=e=>e===e.toUpperCase()?e:e[0].toLowerCase()+e.substring(1),L=e=>e.replace(/ /g,"");export{Y as i};
