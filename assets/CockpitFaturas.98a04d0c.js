import{_ as D,c4 as k,r as x,o as n,n as l,f as r,w as d,B as c,j as A,d as F,Q as P,ax as E,G as I,R as S,S as v,k as U,M as q,e as m,y as O,z as C,bC as h,F as y,s as _,O as Q,aV as T}from"./index.129a5639.js";import{F as H}from"./FaturaCard.328e47d3.js";import{G as N}from"./GChipsV2.1a9b23b5.js";import{n as j}from"./nfePrincipal.b7eb5c87.js";import{J as R}from"./JsonViewer.a65c2dba.js";import"./emitirNFe.35117289.js";import"./FaturaModal.3d745322.js";import"./DocumentosFiscais.765df2e1.js";import"./Campo.2ebba21e.js";import"./compactarValidarNFe.c3faa32e.js";import"./obterItens.7428dd74.js";import"./codigosANP.a6c1a264.js";import"./VendaCard.95088836.js";import"./ModalHistoricoStatus.29ca6929.js";import"./EnvelopeCard.bfc1726f.js";import"./QSpinnerHourglass.6be5d7d8.js";import"./QSpinnerDots.371d3f23.js";const B={components:{FaturaCard:H,GChipsV2:N,nfePrincipal:j,JsonViewer:R},computed:{temFaturasAbertas(){return!!this.faturasAbertas.length},temFaturasFinalizadas(){return!!this.faturasFinalizadas.length},temFaturasCanceladas(){return!!this.faturasCanceladas.length},temRegistros(){return this.temFaturasAbertas||this.temFaturasFinalizadas||this.temFaturasCanceladas}},data(){return{grupos:[],faturasAbertas:[],faturasFinalizadas:[],faturasCanceladas:[],filtro:{},dataIni:null,dataFim:null,carregando:!1,pagination:{maxPages:7,perPage:5,faturasAbertas:{page:1,min:1,max:1},faturasFinalizadas:{page:1,min:1,max:1},faturasCanceladas:{page:1,min:1,max:1}}}},methods:{async atualizar(){this.faturas=[],this.carregando=!0,await $utils.dormir(500),await this.filtrar(),this.carregando=!1},executar(s){this.atualizar()},fechouNFe(s){s&&$utils.emitter.emit("atualizarDocumentosFiscais")},async filtrar(){let s=[],i=[],p=[];i=await $erp().empresa.toArray(),i.length&&(p=await $erp().contato.where("id").anyOf(i.map(t=>t.idContato)).toArray(),p=p.filter(t=>t.ativo&&!t.excluido));let g=new Date(this.dataIni).toISOString().replace(/T.*/,"T00:00:00.000Z"),a=new Date(this.dataFim).toISOString().replace(/T.*/,"T23:59:59.999Z");for(const t of p)await $erp().documento.where(["tipo","idEmpresa","dataHoraFinalizado"]).between(["Fatura",t.id,g],["Fatura",t.id,a],!0,!0).each(o=>{s.push(o)}),await $erp().documento.where(["tipo","idEmpresa","dataHoraEmissao"]).between(["Fatura",t.id,g],["Fatura",t.id,a],!0,!0).each(o=>{s.find(z=>z.id===o.id)||s.push(o)});await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")||(p=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,s=s.filter(t=>p.find(o=>o.id===t.idEmpresa)));for(let t of this.grupos)t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(),/^\d+$/gi.test(t)?s=s.filter(o=>[o.numero,o.codigoDocumento].includes(Number(t))):s=s.filter(o=>((o.descricaoContato||"")+(o.descricaoEmpresa||"")).normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().search(t)!==-1);s=$lodash.orderBy(s,"dataHoraEmissao","desc");const b=s.filter(t=>t.status==="Aberta");g=new Date(new Date(g).toDateString()),a=new Date(new Date(a).toDateString());const f=s.filter(t=>{if(~["Aberta","Cancelada"].indexOf(t.status)||!t.dataHoraFinalizado)return!1;const o=new Date(new Date(t.dataHoraFinalizado).toDateString());return!(o<g||o>a)}),V=s.filter(t=>{if(t.status!=="Cancelada"||!t.dataHoraFinalizado)return!1;const o=new Date(new Date(t.dataHoraFinalizado).toDateString());return!(o<g||o>a)});this.pagination.faturasAbertas.max=(b.length/5|0)+(b.length%5>0?1:0),this.pagination.faturasFinalizadas.max=(f.length/5|0)+(f.length%5>0?1:0),this.pagination.faturasCanceladas.max=(V.length/5|0)+(V.length%5>0?1:0),this.faturasAbertas=b,this.faturasFinalizadas=f,this.faturasCanceladas=V},async limparFiltro(){this.grupos=[],this.dataFim=new Date,this.dataIni=new Date(k().add(-7,"days"))},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},watch:{"$route.params.id"(s){!~this.$route.name.indexOf("CockpitFaturas")||(this.limparFiltro(),this.atualizar())}},async mounted(){if(this.$route.params.id){if(this.limparFiltro(),this.periodo&&this.periodo.ini&&this.periodo.fim){const s=new Date(new Date().setHours(0,0,0,0)).toISOString().replace(/\d{4}-\d{2}-\d{2}/g,"");this.dataIni=this.periodo.ini.replace(/T.+$/g,s),this.dataFim=this.periodo.fim.replace(/T.+$/g,s)}this.atualizar()}}},L={class:"AtendimentoFatura q-pb-md"},J={class:"col-12 col-md-6"},G={class:"col"},M={class:"col"},Z={key:0,class:"col-12",style:{"margin-bottom":"50px"}},K={key:1,class:"col-12",style:{"margin-bottom":"50px"}},W={key:0,class:"col-12",style:{"margin-bottom":"50px"}},X={key:1,class:"col-12",style:{"margin-bottom":"50px"}},Y={key:0,class:"col-12",style:{"margin-bottom":"50px"}},$={key:1,class:"col-12",style:{"margin-bottom":"50px"}},aa={key:1,class:"q-pa-lg text-center"},ea={key:2,class:"q-mt-lg text-center"};function ta(s,i,p,g,a,u){const b=x("GChipsV2"),f=x("campo"),V=x("row"),t=x("fatura-card"),o=x("nfePrincipal"),z=x("JsonViewer");return n(),l("div",L,[r(O,{class:"q-pa-sm no-shadow"},{default:d(()=>[r(V,{class:"items-center q-col-gutter-md"},{default:d(()=>[c("div",J,[r(b,{modelValue:a.grupos,"onUpdate:modelValue":[i[0]||(i[0]=e=>a.grupos=e),u.atualizar],placeholder:"Filtre por Cliente, C\xF3digo ou N\xFAmero"},{prepend:d(()=>[r(A,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),c("div",G,[r(f,{modelValue:a.dataIni,"onUpdate:modelValue":[i[1]||(i[1]=e=>a.dataIni=e),u.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),i[11]||(i[11]=c("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[c("label",null,"at\xE9")],-1)),c("div",M,[r(f,{modelValue:a.dataFim,"onUpdate:modelValue":[i[2]||(i[2]=e=>a.dataFim=e),u.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),s.$db.usuario.desenvolvedor()?(n(),F(P,{key:0,icon:"more_vert",round:"",flat:""},{default:d(()=>[r(E,null,{default:d(()=>[I((n(),F(S,{clickable:"",onClick:i[3]||(i[3]=e=>u.mostrarJsonViewer())},{default:d(()=>[r(v,{avatar:""},{default:d(()=>[r(A,{name:"mdi-file-replace",size:"sm"})]),_:1}),r(v,null,{default:d(()=>i[10]||(i[10]=[U("Ver Objeto")])),_:1})]),_:1})),[[q]])]),_:1})]),_:1})):m("",!0)]),_:1})]),_:1}),!a.carregando&&u.temRegistros?(n(),F(Q,{key:0,class:"no-border row"},{default:d(()=>[u.temFaturasAbertas?(n(),F(C,{key:0,class:"col-12 q-mb-xl","default-opened":"",label:"Abertas (Total R$ "+s.$filters.numero(a.faturasAbertas.reduce((e,w)=>e+w.totalDocumento,0),2)+")",group:"faturasAbertas"},{default:d(()=>[a.pagination.faturasAbertas.max>1?(n(),l("div",Z,[r(h,{modelValue:a.pagination.faturasAbertas.page,"onUpdate:modelValue":i[4]||(i[4]=e=>a.pagination.faturasAbertas.page=e),min:a.pagination.faturasAbertas.min,max:a.pagination.faturasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(n(!0),l(y,null,_(a.faturasAbertas.slice((a.pagination.faturasAbertas.page-1)*a.pagination.perPage,a.pagination.faturasAbertas.page*a.pagination.perPage),e=>(n(),l("div",{key:e.id},[r(t,{id:e.id,onExecutar:u.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.faturasAbertas.max>1?(n(),l("div",K,[r(h,{modelValue:a.pagination.faturasAbertas.page,"onUpdate:modelValue":i[5]||(i[5]=e=>a.pagination.faturasAbertas.page=e),min:a.pagination.faturasAbertas.min,max:a.pagination.faturasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),u.temFaturasFinalizadas?(n(),F(C,{key:1,class:"col-12 q-mb-xl","default-opened":"",label:"Finalizadas (Total R$ "+s.$filters.numero(a.faturasFinalizadas.reduce((e,w)=>e+w.totalDocumento,0),2)+")",group:"faturasFinalizadas"},{default:d(()=>[a.pagination.faturasFinalizadas.max>1?(n(),l("div",W,[r(h,{modelValue:a.pagination.faturasFinalizadas.page,"onUpdate:modelValue":i[6]||(i[6]=e=>a.pagination.faturasFinalizadas.page=e),min:a.pagination.faturasFinalizadas.min,max:a.pagination.faturasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(n(!0),l(y,null,_(a.faturasFinalizadas.slice((a.pagination.faturasFinalizadas.page-1)*a.pagination.perPage,a.pagination.faturasFinalizadas.page*a.pagination.perPage),e=>(n(),l("div",{key:e.id},[r(t,{id:e.id,onExecutar:u.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.faturasFinalizadas.max>1?(n(),l("div",X,[r(h,{modelValue:a.pagination.faturasFinalizadas.page,"onUpdate:modelValue":i[7]||(i[7]=e=>a.pagination.faturasFinalizadas.page=e),min:a.pagination.faturasFinalizadas.min,max:a.pagination.faturasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),u.temFaturasCanceladas?(n(),F(C,{key:2,class:"col-12 q-mb-xl","default-opened":"",label:"Canceladas (Total R$ "+s.$filters.numero(a.faturasCanceladas.reduce((e,w)=>e+w.totalDocumento,0),2)+")",group:"faturasCanceladas"},{default:d(()=>[a.pagination.faturasCanceladas.max>1?(n(),l("div",Y,[r(h,{modelValue:a.pagination.faturasCanceladas.page,"onUpdate:modelValue":i[8]||(i[8]=e=>a.pagination.faturasCanceladas.page=e),min:a.pagination.faturasCanceladas.min,max:a.pagination.faturasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(n(!0),l(y,null,_(a.faturasCanceladas.slice((a.pagination.faturasCanceladas.page-1)*a.pagination.perPage,a.pagination.faturasCanceladas.page*a.pagination.perPage),e=>(n(),l("div",{key:e.id},[r(t,{id:e.id,onExecutar:u.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.faturasCanceladas.max>1?(n(),l("div",$,[r(h,{modelValue:a.pagination.faturasCanceladas.page,"onUpdate:modelValue":i[9]||(i[9]=e=>a.pagination.faturasCanceladas.page=e),min:a.pagination.faturasCanceladas.min,max:a.pagination.faturasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0)]),_:1})):m("",!0),!a.carregando&&!u.temRegistros?(n(),l("div",aa,i[12]||(i[12]=[c("p",null,[c("small",null,"Registros n\xE3o encontrados")],-1)]))):m("",!0),a.carregando?(n(),l("div",ea,[r(T,{color:"tertiary",size:50})])):m("",!0),r(o,{onFechar:u.fechouNFe},null,8,["onFechar"]),r(z,{ref:"jsonViewer"},null,512)])}var Va=D(B,[["render",ta]]);export{Va as default};
