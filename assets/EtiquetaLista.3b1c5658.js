import{_ as ie,aE as we,ai as K,r as y,o as m,d as C,w as i,az as le,f as t,O as Z,n as A,F as W,s as X,u as Ee,G as T,R as U,S as u,T as M,k as h,t as k,B as E,e as L,Q as x,W as ce,l as se,q as _e,ab as xe,dR as Se,d9 as Ve,dS as Ie,dT as ke,dU as Pe,dV as Be,dW as Te,dX as Ue,dY as Fe,aj as V,dZ as de,d_ as Ae,a7 as j,ay as Re,d$ as Ne,an as De,aa as je,v as Qe,dE as Le,e0 as ee,L as Me,D as ze,E as ue,h as te,i as me,j as F,U as Oe,M as oe,H as fe,I as pe,at as He,bd as ae,J as he,a_ as ge,C as Ge,e1 as Je,bF as $e,m as Q}from"./index.353e304f.js";import"./xlsx.5197d0f9.js";const Ke={data(){return{indexSelected:-1}},methods:{addEtiqueta(e){this.$emit("addEtiqueta",e)},async buscarItens(){this.campo.isLoading=!0,await this.erpQuery(),this.campo.isLoading=!1,this.campo.searches.length>0&&(this.indexSelected=0)},async erpQuery(){const e=this.campo;await we[e.db].carregarMemoria(),this.getReceived(e.db);const a={termoBusca:e.value,ativo:!0},r=99,n=1,o=["descricaoConcatenada"],f=(await $db.item.ler({filtros:{...a},limit:r,page:n,sort:o})).data;e.searches=f,f.length>0&&(e.showing=K(!0)),e.isLoading=!1,await this.$forceUpdate()},getReceived(e){return e==="item"?"itens":this.modalConfig.received},getChaveDescricao(e){return Object.keys(e).find(a=>a.toLowerCase().match(/(descricao|nome|apelido)/))},mostrarResultados(){if(!this.campo.searches.length)return!1;setTimeout(function(){this.campo.showing=K(!0),this.$forceUpdate()},100)},selecionarProximo(e){if(!this.campo.searches.length)return!1;this.campo.showing||(this.campo.showing=!0);let a=40,r=38;return 13===e.keyCode&&(this.indexSelected=this.indexSelected===-1&&this.campo.searches.length===1?0:this.indexSelected,this.indexSelected>-1&&(this.addEtiqueta(this.campo.searches[this.indexSelected]),this.campo.value="",this.campo.searches=[])),a===e.keyCode?this.indexSelected<this.campo.searches.length-1&&this.indexSelected++:r===e.keyCode&&this.indexSelected>0&&this.indexSelected--,!0}},props:{campo:{required:!0,type:Object},filled:{default:!1,type:Boolean},outlined:{default:!1,type:Boolean},clearable:{default:!1,type:Boolean},dense:{default:!1,type:Boolean},dark:{default:!1,type:Boolean},cor:{default:"tertiary",type:String},debounce:{default:500,type:Number}}},Ze={class:"text-tertiary text-weight-bold text-caption float-right"};function We(e,a,r,n,o,d){const f=y("avatar"),p=y("badge"),_=y("BadgeCopiarUid");return m(),C(_e,{modelValue:r.campo.value,"onUpdate:modelValue":[a[1]||(a[1]=s=>r.campo.value=s),a[2]||(a[2]=s=>d.buscarItens())],onKeydown:d.selecionarProximo,onFocus:d.mostrarResultados,loading:r.campo.isLoading,debounce:r.debounce,color:r.cor,dense:r.dense,dark:r.dark,filled:r.filled,outlined:r.outlined,clearable:r.clearable,autocomplete:"off",placeholder:"C\xF3digo de barras, descri\xE7\xE3o, etc...",ref:"adicionarProduto"},{default:i(()=>[r.campo.showing?(m(),C(le,{key:0,modelValue:r.campo.showing,"onUpdate:modelValue":a[0]||(a[0]=s=>r.campo.showing=s),"no-focus":""},{default:i(()=>[t(Z,{class:"bg-white rounded-borders",style:{"min-width":"220px",width:"auto","max-width":"320px"}},{default:i(()=>[(m(!0),A(W,null,X(r.campo.searches,(s,b)=>(m(),A("div",{key:b,class:Ee(["itemHover",{selected:o.indexSelected===b}])},[T((m(),C(U,{"manual-focus":"",class:"q-pa-sm items-center"},{default:i(()=>[t(u,{class:"col-shrink items-center"},{default:i(()=>[t(f,{imagem:s.imagem,rotulo:s.descricaoConcatenada,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1024),t(u,{class:"col"},{default:i(()=>[t(M,{caption:"",lines:"2",class:"text-tertiary text-weight-medium ellipsis-2-lines"},{default:i(()=>[h(k(s[d.getChaveDescricao(s)]),1)]),_:2},1024),t(u,{caption:"",class:"q-pt-xs no-margin"},{default:i(()=>[E("div",null,[s!=null&&s.referencia?(m(),C(p,{key:0,escuro:"",cor:"tertiary",rotulo:s==null?void 0:s.referencia,class:"q-mr-xs"},null,8,["rotulo"])):L("",!0),s!=null&&s.codigoBarras?(m(),C(p,{key:1,cor:"light",rotulo:s==null?void 0:s.codigoBarras,class:"q-mr-xs"},null,8,["rotulo"])):L("",!0)])]),_:2},1024),t(u,{class:"q-pt-xs no-margin"},{default:i(()=>[E("div",null,[t(_,{id:s==null?void 0:s.id,numero:s==null?void 0:s.codigoItem,escuro:"",cor:s!=null&&s.ativo?"positive":"tertiary",class:"q-mr-xs"},null,8,["id","numero","cor"]),E("span",Ze,k(e.$filters.numeroZerosDireita(s.valorVenda,4,2)),1)])]),_:2},1024)]),_:2},1024),t(u,{onClick:P=>d.addEtiqueta(s),class:"col-shrink"},{default:i(()=>[t(x,{icon:"mdi-tag-plus",color:"primary",flat:"",round:"",dense:""})]),_:2},1032,["onClick"])]),_:2},1024)),[[ce]]),t(se)],2))),128))]),_:1})]),_:1},8,["modelValue"])):L("",!0)]),_:1},8,["modelValue","onKeydown","onFocus","loading","debounce","color","dense","dark","filled","outlined","clearable"])}var Xe=ie(Ke,[["render",We]]),Ye=xe({name:"QFile",inheritAttrs:!1,props:{...Se,...Ve,...Ie,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ke,...Pe],setup(e,{slots:a,emit:r,attrs:n}){const{proxy:o}=De(),d=Be(),f=K(null),p=K(!1),_=Te(e),{pickFiles:s,onDragover:b,onDragleave:P,processFiles:z,getDndNode:O}=Ue({editable:d.editable,dnd:p,getFileInput:re,addFilesToQueue:ne}),H=Fe(e),g=V(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),G=V(()=>de(g.value)),l=V(()=>g.value.map(c=>c.name).join(", ")),q=V(()=>Ae(g.value.reduce((c,w)=>c+w.size,0))),v=V(()=>({totalSize:q.value,filesNumber:g.value.length,maxFiles:e.maxFiles})),R=V(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:_.value,...n,id:d.targetUid.value,disabled:d.editable.value!==!0})),N=V(()=>"q-file q-field--auto-height"+(p.value===!0?" q-file--dnd":"")),B=V(()=>e.multiple===!0&&e.append===!0);function I(c){const w=g.value.slice();w.splice(c,1),D(w)}function J(c){const w=g.value.indexOf(c);w!==-1&&I(w)}function D(c){r("update:modelValue",e.multiple===!0?c:c[0])}function ve(c){c.keyCode===13&&je(c)}function be(c){(c.keyCode===13||c.keyCode===32)&&s(c)}function re(){return f.value}function ne(c,w){const S=z(c,w,g.value,B.value),Y=re();Y!=null&&(Y.value=""),S!==void 0&&((e.multiple===!0?e.modelValue&&S.every(Ce=>g.value.includes(Ce)):e.modelValue===S[0])||D(B.value===!0?g.value.concat(S):S))}function $(){return[j("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function qe(){if(a.file!==void 0)return g.value.length===0?$():g.value.map((w,S)=>a.file({index:S,file:w,ref:this}));if(a.selected!==void 0)return g.value.length===0?$():a.selected({files:g.value,ref:this});if(e.useChips===!0)return g.value.length===0?$():g.value.map((w,S)=>j(Qe,{key:"file-"+S,removable:d.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{I(S)}},()=>j("span",{class:"ellipsis",textContent:w.name})));const c=e.displayValue!==void 0?e.displayValue:l.value;return c.length!==0?[j("div",{class:e.inputClass,style:e.inputStyle,textContent:c})]:$()}function ye(){const c={ref:f,...R.value,...H.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:ne};return e.multiple===!0&&(c.multiple=!0),j("input",c)}return Object.assign(d,{fieldClass:N,emitValue:D,hasValue:G,inputRef:f,innerValue:g,floatingLabel:V(()=>G.value===!0||de(e.displayValue)),computedCounter:V(()=>{if(e.counterLabel!==void 0)return e.counterLabel(v.value);const c=e.maxFiles;return`${g.value.length}${c!==void 0?" / "+c:""} (${q.value})`}),getControlChild:()=>O("file"),getControl:()=>{const c={ref:d.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return d.editable.value===!0&&Object.assign(c,{onDragover:b,onDragleave:P,onKeydown:ve,onKeyup:be}),j("div",c,[ye()].concat(qe()))}}),Object.assign(o,{removeAtIndex:I,removeFile:J,getNativeElement:()=>f.value}),Re(o,"nativeEl",()=>f.value),Ne(d)}});const ea={components:{SeletorCampoTabela:Le},computed:{opcoesTipo(){return ee},totalEstoqueSaldo(){return this.estoque.reduce((e,a)=>a.saldo+e,0)},showReferencia(){return this.campos.some(e=>e.name==="referencia"&&e.show)},showCodigoBarras(){return this.campos.some(e=>e.name==="codigoBarras"&&e.show)},showMarca(){return this.campos.some(e=>e.name==="marca"&&e.show)}},data(){return{show:!1,campos:[],item:{},permissaoAjusteEstoque:!1,estoque:[],fileError:!1,rules:{referencia:[async e=>await this.verificarReferenciaExistente(e)]}}},emits:["salvarContinuar","salvar","update:modelValue"],methods:{arquivoRejeitado(){this.fileError=!0,this.item.imagem=null,clearTimeout(this.fileErrorTimeout),this.fileErrorTimeout=setTimeout(()=>{this.fileError=!1,console.log("this.fileError: ",this.fileError)},2e3)},async salvar(e){var a,r;try{$q.loading.show();const n={id:$utils.uuid(),descricaoConcatenada:this.item.descricao,descricao:this.item.descricao,...this.item.referencia?{referencia:this.item.referencia}:{},...this.item.codigoBarras?{codigoBarras:this.item.codigoBarras}:{},...this.item.marca?{marca:this.item.marca}:{},...this.item.tipo?{tipo:this.item.tipo}:{},valorCustoReposicao:(a=this.item.valorCustoReposicao)!=null?a:0,valorVenda:(r=this.item.valorVenda)!=null?r:0,ativo:!0};this.item.imagem&&(n.imagem=await(o=>new Promise((d,f)=>{const p=new FileReader;p.readAsDataURL(o),p.onload=()=>d(p.result),p.onerror=_=>f(_)}))(this.item.imagem)),await $db.item.grava({atual:n});try{for(const o of this.estoque)o.saldo>0&&await $db.item.ajusteEstoque({codigoEmpresaSelecionada:o.codigoEmpresa,idItem:n.id,custoDesejado:n.valorCustoReposicao,data:$utils.dataAtual(),lote:"",qtdeDesejada:o.saldo,qtdeDiferenca:o.saldo,qtdeMomento:0,custoMomento:0,planoConta:"146,125",planoContaEstoque:146,planoContaMovimento:125})}catch(o){console.error(o)}finally{$q.notify({type:"positive",message:"Produto gravado com sucesso"})}e.submitter.name==="salvarContinuar"?this.$emit("salvarContinuar",n.id,this.totalEstoqueSaldo):(this.show=!1,this.$emit("salvar",n.id,this.totalEstoqueSaldo))}catch(n){$q.notify({type:"negative",message:"N\xE3o foi poss\xEDvel gravar o produto"}),console.error(n)}finally{$q.loading.hide()}},async tipoSelecionado(){await this.ajustarSecaoEstoque()},ajustarExibicaoCampos(){var r;const e=JSON.parse((r=localStorage.getItem("modalNovoItemCampos"))!=null?r:null);let a=[{name:"referencia",label:"Refer\xEAncia",show:!0},{name:"codigoBarras",label:"C\xF3digo de barras",show:!0},{name:"marca",label:"Marca",show:!0}];if(this.permissaoAjusteEstoque&&a.push({name:"estoque",label:"Estoque",show:!0}),e)for(const n of a){const o=e.find(d=>d.name===n.name);o&&(n.show=o.show)}this.campos=a},async exibicaoCampoAlterado(){var e;this.campos.forEach(a=>{a.show||delete this.item[a.name]}),!this.item.tipo&&this.campos.some(a=>a.name==="tipo"&&a.show)&&(this.item.tipo=(e=ee[0])==null?void 0:e.valor),localStorage.setItem("modalNovoItemCampos",JSON.stringify(this.campos)),await this.ajustarSecaoEstoque()},async ajustarSecaoEstoque(){const e=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,a=this.campos.some(n=>n.name==="estoque"&&n.show);let r=a&&this.permissaoAjusteEstoque?this.estoque:[];if(a&&!r.length)for(const n of e)r.push({codigoEmpresa:n.codigoContato,idContatoEmpresa:n.id,contatoEmpresaApelido:n.apelido,saldo:0,readonly:null});$utils.tratamentoCompletoString(this.item.tipo)!=="servico"&&r.forEach(n=>{n.readonly=!1}),(!this.item.tipo||$utils.tratamentoCompletoString(this.item.tipo)==="servico")&&(r=[]),this.estoque=r},async verificarReferenciaExistente(e){const a=(e||"").trim().toLowerCase();return a&&(await $db.item.carregarMemoria(),$db.item.itens.some(n=>(n.referencia||"").trim().toLowerCase()===a))?"Refer\xEAncia j\xE1 existente":!0},async abrir(){var a;let e=setTimeout(()=>{$q.loading.show()},300);try{this.permissaoAjusteEstoque=await $db.permissao.objeto("item//estoque/ajuste_estoque"),this.item={tipo:(a=ee[0])==null?void 0:a.valor},this.estoque=[],this.ajustarExibicaoCampos(),await this.ajustarSecaoEstoque(),this.show=!0,this.interval=setInterval(()=>{const r=document.getElementsByClassName("input-descricao")[0],n=document.getElementsByClassName("input-referencia")[0],o=document.getElementsByClassName("input-codigoBarras")[0];r&&(r.style.cursor="text"),n&&(n.style.cursor="text"),o&&(o.style.cursor="text"),r&&n&&o&&clearInterval(this.interval)},100)}catch(r){console.error(r)}finally{clearTimeout(e),setTimeout(()=>{$q.loading.hide()},500)}},fechar(){this.$emit("update:modelValue",!1),clearInterval(this.interval)}},props:{modelValue:{default:!1,type:Boolean,required:!0}},watch:{modelValue(){this.modelValue&&this.abrir()}},unmounted(){clearInterval(this.interval)}};function aa(e,a,r,n,o,d){const f=y("campo"),p=y("SeletorCampoTabela"),_=y("Campo");return m(),C(Ge,{modelValue:o.show,"onUpdate:modelValue":a[10]||(a[10]=s=>o.show=s),onHide:d.fechar},{default:i(()=>[t(Me,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"500px"}},{default:i(()=>[t(ze,{onSubmit:d.salvar,ref:"formNovoItem"},{default:i(()=>[t(ue,{class:"bg-primary text-white"},{default:i(()=>[t(te,null,{default:i(()=>[t(me,null,{default:i(()=>[t(F,{name:"extension",size:"sm",class:"q-pr-sm"}),h(" Cadastrar Produto ")]),_:1}),t(x,{icon:"more_vert",flat:"",round:""},{default:i(()=>[t(le,null,{default:i(()=>[T((m(),C(Z,{bordered:"",link:"",class:"bg-white rounded-borders"},{default:i(()=>[(m(!0),A(W,null,X(o.campos,(s,b)=>(m(),A("div",{key:b,class:"itemHover"},[T((m(),C(U,{"manual-focus":"",class:"q-pa-sm items-center"},{default:i(()=>[t(u,{class:"col-shrink no-margin"},{default:i(()=>[t(Oe,{modelValue:s.show,"onUpdate:modelValue":[P=>s.show=P,d.exibicaoCampoAlterado],"checked-icon":"check",color:"primary","unchecked-icon":"clear",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{class:"col-grow q-pl-sm no-margin"},{default:i(()=>[h(k(s.label),1)]),_:2},1024)]),_:2},1024)),[[ce]]),t(se)]))),128))]),_:1})),[[oe]])]),_:1})]),_:1})]),_:1})]),_:1}),t(fe,null,{default:i(()=>[t(pe,{class:"q-pa-md"},{default:i(()=>[t(Ye,{modelValue:o.item.imagem,"onUpdate:modelValue":[a[1]||(a[1]=s=>o.item.imagem=s),a[2]||(a[2]=()=>{o.fileError=!1})],onRejected:d.arquivoRejeitado,rules:[()=>!o.fileError||"JPEG, PNG (m\xE1x. 2MB)"],label:"Selecione a imagem",filled:"",counter:"","max-files":"1","max-file-size":"2097152",accept:".jpg, .png, image/jpeg, image/png",class:"q-mb-md"},{prepend:i(()=>[t(F,{name:"attach_file"})]),append:i(()=>[t(F,{onClick:a[0]||(a[0]=He(()=>{o.item.imagem=null},["stop","prevent"])),name:"close",class:"cursor-pointer"})]),hint:i(()=>[h(" JPEG, PNG (m\xE1x. 2MB) ")]),_:1},8,["modelValue","onRejected","rules"]),t(f,{modelValue:o.item.descricao,"onUpdate:modelValue":a[3]||(a[3]=s=>o.item.descricao=s),rules:[s=>!!s||"Campo obrigat\xF3rio"],rotulo:"Descri\xE7\xE3o"},null,8,["modelValue","rules"]),T(t(f,{modelValue:o.item.referencia,"onUpdate:modelValue":a[4]||(a[4]=s=>o.item.referencia=s),rotulo:"Refer\xEAncia",rules:o.rules.referencia},null,8,["modelValue","rules"]),[[ae,d.showReferencia]]),T(t(f,{modelValue:o.item.codigoBarras,"onUpdate:modelValue":a[5]||(a[5]=s=>o.item.codigoBarras=s),rotulo:"C\xF3digo de Barras",class:"q-field--with-bottom"},null,8,["modelValue"]),[[ae,d.showCodigoBarras]]),T(t(p,{modelValue:o.item.marca,"onUpdate:modelValue":a[6]||(a[6]=s=>o.item.marca=s),buscarSemCaractere:!0,tabela:"item",campo:"marca",label:"Marca",enableAdd:""},null,8,["modelValue"]),[[ae,d.showMarca]]),t(_,{modelValue:o.item.valorCustoReposicao,"onUpdate:modelValue":a[7]||(a[7]=s=>o.item.valorCustoReposicao=s),rotulo:"Custo de Reposi\xE7\xE3o",tipo:"decimal",decimals:"4",zerosDireita:"2",rules:[s=>!d.totalEstoqueSaldo||Number(s==null?void 0:s.replace(/\./g,"").replace(",","."))>0||"Campo obrigat\xF3rio"]},null,8,["modelValue","rules"]),t(_,{modelValue:o.item.valorVenda,"onUpdate:modelValue":a[8]||(a[8]=s=>o.item.valorVenda=s),rotulo:"Valor de Venda",tipo:"decimal",decimals:"4",zerosDireita:"2",class:"q-field--with-bottom"},null,8,["modelValue"]),t(f,{"onUpdate:modelValue":[d.tipoSelecionado,a[9]||(a[9]=s=>o.item.tipo=s)],modelValue:o.item.tipo,opcoes:d.opcoesTipo,rotuloFixo:"Tipo",tipo:"seletor",class:"q-field--with-bottom"},null,8,["onUpdate:modelValue","modelValue","opcoes"]),(m(!0),A(W,null,X(o.estoque,s=>(m(),C(_,{key:s.idContatoEmpresa,modelValue:s.saldo,"onUpdate:modelValue":b=>s.saldo=b,rotulo:`Estoque (${s.contatoEmpresaApelido})`,somenteLeitura:s.readonly,tipo:"quantidade",min:"0",decimals:"4",zerosDireita:"0",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","rotulo","somenteLeitura"]))),128))]),_:1})]),_:1}),t(he,{class:"bg-light"},{default:i(()=>[t(te,null,{default:i(()=>[t(x,{unelevated:"",label:"Salvar e continuar",name:"salvarContinuar",color:"primary",type:"submit",class:"text-white float-left"}),t(ge),T(t(x,{label:"Cancelar",color:"tertiary",flat:"",class:"q-mr-xs"},null,512),[[oe]]),t(x,{type:"submit",label:"Salvar",color:"primary",unelevated:""})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue","onHide"])}var ta=ie(ea,[["render",aa]]);const oa={components:{EtiquetaAdicionar:Xe,EtiquetaNovoItem:ta,PromptCodigoBarras:Je},data(){return{usuario:"",clienteSistema:"",lista:[],item:{},quantidade:1,totalEtiquetas:0,cameraTimeout:null,promptCodigoBarras:!1,opcoesModelo:[],modeloSelecionado:"",emBranco:0,opcoesEmpresas:[],empresaSelecionada:"",tabelasPreco:[],opcoesTabelasPreco:[],tabelaPrecoSelecionada:"",opcoesPlanoConta:[],etiquetaNovoItem:!1,campos:{codigoBarras:{db:"item",value:null,isLoading:!1,showing:!1,chave:"descricaoConcatenada",chaveCadastro:"descricao",searches:[],columns:[{name:"codigoItem",label:"Codigo",align:"left",field:e=>e.codigoItem,format:e=>`${e}`,sortable:!0},{name:"descricao",label:"Descri\xE7\xE3o",align:"left",field:e=>e.descricaoConcatenada,format:e=>`${e}`,sortable:!0}]}}}},methods:{abrirPromptCodigoBarras(){this.promptCodigoBarras=!0,window.scrollTo(0,0)},async onDetected(e){clearTimeout(this.cameraTimeout),this.cameraTimeout=setTimeout(async()=>{this.$refs.etiquetaAdicionar.campo.value=e,await this.$refs.etiquetaAdicionar.buscarItens(),this.$refs.etiquetaAdicionar.$refs.adicionarProduto.focus()},200)},async listar(){try{$q.loading.show();const e=(await $db.etiqueta.ler({cpfUsuarioLogado:this.usuario.numeroDocumentoNacional})).sort((o,d)=>o.dataHoraEmissao>d.dataHoraEmissao?-1:1),a=$utils.clonar(e),r=(await $db.item.ler({filtros:{ids:a.map(o=>o.idItem)}})).data;let n={};for(const o of r)n[o.id]=o;this.item=n,this.listaOriginal=e,this.lista=a,this.totalEtiquetas=this.lista.reduce((o,d)=>{const f=d.quantidadeEtiquetas<0?0:d.quantidadeEtiquetas;return o+f},0)}catch(e){this.$q.notifyError("Erro ao obter dados.",e)}finally{$q.loading.hide()}},async adicionar(e){var r;let a=this.lista.find(n=>n.idItem===e.id);if(a){const n={nomeProduto:e.descricaoConcatenada,valor:e.valorVenda||0,quantidadeEtiquetas:a.quantidadeEtiquetas+this.quantidade};await this.atualizar({...a,...n}),a.nomeProduto=n.nomeProduto,a.valor=n.valor,a.quantidadeEtiquetas=n.quantidadeEtiquetas;return}try{$q.loading.show(),a={id:$utils.uuid(),idItem:e.id,nomeProduto:e.descricaoConcatenada,valor:(r=e.valorVenda)!=null?r:0,quantidadeEtiquetas:this.quantidade,cpfUsuarioLogado:this.usuario.numeroDocumentoNacional,dataHoraEmissao:$utils.dataAtual()},await $db.etiqueta.gravar({atual:a}),await this.listar(),await this.carregarValores(),$q.notify({message:"Etiqueta adicionada com sucesso.",type:"positive"})}catch(n){this.$q.notifyError("Erro ao inserir etiqueta.",n)}finally{$q.loading.hide()}},async atualizar(e){try{$q.loading.show();const a=this.listaOriginal.find(r=>r.id===e.id);await $db.etiqueta.gravar({atual:e,original:a}),await this.listar(),await this.carregarValores(),$q.notify({message:"Etiqueta atualizada com sucesso.",type:"positive"})}catch(a){this.$q.notifyError("Erro ao atualizar etiqueta.",a)}finally{$q.loading.hide()}},async carregarTabelaPreco(){this.tabelaPrecoSelecionada?await this.carregarValores():this.lista=$utils.clonar(this.listaOriginal)},async carregarValores(){for(const e of this.lista){const a=await $erp().item.get(e.idItem);let r,n;!a||(this.tabelaPrecoSelecionada&&(r=this.tabelasPreco.filter(o=>o.id===this.tabelaPrecoSelecionada)[0],n=await $db.itemTabelaPreco.obterValores(r,a,4)),n&&(e.valor=n.valorVenda||0))}},async remover(e){try{await $db.etiqueta.remover(e.id),await this.listar(),$q.notify({message:"Etiqueta removida com sucesso.",type:"positive"})}catch(a){this.$q.notifyError("Erro ao remover etiqueta.",a)}},removerTodas(){$q.dialog({title:"Tem certeza?",message:"Esta a\xE7\xE3o ir\xE1 remover as etiquetas da lista.",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Remover",push:!0,class:"bg-red-7",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();for(const e of this.lista)await $db.etiqueta.remover(e.id);await this.listar(),$q.notify({message:"Etiquetas removidas com sucesso.",type:"positive"})}catch(e){this.$q.notifyError("Erro ao remover etiquetas.",e)}finally{$q.loading.hide()}})},async abrirEtiquetaNovoItem(){this.etiquetaNovoItem=!0},async incluirItem(e,a){const r=await $erp().item.get(e);a&&(this.quantidade=a),r&&this.adicionar(r),this.quantidade=1},async abrirEtiquetaAdicionar(){try{this.$refs.etiquetaAdicionar.campo.value="",await this.$refs.etiquetaAdicionar.buscarItens()}catch(e){console.error("Erro ao abrir adicionar etiqueta.",e)}},async configuraEtiqueta(){const e=await $db.configuracoes.le({nome:"impressao.etiqueta"});this.opcoesModelo=[],e.some(a=>a.valor==="etiquetaFila")?this.opcoesModelo.push({rotulo:"Etiqueta Fila",valor:"etiquetaFila",modelo:"etiquetaFila"}):e.length?e.forEach(a=>{this.opcoesModelo.push({rotulo:a.texto,valor:a.observacao&&a.observacao.trim()!==""?a.observacao:a.valor,modelo:a.valor})}):this.opcoesModelo.push({rotulo:"Etiqueta Carta (EBF-23)",valor:"etiqueta-carta-ebf23",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila Joias",valor:"etiqueta-fila-joias",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila 3 Colunas",valor:"etiqueta-fila-3colunas",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Pimaco (A4 96)",valor:"etiqueta-pimaco-a496",modelo:"imprimir-etiquetas"}),this.opcoesModelo=[...this.opcoesModelo,{rotulo:"Modelos antigos:",value:"modelos-antigos",disable:!0},{rotulo:"Folha Argox",valor:"etiqueta-fila"},{rotulo:"Folha Carta",valor:"etiqueta-carta"},{rotulo:"Folha Pimaco",valor:"EtiquetaPimaco6Col"},{rotulo:"Personaliz\xE1vel",valor:"etiqueta_generica_ajustavel"}],this.modeloSelecionado=this.opcoesModelo[0].valor},async configuraEmpresas(){const e=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.opcoesEmpresas=e.map(a=>({rotulo:a.apelido||a.nome,valor:a.id,codigoEmpresa:a.codigoContato})),this.empresaSelecionada=""},async configuraTabelasPreco(){this.tabelasPreco=await $db.itemTabelaPreco.le({ativo:!0,tabelaMaster:!0})||[],this.opcoesTabelasPreco=this.tabelasPreco.map(e=>({rotulo:e.descricao,valor:e.id,codigoItemTabelaPreco:e.codigoItemTabelaPreco})),this.tabelaPrecoSelecionada=""},async configuraPlanoConta(){const e=(await $db.configuracoes.le()).filter(a=>a.nome==="item.estoque.ajuste").sort((a,r)=>a.texto.localeCompare(r.texto));this.opcoesPlanoConta=[{rotulo:"-",valor:""},...e.map(a=>({rotulo:(a.texto||"").trim(),valor:a.valor})),{rotulo:"Especificar Contas",valor:"0"}]},imprimir(e){var a;if(e==="etiqueta_generica_ajustavel"||e==="etiqueta-fila"||e==="etiqueta-carta"||e==="EtiquetaPimaco6Col"){const r=e==="etiqueta_generica_ajustavel"?"":"OptiSoul/";this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/${r}${e}.html
            ?Banco=${this.clienteSistema.bancoDeDados}
            &URLServidor=${this.clienteSistema.urlServidor}
            &CodigoUsuario=${this.usuario.codigoUsuario}
            &EmBranco=${this.emBranco}
            &TabelaPreco=${this.tabelaPrecoSelecionada?this.opcoesTabelasPreco.find(n=>n.valor===this.tabelaPrecoSelecionada).codigoItemTabelaPreco:""}
            &CodigoContatoEmpresa=${this.empresaSelecionada?this.opcoesEmpresas.find(n=>n.valor===this.empresaSelecionada).codigoEmpresa:""}
            &cpfUsuarioLogado=${this.usuario.cpf}
            &hfCodigoSistema={
              data:{
                CodigoUsuario:${this.usuario.codigoUsuario},
                CodigoSistema:${this.clienteSistema.codigoSistema},
                CodigoClienteSistema:${this.clienteSistema.codigoClienteSistema},
                Sistema:${this.clienteSistema.sistema},
                URLServidor:${this.clienteSistema.urlServidor},
                BancoDeDados:${this.clienteSistema.bancoDeDados},
                CodigoCliente:${this.clienteSistema.codigoCliente},
                Cliente:${this.clienteSistema.cliente},
                Administrador:${this.clienteSistema.administrador},
                GrupoInterno:${this.clienteSistema.grupoInterno}
              }
            }
          `)}else{const r=(a=this.opcoesModelo)==null?void 0:a.find(d=>d.valor===e),n=(r==null?void 0:r.modelo)||"",o=(r==null?void 0:r.valor)||"";$imprimir(n,{impressao:"etiquetas"},{modelo:o,idEmpresa:this.empresaSelecionada,idTabelaPreco:this.tabelaPrecoSelecionada,emBranco:this.emBranco})}},abrirImpressao(e){window.open(e.replace(/[\s\n]/g,""),"_blank").focus()}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.clienteSistema=JSON.parse(localStorage.getItem("clienteSistema")),await this.configuraEtiqueta(),await this.configuraEmpresas(),await this.configuraTabelasPreco(),await this.configuraPlanoConta(),await this.listar(),await this.carregarValores()}},ia={id:"EtiquetaLista"},la={class:"mw80 text-center"},sa={class:"col col-md-auto q-my-xs"},ra=E("span",{class:"q-ml-xs hideonmobile"},"Imprimir",-1);function na(e,a,r,n,o,d){const f=y("barraTopo"),p=y("campo"),_=y("EtiquetaAdicionar"),s=y("g-label"),b=y("g-col"),P=y("g-row"),z=y("BadgeCopiarUid"),O=y("avatar"),H=y("badge"),g=y("EtiquetaNovoItem"),G=y("promptCodigoBarras");return m(),A("div",ia,[t(ue,{elevated:"",class:"bg-gradiente text-white"},{default:i(()=>[t(f),t(te,{class:"q-px-sm"},{default:i(()=>[t(F,{name:"mdi-tag-plus",size:"sm",class:"q-mr-sm etiquetalista-hideonmobile"}),t(me,{class:"etiquetalista-hideonmobile"},{default:i(()=>[h("Imprimir Etiquetas")]),_:1}),t(ge,{class:"etiquetalista-desktop"}),t(p,{modelValue:o.quantidade,"onUpdate:modelValue":a[0]||(a[0]=l=>o.quantidade=l),min:1,dense:"",outlined:"",dark:"",color:"white",tipo:"quantidade",rotulo:"Quantidade",class:"q-ml-sm etiquetalista-QtdAddEtq"},null,8,["modelValue"]),t(_,{onClick:a[1]||(a[1]=l=>d.abrirEtiquetaAdicionar()),onKeyup:a[2]||(a[2]=$e(l=>d.abrirEtiquetaAdicionar(),["enter"])),onAddEtiqueta:d.adicionar,campo:o.campos.codigoBarras,dense:"",outlined:"",clearable:"",dark:"",ref:"etiquetaAdicionar",cor:"white",class:"q-ml-sm etiquetalista-selectAddEtq"},null,8,["onAddEtiqueta","campo"]),t(x,{onClick:d.abrirPromptCodigoBarras,flat:"",round:"",icon:"mdi-barcode-scan",color:"white",size:"md",class:"q-ml-sm hideonmobile"},null,8,["onClick"]),t(x,{onClick:a[3]||(a[3]=l=>d.listar()),flat:"",round:"",icon:"refresh",color:"white",size:"md",class:"q-ml-xs hideonmobile"}),t(x,{icon:"more_vert",flat:"",round:"",dense:"",class:"q-ml-xs"},{default:i(()=>[t(le,null,{default:i(()=>[T((m(),C(Z,{link:"","no-border":""},{default:i(()=>[t(U,{onClick:d.abrirEtiquetaNovoItem,clickable:""},{default:i(()=>[t(u,{avatar:""},{default:i(()=>[t(F,{name:"add",size:"sm"})]),_:1}),t(u,null,{default:i(()=>[h("Adicionar")]),_:1})]),_:1},8,["onClick"]),t(U,{onClick:d.abrirPromptCodigoBarras,clickable:"",class:"hideondesktop"},{default:i(()=>[t(u,{avatar:""},{default:i(()=>[t(F,{name:"mdi-barcode-scan",size:"sm"})]),_:1}),t(u,null,{default:i(()=>[h("C\xF3digo de Barras")]),_:1})]),_:1},8,["onClick"]),t(U,{onClick:d.removerTodas,clickable:""},{default:i(()=>[t(u,{avatar:""},{default:i(()=>[t(F,{name:"delete",size:"sm"})]),_:1}),t(u,null,{default:i(()=>[h("Limpar")]),_:1})]),_:1},8,["onClick"])]),_:1})),[[oe]])]),_:1})]),_:1})]),_:1})]),_:1}),t(fe,null,{default:i(()=>[t(pe,null,{default:i(()=>[t(P,null,{default:i(()=>[o.lista.length===0?(m(),C(b,{key:0,col:"grow",class:"q-px-xs"},{default:i(()=>[t(P,{justify:"center",bg:"bg-white",minHeight:"calc(100vh - 210px)!important"},{default:i(()=>[t(b,{self:"center"},{default:i(()=>[t(s,{text:"caption center medium"},{default:i(()=>[h("Nenhum item a ser listado.")]),_:1})]),_:1})]),_:1})]),_:1})):(m(),C(b,{key:1,col:"grow",class:"q-px-xs"},{default:i(()=>[t(Z,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:i(()=>[(m(!0),A(W,null,X(o.lista,l=>(m(),A("div",{key:l.idItem,class:"itemHover"},[t(U,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:i(()=>[t(u,{class:"col-auto no-margin hideonmobile"},{default:i(()=>{var q,v;return[E("div",la,[t(z,{id:l==null?void 0:l.idItem,numero:(q=o.item[l==null?void 0:l.idItem])==null?void 0:q.codigoItem,cor:(v=o.item[l==null?void 0:l.idItem])!=null&&v.ativo?"positive":"tertiary",escuro:"",dica:"C\xF3digo Item"},null,8,["id","numero","cor"])])]}),_:2},1024),t(u,{class:"col-xs q-pl-sm no-margin"},{default:i(()=>[t(U,{class:"q-pa-none"},{default:i(()=>[t(u,{top:"",class:"col-auto items-center hideondesktop"},{default:i(()=>{var q,v;return[t(O,{imagem:(q=o.item[l.idItem])==null?void 0:q.imagem,style:{display:"flex","align-self":"center"},rotulo:(v=o.item[l.idItem])==null?void 0:v.descricaoConcatenada,tamanho:"40"},null,8,["imagem","rotulo"])]}),_:2},1024),t(u,{class:"col-auto items-center hideonmobile"},{default:i(()=>{var q,v;return[t(O,{imagem:(q=o.item[l.idItem])==null?void 0:q.imagem,style:{display:"flex","align-self":"center"},rotulo:(v=o.item[l.idItem])==null?void 0:v.descricaoConcatenada,tamanho:"40"},null,8,["imagem","rotulo"])]}),_:2},1024),t(u,{class:"col"},{default:i(()=>{var q;return[t(M,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines caption"},{default:i(()=>{var v;return[E("span",null,[h(k((v=o.item[l.idItem])==null?void 0:v.descricaoConcatenada)+" ",1),t(Q,{anchor:"bottom middle",self:"center middle"},{default:i(()=>[h("Descri\xE7\xE3o")]),_:1})])]}),_:2},1024),(q=o.item[l.idItem])!=null&&q.marca?(m(),C(M,{key:0,caption:"",lines:"1",class:"text-tertiary ellipsis caption"},{default:i(()=>{var v,R,N,B,I;return[E("span",null,[h(k((v=o.item[l.idItem])==null?void 0:v.marca)+" ",1),t(Q,{anchor:"bottom middle",self:"center middle"},{default:i(()=>[h("Marca")]),_:1})]),E("span",null,[h(k((R=o.item[l.idItem])!=null&&R.grupo?" | "+((N=o.item[l.idItem])==null?void 0:N.grupo):"")+" ",1),t(Q,{anchor:"bottom middle",self:"center middle"},{default:i(()=>[h("Grupo")]),_:1})]),E("span",null,[h(k((B=o.item[l.idItem])!=null&&B.subGrupo?" | "+((I=o.item[l.idItem])==null?void 0:I.subGrupo):"")+" ",1),t(Q,{anchor:"bottom middle",self:"center middle"},{default:i(()=>[h("Subgrupo")]),_:1})])]}),_:2},1024)):L("",!0),t(u,{class:"q-mt-sm"},{default:i(()=>{var v,R,N,B,I,J;return[E("div",null,[t(z,{id:l==null?void 0:l.idItem,numero:(v=o.item[l==null?void 0:l.idItem])==null?void 0:v.codigoItem,cor:(R=o.item[l==null?void 0:l.idItem])!=null&&R.ativo?"positive":"tertiary",escuro:"",class:"q-mr-xs hideondesktop",dica:"C\xF3digo Item"},null,8,["id","numero","cor"]),(N=o.item[l==null?void 0:l.idItem])!=null&&N.referencia?(m(),C(H,{key:0,rotulo:(B=o.item[l==null?void 0:l.idItem])==null?void 0:B.referencia,escuro:"",cor:"tertiary",dica:"Refer\xEAncia",class:"q-mr-xs"},null,8,["rotulo"])):L("",!0),(I=o.item[l==null?void 0:l.idItem])!=null&&I.codigoBarras?(m(),C(H,{key:1,rotulo:(J=o.item[l==null?void 0:l.idItem])==null?void 0:J.codigoBarras,cor:"light",dica:"C\xF3digo de Barras",class:"q-mr-xs"},null,8,["rotulo"])):L("",!0)]),t(u,{class:"q-pt-sm text-tertiary text-weight-bold hideondesktop"},{default:i(()=>[h(" R$ "+k(e.$filters.numero(l.valor,2))+" ",1),t(Q,null,{default:i(()=>[h("Valor de venda")]),_:1})]),_:2},1024),t(U,{class:"q-pa-none q-pt-sm hideondesktop"},{default:i(()=>[t(u,{top:"",class:"col"},{default:i(()=>[t(p,{modelValue:l.quantidadeEtiquetas,"onUpdate:modelValue":[D=>l.quantidadeEtiquetas=D,D=>d.atualizar(l)],avisoRotulo:`Em estoque: ${o.item[l.idItem].quantidadeDisponivel}`,debounce:500,min:0,dense:"",outlined:"",aviso:"",rotulo:"Quantidade",tipo:"quantidade",color:"tertiary"},null,8,["modelValue","onUpdate:modelValue","avisoRotulo"])]),_:2},1024),t(u,{top:"",class:"col-shrink q-pt-xs q-px-sm"},{default:i(()=>[t(x,{onClick:D=>d.remover(l),dense:"",round:"",flat:"",icon:"delete",size:"md",color:"tertiary",class:"buttons"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]}),_:2},1024)]}),_:2},1024)]),_:2},1024)]),_:2},1024),t(u,{class:"col maxw160 q-pl-sm no-margin hideonmobile"},{default:i(()=>[E("div",sa,[t(M,null,{default:i(()=>[t(p,{modelValue:l.quantidadeEtiquetas,"onUpdate:modelValue":[q=>l.quantidadeEtiquetas=q,q=>d.atualizar(l)],avisoRotulo:`Em estoque: ${o.item[l.idItem].quantidadeDisponivel}`,debounce:500,min:0,dense:"",outlined:"",aviso:"",tipo:"quantidade",rotulo:"Quantidade",color:"tertiary"},null,8,["modelValue","onUpdate:modelValue","avisoRotulo"])]),_:2},1024)])]),_:2},1024),t(u,{class:"col maxw100 q-pl-sm no-margin hideonmobile"},{default:i(()=>[t(M,{caption:"",class:"text-tertiary text-weight-bold text-right caption"},{default:i(()=>[E("span",null,[h(k(e.$filters.numeroZerosDireita(l.valor,4,2))+" ",1),t(Q,{anchor:"bottom middle",self:"center middle"},{default:i(()=>[h("Valor de venda")]),_:1})])]),_:2},1024)]),_:2},1024),t(u,{class:"col-shrink q-pl-sm no-margin hideonmobile"},{default:i(()=>[t(x,{onClick:q=>d.remover(l),dense:"",flat:"",round:"",color:"tertiary",icon:"delete",class:"buttons"},null,8,["onClick"])]),_:2},1024)]),_:2},1024),t(se)]))),128))]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),t(he,{class:"bg-white text-tertiary shadow-up-5"},{default:i(()=>[t(P,{gutter:"sm",items:"center"},{default:i(()=>[t(b,{col:"4 sm"},{default:i(()=>[t(p,{modelValue:o.modeloSelecionado,"onUpdate:modelValue":a[4]||(a[4]=l=>o.modeloSelecionado=l),opcoes:o.opcoesModelo,dense:"",filled:"",tipo:"seletor",rotulo:"Modelo",cor:"white",class:"etiquetalista-seletor","popup-content-class":"etiquetalista-modeloSelecionado"},null,8,["modelValue","opcoes"])]),_:1}),t(b,{col:"4 sm"},{default:i(()=>[t(p,{modelValue:o.empresaSelecionada,"onUpdate:modelValue":a[5]||(a[5]=l=>o.empresaSelecionada=l),opcoes:o.opcoesEmpresas,dense:"",filled:"",clearable:"",tipo:"seletor",rotulo:"Empresa",color:"tertiary",class:"etiquetalista-seletor"},null,8,["modelValue","opcoes"])]),_:1}),t(b,{col:"4 sm"},{default:i(()=>[t(p,{modelValue:o.tabelaPrecoSelecionada,"onUpdate:modelValue":[a[6]||(a[6]=l=>o.tabelaPrecoSelecionada=l),d.carregarTabelaPreco],dense:"",filled:"",clearable:"",opcoes:o.opcoesTabelasPreco,tipo:"seletor",rotulo:"Tabela de Pre\xE7o",color:"tertiary",class:"etiquetalista-seletor"},null,8,["modelValue","onUpdate:modelValue","opcoes"])]),_:1}),t(b,{col:"xs"},{default:i(()=>[t(p,{modelValue:o.emBranco,"onUpdate:modelValue":a[7]||(a[7]=l=>o.emBranco=l),min:0,tipo:"quantidade",dense:"",filled:"",rotulo:"Etiquetas em branco",color:"tertiary","text-color":"red"},null,8,["modelValue"])]),_:1}),t(b,{col:"xs sm-shrink text-center"},{default:i(()=>[t(p,{modelValue:o.totalEtiquetas,"onUpdate:modelValue":a[8]||(a[8]=l=>o.totalEtiquetas=l),disable:"",filled:"",rotulo:"Quantidade etiquetas",class:"etiquetalista-QtdTotalEtq",style:{"max-width":"132px"}},null,8,["modelValue"])]),_:1}),t(b,{col:"shrink text-center"},{default:i(()=>[t(x,{onClick:a[9]||(a[9]=l=>d.imprimir(o.modeloSelecionado)),flat:"",color:"primary"},{default:i(()=>[t(F,{name:"print",size:"sm"}),ra]),_:1})]),_:1})]),_:1})]),_:1}),t(g,{modelValue:o.etiquetaNovoItem,"onUpdate:modelValue":a[10]||(a[10]=l=>o.etiquetaNovoItem=l),onSalvar:d.incluirItem,onSalvarContinuar:d.incluirItem},null,8,["modelValue","onSalvar","onSalvarContinuar"]),t(G,{modelValue:o.promptCodigoBarras,"onUpdate:modelValue":a[11]||(a[11]=l=>o.promptCodigoBarras=l),onEscanear:d.onDetected,useQuagga:!0},null,8,["modelValue","onEscanear"])])}var ua=ie(oa,[["render",na]]);export{ua as default};
