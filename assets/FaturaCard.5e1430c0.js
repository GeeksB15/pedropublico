import{_ as ue,aD as K,a$ as fe,c1 as re,bA as se,o as n,d as c,w as t,f as e,L as ce,B as C,ar as pe,E as be,h as le,i as me,j as _,k as s,G as J,Q as U,M as Z,I as ve,H as ge,R as y,S as r,T as p,t as f,e as k,O as W,n as T,F as H,s as Q,m as L,W as ie,aT as oe,l as X,aq as he,cZ as ke,aV as ye,J as _e,aY as Fe,C as we,aC as j,c_ as Ce,ba as Be,r as Y,c$ as ae,ax as $,bb as ne,y as Ee,bs as qe,u as de}from"./index.188ab8e6.js";import{e as xe}from"./emitirNFe.35117289.js";import{n as Pe}from"./nfePrincipal.e422e0b1.js";import{F as Ve}from"./FaturaModal.7945239e.js";import{D as Ne}from"./DocumentosFiscais.faec51ff.js";import{M as De}from"./ModalHistoricoStatus.544a4c46.js";import{Q as Se}from"./QSpinnerHourglass.8a0d2be5.js";import{Q as ze}from"./QSpinnerDots.3f1f1f17.js";const Ie={computed:{visivel:{get(){return this.modelValue},async set(i){this.$emit("update:modelValue",i)}},ativarBotaoEmissaoBoleto(){var a,F,m,o;const i=Number((F=(a=this.boletos)==null?void 0:a.financeiroBanco)==null?void 0:F.value);return Number.isInteger(i)&&i&&((o=(m=this.boletos)==null?void 0:m.condicoesPagamento)==null?void 0:o.find(v=>v.checked))}},data(){return{boletos:{codigoFinanceiroBanco:"",condicoesPagamento:[],bancos:[],emitidos:!1,emitir:!1,loading:!1,cancelarAtualizarBoletos:!1}}},emits:["update:modelValue"],methods:{async atualizar(){var i,a,F,m,o;try{if((i=this.fatura)!=null&&i.id){this.boletos={codigoFinanceiroBanco:"",condicoesPagamento:[],bancos:[],emitidos:!1,emitir:!1,loading:!1,cancelarAtualizarBoletos:!1};const v=[],E=await K().formaPagamento.toArray(),x=await K().empresa.where({idContato:(a=this.fatura)==null?void 0:a.idEmpresa}).toArray();if(await(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:(F=this.fatura)==null?void 0:F.id}})).forEach(B=>{const N=E.find(w=>w.id===B.idFormaPagamento&&w.tipo===99&&w.tipoFinanceiro==="T\xEDtulo em aberto");N&&v.push({dataVencimento:B.dataVencimento,descricao:N.descricao,idFinanceiroTitulo:B.idFinanceiroTitulo,codigoFinanceiroBoleto:"",checked:!1,disable:!0,valor:B.valor})}),!v.length)return;const R=[];await K().financeiroBanco.each(B=>{if(!!B.ativo){if(B.id==="7D07229E-B35E-42AA-A312-78313BE61B2F"){R.push(B);return}B.idEmpresa&&x.find(N=>N.id===B.idEmpresa)&&R.push(B)}});const M=[...new Set(R.map(B=>B.codigoBanco))],z=[];await K()._banco.each(B=>{M.find(N=>N===B.codigoBanco)&&z.push(B)}),this.boletos.condicoesPagamento=fe.exports.orderBy(v,"dataVencimento","asc");const I=[];for(const B of R){const N=z.find(d=>d.codigoBanco===B.codigoBanco)||{};if(!N)continue;const w=(N.descricao||"").trim(),q=(B.agencia||"").trim(),D=(B.conta||"").trim();if(!N.arquivoBoleto||!w||!q||!D)continue;let l=w+" - Ag. "+q+" C/C "+D;I.push({arquivoBoleto:N.arquivoBoleto,label:l,value:B.codigoFinanceiroBanco})}I.length&&(this.boletos.financeiroBanco=I[0],this.boletos.bancos=I);const V=(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:(m=this.fatura)==null?void 0:m.id}})).find(B=>B.situacao==="Emitido")||null;for(const B of(o=this.boletos)==null?void 0:o.condicoesPagamento)B.checked=!1,B.disable=!0,B.codigoFinanceiroBoleto="",B.codigoFinanceiroTitulo="",B.banco={};this.boletos.docFiscal=V,this.boletos.financeiroBanco=this.boletos.bancos[0],this.$nextTick().then(async()=>{await this.atualizarBoletos()})}}catch(v){console.error("ERRO: ",v)}},async atualizarBoletos(){var i;try{let a,F,m,o;o=(i=this.boletos)==null?void 0:i.condicoesPagamento,m=o.reduce((E,x)=>E+"'"+x.idFinanceiroTitulo+"',",""),m=m.slice(0,m.length-1),a=`
            select
              fTitulo.id,
              fTitulo.codigoFinanceiroTitulo,
              fBoleto.codigoFinanceiroBoleto,
              fBoleto.dataEmissao,
              b.descricao,
              fBanco.agencia,
              fBanco.conta,
              b.arquivoBoleto
            from financeiroTitulo fTitulo
              left join financeiroBoleto fBoleto on(fBoleto.codigoFinanceiroBoleto = fTitulo.codigoFinanceiroBoleto)
              left join financeiroBanco fBanco on(fBanco.CodigoFinanceiroBanco = fBoleto.codigoFinanceiroBanco)
              left join _banco b on(b.codigoBanco = fBanco.codigoBanco)
            where fTitulo.id in (${m})
          `,this.boletos.cancelarAtualizarBoletos=!1;let v=0;do{try{F=await re(a),v=0}catch(E){F=[],++v%3===0&&this.$q.notifyError(E.message)}for(const E of F){const x=o.find(S=>S.idFinanceiroTitulo===E.id);x&&(E.codigoFinanceiroBoleto&&(x.codigoFinanceiroBoleto=E.codigoFinanceiroBoleto,x.banco={descricao:E.descricao,dataEmissao:E.dataEmissao,agencia:E.agencia,conta:E.conta,arquivoBoleto:E.arquivoBoleto}),E.codigoFinanceiroTitulo&&(x.codigoFinanceiroTitulo=E.codigoFinanceiroTitulo,x.disable=!1))}if(F.length===o.length||this.boletos.cancelarAtualizarBoletos)break;await se(5e3)}while(1)}catch{$q.notify({message:"N\xE3o foi poss\xEDvel atualizar os boletos.",type:"tertiary"})}},async emitirImprimirBoleto(){var E,x,S,R,M,z,I,V,B,N;this.boletos.loading=!0;let i,a,F,m={},o=[];F=(x=(E=this.boletos)==null?void 0:E.condicoesPagamento)==null?void 0:x.filter(w=>w.checked);for(const w of F){if(w.codigoFinanceiroBoleto&&(w.banco||{}).arquivoBoleto){if(!m[w.banco.arquivoBoleto]){m[w.banco.arquivoBoleto]=[w.codigoFinanceiroBoleto];continue}m[w.banco.arquivoBoleto].push(w.codigoFinanceiroBoleto);continue}o.push(w.codigoFinanceiroTitulo)}if((o==null?void 0:o.length)&&((R=(S=this.boletos)==null?void 0:S.financeiroBanco)==null?void 0:R.value)){let w,q,D,l=0,d=0,u,g="";if(this.cancelarEmitirBoletos=!1,(M=this.boletos)!=null&&M.docFiscal&&(g=`${this.boletos.docFiscal.nNF} / S\xE9rie ${this.boletos.docFiscal.serie} | `),u=(V=((I=(z=this.boletos)==null?void 0:z.bancos)==null?void 0:I.find(h=>{var P,A;return h.value===((A=(P=this.boletos)==null?void 0:P.financeiroBanco)==null?void 0:A.value)}))||{})==null?void 0:V.arquivoBoleto,!u){this.$q.notifyError("Arquivo boleto n\xE3o encontrado");return}i=`sp_financeiro_boletoEmitir ${(N=(B=this.boletos)==null?void 0:B.financeiroBanco)==null?void 0:N.value}, '${o==null?void 0:o.join(",")}', '${g}'`;do{if(this.cancelarEmitirBoletos)break;try{a=await re(i),l=0}catch(h){a=[],++l%3===0&&this.$q.notifyError(h.message)}if(w=(a||[])[0],q=((w||{}).Msg||"").trim(),D=((w||{}).Retorno||"").trim(),q==="Boleto Gerado com sucesso!"&&D){const h=D.substring(0,D.length-1).split(",");if(!m[u]){m[u]=h;break}for(const P of h)m[u].push(P);break}else++d%3===0&&this.$q.notifyError(q);await se(5e3)}while(1)}let v=JSON.parse(localStorage.getItem("clienteSistema"))||{};for(const w in m){let q;q="https://rel.storage.b15.com.br/Relatorios/"+w+".html?",q+="CodigoFinanceiroBoleto="+m[w].join(","),q+="&Banco="+v.bancoDeDados,q+="&URLServidor="+v.urlServidor,this.$imprimir("tela-de-boleto-automatico",btoa(q))}await this.atualizarBoletos(),this.boletos.loading=!1},checkboxTodos(i){var a,F,m,o,v,E,x,S,R,M,z,I,V,B,N,w,q,D,l,d;if(i==="emitidos"&&((m=(F=(a=this.boletos)==null?void 0:a.condicoesPagamento)==null?void 0:F.filter(u=>!u.disable&&u.codigoFinanceiroBoleto))==null?void 0:m.length))for(const u of(v=(o=this.boletos)==null?void 0:o.condicoesPagamento)==null?void 0:v.filter(g=>!g.disable&&g.codigoFinanceiroBoleto))u.checked=!!this.boletos.emitidos;if(i==="emitir"&&((S=(x=(E=this.boletos)==null?void 0:E.condicoesPagamento)==null?void 0:x.filter(u=>!u.disable&&!u.codigoFinanceiroBoleto))==null?void 0:S.length))for(const u of(M=(R=this.boletos)==null?void 0:R.condicoesPagamento)==null?void 0:M.filter(g=>!g.disable&&!g.codigoFinanceiroBoleto))u.checked=!!this.boletos.emitir;if(!i){if((V=(I=(z=this.boletos)==null?void 0:z.condicoesPagamento)==null?void 0:I.filter(u=>!u.disable&&u.codigoFinanceiroBoleto))!=null&&V.length){const u=(N=(B=this.boletos)==null?void 0:B.condicoesPagamento)==null?void 0:N.filter(g=>!g.disable&&g.codigoFinanceiroBoleto);this.boletos.emitidos=u.reduce((g,h)=>g&&h.checked,!0)}if((D=(q=(w=this.boletos)==null?void 0:w.condicoesPagamento)==null?void 0:q.filter(u=>!u.disable&&!u.codigoFinanceiroBoleto))!=null&&D.length){const u=(d=(l=this.boletos)==null?void 0:l.condicoesPagamento)==null?void 0:d.filter(g=>!g.disable&&!g.codigoFinanceiroBoleto);this.boletos.emitir=u.reduce((g,h)=>g&&h.checked,!0)}}},async fetchAndRenderHTMLInIframe(i){return new Promise((a,F)=>{const m=document.createElement("iframe");m.style.display="none",document.body.appendChild(m),m.onload=async()=>{try{const o=m.contentWindow.document.body.innerHTML;document.body.removeChild(m),a(o)}catch(o){F(o)}},m.onerror=()=>{F(new Error("Erro ao carregar o iframe"))},m.src=i})},async enviarBoletoEmailAutomatico(i,a,F){try{const{showLoading:m,successMsg:o,errorMsg:v}={},x={host:"smtp.gmail.com",port:587,ssl:!0,auth:{user:"auto@geekssolucoes.com.br",pass:"xpto@9@9"},from:a,to:F,subject:"Boleto Automatico",text:"Boleto envio automatico",attachments:[{name:"boleto.pdf",content:i,method:"url2pdf"}]},S=await axios({baseURL:"https://api.b15.com.br",method:"post",url:"/email/v2",data:x});this.$q.notifyPositive((S==null?void 0:S.status)===200&&o?o:S.data.message)}catch(m){this.$q.notifyError("Erro ao enviar o boleto",m)}}},props:{modelValue:{type:Boolean,required:!0},fatura:{type:Object,required:!0,default:()=>({})}},watch:{async visivel(i){i&&await this.atualizar()}}},Re={class:"text-weight-medium q-px-xs"},Te={class:"text-weight-medium q-px-xs"},He={class:"text-weight-bold q-pr-xs"},Ae={class:"text-weight-bold q-pr-xs"},Qe={class:"text-weight-bold q-pr-xs"},Oe={class:"text-weight-medium float-right"};function Me(i,a,F,m,o,v){return n(),c(we,{modelValue:v.visivel,"onUpdate:modelValue":a[8]||(a[8]=E=>v.visivel=E)},{default:t(()=>[e(ce,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"500px"}},{default:t(()=>[C("form",{onSubmit:a[7]||(a[7]=pe(E=>v.emitirImprimirBoleto(),["prevent"])),class:"q-pa-sm"},[e(be,null,{default:t(()=>[e(le,null,{default:t(()=>[e(me,null,{default:t(()=>[e(_,{name:"receipt_long",size:"sm",class:"q-mr-sm"}),a[9]||(a[9]=s(" Emiss\xE3o de Boleto "))]),_:1}),J(e(U,{icon:"close",flat:"",round:"",dense:""},null,512),[[Z]])]),_:1})]),_:1}),e(ve,null,{default:t(()=>[e(ge,null,{default:t(()=>{var E,x,S,R,M,z,I,V,B,N,w;return[(E=o.boletos)!=null&&E.docFiscal?(n(),c(y,{key:0,class:"q-py-none q-px-sm"},{default:t(()=>[e(r,{class:"no-margin"},{default:t(()=>[e(p,{header:""},{default:t(()=>{var q,D,l,d;return[e(_,{name:"insert_drive_file",size:"xs",class:"q-mr-xs"}),a[10]||(a[10]=s(" Nota fiscal: ")),C("span",Re,f((D=(q=o.boletos)==null?void 0:q.docFiscal)==null?void 0:D.nNF),1),a[11]||(a[11]=s(" | S\xE9rie: ")),C("span",Te,f((d=(l=o.boletos)==null?void 0:l.docFiscal)==null?void 0:d.serie),1)]}),_:1})]),_:1})]),_:1})):k("",!0),(R=(S=(x=o.boletos)==null?void 0:x.condicoesPagamento)==null?void 0:S.filter(q=>q.disable))!=null&&R.length?(n(),c(W,{key:1,dense:"",highlight:"",bordered:"","rounded-borders":"",class:"q-pa-none q-mx-sm q-my-lg"},{default:t(()=>{var q,D;return[e(p,{header:"",class:"text-weight-medium text-center"},{default:t(()=>[e(Se,{size:"xs",class:"q-mr-sm"}),a[12]||(a[12]=s(" Recuperando informa\xE7\xF5es do servidor... "))]),_:1}),(n(!0),T(H,null,Q((D=(q=o.boletos)==null?void 0:q.condicoesPagamento)==null?void 0:D.filter(l=>l.disable),(l,d)=>J((n(),c(y,{key:d,tag:"label"},{default:t(()=>[e(r,{side:""},{default:t(()=>[l!=null&&l.disable?(n(),c(ze,{key:0})):k("",!0)]),_:2},1024),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(l==null?void 0:l.descricao),1)]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,{class:"text-weight-medium text-center"},{default:t(()=>[C("span",null,[s(f(i.$filters.data(l==null?void 0:l.dataVencimento))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>a[13]||(a[13]=[s(" Data de Vencimento ")])),_:1})])]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,{class:"text-weight-medium text-right"},{default:t(()=>[s(f(i.$filters.numero(l==null?void 0:l.valor,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[ie]])),128))]}),_:1})):k("",!0),(I=(z=(M=o.boletos)==null?void 0:M.condicoesPagamento)==null?void 0:z.filter(q=>!q.disable&&q.codigoFinanceiroBoleto))!=null&&I.length?(n(),c(W,{key:2,dense:"",highlight:"",bordered:"","rounded-borders":"",class:"q-pa-none q-mx-sm q-my-lg"},{default:t(()=>{var q,D;return[e(p,{header:"",class:"text-weight-medium"},{default:t(()=>[C("span",null,[e(oe,{modelValue:o.boletos.emitidos,"onUpdate:modelValue":[a[0]||(a[0]=l=>o.boletos.emitidos=l),a[1]||(a[1]=l=>v.checkboxTodos("emitidos"))]},null,8,["modelValue"]),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[s(f(o.boletos.emitidos?"Desmarcar Todos":"Marcar Todos"),1)]),_:1})]),a[14]||(a[14]=s(" Boletos Emitidos "))]),_:1}),(n(!0),T(H,null,Q((D=(q=o.boletos)==null?void 0:q.condicoesPagamento)==null?void 0:D.filter(l=>!l.disable&&l.codigoFinanceiroBoleto),(l,d)=>J((n(),c(y,{key:d,tag:"label"},{default:t(()=>[e(r,{side:""},{default:t(()=>[e(oe,{modelValue:l.checked,"onUpdate:modelValue":[u=>l.checked=u,a[2]||(a[2]=u=>v.checkboxTodos())]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[e(y,{class:"q-pa-none",style:{"min-height":"22px"}},{default:t(()=>[e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(l==null?void 0:l.descricao),1)]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,{class:"text-weight-medium text-center"},{default:t(()=>[C("span",null,[s(f(i.$filters.data(l==null?void 0:l.dataVencimento))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>a[15]||(a[15]=[s(" Data de Vencimento ")])),_:1})])]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,{class:"text-weight-medium text-right"},{default:t(()=>[s(f(i.$filters.numero(l==null?void 0:l.valor,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(X,{class:"q-mx-sm"}),e(p,{caption:""},{default:t(()=>{var u,g,h,P;return[C("span",He,f((u=l==null?void 0:l.banco)==null?void 0:u.descricao)+",",1),a[16]||(a[16]=s(" Ag.: ")),C("span",Ae,f((g=l==null?void 0:l.banco)==null?void 0:g.agencia)+",",1),a[17]||(a[17]=s(" C/C: ")),C("span",Qe,f((h=l==null?void 0:l.banco)==null?void 0:h.conta),1),C("span",Oe,[s(f(i.$filters.data((P=l==null?void 0:l.banco)==null?void 0:P.dataEmissao))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>{var A;return[s(" Emitido \xE1s "+f(i.$filters.hora((A=l==null?void 0:l.banco)==null?void 0:A.dataEmissao)),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1024)]),_:2},1024)),[[ie]])),128))]}),_:1})):k("",!0),(N=(B=(V=o.boletos)==null?void 0:V.condicoesPagamento)==null?void 0:B.filter(q=>!q.disable&&!q.codigoFinanceiroBoleto))!=null&&N.length?(n(),c(W,{key:3,dense:"",highlight:"",bordered:"","rounded-borders":"",class:"q-pa-none q-mx-sm q-my-lg"},{default:t(()=>{var q,D;return[e(p,{header:"",class:"text-weight-medium"},{default:t(()=>[C("span",null,[e(oe,{modelValue:o.boletos.emitir,"onUpdate:modelValue":[a[3]||(a[3]=l=>o.boletos.emitir=l),a[4]||(a[4]=l=>v.checkboxTodos("emitir"))]},null,8,["modelValue"]),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[s(f(o.boletos.emitir?"Desmarcar Todos":"Marcar Todos"),1)]),_:1})]),a[18]||(a[18]=s(" Boletos a Emitir "))]),_:1}),e(y,{class:"q-pa-none"},{default:t(()=>[e(r,null,{default:t(()=>[e(he,{modelValue:o.boletos.financeiroBanco,"onUpdate:modelValue":a[5]||(a[5]=l=>o.boletos.financeiroBanco=l),options:o.boletos.bancos,dense:"",filled:"",label:"Op\xE7\xF5es de Bancos",class:"q-field--with-bottom"},null,8,["modelValue","options"])]),_:1})]),_:1}),(n(!0),T(H,null,Q((D=(q=o.boletos)==null?void 0:q.condicoesPagamento)==null?void 0:D.filter(l=>!l.disable&&!l.codigoFinanceiroBoleto),(l,d)=>J((n(),c(y,{key:d,tag:"label"},{default:t(()=>[e(r,{side:""},{default:t(()=>[e(oe,{modelValue:l.checked,"onUpdate:modelValue":[u=>l.checked=u,a[6]||(a[6]=u=>v.checkboxTodos())]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(l==null?void 0:l.descricao),1)]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,{class:"text-weight-medium text-center"},{default:t(()=>[C("span",null,[s(f(i.$filters.data(l==null?void 0:l.dataVencimento))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>a[19]||(a[19]=[s(" Data de Vencimento ")])),_:1})])]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,{class:"text-weight-medium text-right"},{default:t(()=>[s(f(i.$filters.numero(l==null?void 0:l.valor,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[ie]])),128))]}),_:1})):k("",!0),e(ke,{showing:(w=o.boletos)==null?void 0:w.loading},{default:t(()=>[e(ye,{size:"50px",color:"primary"})]),_:1},8,["showing"])]}),_:1})]),_:1}),e(_e,{class:"bg-light"},{default:t(()=>[e(le,null,{default:t(()=>[e(Fe),J(e(U,{label:"Cancelar",color:"tertiary",flat:"",class:"q-mr-sm"},null,512),[[Z]]),e(U,{disable:!v.ativarBotaoEmissaoBoleto,type:"submit",label:"Imprimir",color:"primary",unelevated:""},null,8,["disable"])]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])}var Le=ue(Ie,[["render",Me]]);const je={components:{FaturaModal:Ve,nfePrincipal:Pe,DocumentosFiscais:Ne,ModalHistoricoStatus:De,EmitirBoletos:Le},computed:{config(){return j.configuracoes.valores},mostrarOpcaoRemoverFatura(){return this.dados.fatura.status==="Aberta"&&!this.dados.vendas.length&&!this.dados.documentosEnvelope.length&&!this.dados.carnes.length&&!this.dados.condicaoPagamento.length}},data(){return{dbUsuario:j.usuario,width:0,dados:{fatura:{}},contatos:{},detalhesVisivel:!1,sistemaPai:"",configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],boletos:{visivel:!1,fatura:{},btnEmitirBoleto:!1},podeEditar:!1,mostrarBotaoEnviarAvaliacao:!1,mostrarBotaoEnviarPedidosProtheus:!1,mostrarBotaoEmitirCupom:!1}},emits:["executar","carregou","verificarListaLayout"],mixins:[Ce,xe],props:{id:{required:!0,type:String},layout:{type:String,default:"card"}},methods:{async enviarPedidosProtheus(i){await $db.fatura.enviarPedidosProtheus(i)},async removerFatura(){try{await new Promise((i,a)=>{this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 remover esta fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{i()}).onCancel(()=>{a()})})}catch{return}this.dados.fatura.id?(await j.fatura.remover(this.dados.fatura.id),this.$emit("executar","atualizar")):this.$q.notify("N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o")},abrirEmitirBoletos(i){this.boletos.visivel=!0,this.boletos.fatura=i},alternarDetalhes(i){this.detalhesVisivel=!this.detalhesVisivel,this.layout==="lista"&&this.$emit("verificarListaLayout",{id:i,acao:"detalhes",estado:this.detalhesVisivel})},async atualizar(){const i={},a=await j.fatura.leCompleto(this.id);if(a.vendas.sort((m,o)=>new Date(m.dataHoraFinalizado)<new Date(o.dataHoraFinalizado)?-1:1),a.documentosEnvelope.sort((m,o)=>new Date(m.dataHoraFinalizado)<new Date(o.dataHoraFinalizado)?-1:1),a.carnes.sort((m,o)=>new Date(m.dataVencimento)<new Date(o.dataVencimento)?-1:1),a.vendas)for(const m of a.vendas)i[m.idContatoVendedor]||(i[m.idContatoVendedor]=await j.contato.le({id:m.idContatoVendedor})),i[m.idContatoDigitador]||(i[m.idContatoDigitador]=await j.contato.le({id:m.idContatoDigitador}));if(a.documentosEnvelope)for(const m of a.documentosEnvelope)i[m.idContatoVendedor]||(i[m.idContatoVendedor]=await j.contato.le({id:m.idContatoVendedor})),i[m.idContatoDigitador]||(i[m.idContatoDigitador]=await j.contato.le({id:m.idContatoDigitador}));if(a.fatura.idContato){const m=a.fatura.idContato;i[m]||(i[m]=await j.contato.le({id:m}))}if(a.fatura.idEmpresa){const m=a.fatura.idEmpresa;i[m]||(i[m]=await j.contato.le({id:m}))}if(a.fatura){let m=[],o=[];for(const v of a.vendas)m.push(v.idContatoVendedor),o.push(v.idContatoDigitador);for(const v of a.documentosEnvelope)m.push(v.idContatoVendedor),o.push(v.idContatoDigitador);a.fatura.vendedores=[...new Set(m)],a.fatura.digitadores=[...new Set(o)]}a.fatura.permiteNFSe=await this.exibirEmitirNFSe(a.fatura.id),this.contatos=i,this.dados=a,this.condicaoPagamento=a.condicaoPagamento,await this.resumeCondicaoPagamento();const F=(await j.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.podeEditar=!1,F.find(m=>m.id===a.fatura.idEmpresa)&&(this.podeEditar=!0),await this.configuraVisibilidadeBotoes(),await this.configuraVisibilidadeBtnBoletos(),await this.configuraImpressaoCarne(a.fatura.idEmpresa),await this.configuraImpressaoConvenio(a.fatura.idEmpresa),await this.configuraImpressaoEnvelope(a.fatura.idEmpresa),await this.configuraImpressaoFatura(a.fatura.idEmpresa),this.$nextTick(()=>{a.fatura.id===localStorage.getItem("idFatura")&&(this.podeEditar&&this.$refs.faturaModal.mostrar({id:this.dados.fatura.id}),localStorage.removeItem("idFatura"))})},editar(){this.$refs.faturaModal.mostrar({id:this.dados.fatura.id})},async executar(i){switch(i){case"atualizar":case"finalizar":case"retornarOrcamento":case"remover":this.$emit("executar","atualizar");return}await this.atualizar()},async sendReview(i){try{this.$q.loading.show();const a=[],F=this.contatos[i.idContato],m=await $api.bten.send(F,i);for(let o=0;o<m.length;o++){const v=m[o];v.status?a.push(v.telefone):this.$q.notifyError(`Falha ao enviar NPS para ${v.telefone}!`)}this.$q.loading.hide(),a.length&&this.$q.notifyPositive(`NPS enviado para ${a.join(",")}!`)}catch(a){if(a.name==="GeeksException"){this.$q.notifyAlert(a.message);return}this.$q.notifyError("N\xE3o foi possivel enviar NPS para o contato.",a)}finally{this.$q.loading.hide()}},fechouNFe(i){i&&$utils.emitter.emit("atualizarDocumentosFiscais")},async exibirEmitirNFSe(i){const a=(await $db.hibrido.lista({table:"documento",where:{idFatura:i}}))[0];return(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:a.id}})).some(m=>m.tipoItem==="Servi\xE7o")},async emitirNFSe(i){var F,m,o,v,E,x,S,R,M;const a=await this.verificaNFSeJaEmitida(i.idFatura);if(!a){const z=(await $db.hibrido.lista({table:"documento",where:{idFatura:i.idFatura}}))[0],I=(await $erp().empresa.toArray()).find(h=>h.numeroDocumentoNacional.replace(/\D/g,"")===z.numeroDocumentoEmpresa.replace(/\D/g,""));let V,B,N,w;I!=null&&I.idContato&&(w=await $db.contato.le({id:I.idContato}),V=(await $db.empresa.le({idContato:I.idContato}))[0],B=await $db.contatoEndereco.leEnderecoPrincipal(I.idContato),V!=null&&V.nfseCodigoServico&&(N=JSON.parse(V==null?void 0:V.nfseItensListaDeServico).find(h=>h.codigo==="01.07")));const q=(await $db.contato.le()).find(h=>h.numeroDocumentoNacional===z.numeroDocumentoContato),D=await $db.contatoEndereco.leEnderecoPrincipal(q.id),l=$utils.uuid(),d=await this.obterNFSeRPSMaisRecente(),u={numero:null,numeroLote:"",inscricaoMunicipal:(F=w.numeroDocumentoMunicipal)!=null?F:"",quantidadeRps:1,identificacaoRps:{},dataEmissao:new Date,dataHoraCriacao:new Date,optanteSimplesNacional:(V==null?void 0:V.nfseOptanteSimples)||"",incentivadorCultural:(V==null?void 0:V.nfseIncentivadorCultural)||"",naturezaOperacao:(V==null?void 0:V.nfseNaturezaOperacao)||"",regimeEspecialTributacao:(V==null?void 0:V.nfseRegimeTributario)||"",status:1,servico:{itemListaServico:N==null?void 0:N.codigo,codigoCnae:N==null?void 0:N.codigoCNAE,codigoTributacaoMunicipio:N==null?void 0:N.codigoTributacao,discriminacao:N==null?void 0:N.descricao,municipioPrestacaoServico:(m=B==null?void 0:B.ibgeCod)!=null?m:"",valores:{valorServicos:z.totalDocumento,valorPis:0,valorInss:0,valorCsll:0,issRetido:"2",valorIss:0,baseCalculo:z.totalDocumento,aliquota:(o=V==null?void 0:V.nfseAliquotaIss)!=null?o:0,valorLiquidoNfse:z.totalDocumento,descontoIncondicionado:0,descontoCondicionado:0}},prestador:{documento:z.numeroDocumentoEmpresa.replace(/\D/g,""),razaoSocial:z.descricaoEmpresa,inscricaoMunicipal:(v=w.numeroDocumentoMunicipal)!=null?v:""},tomador:{documento:z.numeroDocumentoContato.replace(/\D/g,""),razaoSocial:z.descricaoContato,endereco:{rua:D.logradouro,numero:D.numero,bairro:D.bairro,cidade:D.ibgeCod,estado:D.uf,cep:D.cep}},id:l};if(d){const h=(x=JSON.parse((E=d==null?void 0:d.json)!=null?E:null))==null?void 0:x.rps,P=(Number((S=h==null?void 0:h.identificacaoRps)==null?void 0:S.numero)||0)+1;u.identificacaoRps.numero=P.toString(),u.identificacaoRps.serie=(R=h==null?void 0:h.identificacaoRps)==null?void 0:R.serie,u.numeroLote=u.numeroLote||P.toString()}const g={id:l,tipo:"NFSe",situacao:"Rascunho",tpAmb:2,dataHoraCriacao:new Date,dataHoraEmissao:new Date,dahEmi:new Date,cpfCnpjEmitente:z.numeroDocumentoEmpresa.replace(/\D/g,""),xNomeEmitente:z.descricaoEmpresa,cpfCnpjDestinatario:z.numeroDocumentoContato.replace(/\D/g,""),xNomeDestinatario:z.descricaoContato,json:JSON.stringify({rps:u}),idDocumento:i.idFatura,vNF:z.totalDocumento};console.log(g),await $db.documentoFiscalEletronico.grava({atual:g,original:{}}),this.$router.push({name:"NFSe",params:{id:(M=g.id)!=null?M:null}})}a&&$q.dialog({title:"NFS-e j\xE1 emitida",message:"Uma NFse j\xE1 foi emitida para esta fatura ou para a venda relacionada",cancel:!0,persistent:!0}).onOk(()=>{console.log("NFSe j\xE1 emitida")})},async obterNFSeRPSMaisRecente(){var a;let i;return i=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}}),i.sort((F,m)=>{var E,x,S,R,M,z,I,V;const o=(R=(S=(x=JSON.parse((E=F.json)!=null?E:null))==null?void 0:x.rps)==null?void 0:S.identificacaoRps)==null?void 0:R.numero,v=(V=(I=(z=JSON.parse((M=m.json)!=null?M:null))==null?void 0:z.rps)==null?void 0:I.identificacaoRps)==null?void 0:V.numero;return o>v?-1:1}),(a=i[0])!=null?a:nul},async verificaNFSeJaEmitida(i){var o,v,E;let a=(await $db.hibrido.lista({table:"documento"})).filter(x=>{if(x.id===i||x.idFatura===i)return x}),F=(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}})).filter(x=>x==null?void 0:x.idDocumento),m=!1;for(let x in F){const S=(o=F[x])==null?void 0:o.idDocumento;if(S)for(let R in a)S===((v=a[R])==null?void 0:v.id)&&(m=!0),S===((E=a[R])==null?void 0:E.idFatura)&&(m=!0)}return m},async configuraImpressaoConvenio(i){const a=await j.configuracoes.porNome("impressao.convenio",i);this.configImpressaoConvenio=[...a.length?a.map(F=>({texto:"Imprimir Conv\xEAnio",...F})):[{valor:"convenio",texto:"Imprimir Conv\xEAnio"}]]},async configuraImpressaoCarne(i){const a=await j.configuracoes.porNome("impressao.carne",i);this.configImpressaoCarne=[...a.length?a.map(F=>({texto:"Imprimir Carn\xEA",...F})):[{valor:"carne-crediario",texto:"Reimprimir carn\xEA e notas promiss\xF3rias da fatura"}]]},async configuraImpressaoEnvelope(i){const a=await j.configuracoes.porNome("impressao.envelope",i);this.configImpressaoEnvelope=[...a.length?a.map(F=>({texto:"Imprimir Envelope",...F})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoFatura(i){const a=await j.configuracoes.porNome("impressao.fatura",i),F=[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}];this.sistemaPai==="optisoul"&&F.push({valor:"termoGarantia",texto:"Termo de Garantia"}),this.configImpressaoFatura=[...a.length?a.map(m=>({texto:"Imprimir Fatura",...m})):F]},async configuraVisibilidadeBotoes(){var m,o,v,E,x;let i,a,F;i=await $db.configuracoes.leValorComFiltroEmpresa("integrador.idDispositivo",this.dados.fatura.idEmpresa),this.mostrarBotaoEmitirCupom=!!i,i=await $db.configuracoes.porNome("integracao.bten.business"),a=(o=(m=i[0])==null?void 0:m.valor)!=null?o:!1,i=await $db.configuracoes.porNome("integracao.bten.authorization"),F=(E=(v=i[0])==null?void 0:v.valor)!=null?E:!1,this.mostrarBotaoEnviarAvaliacao=a&&F,i=await $db.configuracoes.porNome("protheus.credentials"),this.mostrarBotaoEnviarPedidosProtheus=!!((x=i[0])!=null&&x.valor)&&!!this.dados.fatura.dataHoraFinalizado},async configuraVisibilidadeBtnBoletos(){var i,a,F,m,o,v,E,x;try{if((a=(i=this.dados)==null?void 0:i.fatura)!=null&&a.id){const S=[],R=await K().formaPagamento.toArray(),M=await K().empresa.where({idContato:(m=(F=this.dados)==null?void 0:F.fatura)==null?void 0:m.idEmpresa}).toArray();if(await(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:(v=(o=this.dados)==null?void 0:o.fatura)==null?void 0:v.id}})).forEach(w=>{const q=R.find(D=>D.id===w.idFormaPagamento&&D.tipo===99&&D.tipoFinanceiro==="T\xEDtulo em aberto");q&&S.push({descricao:q.descricao})}),!S.length)return;const I=[];await K().financeiroBanco.each(w=>{if(!!w.ativo){if(w.id==="7D07229E-B35E-42AA-A312-78313BE61B2F"){I.push(w);return}w.idEmpresa&&M.find(q=>q.id===w.idEmpresa)&&I.push(w)}});const V=[...new Set(I.map(w=>w.codigoBanco))],B=[];await K()._banco.each(w=>{V.find(q=>q===b.codigoBanco)&&B.push(w)});const N=[];for(const w of I){B.find(D=>D.codigoBanco===w.codigoBanco);N.push({codigoBanco:w.codigoBanco})}this.boletos.btnEmitirBoleto=!!((E=S||[])!=null&&E.length)&&!!((x=N||[])!=null&&x.length)}}catch(S){console.error("ERRO: ",S)}}},onResize(){this.width=window.innerWidth},async mounted(){this.sistemaPai=Be(),await this.atualizar(),this.$emit("carregou")}},Ue={id:"FaturaCard"},Je={class:"col-12 col-md-6 q-pl-none"},Ge={class:"q-item-section"},We={class:"col-3 col-md hideonmobile"},Ye={class:"text-left q-my-none"},Ze={class:"col-3 col-md hideonmobile"},Ke={class:"text-left q-my-none"},Xe={class:"col-6 col-md hideonmobile"},$e={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},et={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},tt={class:"col-12 col-md-6"},at={class:"col-12 col-md-6 full-height items-end hideonmobile"},ot={class:"col-6"},it={class:"text-left q-my-none hideondesktop"},lt={class:"text-left q-my-none"},rt={class:"col-6"},st={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},nt={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},dt={class:"col-12 full-height items-end"},ut={class:"col-12 col-md-6"},mt={class:"text-subtitle1 text-weight-bold q-ma-none items-center"},ft={class:"col-12 col-md-4"},ct={class:"q-ma-none"},pt={class:"col-12 col-md-2 text-right"},bt={class:"q-ma-none"},vt={class:"mw80 text-center"},gt={style:{"margin-left":"14px"}},ht={style:{"margin-left":"14px"}},kt={class:"float-right text-weight-medium text-right q-ml-sm",style:{"min-width":"70px"}};function yt(i,a,F,m,o,v){const E=Y("avatar"),x=Y("badge"),S=Y("BadgeCopiarUid"),R=Y("row"),M=Y("documentos-fiscais"),z=Y("g-label"),I=Y("g-col"),V=Y("DocumentosFiscais"),B=Y("g-row"),N=Y("fatura-modal"),w=Y("modal-historico-status"),q=Y("nfePrincipal"),D=Y("EmitirBoletos");return n(),T("div",Ue,[F.layout==="card"?(n(),T(H,{key:0},[o.dados.fatura.id?(n(),c(Ee,{key:0,class:"extratoItem bg-grey-1 q-pa-sm no-shadow"},{default:t(()=>[e(R,{class:"items-center q-mx-none q-px-none q-mb-sm"},{default:t(()=>[C("div",Je,[e(le,{class:"q-pa-none"},{default:t(()=>{var l,d,u,g,h,P;return[e(E,{imagem:(o.contatos[o.dados.fatura.idContato]||{}).imagem,rotulo:o.dados.fatura.descricaoContato,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"]),e(me,null,{default:t(()=>[C("div",Ge,[e(p,null,{default:t(()=>[s(f((o.contatos[o.dados.fatura.idContato]||{}).apelido),1)]),_:1}),(o.contatos[o.dados.fatura.idContato]||{}).nome!==(o.contatos[o.dados.fatura.idContato]||{}).apelido?(n(),c(p,{key:0,caption:""},{default:t(()=>[s(f((o.contatos[o.dados.fatura.idContato]||{}).nome),1)]),_:1})):k("",!0)])]),_:1}),e(x,{rotulo:o.dados.fatura.status,cor:"tertiary",escuro:"",class:"q-mr-sm"},null,8,["rotulo"]),e(S,{id:(d=(l=o.dados)==null?void 0:l.fatura)==null?void 0:d.id,numero:(g=(u=o.dados)==null?void 0:u.fatura)==null?void 0:g.numero,cor:((P=(h=o.dados)==null?void 0:h.fatura)==null?void 0:P.status)==="Finalizada"?"positive":"tertiary",escuro:""},null,8,["id","numero","cor"])]}),_:1})]),C("div",We,[C("p",Ye,[o.dados.fatura.dataHoraEmissao?(n(),c(_,{key:0,name:"mdi-calendar-today "})):k("",!0),s(" "+f(i.$filters.data(o.dados.fatura.dataHoraEmissao))+" ",1),e(L,null,{default:t(()=>a[39]||(a[39]=[s(" Emiss\xE3o ")])),_:1})])]),C("div",Ze,[C("p",Ke,[o.dados.fatura.dataHoraFinalizado?(n(),c(_,{key:0,name:"mdi-calendar-check"})):k("",!0),s(" "+f(i.$filters.data(o.dados.fatura.dataHoraFinalizado))+" ",1),e(L,null,{default:t(()=>a[40]||(a[40]=[s(" Finalizado ")])),_:1})])]),C("div",Xe,[C("p",$e,f(i.$filters.numero(o.dados.fatura.totalDocumento,2)),1),C("p",et,f(i.$filters.numero(o.dados.fatura.subTotal,2)),1)])]),_:1}),e(X,{class:"hideondesktop q-mb-sm"}),e(R,{class:"q-mx-none q-px-none items-end"},{default:t(()=>[C("div",tt,[e(W,{class:"no-border text-tertiary"},{default:t(()=>[(n(!0),T(H,null,Q(o.dados.vendas,l=>(n(),c(y,{key:l.id,class:"items-center q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:t(()=>[e(r,{avatar:"",class:"mw80"},{default:t(()=>[e(p,null,{default:t(()=>[s(f(l.tipo)+" ",1),e(ae,{dark:"",color:"tertiary",denso:"",round:""},{default:t(()=>[s("#"+f(parseInt(l.numero)||(l.id||"").slice(-6)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.data(l.dataHoraFinalizado))+" - "+f((o.contatos[l.idContatoVendedor]||{}).apelido)+" ",1),e(L,null,{default:t(()=>a[41]||(a[41]=[s(" Data Finalizado - Vendedor ")])),_:1})]),_:2},1024)]),_:2},1024),e(r,{avatar:"",class:"mw50"},{default:t(()=>[e(ae,{dark:"",rounded:"",color:"tertiary",denso:""},{default:t(()=>[s(f(l.status),1)]),_:2},1024)]),_:2},1024),e(r,{right:"",top:"",class:"mw50"},{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.numero(l.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(W,{class:"no-border text-tertiary"},{default:t(()=>[(n(!0),T(H,null,Q(o.dados.documentosEnvelope,l=>(n(),c(y,{key:l.id,class:"items-center q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:t(()=>[e(r,{avatar:"",class:"mw80"},{default:t(()=>[e(p,null,{default:t(()=>[s(f(l.tipo)+" ",1),e(ae,{dark:"",color:"tertiary",denso:"",round:""},{default:t(()=>[s("#"+f(parseInt(l.numero)||(l.id||"").slice(-6)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.data(l.dataHoraFinalizado))+" - "+f((o.contatos[l.idContatoVendedor]||{}).apelido)+" ",1),e(L,null,{default:t(()=>a[42]||(a[42]=[s(" Data Finalizado - Vendedor ")])),_:1})]),_:2},1024)]),_:2},1024),e(r,{avatar:"",class:"mw50"},{default:t(()=>[e(ae,{dark:"",rounded:"",color:"tertiary",denso:""},{default:t(()=>[s(f(l.status),1)]),_:2},1024)]),_:2},1024),e(r,{right:"",top:"",class:"mw50"},{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.numero(l.totalDocumento,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(W,{class:"no-border text-tertiary"},{default:t(()=>[(n(!0),T(H,null,Q(o.dados.carnes,l=>(n(),c(y,{key:l.id,class:"q-pa-none q-mb-xs",style:{"min-height":"auto"}},{default:t(()=>[e(r,{avatar:"",class:"mw80"},{default:t(()=>[e(p,null,{default:t(()=>[a[43]||(a[43]=s(" Carn\xEA ")),e(ae,{dark:"",color:"tertiary",denso:"",round:""},{default:t(()=>[s("#"+f((l.id||"").slice(-6)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.data(l.dataVencimento)),1)]),_:2},1024)]),_:2},1024),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(l.formaDePagamento),1)]),_:2},1024)]),_:2},1024),e(r,{right:"",top:""},{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.numero(l.valorTotal,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),C("div",at,[e(X,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(U,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:t(()=>[e($,null,{default:t(()=>[J((n(),c(W,{link:"",separator:""},{default:t(()=>{var l;return[o.dados.fatura.id?(n(),c(y,{key:0,clickable:"",onClick:a[0]||(a[0]=d=>i.$refs.documentosFiscais.emitirCupom(o.dados.fatura.id))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[44]||(a[44]=[s("Emitir cupom")])),_:1})]),_:1})]),_:1})):k("",!0),i.$utils.mapearStatus(o.dados.fatura).permiteNota?(n(),T(H,{key:1},[e(y,{clickable:"",onClick:a[1]||(a[1]=d=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Venda"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[45]||(a[45]=[s("NFe de Sa\xEDda/Venda")])),_:1})]),_:1})]),_:1}),e(y,{clickable:"",onClick:a[2]||(a[2]=d=>i.emitirNFeV2({idFatura:o.dados.fatura.id},0,"Devolu\xE7\xE3o"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[46]||(a[46]=[s("NFe de Entrada/Devolu\xE7\xE3o")])),_:1})]),_:1})]),_:1}),e(y,{clickable:"",onClick:a[3]||(a[3]=d=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Remessa"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[47]||(a[47]=[s("NFe de Remessa")])),_:1})]),_:1})]),_:1}),(l=o.dados.fatura)!=null&&l.permiteNFSe?J((n(),c(y,{key:0,clickable:"",onClick:a[4]||(a[4]=d=>v.emitirNFSe({idFatura:o.dados.fatura.id}))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>a[48]||(a[48]=[s("Emitir NFSe")])),_:1})]),_:1})),[[Z]]):k("",!0)],64)):k("",!0),v.mostrarOpcaoRemoverFatura?(n(),c(y,{key:2,clickable:"",onClick:a[5]||(a[5]=d=>v.removerFatura())},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-trash-can"})]),_:1}),e(r,null,{default:t(()=>a[49]||(a[49]=[s("Remover Fatura")])),_:1})]),_:1})):k("",!0),e(y,{clickable:"",onClick:a[6]||(a[6]=d=>i.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.fatura.id}))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"history"})]),_:1}),e(r,null,{default:t(()=>a[50]||(a[50]=[s("Hist\xF3rico do Status")])),_:1})]),_:1}),o.mostrarBotaoEnviarAvaliacao&&o.dados.fatura.status==="Finalizada"?(n(),c(y,{key:3,clickable:"",onClick:a[7]||(a[7]=d=>v.sendReview(o.dados.fatura))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-file-replace-outline"})]),_:1}),e(r,null,{default:t(()=>a[51]||(a[51]=[s("Enviar Avalia\xE7\xE3o")])),_:1})]),_:1})):k("",!0),o.mostrarBotaoEnviarPedidosProtheus?(n(),c(y,{key:4,clickable:"",onClick:a[8]||(a[8]=d=>v.enviarPedidosProtheus(o.dados.fatura.id))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"send"})]),_:1}),e(r,null,{default:t(()=>a[52]||(a[52]=[s("Enviar Pedidos - Protheus")])),_:1})]),_:1})):k("",!0)]}),_:1})),[[Z]])]),_:1})]),_:1}),o.podeEditar?(n(),c(U,{key:0,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-ma-xs",size:"md",onClick:v.editar,style:{float:"right"}},null,8,["onClick"])):k("",!0),e(U,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:t(()=>[e($,null,{default:t(()=>[J((n(),c(W,{link:"",separator:""},{default:t(()=>{var l;return[(l=o.boletos)!=null&&l.btnEmitirBoleto?(n(),c(y,{key:0,clickable:"",onClick:a[9]||(a[9]=d=>{var u;return v.abrirEmitirBoletos((u=o.dados)==null?void 0:u.fatura)})},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-printer"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[53]||(a[53]=[s("Emitir Boleto")])),_:1})]),_:1})]),_:1})):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoFatura,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(n(!0),T(H,{key:1},Q(o.configImpressaoEnvelope,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoCarne,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(n(!0),T(H,null,Q(o.configImpressaoConvenio,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})),[[Z]])]),_:1})]),_:1}),e(U,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs",color:"tertiary",style:{float:"right"},onClick:v.alternarDetalhes},null,8,["icon","onClick"])])]),_:1}),e(X,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(R,{class:"hideondesktop"},{default:t(()=>[C("div",ot,[C("p",it,[o.dados.fatura.dataHoraEmissao?(n(),c(_,{key:0,name:"mdi-calendar-today"})):k("",!0),s(" "+f(i.$filters.data(o.dados.fatura.dataHoraEmissao))+" ",1),e(L,null,{default:t(()=>a[54]||(a[54]=[s(" Emiss\xE3o ")])),_:1})]),C("p",lt,[o.dados.fatura.dataHoraFinalizado?(n(),c(_,{key:0,name:"mdi-calendar-check"})):k("",!0),s(" "+f(i.$filters.data(o.dados.fatura.dataHoraFinalizado))+" ",1),o.dados.fatura.dataHoraFinalizado?(n(),c(L,{key:1},{default:t(()=>a[55]||(a[55]=[s(" Finalizado ")])),_:1})):k("",!0)])]),C("div",rt,[C("p",st,f(i.$filters.numero(o.dados.fatura.subTotal,2)),1),C("p",nt,f(i.$filters.numero(o.dados.fatura.totalDocumento,2)),1)]),C("div",dt,[e(X,{class:"hideondesktop q-mb-sm q-mt-xs"}),e(U,{rounded:"",dense:"",flat:"",icon:"more_vert",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:t(()=>[e($,null,{default:t(()=>[J((n(),c(W,{link:"",separator:""},{default:t(()=>{var l;return[o.mostrarBotaoEmitirCupom&&o.dados.fatura.id?(n(),c(y,{key:0,clickable:"",onClick:a[10]||(a[10]=d=>i.$refs.documentosFiscais.emitirCupom(o.dados.fatura.id))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[56]||(a[56]=[s("Emitir cupom")])),_:1})]),_:1})]),_:1})):k("",!0),i.$utils.mapearStatus(o.dados.fatura).permiteNota?(n(),T(H,{key:1},[e(y,{clickable:"",onClick:a[11]||(a[11]=d=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Venda"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[57]||(a[57]=[s("NFe de Sa\xEDda/Venda")])),_:1})]),_:1})]),_:1}),e(y,{clickable:"",onClick:a[12]||(a[12]=d=>i.emitirNFeV2({idFatura:o.dados.fatura.id},0,"Devolu\xE7\xE3o"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[58]||(a[58]=[s("NFe de Entrada/Devolu\xE7\xE3o")])),_:1})]),_:1})]),_:1}),e(y,{clickable:"",onClick:a[13]||(a[13]=d=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Remessa"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[59]||(a[59]=[s("NFe de Remessa")])),_:1})]),_:1})]),_:1}),(l=o.dados.fatura)!=null&&l.permiteNFSe?J((n(),c(y,{key:0,clickable:"",onClick:a[14]||(a[14]=d=>v.emitirNFSe({idFatura:o.dados.fatura.id}))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>a[60]||(a[60]=[s("Emitir NFSe")])),_:1})]),_:1})),[[Z]]):k("",!0)],64)):k("",!0),v.mostrarOpcaoRemoverFatura?(n(),c(y,{key:2,clickable:"",onClick:a[15]||(a[15]=d=>v.removerFatura())},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-trash-can"})]),_:1}),e(r,null,{default:t(()=>a[61]||(a[61]=[s("Remover Fatura")])),_:1})]),_:1})):k("",!0),e(y,{clickable:"",onClick:a[16]||(a[16]=d=>i.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.fatura.id}))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"history"})]),_:1}),e(r,null,{default:t(()=>a[62]||(a[62]=[s("Hist\xF3rico do Status")])),_:1})]),_:1}),o.mostrarBotaoEnviarAvaliacao&&o.dados.fatura.status==="Finalizada"?(n(),c(y,{key:3,clickable:"",onClick:a[17]||(a[17]=d=>v.sendReview(o.dados.fatura))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-file-replace-outline"})]),_:1}),e(r,null,{default:t(()=>a[63]||(a[63]=[s("Enviar Avalia\xE7\xE3o")])),_:1})]),_:1})):k("",!0),o.mostrarBotaoEnviarPedidosProtheus?(n(),c(y,{key:4,clickable:"",onClick:a[18]||(a[18]=d=>v.enviarPedidosProtheus(o.dados.fatura.id))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"send"})]),_:1}),e(r,null,{default:t(()=>a[64]||(a[64]=[s("Enviar Pedidos - Protheus")])),_:1})]),_:1})):k("",!0)]}),_:1})),[[Z]])]),_:1})]),_:1}),o.podeEditar?(n(),c(U,{key:0,rounded:"",dense:"",flat:"",icon:"edit",color:"primary",class:"no-shadow q-ma-xs",size:"md",onClick:v.editar,style:{float:"right"}},null,8,["onClick"])):k("",!0),e(U,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs",size:"md",style:{float:"right"}},{default:t(()=>[e($,null,{default:t(()=>[e(W,{link:"",separator:""},{default:t(()=>{var l;return[(l=o.boletos)!=null&&l.btnEmitirBoleto?(n(),c(y,{key:0,clickable:"",onClick:a[19]||(a[19]=d=>{var u;return v.abrirEmitirBoletos((u=o.dados)==null?void 0:u.fatura)})},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-printer"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[65]||(a[65]=[s("Emitir Boleto")])),_:1})]),_:1})]),_:1})):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoFatura,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(n(!0),T(H,{key:1},Q(o.configImpressaoEnvelope,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoCarne,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(n(!0),T(H,null,Q(o.configImpressaoConvenio,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1}),e(U,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs",color:"tertiary",style:{float:"right"},onClick:v.alternarDetalhes},null,8,["icon","onClick"])])]),_:1}),o.detalhesVisivel?(n(),c(X,{key:0,class:"hideondesktop q-my-sm"})):k("",!0),J(e(R,{class:"items-start q-mx-none q-px-none q-mt-md"},{default:t(()=>[C("div",ut,[C("p",mt,[e(_,{name:"business"}),s(" "+f(o.dados.fatura.descricaoEmpresa),1)]),e(M,{ref:"documentosFiscais",idFatura:o.dados.fatura.id},null,8,["idFatura"])]),C("div",ft,[a[66]||(a[66]=C("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Faturamento ",-1)),C("p",ct,f(o.dados.fatura.observacaoFaturamento),1),e(W,{class:"no-border"},{default:t(()=>[(n(!0),T(H,null,Q(i.condicaoPagamentoResumo,l=>(n(),c(y,{key:l.id,class:"q-pa-none row",style:{"min-height":"auto"}},{default:t(()=>[e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(l.formaPagamento),1)]),_:2},1024)]),_:2},1024),e(r,{class:"text-right"},{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.numero(l.valor,2))+f(l.parcelas>1?` (em ${l.parcelas}x)`:""),1)]),_:2},1024)]),_:2},1024),e(r,{right:""},{default:t(()=>[e(p,null,{default:t(()=>[s(f(i.$filters.data(l.dataVencimento)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),C("div",pt,[a[67]||(a[67]=C("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1)),C("p",bt,f(i.$filters.numero(o.dados.fatura.totalDesconto,2)),1)])]),_:1},512),[[ne,o.detalhesVisivel]])]),_:1})):k("",!0)],64)):k("",!0),F.layout==="lista"?(n(),T(H,{key:1},[e(qe,{onResize:i.onResize},null,8,["onResize"]),o.dados.fatura.id?(n(),c(y,{key:0,clickable:"","manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[e(r,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:t(()=>{var l,d,u,g,h,P;return[C("div",vt,[e(S,{id:(d=(l=o.dados)==null?void 0:l.fatura)==null?void 0:d.id,numero:(g=(u=o.dados)==null?void 0:u.fatura)==null?void 0:g.numero,cor:((P=(h=o.dados)==null?void 0:h.fatura)==null?void 0:P.status)==="Finalizada"?"positive":"tertiary",escuro:""},null,8,["id","numero","cor"])])]}),_:1}),e(r,{class:"col-md col-lg col-xl no-margin"},{default:t(()=>[e(y,{class:"q-pa-none"},{default:t(()=>[e(r,{onClick:a[20]||(a[20]=l=>v.editar()),class:"col-auto items-center"},{default:t(()=>{var l,d,u,g,h;return[e(E,{imagem:(u=o.contatos[(d=(l=o.dados)==null?void 0:l.fatura)==null?void 0:d.idContato]||{})==null?void 0:u.imagem,tamanho:"40",rotulo:(h=(g=o.dados)==null?void 0:g.fatura)==null?void 0:h.descricaoContato,style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]}),_:1}),e(r,{onClick:a[21]||(a[21]=l=>v.editar()),class:"col"},{default:t(()=>{var l,d,u;return[e(p,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>{var g,h,P;return[C("span",null,[s(f((P=o.contatos[(h=(g=o.dados)==null?void 0:g.fatura)==null?void 0:h.idContato]||{})==null?void 0:P.apelido)+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>a[68]||(a[68]=[s("Cliente")])),_:1})])]}),_:1}),e(p,{caption:"",class:"hideondesktop"},{default:t(()=>{var g,h,P,A,O,G;return[e(S,{id:(h=(g=o.dados)==null?void 0:g.fatura)==null?void 0:h.id,numero:(A=(P=o.dados)==null?void 0:P.fatura)==null?void 0:A.numero,cor:((G=(O=o.dados)==null?void 0:O.fatura)==null?void 0:G.status)==="Finalizada"?"positive":"tertiary",escuro:"",class:"q-mr-sm"},null,8,["id","numero","cor"])]}),_:1}),o.contatos[o.dados.fatura.idEmpresa]?(n(),c(p,{key:0,caption:"",lines:"2"},{default:t(()=>{var g,h;return[C("span",null,[e(_,{name:"business"}),s(" "+f(((g=o.contatos[o.dados.fatura.idEmpresa])==null?void 0:g.apelido)||((h=o.contatos[o.dados.fatura.idEmpresa])==null?void 0:h.nome))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>a[69]||(a[69]=[s(" Empresa ")])),_:1})])]}),_:1})):k("",!0),(u=(d=(l=o.dados)==null?void 0:l.fatura)==null?void 0:d.vendedores)!=null&&u.length?(n(),c(p,{key:1,caption:"",lines:"2"},{default:t(()=>{var g,h,P;return[C("span",null,[e(_,{name:"mdi-account-tie"}),s(" "+f((P=(h=(g=o.dados)==null?void 0:g.fatura)==null?void 0:h.vendedores)==null?void 0:P.map(A=>{var O;return(O=o.contatos[A])==null?void 0:O.apelido}).filter(Boolean).join(", "))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>{var A,O,G;return[s(f(((G=(O=(A=o.dados)==null?void 0:A.fatura)==null?void 0:O.vendedores)==null?void 0:G.length)>1?"Vendedores":"Vendedor"),1)]}),_:1})])]}),_:1})):k("",!0),e(r,{class:"hideondesktop q-mt-sm"},{default:t(()=>[e(y,{class:"q-pa-none",style:{"min-height":"36px!important"}},{default:t(()=>[e(r,{top:"",class:"col-5 no-margin"},{default:t(()=>{var g,h,P,A;return[(h=(g=o.dados)==null?void 0:g.fatura)!=null&&h.dataHoraEmissao?(n(),c(p,{key:0,caption:""},{default:t(()=>{var O,G;return[e(_,{name:"mdi-calendar-today",style:{position:"absolute","margin-top":"2px"}}),C("span",gt,f(i.$filters.data((G=(O=o.dados)==null?void 0:O.fatura)==null?void 0:G.dataHoraEmissao)),1)]}),_:1})):k("",!0),(A=(P=o.dados)==null?void 0:P.fatura)!=null&&A.dataHoraFinalizado?(n(),c(p,{key:1,caption:""},{default:t(()=>{var O,G;return[e(_,{name:"mdi-calendar",style:{position:"absolute","margin-top":"2px"}}),C("span",ht,f(i.$filters.data((G=(O=o.dados)==null?void 0:O.fatura)==null?void 0:G.dataHoraFinalizado)),1)]}),_:1})):k("",!0)]}),_:1}),e(r,{top:"",class:"col-7 no-margin text-right"},{default:t(()=>{var g,h,P,A,O,G;return[(h=(g=o.dados)==null?void 0:g.fatura)!=null&&h.totalDocumento?(n(),c(p,{key:0,caption:"",class:"text-weight-bold"},{default:t(()=>{var ee,te;return[s(f(i.$filters.numero((te=(ee=o.dados)==null?void 0:ee.fatura)==null?void 0:te.totalDocumento,2)),1)]}),_:1})):k("",!0),((A=(P=o.dados)==null?void 0:P.fatura)==null?void 0:A.subTotal)!==((G=(O=o.dados)==null?void 0:O.fatura)==null?void 0:G.totalDocumento)?(n(),c(p,{key:1,caption:""},{default:t(()=>{var ee,te;return[s(f(i.$filters.numero((te=(ee=o.dados)==null?void 0:ee.fatura)==null?void 0:te.subTotal,2)),1)]}),_:1})):k("",!0)]}),_:1})]),_:1})]),_:1})]}),_:1})]),_:1})]),_:1}),e(r,{onClick:a[22]||(a[22]=l=>v.editar()),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>{var l,d,u,g;return[(d=(l=o.dados)==null?void 0:l.fatura)!=null&&d.dataHoraEmissao?(n(),c(p,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>{var h,P;return[C("span",null,[e(_,{name:"mdi-calendar-today"}),s(" "+f(i.$filters.data((P=(h=o.dados)==null?void 0:h.fatura)==null?void 0:P.dataHoraEmissao))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>{var A,O;return[s(" Emitido \xE0s "+f(i.$filters.hora((O=(A=o.dados)==null?void 0:A.fatura)==null?void 0:O.dataHoraEmissao)),1)]}),_:1})])]}),_:1})):k("",!0),(g=(u=o.dados)==null?void 0:u.fatura)!=null&&g.dataHoraFinalizado?(n(),c(p,{key:1,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>{var h,P;return[C("span",null,[e(_,{name:"mdi-calendar"}),s(" "+f(i.$filters.data((P=(h=o.dados)==null?void 0:h.fatura)==null?void 0:P.dataHoraFinalizado))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>{var A,O;return[s(" Finalizado \xE1s "+f(i.$filters.hora((O=(A=o.dados)==null?void 0:A.fatura)==null?void 0:O.dataHoraFinalizado)),1)]}),_:1})])]}),_:1})):k("",!0)]}),_:1}),e(r,{onClick:a[23]||(a[23]=l=>v.editar()),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:t(()=>{var l,d,u,g;return[(d=(l=o.dados)==null?void 0:l.fatura)!=null&&d.totalDocumento?(n(),c(p,{key:0,class:"text-weight-bold text-right"},{default:t(()=>{var h,P;return[C("span",null,[s(f(i.$filters.numero((P=(h=o.dados)==null?void 0:h.fatura)==null?void 0:P.totalDocumento,2))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>a[70]||(a[70]=[s(" Total ")])),_:1})])]}),_:1})):k("",!0),(g=(u=o.dados)==null?void 0:u.fatura)!=null&&g.subTotal?(n(),c(p,{key:1,class:"text-caption text-right"},{default:t(()=>{var h,P;return[C("span",null,[s(f(i.$filters.numero((P=(h=o.dados)==null?void 0:h.fatura)==null?void 0:P.subTotal,2))+" ",1),e(L,{anchor:"bottom middle",self:"center middle"},{default:t(()=>a[71]||(a[71]=[s(" Subtotal ")])),_:1})])]}),_:1})):k("",!0)]}),_:1}),e(r,{class:"col-auto q-pl-sm no-margin"},{default:t(()=>[e(y,{class:"q-pa-none"},{default:t(()=>[e(r,{class:"hideonmobile no-margin"},{default:t(()=>[e(U,{onClick:a[24]||(a[24]=l=>{var d,u;return v.alternarDetalhes((u=(d=o.dados)==null?void 0:d.fatura)==null?void 0:u.id)}),round:"",flat:"",dense:"",size:"md",color:"tertiary",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["icon"])]),_:1}),e(r,{class:"hideonmobile no-margin"},{default:t(()=>[o.podeEditar?(n(),c(U,{key:0,onClick:a[25]||(a[25]=l=>v.editar()),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""})):k("",!0)]),_:1}),e(r,{class:"hideonmobile no-margin"},{default:t(()=>[e(U,{icon:"print",size:"md",round:"",flat:"",dense:"",class:"hideonmobile"},{default:t(()=>[e($,null,{default:t(()=>[J((n(),c(W,{link:"","no-border":"",separator:""},{default:t(()=>{var l;return[(l=o.boletos)!=null&&l.btnEmitirBoleto?(n(),c(y,{key:0,onClick:a[26]||(a[26]=d=>{var u;return v.abrirEmitirBoletos((u=o.dados)==null?void 0:u.fatura)}),clickable:""},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-printer"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[72]||(a[72]=[s("Emitir Boleto")])),_:1})]),_:1})]),_:1})):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoFatura,d=>(n(),c(y,{key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0"),clickable:""},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(n(!0),T(H,{key:1},Q(o.configImpressaoEnvelope,d=>(n(),c(y,{clickable:"",key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoCarne,d=>(n(),c(y,{key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0"),clickable:""},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(n(!0),T(H,null,Q(o.configImpressaoConvenio,d=>(n(),c(y,{key:d.valor,onClick:u=>i.$imprimir(d.valor,(o.dados.fatura||{}).id||"0"),clickable:""},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})),[[Z]])]),_:1})]),_:1})]),_:1}),e(r,{class:"no-margin"},{default:t(()=>[e(U,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:t(()=>[e($,null,{default:t(()=>[J((n(),c(W,{link:"","no-border":"",separator:""},{default:t(()=>{var l,d;return[o.podeEditar?(n(),c(y,{key:0,onClick:a[27]||(a[27]=u=>v.editar()),clickable:"",class:"hideondesktop"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"edit"})]),_:1}),e(r,null,{default:t(()=>a[73]||(a[73]=[s(" Editar ")])),_:1})]),_:1})):k("",!0),e(y,{onClick:a[28]||(a[28]=u=>{var g,h;return v.alternarDetalhes((h=(g=o.dados)==null?void 0:g.fatura)==null?void 0:h.id)}),clickable:"",class:"hideondesktop"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]),_:1}),e(r,null,{default:t(()=>a[74]||(a[74]=[s(" Detalhes ")])),_:1})]),_:1}),o.dados.fatura.id?(n(),c(y,{key:1,clickable:"",onClick:a[29]||(a[29]=u=>i.$refs.documentosFiscais.emitirCupom(o.dados.fatura.id))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[75]||(a[75]=[s("Emitir cupom")])),_:1})]),_:1})]),_:1})):k("",!0),i.$utils.mapearStatus(o.dados.fatura).permiteNota?(n(),c(y,{key:2,clickable:"",onClick:a[30]||(a[30]=u=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Venda"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[76]||(a[76]=[s("NFe de Sa\xEDda/Venda")])),_:1})]),_:1})]),_:1})):k("",!0),i.$utils.mapearStatus(o.dados.fatura).permiteNota?(n(),c(y,{key:3,clickable:"",onClick:a[31]||(a[31]=u=>i.emitirNFeV2({idFatura:o.dados.fatura.id},0,"Devolu\xE7\xE3o"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[77]||(a[77]=[s("NFe de Entrada/Devolu\xE7\xE3o")])),_:1})]),_:1})]),_:1})):k("",!0),i.$utils.mapearStatus(o.dados.fatura).permiteNota?(n(),c(y,{key:4,clickable:"",onClick:a[32]||(a[32]=u=>i.emitirNFeV2({idFatura:o.dados.fatura.id},1,"Remessa"))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[78]||(a[78]=[s("NFe de Remessa")])),_:1})]),_:1})]),_:1})):k("",!0),(l=o.dados.fatura)!=null&&l.permiteNFSe?J((n(),c(y,{key:5,clickable:"",onClick:a[33]||(a[33]=u=>v.emitirNFSe({idFatura:o.dados.fatura.id}))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"account_balance"})]),_:1}),e(r,null,{default:t(()=>a[79]||(a[79]=[s("Emitir NFSe")])),_:1})]),_:1})),[[Z]]):k("",!0),v.mostrarOpcaoRemoverFatura?(n(),c(y,{key:6,clickable:"",onClick:a[34]||(a[34]=u=>v.removerFatura())},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-trash-can"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[80]||(a[80]=[s("Remover Fatura")])),_:1})]),_:1})]),_:1})):k("",!0),e(y,{clickable:"",onClick:a[35]||(a[35]=u=>i.$refs.modalHistoricoStatus.mostrar({idDocumento:o.dados.fatura.id}))},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"history"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[81]||(a[81]=[s("Hist\xF3rico do Status")])),_:1})]),_:1})]),_:1}),o.mostrarBotaoEnviarAvaliacao&&o.dados.fatura.status==="Finalizada"?(n(),c(y,{key:7,onClick:a[36]||(a[36]=u=>v.sendReview(o.dados.fatura)),clickable:""},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-file-replace-outline"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[82]||(a[82]=[s("Enviar Avalia\xE7\xE3o")])),_:1})]),_:1})]),_:1})):k("",!0),(d=o.boletos)!=null&&d.btnEmitirBoleto?(n(),c(y,{key:8,clickable:"",onClick:a[37]||(a[37]=u=>{var g;return v.abrirEmitirBoletos((g=o.dados)==null?void 0:g.fatura)}),class:"hideondesktop"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"mdi-printer"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>a[83]||(a[83]=[s("Emitir Boleto")])),_:1})]),_:1})]),_:1})):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoFatura,u=>(n(),c(y,{key:u.valor,onClick:g=>i.$imprimir(u.valor,(o.dados.fatura||{}).id||"0"),clickable:"",class:"hideondesktop"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(u.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.sistemaPai==="optisoul"?(n(!0),T(H,{key:9},Q(o.configImpressaoEnvelope,u=>(n(),c(y,{clickable:"",class:"hideondesktop",key:u.valor,onClick:g=>i.$imprimir(u.valor,(o.dados.fatura||{}).id||"0")},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(u.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):k("",!0),(n(!0),T(H,null,Q(o.configImpressaoCarne,u=>(n(),c(y,{key:u.valor,onClick:g=>i.$imprimir(u.valor,(o.dados.fatura||{}).id||"0"),clickable:"",class:"hideondesktop"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(u.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(n(!0),T(H,null,Q(o.configImpressaoConvenio,u=>(n(),c(y,{key:u.valor,onClick:g=>i.$imprimir(u.valor,(o.dados.fatura||{}).id||"0"),clickable:"",class:"hideondesktop"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(_,{name:"print"})]),_:1}),e(r,null,{default:t(()=>[e(p,null,{default:t(()=>[s(f(u.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})),[[Z]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):k("",!0),J(e(B,{gutter:"md-x lg-y"},{default:t(()=>[o.dados.fatura.totalDesconto?(n(),c(I,{key:0,col:"xs12"},{default:t(()=>[e(z,{caption:o.width<=992,text:"sub2 regular",class:de(["q-pr-sm",`${o.width<=992?"text-left":"text-right"}`])},{default:t(()=>[a[84]||(a[84]=s(" Desconto: ")),C("span",kt,f(i.$filters.numero(o.dados.fatura.totalDesconto,2)),1)]),_:1},8,["caption","class"])]),_:1})):k("",!0),e(I,{col:"xs12 md6",bordered:""},{default:t(()=>[o.dados.fatura.observacaoFaturamento||i.condicaoPagamentoResumo.length||o.dados.fatura.totalDesconto?(n(),c(z,{key:0,icon:`attach_money ${o.width<=992?"15px":"xs"} tertiary`,caption:o.width<=992,text:"sub2 medium",class:"q-mb-md"},{default:t(()=>a[85]||(a[85]=[s(" Faturamento ")])),_:1},8,["icon","caption"])):k("",!0),o.dados.fatura.observacaoFaturamento?(n(),c(z,{key:1,text:"sub2 regular",class:"q-mb-md q-mx-xs",caption:o.width<=992},{default:t(()=>[a[86]||(a[86]=C("span",{class:"text-weight-medium q-pr-sm"},"Obs.:",-1)),s(" "+f(o.dados.fatura.observacaoFaturamento),1)]),_:1},8,["caption"])):k("",!0),i.condicaoPagamentoResumo.length?(n(),c(W,{key:2},{default:t(()=>[(n(!0),T(H,null,Q(i.condicaoPagamentoResumo,l=>(n(),c(y,{key:l.id,class:de([`${i.condicaoPagamentoResumo.length>1?"border-bottom":""}`,"q-px-sm q-py-none q-mb-md"])},{default:t(()=>[e(r,null,{default:t(()=>[e(p,{class:"text-weight-medium",caption:o.width<=992},{default:t(()=>[s(f(l.formaPagamento),1)]),_:2},1032,["caption"]),e(r,{class:"hideondesktop"},{default:t(()=>[e(y,{class:"q-pa-none"},{default:t(()=>[e(r,{class:"maxw80 no-margin"},{default:t(()=>[e(p,{caption:"",class:"text-weight-medium"},{default:t(()=>[s(f(i.$filters.data(l.dataVencimento)),1)]),_:2},1024),e(p,{caption:""},{default:t(()=>[s(f(i.$filters.hora(l.dataVencimento)),1)]),_:2},1024)]),_:2},1024),e(r,{class:"no-margin"},{default:t(()=>[e(p,{class:"text-right text-weight-medium",caption:o.width<=992},{default:t(()=>[s(f(i.$filters.numero(l.valor,2)),1)]),_:2},1032,["caption"]),l.parcelas?(n(),c(p,{key:0,caption:"",class:"text-right"},{default:t(()=>[s(f(l.parcelas>1?`(${l.parcelas}x)`:""),1)]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{class:"maxw80 no-margin hideonmobile"},{default:t(()=>[e(p,{class:"text-weight-medium",caption:o.width<=992},{default:t(()=>[s(f(i.$filters.data(l.dataVencimento)),1)]),_:2},1032,["caption"]),e(p,{caption:""},{default:t(()=>[s(f(i.$filters.hora(l.dataVencimento)),1)]),_:2},1024)]),_:2},1024),e(r,{class:"maxw100 no-margin hideonmobile"},{default:t(()=>[e(p,{class:"text-right text-weight-medium",caption:o.width<=992},{default:t(()=>[s(f(i.$filters.numero(l.valor,2)),1)]),_:2},1032,["caption"]),l.parcelas?(n(),c(p,{key:0,caption:"",class:"text-right"},{default:t(()=>[s(f(l.parcelas>1?`(${l.parcelas}x)`:""),1)]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):k("",!0)]),_:1}),e(I,{col:"xs12 md6",bordered:""},{default:t(()=>[e(V,{idFatura:o.dados.fatura.id,ref:"documentosFiscais"},null,8,["idFatura"])]),_:1})]),_:1},512),[[ne,o.dados.fatura.id&&o.detalhesVisivel]]),o.dados.fatura.id?(n(),c(X,{key:1})):k("",!0)],64)):k("",!0),e(N,{onExecutar:v.executar,ref:"faturaModal"},null,8,["onExecutar"]),e(w,{ref:"modalHistoricoStatus"},null,512),e(q,{onFechar:v.fechouNFe},null,8,["onFechar"]),e(D,{modelValue:o.boletos.visivel,"onUpdate:modelValue":a[38]||(a[38]=l=>o.boletos.visivel=l),fatura:o.boletos.fatura},null,8,["modelValue","fatura"])])}var Pt=ue(je,[["render",yt]]);export{Pt as F};
