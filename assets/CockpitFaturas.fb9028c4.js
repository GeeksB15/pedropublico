import{_ as D,c6 as k,r as x,o as n,n as l,f as r,w as d,B as g,j as A,d as h,Q as P,az as E,G as I,R as S,S as v,k as U,M as q,e as m,y as O,z as C,bE as F,F as _,s as y,O as Q,aX as T}from"./index.9b156bba.js";import{F as H}from"./FaturaCard.91910560.js";import{G as N}from"./GChipsV2.cdff2fe0.js";import{n as j}from"./nfePrincipal.7455ee94.js";import{J as R}from"./JsonViewer.522116ce.js";import"./emitirNFe.35117289.js";import"./FaturaModal.c2a34fd1.js";import"./DocumentosFiscais.9a161678.js";import"./Campo.7909a0e7.js";import"./compactarValidarNFe.d3892009.js";import"./obterItens.68ea9ec4.js";import"./codigosANP.a6c1a264.js";import"./VendaCard.9cec35eb.js";import"./ModalHistoricoStatus.d2a763d2.js";import"./EnvelopeCard.c011f679.js";import"./QSpinnerHourglass.c114b667.js";import"./QSpinnerDots.b0dfb5d8.js";const B={components:{FaturaCard:H,GChipsV2:N,nfePrincipal:j,JsonViewer:R},computed:{temFaturasAbertas(){return!!this.faturasAbertas.length},temFaturasFinalizadas(){return!!this.faturasFinalizadas.length},temFaturasCanceladas(){return!!this.faturasCanceladas.length},temRegistros(){return this.temFaturasAbertas||this.temFaturasFinalizadas||this.temFaturasCanceladas}},data(){return{grupos:[],faturasAbertas:[],faturasFinalizadas:[],faturasCanceladas:[],filtro:{},dataIni:null,dataFim:null,carregando:!1,pagination:{maxPages:7,perPage:5,faturasAbertas:{page:1,min:1,max:1},faturasFinalizadas:{page:1,min:1,max:1},faturasCanceladas:{page:1,min:1,max:1}}}},methods:{async atualizar(){this.faturas=[],this.carregando=!0,await $utils.dormir(500),await this.filtrar(),this.carregando=!1},executar(i){this.atualizar()},fechouNFe(i){i&&$utils.emitter.emit("atualizarDocumentosFiscais")},async filtrar(){let i=[],s=[],p=[];s=await $erp().empresa.toArray(),s.length&&(p=await $erp().contato.where("id").anyOf(s.map(t=>t.idContato)).toArray(),p=p.filter(t=>t.ativo&&!t.excluido));let c=new Date(this.dataIni).toISOString().replace(/T.*/,"T00:00:00.000Z"),a=new Date(this.dataFim).toISOString().replace(/T.*/,"T23:59:59.999Z");for(const t of p)await $erp().documento.where(["tipo","idEmpresa","dataHoraFinalizado"]).between(["Fatura",t.id,c],["Fatura",t.id,a],!0,!0).each(o=>{i.push(o)}),await $erp().documento.where(["tipo","idEmpresa","dataHoraEmissao"]).between(["Fatura",t.id,c],["Fatura",t.id,a],!0,!0).each(o=>{i.find(w=>w.id===o.id)||i.push(o)});await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")||(p=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,i=i.filter(t=>p.find(o=>o.id===t.idEmpresa)));for(let t of this.grupos)t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(),/^\d+$/gi.test(t)?i=i.filter(o=>[o.numero,o.codigoDocumento].includes(Number(t))):i=i.filter(o=>((o.descricaoContato||"")+(o.descricaoEmpresa||"")).normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().search(t)!==-1);i=$lodash.orderBy(i,"dataHoraEmissao","desc");const b=i.filter(t=>t.status==="Aberta");c=new Date(new Date(c).toDateString()),a=new Date(new Date(a).toDateString());const f=i.filter(t=>{if(~["Aberta","Cancelada"].indexOf(t.status)||!t.dataHoraFinalizado)return!1;const o=new Date(new Date(t.dataHoraFinalizado).toDateString());return!(o<c||o>a)}),V=i.filter(t=>{if(t.status!=="Cancelada"||!t.dataHoraFinalizado)return!1;const o=new Date(new Date(t.dataHoraFinalizado).toDateString());return!(o<c||o>a)});this.pagination.faturasAbertas.max=(b.length/5|0)+(b.length%5>0?1:0),this.pagination.faturasFinalizadas.max=(f.length/5|0)+(f.length%5>0?1:0),this.pagination.faturasCanceladas.max=(V.length/5|0)+(V.length%5>0?1:0),this.faturasAbertas=b,this.faturasFinalizadas=f,this.faturasCanceladas=V},async limparFiltro(){this.grupos=[],this.dataFim=new Date,this.dataIni=new Date(k().add(-7,"days"))},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},watch:{"$route.params.id"(i){!~this.$route.name.indexOf("CockpitFaturas")||(this.limparFiltro(),this.atualizar())}},async mounted(){if(this.$route.params.id){if(this.limparFiltro(),this.periodo&&this.periodo.ini&&this.periodo.fim){const i=new Date(new Date().setHours(0,0,0,0)).toISOString().replace(/\d{4}-\d{2}-\d{2}/g,"");this.dataIni=this.periodo.ini.replace(/T.+$/g,i),this.dataFim=this.periodo.fim.replace(/T.+$/g,i)}this.atualizar()}}},L={class:"AtendimentoFatura q-pb-md"},J={class:"col-12 col-md-6"},G={class:"col"},M=g("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[g("label",null,"at\xE9")],-1),Z={class:"col"},X={key:0,class:"col-12",style:{"margin-bottom":"50px"}},K={key:1,class:"col-12",style:{"margin-bottom":"50px"}},W={key:0,class:"col-12",style:{"margin-bottom":"50px"}},Y={key:1,class:"col-12",style:{"margin-bottom":"50px"}},$={key:0,class:"col-12",style:{"margin-bottom":"50px"}},aa={key:1,class:"col-12",style:{"margin-bottom":"50px"}},ea={key:1,class:"q-pa-lg text-center"},ta=g("p",null,[g("small",null,"Registros n\xE3o encontrados")],-1),ia=[ta],sa={key:2,class:"q-mt-lg text-center"};function ra(i,s,p,c,a,u){const b=x("GChipsV2"),f=x("campo"),V=x("row"),t=x("fatura-card"),o=x("nfePrincipal"),w=x("JsonViewer");return n(),l("div",L,[r(O,{class:"q-pa-sm no-shadow"},{default:d(()=>[r(V,{class:"items-center q-col-gutter-md"},{default:d(()=>[g("div",J,[r(b,{modelValue:a.grupos,"onUpdate:modelValue":[s[0]||(s[0]=e=>a.grupos=e),u.atualizar],placeholder:"Filtre por Cliente, C\xF3digo ou N\xFAmero"},{prepend:d(()=>[r(A,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),g("div",G,[r(f,{modelValue:a.dataIni,"onUpdate:modelValue":[s[1]||(s[1]=e=>a.dataIni=e),u.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),M,g("div",Z,[r(f,{modelValue:a.dataFim,"onUpdate:modelValue":[s[2]||(s[2]=e=>a.dataFim=e),u.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),i.$db.usuario.desenvolvedor()?(n(),h(P,{key:0,icon:"more_vert",round:"",flat:""},{default:d(()=>[r(E,null,{default:d(()=>[I((n(),h(S,{clickable:"",onClick:s[3]||(s[3]=e=>u.mostrarJsonViewer())},{default:d(()=>[r(v,{avatar:""},{default:d(()=>[r(A,{name:"mdi-file-replace",size:"sm"})]),_:1}),r(v,null,{default:d(()=>[U("Ver Objeto")]),_:1})]),_:1})),[[q]])]),_:1})]),_:1})):m("",!0)]),_:1})]),_:1}),!a.carregando&&u.temRegistros?(n(),h(Q,{key:0,class:"no-border row"},{default:d(()=>[u.temFaturasAbertas?(n(),h(C,{key:0,class:"col-12 q-mb-xl","default-opened":"",label:"Abertas (Total R$ "+i.$filters.numero(a.faturasAbertas.reduce((e,z)=>e+z.totalDocumento,0),2)+")",group:"faturasAbertas"},{default:d(()=>[a.pagination.faturasAbertas.max>1?(n(),l("div",X,[r(F,{modelValue:a.pagination.faturasAbertas.page,"onUpdate:modelValue":s[4]||(s[4]=e=>a.pagination.faturasAbertas.page=e),min:a.pagination.faturasAbertas.min,max:a.pagination.faturasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(n(!0),l(_,null,y(a.faturasAbertas.slice((a.pagination.faturasAbertas.page-1)*a.pagination.perPage,a.pagination.faturasAbertas.page*a.pagination.perPage),e=>(n(),l("div",{key:e.id},[r(t,{id:e.id,onExecutar:u.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.faturasAbertas.max>1?(n(),l("div",K,[r(F,{modelValue:a.pagination.faturasAbertas.page,"onUpdate:modelValue":s[5]||(s[5]=e=>a.pagination.faturasAbertas.page=e),min:a.pagination.faturasAbertas.min,max:a.pagination.faturasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),u.temFaturasFinalizadas?(n(),h(C,{key:1,class:"col-12 q-mb-xl","default-opened":"",label:"Finalizadas (Total R$ "+i.$filters.numero(a.faturasFinalizadas.reduce((e,z)=>e+z.totalDocumento,0),2)+")",group:"faturasFinalizadas"},{default:d(()=>[a.pagination.faturasFinalizadas.max>1?(n(),l("div",W,[r(F,{modelValue:a.pagination.faturasFinalizadas.page,"onUpdate:modelValue":s[6]||(s[6]=e=>a.pagination.faturasFinalizadas.page=e),min:a.pagination.faturasFinalizadas.min,max:a.pagination.faturasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(n(!0),l(_,null,y(a.faturasFinalizadas.slice((a.pagination.faturasFinalizadas.page-1)*a.pagination.perPage,a.pagination.faturasFinalizadas.page*a.pagination.perPage),e=>(n(),l("div",{key:e.id},[r(t,{id:e.id,onExecutar:u.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.faturasFinalizadas.max>1?(n(),l("div",Y,[r(F,{modelValue:a.pagination.faturasFinalizadas.page,"onUpdate:modelValue":s[7]||(s[7]=e=>a.pagination.faturasFinalizadas.page=e),min:a.pagination.faturasFinalizadas.min,max:a.pagination.faturasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),u.temFaturasCanceladas?(n(),h(C,{key:2,class:"col-12 q-mb-xl","default-opened":"",label:"Canceladas (Total R$ "+i.$filters.numero(a.faturasCanceladas.reduce((e,z)=>e+z.totalDocumento,0),2)+")",group:"faturasCanceladas"},{default:d(()=>[a.pagination.faturasCanceladas.max>1?(n(),l("div",$,[r(F,{modelValue:a.pagination.faturasCanceladas.page,"onUpdate:modelValue":s[8]||(s[8]=e=>a.pagination.faturasCanceladas.page=e),min:a.pagination.faturasCanceladas.min,max:a.pagination.faturasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(n(!0),l(_,null,y(a.faturasCanceladas.slice((a.pagination.faturasCanceladas.page-1)*a.pagination.perPage,a.pagination.faturasCanceladas.page*a.pagination.perPage),e=>(n(),l("div",{key:e.id},[r(t,{id:e.id,onExecutar:u.executar,class:"q-mb-md"},null,8,["id","onExecutar"])]))),128)),a.pagination.faturasCanceladas.max>1?(n(),l("div",aa,[r(F,{modelValue:a.pagination.faturasCanceladas.page,"onUpdate:modelValue":s[9]||(s[9]=e=>a.pagination.faturasCanceladas.page=e),min:a.pagination.faturasCanceladas.min,max:a.pagination.faturasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0)]),_:1})):m("",!0),!a.carregando&&!u.temRegistros?(n(),l("div",ea,ia)):m("",!0),a.carregando?(n(),l("div",sa,[r(T,{color:"tertiary",size:50})])):m("",!0),r(o,{onFechar:u.fechouNFe},null,8,["onFechar"]),r(w,{ref:"jsonViewer"},null,512)])}var Ca=D(B,[["render",ra]]);export{Ca as default};
