import{_ as z,Z as Q,r as u,o as s,n as c,f as t,w as a,B as i,h as B,i as O,k as m,c$ as N,t as r,d as q,j as C,e as k,m as j,O as M,F as b,s as $,R as E,S as f,T as U,y as S,dH as A,dI as D,Q as y,ax as L,G as w,M as x}from"./index.c8ffb049.js";const P={components:{BadgeCopiarUid:Q},data(){return{}},methods:{async atualizar(){this.os.id&&(this.os.itens=await $db.hibrido.lista({table:"documentoItem",where:{idDocumentoAdicional:this.os.id}}))}},props:{os:{type:Object,required:!0}},mounted(){this.atualizar()}},H={id:"OSCard"},F={class:"col-12 col-md-6"},R={class:"col-8 col-md"},G={class:"text-left q-my-none"},Z={class:"col-auto text-right items-end justify-end"},J={class:"col-12"};function K(e,o,n,I,_,p){const g=u("BadgeCopiarUid"),v=u("row");return s(),c("div",H,[t(S,{class:"card-os q-pa-sm"},{default:a(()=>[t(v,{class:"items-center justify-between q-col-gutter-sm"},{default:a(()=>[i("div",F,[t(B,{class:"q-pa-none"},{default:a(()=>[t(O,null,{default:a(()=>o[0]||(o[0]=[m(" Ordem de servi\xE7o ")])),_:1}),t(N,{rounded:"",color:"tertiary",small:""},{default:a(()=>[m(r(n.os.status),1)]),_:1})]),_:1})]),i("div",R,[i("p",G,[n.os.dataHoraEmissao?(s(),q(C,{key:0,name:"mdi-calendar-today "})):k("",!0),m(" "+r(e.$filters.data(n.os.dataHoraEmissao))+" ",1),t(j,null,{default:a(()=>o[1]||(o[1]=[m(" Emiss\xE3o ")])),_:1})])]),i("div",Z,[t(g,{id:n.os.id,numero:n.os.numero,cor:"positive"},null,8,["id","numero"])])]),_:1}),t(v,{class:"items-center"},{default:a(()=>[i("div",J,[i("div",null,r(n.os.descricao),1),e.$lodash.get(n.os,"itens.length")?(s(),q(M,{key:0,class:"no-border"},{default:a(()=>[(s(!0),c(b,null,$(n.os.itens,d=>(s(),q(E,{key:d.id,class:"q-pa-none",style:{"min-height":"auto"}},{default:a(()=>[t(f,null,{default:a(()=>[i("small",null,r(d.quantidade)+"x",1)]),_:2},1024),t(U,null,{default:a(()=>[i("small",null,r(d.descricaoItem),1)]),_:2},1024),t(f,{right:""},{default:a(()=>[i("small",null,r(e.$filters.numero(d.total,2)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):k("",!0)])]),_:1})]),_:1})])}var W=z(P,[["render",K]]);const X={components:{BadgeCopiarUid:Q,EquipamentoCard:A,EquipamentoModal:D,OSCard:W},data(){return{contato:{},equipamentos:[]}},methods:{async atualizar(){try{this.idContato=this.contato.id,this.equipamentos=(await $db.equipamento.le({idContato:this.idContato})).sort((e,o)=>(e.dataCadastro||"z").localeCompare(o.dataCadastro||"z")),$utils.gconsole.log("Equipamentos","atualizar",this.equipamentos.length,"linhas");for(const e of this.equipamentos)e.oss=await $db.hibrido.lista({table:"documento",where:{idEquipamento:e.id}});console.log("this.equipamentos",this.equipamentos)}catch(e){this.$q.notifyError("Ocorreu erro ao consultar equipamentos",e)}},async abrirModalEquipamento(e){$utils.gconsole.log("Equipamentos","abrirModalEquipamento",{...e}),this.$refs.equipamento.campos=$utils.clonarV2(e),this.$refs.equipamento.original=$utils.clonarV2(e),this.$refs.equipamento.visivel=!0},async duplicarEquipamento(e){e||(e=this.$refs.equipamento.campos);const o=this.$utils.clonarV2(e);o.id=this.$utils.uuid(),delete o.dataCadastro,this.$refs.equipamento.original={},this.$refs.equipamento.campos=o,this.$refs.equipamento.visivel=!0,this.$q.notifyPositive("Equipamento duplicado com sucesso")},async removerEquipamento(e){$utils.gconsole.log("Equipamentos","removerEquipamento",{...e}),$q.dialog({title:"Tem certeza que deseja remover?",message:"Ao continuar voc\xEA ir\xE1 remover o equipamento",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{this.tryLoading(async()=>{await $db.equipamento.remove(e.id),await this.atualizar(),this.$q.notifyPositive("O equipamento foi removido com sucesso")},{erro:"Erro ao remover equipamento"})}).onCancel(()=>{console.log("Cancel")})}},watch:{"$route.params.id"(){const e=this.$route.params.id;!e||$db.contato.le({id:e}).then(o=>{this.contato=o,this.atualizar()}).catch(o=>{$q.notifyError("Ops! Ocorreu um erro",o)})}},mounted(){const e=this.$route.params.id;!e||$db.contato.le({id:e}).then(o=>{this.contato=o,this.atualizar()})}},Y={key:0,class:"bg-white q-pa-xl text-center"};function tt(e,o,n,I,_,p){const g=u("BadgeCopiarUid"),v=u("EquipamentoCard"),d=u("row"),T=u("OSCard"),V=u("EquipamentoModal");return s(),c("div",null,[_.equipamentos.length?(s(!0),c(b,{key:1},$(_.equipamentos,l=>(s(),q(S,{class:"q-px-md q-pb-md q-mb-md bg-white no-shadow rounded-borders",key:l.id},{default:a(()=>[t(B,{class:"q-px-none items-center"},{default:a(()=>[t(O,{class:"q-px-none"},{default:a(()=>[m(r(l.tipo||"Equipamento"),1)]),_:2},1024),t(g,{id:l.id,numero:"",class:"q-my-none q-mr-sm",cor:"positive"},null,8,["id"]),t(y,{color:"primary",flat:"",icon:"edit",onClick:h=>p.abrirModalEquipamento(l),round:""},null,8,["onClick"]),t(y,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:a(()=>[t(L,null,{default:a(()=>[t(M,{link:"",separator:""},{default:a(()=>[w((s(),q(E,{clickable:"",onClick:h=>p.duplicarEquipamento(l)},{default:a(()=>[t(f,{avatar:""},{default:a(()=>[t(C,{name:"file_copy"})]),_:1}),t(f,null,{default:a(()=>o[2]||(o[2]=[m(" Duplicar ")])),_:1})]),_:2},1032,["onClick"])),[[x]]),w((s(),q(E,{clickable:"",onClick:h=>p.removerEquipamento(l)},{default:a(()=>[t(f,{avatar:""},{default:a(()=>[t(C,{name:"delete"})]),_:1}),t(f,null,{default:a(()=>o[3]||(o[3]=[m(" Remover ")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(d,{class:"q-col-gutter-md"},{default:a(()=>[t(v,{equipamento:l},null,8,["equipamento"])]),_:2},1024),t(d,{class:"row"},{default:a(()=>[(s(!0),c(b,null,$(l.oss,h=>(s(),c("div",{key:h.id,class:"col-12 q-mt-lg"},[t(T,{os:h,class:"q-mb-md"},null,8,["os"])]))),128))]),_:2},1024)]),_:2},1024))),128)):(s(),c("div",Y,[i("p",null,"N\xE3o h\xE1 equipamentos cadastrados para o contato "+r((_.contato.nome||"").trim())+".",1),o[1]||(o[1]=i("p",{class:"text-caption"},"Para incluir, utilize o bot\xE3o de adi\xE7\xE3o.",-1))])),o[4]||(o[4]=i("div",{class:"q-ma-xl"},null,-1)),t(y,{round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},onClick:o[0]||(o[0]=l=>p.abrirModalEquipamento({}))}),t(V,{ref:"equipamento",onAtualizar:p.atualizar},null,8,["onAtualizar"])])}var ot=z(X,[["render",tt]]);export{ot as default};
