import{_ as M,dn as A,dp as B,r as f,o as n,n as y,B as t,F as z,s as N,d as p,w as s,f as r,h as K,i as L,t as j,k as w,c$ as g,e as d,Q as h,y as k,b1 as R,b2 as x,l as F,bc as H,bd as E,N as O,D as _,aq as T,G as q,M as U,be as J,dj as G,dk as D,q as V,bD as W,ar as v,j as b,C as X}from"./index.188ab8e6.js";import{Q as Y}from"./QPopupEdit.fd0267cb.js";const Z={visivel:!1,tab:"autenticacao",eCommerce:{},dePara:{columns:[{name:"de",style:"min-width: 160px; width: 160px",align:"left",label:"De",field:"de"},{name:"para",style:"min-width: 200px; width: 200px",align:"left",label:"Para",field:"para"}],rows:[]},descricaoEmpresa:"",descricaoTabelaPreco:"",descricaoOperacao:"",optsParceiro:[{label:"Tray",value:"Tray"},{label:"Uappi",value:"Uappi"}],optsSincronismoProdutos:[{label:"Desativado",value:"desativado"},{label:"B15 <- E-Commerce",value:"importacao"},{label:"B15 -> E-Commerce",value:"exportacao"},{label:"B15 <-> E-Commerce",value:"importacao_exportacao"}]},$={tray:{codigoItem:"id",referencia:"reference",codigoBarras:"ean",descricao:"name",ncm:"ncm",valorVenda:"price",valorCustoReposicao:"cost_price",marca:"brand",quantidadeDisponivel:"stock",ativo:"available"}},ee={tray:["id"]},oe={id:"",parceiro:"",descricao:"",json:{auth:{},idTabelaPreco:"",idEmpresa:"",idDocumentoOperacao:"",sincronismo:{produtos:"exportacao",chaves:[],dePara:{}}},ativo:!1},ae={components:{PromptItemTabelaPrecoNovo:A,PromptDocumentoOperacao:B},computed:{dateExpirationAccessToken(){let l;return this.modal.eCommerce.parceiro==="Tray"&&this.modal.eCommerce.json.auth.dateExpirationAccessToken&&(l=this.modal.eCommerce.json.auth.dateExpirationAccessToken),this.modal.eCommerce.parceiro==="Uappi"&&this.modal.eCommerce.json.auth.expiration&&(l=new Date(this.modal.eCommerce.json.auth.expiration)),l?`Expira em ${$filters.dataHora(l)}`:""},dateExpirationRefreshToken(){var e;const l=(e=this.modal.eCommerce.json.auth.dateExpirationRefreshToken)!=null?e:"";return l?`Expira em ${$filters.dataHora(l)}`:""},habilitarBotaoObterToken(){let l=!1;return this.modal.eCommerce.parceiro==="Tray"&&(l=!!(this.modal.eCommerce.json.auth.authorizationCode&&this.modal.eCommerce.json.auth.apiHost)),this.modal.eCommerce.parceiro==="Uappi"&&(l=!!(this.modal.eCommerce.json.auth.apiKey&&this.modal.eCommerce.json.auth.secretKey&&this.modal.eCommerce.json.auth.apiHost)),l}},data(){return{lista:[],modal:{}}},methods:{async atualizar(){try{const l=await $db.eCommerce.ler();l.forEach(e=>{e.json=JSON.parse(e.json)}),this.lista=l}catch(l){$q.notifyError("Erro ao consultar dados de e-commerce",l)}},async parceiroSelecionado(){const l=this.modal.eCommerce.parceiro.toLowerCase();if($db.integracaoECommerce[l].obterMapeamento){const e=await $db.integracaoECommerce[l].obterMapeamento();this.modal.eCommerce.json.sincronismo.chaves=e.chaves,this.modal.eCommerce.json.sincronismo.dePara=e.dePara}else this.modal.eCommerce.json.sincronismo.chaves=$utils.clonar(ee[l]),this.modal.eCommerce.json.sincronismo.dePara=$utils.clonar($[l]);this.modal.dePara.rows=this.objetoParaLista(this.modal.eCommerce.json.sincronismo.dePara)},criar(){this.limparModal(),this.modal.eCommerce=$utils.clonar(oe),this.modal.eCommerce.id=$utils.uuid(),this.modal.visivel=!0},async editar(l){var e,m,c;if(this.limparModal(),this.modal.eCommerce=$utils.clonar(l),this.modal.eCommerce.json.idEmpresa){const o=await $erp().contato.get(this.modal.eCommerce.json.idEmpresa);this.modal.descricaoEmpresa=(e=o==null?void 0:o.nome)!=null?e:""}if(this.modal.eCommerce.json.idTabelaPreco){const o=await $erp().itemTabelaPreco.get(this.modal.eCommerce.json.idTabelaPreco);this.modal.descricaoTabelaPreco=(m=o==null?void 0:o.descricao)!=null?m:""}if(this.modal.eCommerce.json.idDocumentoOperacao){const o=await $db.hibrido.le({table:"documentoOperacao",id:this.modal.eCommerce.json.idDocumentoOperacao});this.modal.descricaoOperacao=(c=o==null?void 0:o.descricao)!=null?c:""}this.modal.dePara.rows=this.objetoParaLista(this.modal.eCommerce.json.sincronismo.dePara),this.modal.visivel=!0},objetoParaLista(l){const e=[];for(const m in l)e.push({de:m,para:l[m]});return e},listaParaObjeto(l){const e={};for(const m of l)e[m.de]=m.para;return e},limparEmpresa(){this.modal.eCommerce.json.idEmpresa=null,this.modal.descricaoEmpresa=""},limparTabelaPreco(){this.modal.eCommerce.json.idTabelaPreco=null,this.modal.descricaoTabelaPreco=""},limparOperacao(){this.modal.eCommerce.json.idDocumentoOperacao=null,this.modal.descricaoOperacao=""},limparModal(){this.modal=$utils.clonar(Z)},async obterToken(){var l;try{await this.salvar(),$q.loading.show();const e=await $db.integracaoECommerce[this.modal.eCommerce.parceiro.toLowerCase()].autenticar({idECommerce:this.modal.eCommerce.id});this.modal.eCommerce.json.auth={...this.modal.eCommerce.json.auth,...(l=e==null?void 0:e.data)==null?void 0:l.autenticar},$q.notify({type:"positive",message:"Chave de acesso obtida"}),await this.salvar()}catch(e){this.$q.notifyError("N\xE3o foi poss\xEDvel obter a chave de acesso neste momento, tente novamente em instantes!",e)}finally{$q.loading.hide()}},async remover(l){try{await new Promise((e,m)=>{$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Deseja remover este item?",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{e()}).onCancel(()=>{m()})})}catch{return}try{$q.loading.show(),await $db.eCommerce.remover(l),await this.atualizar()}catch(e){$q.notifyError("Erro ao remover dados de e-commerce",e)}finally{$q.loading.hide()}},async salvarModal(){await this.salvar(),this.modal.visivel=!1},async salvar(){try{$q.loading.show();const l=$utils.clonar(this.modal.eCommerce);l.json.sincronismo.dePara=this.listaParaObjeto(this.modal.dePara.rows),l.json=JSON.stringify(l.json),await $db.eCommerce.gravar(l),await this.atualizar(),$q.notify({type:"positive",message:"Configura\xE7\xF5es salvas"})}catch(l){$q.notifyError("Erro ao salvar dados de e-commerce",l)}finally{$q.loading.hide()}},async selecionarEmpresa(){var m,c;const l={filtro:{ativo:!0,empresas:!0},placeholder:"Selecione a empresa"},e=await $g.promptContato.show(l);this.modal.eCommerce.json.idEmpresa=(m=e==null?void 0:e.id)!=null?m:null,this.modal.descricaoEmpresa=(c=e==null?void 0:e.nome)!=null?c:""},async selecionarItemTabelaPreco(l,e){var m,c;l||(this.$refs.promptItemTabelaPreco.placeholder="Selecione a tabela de pre\xE7o",this.$refs.promptItemTabelaPreco.filtro={tabelaMaster:!0,idContatoEmpresa:e},this.$refs.promptItemTabelaPreco.mostrar()),this.modal.eCommerce.json.idTabelaPreco=(m=l==null?void 0:l.id)!=null?m:null,this.modal.descricaoTabelaPreco=(c=l==null?void 0:l.descricao)!=null?c:""},async selecionarDocumentoOperacao(l){var e,m;l||(this.$refs.promptDocumentoOperacao.placeholder="Selecione a opera\xE7\xE3o",this.$refs.promptDocumentoOperacao.mostrar()),this.modal.eCommerce.json.idDocumentoOperacao=(e=l==null?void 0:l.id)!=null?e:null,this.modal.descricaoOperacao=(m=l==null?void 0:l.descricao)!=null?m:""}},async created(){await this.atualizar()}},le={class:"u-container"},re={class:"q-mt-md no-shadow"},se={class:"col text-body1"},te={class:"q-pr-md"},ie={class:"q-mt-md text-center"},me={class:"col-12"},ne={class:"col-12"},de={class:"col-12"},ce={key:0},ue={key:1},pe={class:"row col-12"},he={class:"row col-12 q-gutter-sm"},ve={class:"col-12"},Ce={class:"col-12"},be={class:"col-12"},fe={class:"q-mt-lg text-right"},ye={class:"col-12"},je={class:"col-12"},we={class:"col-12"},Ve={class:"col-12"},Pe={class:"col-12"},Te={class:"col-12"},ge={class:"q-mt-lg text-right"};function ke(l,e,m,c,o,i){const P=f("row"),u=f("campo"),S=f("prompt-item-tabela-preco-novo"),Q=f("prompt-documento-operacao");return n(),y("div",le,[t("div",re,[(n(!0),y(z,null,N(o.lista,a=>(n(),p(k,{class:"bg-white q-mb-md q-pa-md",key:a.id},{default:s(()=>[r(K,null,{default:s(()=>[r(L,null,{default:s(()=>[t("div",null,j(a.descricao),1),r(P,{class:"q-col-gutter-md"},{default:s(()=>[t("div",se,[t("span",te,[e[28]||(e[28]=w("Parceiro: ")),t("strong",null,j(a.parceiro),1)]),a.ativo?(n(),p(g,{key:0,class:"q-ml-sm",color:"positive",escuro:""},{default:s(()=>e[29]||(e[29]=[w("Ativo")])),_:1})):d("",!0),a.ativo?d("",!0):(n(),p(g,{key:1,class:"q-ml-sm",color:"negative",escuro:""},{default:s(()=>e[30]||(e[30]=[w("Desativado")])),_:1}))])]),_:2},1024)]),_:2},1024),r(h,{rounded:"",dense:"",flat:"",icon:"edit",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",onClick:C=>i.editar(a)},null,8,["onClick"]),r(h,{rounded:"",dense:"",flat:"",icon:"delete",color:"tertiary",class:"no-shadow q-ma-xs",size:"md",onClick:C=>i.remover(a.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t("div",ie,[r(h,{color:"positive",icon:"add",label:"E-COMMERCE",outline:"",size:"sm",onClick:e[0]||(e[0]=a=>i.criar())})])]),r(X,{modelValue:o.modal.visivel,"onUpdate:modelValue":e[27]||(e[27]=a=>o.modal.visivel=a),"content-css":{minWidth:"50vw"}},{default:s(()=>[r(k,null,{default:s(()=>[r(R,{modelValue:o.modal.tab,"onUpdate:modelValue":e[1]||(e[1]=a=>o.modal.tab=a)},{default:s(()=>[r(x,{name:"autenticacao",label:"Autentica\xE7\xE3o"}),r(x,{name:"regrasOperacao",label:"Regras de Opera\xE7\xE3o"})]),_:1},8,["modelValue"]),r(F),r(H,{modelValue:o.modal.tab,"onUpdate:modelValue":e[26]||(e[26]=a=>o.modal.tab=a),animated:""},{default:s(()=>[r(E,{name:"autenticacao"},{default:s(()=>[r(O,null,{default:s(()=>[r(_,{onSubmit:i.salvarModal},{default:s(()=>[r(P,{class:"q-col-gutter-md"},{default:s(()=>[t("div",me,[r(T,{label:"Parceiro",dense:"",modelValue:o.modal.eCommerce.parceiro,"onUpdate:modelValue":[e[2]||(e[2]=a=>o.modal.eCommerce.parceiro=a),i.parceiroSelecionado],"emit-value":"","map-options":"",options:o.modal.optsParceiro},null,8,["modelValue","options","onUpdate:modelValue"])]),t("div",ne,[r(u,{maxlength:"250",modelValue:o.modal.eCommerce.descricao,"onUpdate:modelValue":e[3]||(e[3]=a=>o.modal.eCommerce.descricao=a),class:"row",tipo:"texto",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),t("div",de,[o.modal.eCommerce.parceiro==="Tray"?(n(),y("div",ce,[r(u,{maxlength:"250",modelValue:o.modal.eCommerce.json.auth.authorizationCode,"onUpdate:modelValue":e[4]||(e[4]=a=>o.modal.eCommerce.json.auth.authorizationCode=a),class:"row",tipo:"texto",rotulo:"C\xF3digo de autoriza\xE7\xE3o da Loja"},null,8,["modelValue"])])):d("",!0),o.modal.eCommerce.parceiro==="Uappi"?(n(),y("div",ue,[r(u,{maxlength:"250",modelValue:o.modal.eCommerce.json.auth.apiKey,"onUpdate:modelValue":e[5]||(e[5]=a=>o.modal.eCommerce.json.auth.apiKey=a),class:"row",tipo:"texto",rotulo:"Token"},null,8,["modelValue"]),r(u,{maxlength:"250",modelValue:o.modal.eCommerce.json.auth.secretKey,"onUpdate:modelValue":e[6]||(e[6]=a=>o.modal.eCommerce.json.auth.secretKey=a),class:"row",tipo:"texto",rotulo:"Pass"},null,8,["modelValue"])])):d("",!0)]),t("div",pe,[r(u,{maxlength:"250",modelValue:o.modal.eCommerce.json.auth.apiHost,"onUpdate:modelValue":e[7]||(e[7]=a=>o.modal.eCommerce.json.auth.apiHost=a),tipo:"texto",rotulo:"URL da API"},null,8,["modelValue"])]),t("div",he,[r(h,{color:"positive",class:"no-shadow",unelevated:"",label:"Obter Chave de Acesso",type:"button",disable:!i.habilitarBotaoObterToken,onClick:i.obterToken},null,8,["disable","onClick"])]),t("div",ve,[o.modal.eCommerce.parceiro==="Tray"?(n(),p(u,{key:0,maxlength:"250",modelValue:o.modal.eCommerce.json.auth.accessToken,"onUpdate:modelValue":e[8]||(e[8]=a=>o.modal.eCommerce.json.auth.accessToken=a),class:"row",tipo:"texto","somente-leitura":"",rotulo:"Chave de Acesso",ajuda:i.dateExpirationAccessToken},null,8,["modelValue","ajuda"])):d("",!0),o.modal.eCommerce.parceiro==="Uappi"?(n(),p(u,{key:1,maxlength:"250",modelValue:o.modal.eCommerce.json.auth.token,"onUpdate:modelValue":e[9]||(e[9]=a=>o.modal.eCommerce.json.auth.token=a),class:"row",tipo:"texto","somente-leitura":"",rotulo:"Chave de Acesso",ajuda:i.dateExpirationAccessToken},null,8,["modelValue","ajuda"])):d("",!0)]),t("div",Ce,[o.modal.eCommerce.parceiro==="Tray"?(n(),p(u,{key:0,maxlength:"250",modelValue:o.modal.eCommerce.json.auth.refreshToken,"onUpdate:modelValue":e[10]||(e[10]=a=>o.modal.eCommerce.json.auth.refreshToken=a),class:"row",tipo:"texto","somente-leitura":"",rotulo:"Chave de Atualiza\xE7\xE3o",ajuda:i.dateExpirationRefreshToken},null,8,["modelValue","ajuda"])):d("",!0)]),t("div",be,[r(u,{modelValue:o.modal.eCommerce.ativo,"onUpdate:modelValue":e[11]||(e[11]=a=>o.modal.eCommerce.ativo=a),class:"col-12",rotulo:"Ativo",tipo:"logico"},null,8,["modelValue"])])]),_:1}),t("div",fe,[q(r(h,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[U]]),r(h,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Salvar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),r(E,{name:"regrasOperacao"},{default:s(()=>[r(O,null,{default:s(()=>[r(_,{onSubmit:i.salvarModal},{default:s(()=>[r(P,{class:"q-col-gutter-md"},{default:s(()=>[t("div",ye,[r(T,{readonly:"",label:"Sincronismo de produtos","emit-value":"","map-options":"",dense:"",modelValue:o.modal.eCommerce.json.sincronismo.produtos,"onUpdate:modelValue":e[12]||(e[12]=a=>o.modal.eCommerce.json.sincronismo.produtos=a),options:o.modal.optsSincronismoProdutos},null,8,["modelValue","options"])]),t("div",je,[r(T,{label:"Campos-chave",modelValue:o.modal.eCommerce.json.sincronismo.chaves,"onUpdate:modelValue":e[13]||(e[13]=a=>o.modal.eCommerce.json.sincronismo.chaves=a),"use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique"},null,8,["modelValue"])]),t("div",we,[r(J,{rows:o.modal.dePara.rows,columns:o.modal.dePara.columns,title:"Mapeamento de campos","rows-per-page-options":[0],"hide-header":"","hide-bottom":"","row-key":"name","wrap-cells":"",separator:"cell","virtual-scroll":"",style:{height:"200px"}},{body:s(a=>[r(G,{props:a},{default:s(()=>[r(D,{key:"de",props:a},{default:s(()=>[w(j(a.row.de),1)]),_:2},1032,["props"]),r(D,{key:"para",props:a},{default:s(()=>[t("div",null,j(a.row.para),1),r(Y,{buttons:"",modelValue:a.row.para,"onUpdate:modelValue":C=>a.row.para=C},{default:s(C=>[r(V,{type:"textarea",modelValue:C.value,"onUpdate:modelValue":I=>C.value=I,autofocus:"",autogrow:"",onKeyup:e[14]||(e[14]=W(v(()=>{},["stop"]),["enter"]))},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),t("div",Ve,[r(V,{dense:"",rounded:"",readonly:"",modelValue:o.modal.descricaoEmpresa,"onUpdate:modelValue":e[17]||(e[17]=a=>o.modal.descricaoEmpresa=a),label:"Empresa",onFilter:e[18]||(e[18]=a=>i.selecionarEmpresa())},{append:s(()=>[o.modal.eCommerce.json.idEmpresa?(n(),p(b,{key:0,name:"close",onClick:e[15]||(e[15]=v(a=>i.limparEmpresa(),["stop"])),class:"cursor-pointer"})):d("",!0),r(b,{name:"search",onClick:e[16]||(e[16]=v(a=>i.selecionarEmpresa(),["stop"])),class:"cursor-pointer"})]),_:1},8,["modelValue"])]),t("div",Pe,[r(V,{dense:"",rounded:"",readonly:"",modelValue:o.modal.descricaoTabelaPreco,"onUpdate:modelValue":e[21]||(e[21]=a=>o.modal.descricaoTabelaPreco=a),label:"Tabela de Pre\xE7o",onFilter:e[22]||(e[22]=a=>i.selecionarItemTabelaPreco())},{append:s(()=>[o.modal.eCommerce.json.idTabelaPreco?(n(),p(b,{key:0,name:"close",onClick:e[19]||(e[19]=v(a=>i.limparTabelaPreco(),["stop"])),class:"cursor-pointer"})):d("",!0),r(b,{name:"search",onClick:e[20]||(e[20]=v(a=>i.selecionarItemTabelaPreco(),["stop"])),class:"cursor-pointer"})]),_:1},8,["modelValue"])]),t("div",Te,[r(V,{dense:"",rounded:"",readonly:"",modelValue:o.modal.descricaoOperacao,"onUpdate:modelValue":e[24]||(e[24]=a=>o.modal.descricaoOperacao=a),label:"Opera\xE7\xE3o",onFilter:e[25]||(e[25]=a=>i.selecionarDocumentoOperacao())},{append:s(()=>[o.modal.eCommerce.json.idDocumentoOperacao?(n(),p(b,{key:0,name:"close",onClick:v(i.limparOperacao,["stop"]),class:"cursor-pointer"},null,8,["onClick"])):d("",!0),r(b,{name:"search",onClick:e[23]||(e[23]=v(a=>i.selecionarDocumentoOperacao(),["stop"])),class:"cursor-pointer"})]),_:1},8,["modelValue"])])]),_:1}),t("div",ge,[q(r(h,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[U]]),r(h,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Salvar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),r(S,{ref:"promptItemTabelaPreco",onSelecionar:i.selecionarItemTabelaPreco},null,8,["onSelecionar"]),r(Q,{ref:"promptDocumentoOperacao",onSelecionar:i.selecionarDocumentoOperacao},null,8,["onSelecionar"])])}var Oe=M(ae,[["render",ke]]);export{Oe as default};
