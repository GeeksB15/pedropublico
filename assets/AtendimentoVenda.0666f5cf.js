import{al as D,ad as aa,cQ as ua,a6 as ma,cR as ea,a8 as k,Q as S,j as Q,cS as ta,ap as oa,cT as va,cU as ha,ak as Y,cV as ga,cW as fa,cX as pa,a7 as ba,_ as ia,r as P,o as u,d as p,w as c,f as l,z as na,h as Ca,i as Ia,k as V,H as sa,N as la,C as g,av as Va,b$ as X,e as v,D as wa,$ as _a,bI as ya,cu as xa,p as I,aP as Pa,P as Z,S as M,T,U as N,A as j,aT as L,F as W,u as J,bk as Da,bl as R,t as y,m as Fa,bj as ka}from"./index.a1a1867c.js";import{n as za}from"./nfePrincipal.277e4b5a.js";import{E as qa}from"./EnvelopeCard.c61133eb.js";import{V as Ea}from"./VendaCard.41ba9f3d.js";import{G as Aa}from"./GChipsV2.ba8f86bd.js";import{o as Ga}from"./open-url.a374a43a.js";import"./compactarValidarNFe.b0a0ca66.js";import"./obterItens.2c072976.js";import"./codigosANP.a6c1a264.js";import"./emitirNFe.35117289.js";import"./DocumentosFiscais.c97e8810.js";import"./Campo.5cd61c3c.js";import"./ModalHistoricoStatus.f4b94690.js";const Oa=["top","right","bottom","left"],K={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:t=>Oa.includes(t)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function da(t,e){return{formClass:D(()=>`q-fab--form-${t.square===!0?"square":"rounded"}`),stacked:D(()=>t.externalLabel===!1&&["top","bottom"].includes(t.labelPosition)),labelProps:D(()=>{if(t.externalLabel===!0){const d=t.hideLabel===null?e.value===!1:t.hideLabel;return{action:"push",data:{class:[t.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${t.labelPosition}`+(d===!0?" q-fab__label--external-hidden":"")],style:t.labelStyle}}}return{action:["left","top"].includes(t.labelPosition)?"unshift":"push",data:{class:[t.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${t.labelPosition}`+(t.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:t.labelStyle}}})}}const ra={start:"self-end",center:"self-center",end:"self-start"},Sa=Object.keys(ra);var $=aa({name:"QFabAction",props:{...K,icon:{type:String,default:""},anchor:{type:String,validator:t=>Sa.includes(t)},to:[String,Object],replace:Boolean},emits:["click"],setup(t,{slots:e,emit:d}){const s=ua(ea,()=>({showing:{value:!0},onChildClick:ma})),{formClass:a,labelProps:n}=da(t,s.showing),m=D(()=>{const h=ra[t.anchor];return a.value+(h!==void 0?` ${h}`:"")}),o=D(()=>t.disable===!0||s.showing.value!==!0);function C(h){s.onChildClick(h),d("click",h)}function w(){const h=[];return e.icon!==void 0?h.push(e.icon()):t.icon!==""&&h.push(k(Q,{name:t.icon})),(t.label!==""||e.label!==void 0)&&h[n.value.action](k("div",n.value.data,e.label!==void 0?e.label():[t.label])),ta(e.default,h)}const _=oa();return Object.assign(_.proxy,{click:C}),()=>k(S,{class:m.value,...t,noWrap:!0,stack:t.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:o.value,onClick:C},w)}});const Ta=["up","right","down","left"],La=["left","center","right"];var Ra=aa({name:"QFab",props:{...K,...va,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{...K.hideLabel,default:null},direction:{type:String,default:"right",validator:t=>Ta.includes(t)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:t=>La.includes(t)}},emits:ha,setup(t,{slots:e}){const d=Y(null),s=Y(t.modelValue===!0),a=ga(),{proxy:{$q:n}}=oa(),{formClass:m,labelProps:o}=da(t,s),C=D(()=>t.persistent!==!0),{hide:w,toggle:_}=fa({showing:s,hideOnRouteChange:C}),h=D(()=>({opened:s.value})),F=D(()=>`q-fab z-fab row inline justify-center q-fab--align-${t.verticalActionsAlign} ${m.value}`+(s.value===!0?" q-fab--opened":" q-fab--closed")),x=D(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${t.direction} q-fab__actions--${s.value===!0?"opened":"closed"}`),q=D(()=>{const b={id:a.value,role:"menu"};return s.value!==!0&&(b["aria-hidden"]="true"),b}),O=D(()=>`q-fab__icon-holder  q-fab__icon-holder--${s.value===!0?"opened":"closed"}`);function z(b,E){const A=e[b],G=`q-fab__${b} absolute-full`;return A===void 0?k(Q,{class:G,name:t[E]||n.iconSet.fab[E]}):k("div",{class:G},A(h.value))}function i(){const b=[];return t.hideIcon!==!0&&b.push(k("div",{class:O.value},[z("icon","icon"),z("active-icon","activeIcon")])),(t.label!==""||e.label!==void 0)&&b[o.value.action](k("div",o.value.data,e.label!==void 0?e.label(h.value):[t.label])),ta(e.tooltip,b)}return pa(ea,{showing:s,onChildClick(b){w(b),d.value!==null&&d.value.$el.focus()}}),()=>k("div",{class:F.value},[k(S,{ref:d,class:m.value,...t,noWrap:!0,stack:t.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":s.value===!0?"true":"false","aria-haspopup":"true","aria-controls":a.value,onClick:_},i),k("div",{class:x.value,...q.value},ba(e.default))])}});const Qa={data(){return{motivo:"",motivos:[],tipo:"devolucao",visivel:!1}},emits:["executa"],methods:{async atualizar(){this.motivo="",this.tipo="devolucao";const t=await $db.configuracoes.le({nome:"vendas.garantia.motivo"});this.motivos=t.map(e=>e.valor)},executa(){if(this.tipo==="garantia"&&!this.motivo){this.$q.notify({message:"Selecione o motivo",type:"negative"});return}this.visivel=!1,this.$emit("executa",{tipo:this.tipo,motivo:this.motivo})},async mostrar(){await this.atualizar(),this.visivel=!0}}},Ba={class:"layout-padding"},Ha={class:"q-mt-lg text-center"};function Ua(t,e,d,s,a,n){const m=P("campo");return u(),p(wa,{modelValue:a.visivel,"onUpdate:modelValue":e[5]||(e[5]=o=>a.visivel=o),"content-css":{minWidth:"30vw"}},{default:c(()=>[l(na,{class:"q-dialog-plugin"},{default:c(()=>[l(Ca,{class:"bg-primary text-white"},{default:c(()=>[l(Ia,null,{default:c(()=>[V("Devolu\xE7\xE3o/Garantia")]),_:1}),sa(l(S,{dense:"",flat:"",icon:"close",round:""},null,512),[[la]])]),_:1}),g("div",Ba,[g("form",{class:"q-pa-md",onSubmit:e[4]||(e[4]=Va((...o)=>n.executa&&n.executa(...o),["prevent"]))},[l(X,{modelValue:a.tipo,"onUpdate:modelValue":[e[0]||(e[0]=o=>a.tipo=o),e[1]||(e[1]=o=>a.motivo="")],class:"q-mr-sm",label:"Devolu\xE7\xE3o",val:"devolucao"},null,8,["modelValue"]),l(X,{modelValue:a.tipo,"onUpdate:modelValue":e[2]||(e[2]=o=>a.tipo=o),label:"Garantia",val:"garantia"},null,8,["modelValue"]),a.tipo==="garantia"?(u(),p(m,{key:0,modelValue:a.motivo,"onUpdate:modelValue":e[3]||(e[3]=o=>a.motivo=o),rotulo:"Motivo",tipo:"seletor",opcoes:a.motivos},null,8,["modelValue","opcoes"])):v("",!0),g("div",Ha,[l(S,{color:"primary",class:"q-ml-sm no-shadow",label:"Continua",type:"submit"})])],32)])]),_:1})]),_:1},8,["modelValue"])}var Ma=ia(Qa,[["render",Ua]]);const Na={components:{Avatar:_a,NfePrincipal:za,EnvelopeCard:qa,VendaCard:Ea,VendaDevolucaoGarantia:Ma,VendaModal:ya,Envelope:xa,GChipsV2:Aa},computed:{temVendasAbertas(){return!!this.vendasAbertas.length},temVendasCanceladas(){return!!this.vendasCanceladas.length},temVendasFinalizadas(){return!!this.vendasFinalizadas.length},temRegistros(){return this.temVendasAbertas||this.temVendasCanceladas||this.temVendasFinalizadas}},data(){return{grupos:[],documentos:{},itens:{},documentosItens:[],vendasCompletas:{},vendasAbertas:[],vendasFinalizadas:[],vendasCanceladas:[],totalVendasAbertas:0,totalVendasFinalizadas:0,totalVendasCanceladas:0,filtro:{},tipoLista:"documentos",dataIni:null,dataFim:null,carregando:!1,colunas:[{name:"descricao",label:"Descri\xE7\xE3o",align:"left"},{name:"documento",label:"Documento",align:"left"},{name:"valorUnitario",label:"Valor Unit\xE1rio",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorTotal",label:"Valor Total",align:"right"},{name:"botao",label:"",align:"right"}],contato:null,tablePagination:{page:1,rowsPerPage:25},vendaCardPagination:{maxPages:7,perPage:5,vendasAbertas:{page:1,min:1,max:1},vendasFinalizadas:{page:1,min:1,max:1},vendasCanceladas:{page:1,min:1,max:1}},documentoItemDevolucaoGarantia:{},modalVenda:{visivel:!1,orcamento:{}},urlHistoricoCliente:"",sistemaPai:""}},methods:{abrirHistoricoCliente(){Ga(this.urlHistoricoCliente)},adicionarVenda(){this.$refs.modalVenda.mostrar({idContato:this.$route.params.id})},adicionarEnvelope(){this.$refs.modalEnvelope.mostrar({idContato:this.$route.params.id})},abrirModalDevolucaoGarantia(t){this.documentoItemDevolucaoGarantia=t,this.$refs.modalDevolucaoGarantia.mostrar()},alternarLista(){this.tipoLista=this.tipoLista==="documentos"?"itens":"documentos",this.atualizar()},fechouNFe(t){t&&$utils.emitter.emit("atualizarDocumentosFiscais")},async finalizaDevolucaoGarantia(t){var x,q;let e,d;if(d=this.documentoItemDevolucaoGarantia||{},d.idDocumento&&(e=await $db.hibrido.le({table:"documento",id:d.idDocumento})),!e.id){this.$q.notify("Venda original n\xE3o encontrada");return}let s={};if(this.documentoItemDevolucaoGarantia.idItem&&(s=await $erp().item.get(this.documentoItemDevolucaoGarantia.idItem)||{}),!s.id){this.$q.notify("Erro na recupera\xE7\xE3o do item");return}const a=e.tipo==="Envelope"?e.idContatoResponsavel:e.idContato;if(!Boolean(a)){this.$q.notify("Destinat\xE1rio n\xE3o encontrado");return}if(!e.idEmpresa){this.$q.notify("Emitente n\xE3o encontrado");return}const n=await $erp().documento.where({idContato:a,idEmpresa:e.idEmpresa,tipo:"Venda",status:"Or\xE7amento"}).toArray();n.sort((O,z)=>new Date(O.dataHoraEmissao)<new Date(z.dataHoraEmissao)?1:-1);const m=await $utils.selecionarCfop({ncm:s.ncm,idItem:s.id,itemTipo:s.tipo,codigoDocumentoOperacao:((x=n[0])==null?void 0:x.codigoDocumentoOperacao)||e.codigoDocumentoOperacao,idContatoDestinatario:a,idContatoEmitente:e.idEmpresa,operacaoFator:1});if(!m){this.$q.notifyError("CFOP n\xE3o encontrado");return}let o={};const C=$utils.removerAcentos((this.documentoItemDevolucaoGarantia.tipoItem||"").toLowerCase())==="servico";t.tipo==="devolucao"&&(o.operacao=C?"Devolu\xE7\xE3o de Servi\xE7o":"Devolu\xE7\xE3o de Venda"),t.tipo==="garantia"&&(o.operacao=C?"Garantia de Servi\xE7o":"Garantia de Venda",o.motivo=t.motivo),o.id=$utils.uuid(),o.dataHoraFinalizado="",o.idDocumentoItemVenda=this.documentoItemDevolucaoGarantia.id,o.idDocumentoVenda=this.documentoItemDevolucaoGarantia.idDocumento,o.idItem=this.documentoItemDevolucaoGarantia.idItem,o.idPlanoContaDestino=this.documentoItemDevolucaoGarantia.idPlanoContaDestino,o.idPlanoContaEstoque=this.documentoItemDevolucaoGarantia.idPlanoContaEstoque,o.tipoItem=this.documentoItemDevolucaoGarantia.tipoItem,o.descricaoItem=this.documentoItemDevolucaoGarantia.descricaoItem,o.status="Or\xE7amento",o.quantidade=this.documentoItemDevolucaoGarantia.quantidade||1,o.operacaoFator=m==null?void 0:m.fator,o.idCfop=m==null?void 0:m.id;const w=this.documentoItemDevolucaoGarantia.descontoItem||0,_=(this.documentoItemDevolucaoGarantia.descontoTotalRateado||0)/o.quantidade,h=(this.documentoItemDevolucaoGarantia.descontoFaturaRateado||0)/o.quantidade,F=$utils.arredondar(w+_+h,4);o.descontoItem=$utils.arredondar(F*-1,4),o.descontoPercentualItem=$utils.arredondar(o.descontoItem/(this.documentoItemDevolucaoGarantia.valorItem||1)*100,2),o.descontoTotalRateado=0,o.descontoFaturaRateado=0,o.descontoSubTotal=this.documentoItemDevolucaoGarantia.descontoSubTotal||0,o.valorCustoMedio=this.documentoItemDevolucaoGarantia.valorCustoMedio||0,o.valorCustoReposicao=this.documentoItemDevolucaoGarantia.valorCustoReposicao||0,o.valorOriginal=(this.documentoItemDevolucaoGarantia.valorOriginal||0)*-1,o.valorItem=(this.documentoItemDevolucaoGarantia.valorItem||0)*-1,o.subTotal=$utils.arredondar(((this.documentoItemDevolucaoGarantia.valorItem||0)-F)*-o.quantidade,2),o.total=o.subTotal||0,o.valorReal=$utils.arredondar(((this.documentoItemDevolucaoGarantia.valorItem||0)-F)*-1,4),o.valorRealTotal=o.subTotal||0,o.valorIpi=(this.documentoItemDevolucaoGarantia.valorIpi||0)*-1,o.valorIcms=(this.documentoItemDevolucaoGarantia.valorIcms||0)*-1,o.valorIcmsSt=(this.documentoItemDevolucaoGarantia.valorIcmsSt||0)*-1,o.valorDifal=(this.documentoItemDevolucaoGarantia.valorDifal||0)*-1,o.loteEmpresa=this.documentoItemDevolucaoGarantia.loteEmpresa,localStorage.setItem("documentoItemDevolucao",JSON.stringify(o)),n.length&&(o.idDocumento=n[0].id,o.dataHoraEmissao=$utils.dataAtual(),await $db.documentoItem.grava({atual:o}),this.$q.notify({message:"Item adicionado ao or\xE7amento.",type:"positive"})),this.$refs.modalVenda.mostrar({id:(q=n[0])==null?void 0:q.id,idContato:this.$route.params.id})},async atualizar(){this.documentos={},this.itens={},this.documentosItens=[],this.vendasCompletas={},this.tablePagination={page:1,rowsPerPage:25};let t,e;e=JSON.parse(localStorage.getItem("clienteSistema"))||{},t="https://rel.storage.b15.com.br/Relatorios/OptiSoul/historico-cliente.html?",t+="CodigoCliente="+this.contato.codigoContato,t+="&BancoDeDados="+e.bancoDeDados,t+="&URLServidor="+e.urlServidor,this.urlHistoricoCliente=t,await this.atualizarVendas()},async carregarImagensItens(t){const e=Object.keys(t);if(!!e.length){await $utils.dormir(200);try{const d=await $db.hibrido.lista({table:"item",columns:["id","descricao","imagem"],whereIn:{id:e}});for(const s of d)t[s.id].imagem=s.imagem||""}catch(d){console.error("Erro ao ler imagens de itens - ",d)}}},async carregarImagensContatos(t){const e=Object.keys(t);if(!!e.length){await $utils.dormir(200);try{const d=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:e}});for(const s of d)t[s.id].imagem=s.imagem||""}catch(d){console.error("Erro ao carregar imagens de contatos - ",d)}}},executar(){this.atualizar()},async atualizarVendas(){var e,d,s;const t=$utils.logarIni("AtendimentoVenda");await $tryLoading(async()=>{$db.hibrido.isOnline()?this.tipoLista==="itens"?await this.atualizarVendasItensOnline():await this.atualizarVendasOnline():this.tipoLista==="itens"?await this.atualizarVendasItensOffline():await this.atualizarVendasOffline()},{mensagem:"Carregando vendas...",erro:"Ocorreu um erro ao consultar vendas",carregando:a=>this.carregando=a}),$utils.logarFim(t,(((e=this.vendasAbertas)==null?void 0:e.length)||0)+(((d=this.vendasFinalizadas)==null?void 0:d.length)||0)+(((s=this.totalVendasCanceladas)==null?void 0:s.length)||0))},async atualizarVendasOnline(){var m,o,C,w,_,h;if(!this.contato.id){console.error("id contato n\xE3o fornecido em atualizarVendasOnline");return}const{vendasAbertas:t,vendasFinalizadas:e,vendasCanceladas:d}=await $db.venda.leListaCompletaOnline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},grupos:this.grupos},vendaCardPagination:this.vendaCardPagination}),s=[...t.data.vendas,...e.data.vendas,...d.data.vendas],a={...t.data.itens,...e.data.itens,...d.data.itens},n={...t.data.contatos,...e.data.contatos,...d.data.contatos};for(const F of s)for(const x of F.carrinho)x.item=a[x.idItem];this.vendasCompletas={dadosContatos:n,contatosEmpresa:e.data.contatosEmpresa,faturasAbertas:e.data.faturasAbertas},this.vendaCardPagination.vendasAbertas.max=(m=t.totalPages)!=null?m:0,this.vendaCardPagination.vendasFinalizadas.max=(o=e.totalPages)!=null?o:0,this.vendaCardPagination.vendasCanceladas.max=(C=d.totalPages)!=null?C:0,this.vendasAbertas=t.data.vendas,this.vendasFinalizadas=e.data.vendas,this.vendasCanceladas=d.data.vendas,this.totalVendasAbertas=$filters.numero((w=t.somaTotalDocumento)!=null?w:0,2),this.totalVendasFinalizadas=$filters.numero((_=e.somaTotalDocumento)!=null?_:0,2),this.totalVendasCanceladas=$filters.numero((h=d.somaTotalDocumento)!=null?h:0,2),this.carregarImagensContatos(this.vendasCompletas.dadosContatos)},async atualizarVendasItensOnline(){if(!this.contato.id){console.error("id contato n\xE3o fornecido em atualizarVendasItensOnline");return}const{vendasFinalizadas:t}=await $db.venda.leListaCompletaItensOnline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},grupos:this.grupos},vendaCardPagination:this.vendaCardPagination}),e={};let d=[];for(const s of t.data.vendas)e[s.id]=s,!(s.tipo==="Envelope"&&s.idContatoResponsavel!==this.contato.id)&&d.push(...s.carrinho);this.documentos=e,this.itens=t.data.itens,d=d.filter(s=>s.idItem),this.documentosItens=d.sort((s,a)=>new Date(a.dataHoraFinalizado||a.DataHoraEmissao||0)-new Date(s.dataHoraFinalizado||s.DataHoraEmissao||0)),this.carregarImagensItens(this.itens)},async atualizarVendasItensOffline(){const t=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"finalizada",grupos:this.grupos},page:this.vendaCardPagination.vendasFinalizadas.page,limit:1e3}),e={},d={},s=t.data.filter(o=>o.tipo==="Envelope"&&o.idContatoResponsavel===this.contato.id||o.tipo==="Venda").map(({id:o})=>o);let a=await $db.hibrido.lista({table:"documentoItem",whereIn:{idDocumento:s}});await $db.hibrido.lista({table:"documento",whereIn:{documentoId:s}});const n=a.filter(({idItem:o})=>o).map(({idItem:o})=>o),m=await $db.hibrido.lista({table:"item",whereIn:{id:n}});for(const o of m)d[o.id]=o;for(const o of t.data)e[o.id]=o;this.documentos=e,this.itens=d,a=a.filter(o=>o.idItem),this.documentosItens=a.sort((o,C)=>new Date(C.dataHoraFinalizado||C.DataHoraEmissao||0)-new Date(o.dataHoraFinalizado||o.DataHoraEmissao||0))},async atualizarVendasOffline(){var E,A,G,B,H,U;const t=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"aberta",grupos:this.grupos},page:this.vendaCardPagination.vendasAbertas.page,limit:5}),e=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"finalizada",grupos:this.grupos},page:this.vendaCardPagination.vendasFinalizadas.page,limit:5}),d=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"cancelada",grupos:this.grupos},page:this.vendaCardPagination.vendasCanceladas.page,limit:5}),s=[...t.data,...e.data,...d.data],a=s.map(({id:r})=>r),n=await $db.hibrido.lista({table:"documentoItem",whereIn:{idDocumento:a}}),m=await $db.hibrido.lista({table:"documento",whereIn:{documentoId:a}}),o=s.map(({idContato:r})=>r),C=s.map(({idContatoVendedor:r})=>r),w=[...o,...C].filter(Boolean),_=await $db.hibrido.lista({table:"contato",whereIn:{id:w}}),h={};for(const r of _)h[r.id]=r;const x=(await $db.hibrido.lista({table:"empresa",columns:["idContato"],whereFilter:{ativo:!0}})).map(({idContato:r})=>r),q=await $db.hibrido.lista({table:"contato",columns:["id"],whereIn:{id:x},whereFilter:{ativo:!0}}),O=(await $db.hibrido.lista({table:"documento",where:{tipo:"Fatura",idContato:this.contato.id},whereFilter:{status:"Aberta"}})).sort((r,f)=>!r.numero||r.numero<f.numero?-1:1),z=n.filter(({idItem:r})=>r).map(({idItem:r})=>r),i=await $db.hibrido.lista({table:"item",whereIn:{id:z}}),b={};for(const r of i)b[r.id]=r;for(const r of s){r.carrinho=n.filter(({idDocumento:f})=>f===r.id),r.envelopes=m.filter(f=>f.documentoId===r.id&&f.tipo==="Envelope"),r.customs=m.filter(f=>f.documentoId===r.id&&f.tipo==="Custom"),r.oss=m.filter(f=>f.documentoId===r.id&&f.tipo==="Ordem de Servi\xE7o"),r.kits=m.filter(f=>f.documentoId===r.id&&f.tipo==="Venda Kit");for(const f of r.carrinho)f.item=b[f.idItem];for(const f of r.envelopes)f.itens=r.carrinho.filter(({idDocumentoAdicional:ca})=>ca===f.id)}this.vendasCompletas={dadosContatos:h,contatosEmpresa:q,faturasAbertas:O},this.vendaCardPagination.vendasAbertas.max=(E=t.totalPages)!=null?E:0,this.vendaCardPagination.vendasFinalizadas.max=(A=e.totalPages)!=null?A:0,this.vendaCardPagination.vendasCanceladas.max=(G=d.totalPages)!=null?G:0,this.vendasAbertas=t.data,this.vendasFinalizadas=e.data,this.vendasCanceladas=d.data,this.totalVendasAbertas=$filters.numero((B=t.somaTotalDocumento)!=null?B:0,2),this.totalVendasFinalizadas=$filters.numero((H=e.somaTotalDocumento)!=null?H:0,2),this.totalVendasCanceladas=$filters.numero((U=d.somaTotalDocumento)!=null?U:0,2)},async limparFiltro(){this.grupos=[],this.dataFim=new Date;const t=new Date;if(t.setFullYear(t.getFullYear()-2),this.dataIni=t,this.contato.codigoContato){const e=await $db.configuracoes.leValorNumerico("venda.codigoconsumidor");this.contato.codigoContato===e&&(this.dataIni=this.dataFim)}}},watch:{"$route.params.id"(){const t=this.$route.params.id;!t||$db.contato.le({id:t}).then(e=>{this.contato=e,this.tipoLista="documentos",this.limparFiltro().then(()=>{this.atualizar()}).catch(d=>{$q.notifyError("Ops! Ocorreu um erro",d)})}).catch(e=>{$q.notifyError("Ops! Ocorreu um erro",e)})}},created(){$utils.emitter.off("atualizarAtendimentoVenda"),$utils.emitter.on("atualizarAtendimentoVenda",this.atualizar)},mounted(){this.sistemaPai=$utils.sistemaPai();const t=this.$route.params.id;!t||$db.contato.le({id:t}).then(e=>{this.contato=e,this.limparFiltro().then(()=>{this.atualizar()}).catch(d=>{$q.notifyError("Ops! Ocorreu um erro",d)})}).catch(e=>{$q.notifyError("Ops! Ocorreu um erro",e)})}},ja={class:"AtendimentoVenda q-pb-md"},Wa={class:"row q-mt-md",style:{display:"flex","align-items":"center"}},Ja={class:"col"},Ka={class:"col-12 col-md-6"},Ya={class:"col"},Xa=g("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[g("label",null,"at\xE9")],-1),Za={class:"col"},$a={class:"col-auto q-ml-xs"},ae={key:0,class:"row justify-end q-mb-md"},ee={class:"row"},te={key:1,class:"row justify-end q-mb-md"},oe={key:0,class:"row justify-end q-mb-md"},ie={class:"row"},ne={key:1,class:"row justify-end q-mb-md"},se={key:0,class:"col-12",style:{"margin-bottom":"50px"}},le={key:1,class:"col-12",style:{"margin-bottom":"50px"}},de={class:"row items-center",style:{"min-width":"180px","max-width":"100%"}},re={class:"col-auto hideonmobile"},ce={class:"col",style:{"word-break":"break-word","white-space":"initial"}},ue=g("br",null,null,-1),me=g("br",null,null,-1),ve=g("br",null,null,-1),he=g("br",null,null,-1),ge=g("br",null,null,-1),fe={key:0,style:{"text-decoration":"line-through"}},pe={key:2,class:"q-pa-lg text-center"},be=g("p",null,[g("small",null,"Registros n\xE3o encontrados")],-1),Ce=[be],Ie={key:3};function Ve(t,e,d,s,a,n){var z;const m=P("GChipsV2"),o=P("campo"),C=P("row"),w=P("VendaCard"),_=P("EnvelopeCard"),h=P("avatar"),F=P("VendaModal"),x=P("Envelope"),q=P("VendaDevolucaoGarantia"),O=P("NfePrincipal");return u(),I("div",ja,[g("div",Wa,[g("div",Ja,[l(na,{class:"q-pa-sm q-ml-sm no-shadow"},{default:c(()=>[l(C,{class:"items-center q-col-gutter-md"},{default:c(()=>[g("div",Ka,[l(m,{modelValue:a.grupos,"onUpdate:modelValue":[e[0]||(e[0]=i=>a.grupos=i),n.atualizarVendas],placeholder:"Filtre por Produto, Marca, N\xFAmero..."},{prepend:c(()=>[l(Q,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),g("div",Ya,[l(o,{modelValue:a.dataIni,"onUpdate:modelValue":e[1]||(e[1]=i=>a.dataIni=i),tipo:"data",onBlur:n.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])]),Xa,g("div",Za,[l(o,{modelValue:a.dataFim,"onUpdate:modelValue":e[2]||(e[2]=i=>a.dataFim=i),tipo:"data",onBlur:n.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])])]),_:1})]),_:1})]),g("div",$a,[l(S,{round:"",dense:"",flat:"",icon:"more_vert",color:"primary",size:"md"},{default:c(()=>[l(Pa,null,{default:c(()=>[sa((u(),p(Z,{link:"","no-border":"",separator:""},{default:c(()=>[a.tipoLista==="itens"?(u(),p(M,{key:0,onClick:n.alternarLista,clickable:""},{default:c(()=>[l(T,{avatar:""},{default:c(()=>[l(Q,{name:"view_stream"})]),_:1}),l(T,null,{default:c(()=>[l(N,null,{default:c(()=>[V("Vendas")]),_:1})]),_:1})]),_:1},8,["onClick"])):v("",!0),a.tipoLista==="documentos"?(u(),p(M,{key:1,onClick:n.alternarLista,clickable:""},{default:c(()=>[l(T,{avatar:""},{default:c(()=>[l(Q,{name:"view_list"})]),_:1}),l(T,null,{default:c(()=>[l(N,null,{default:c(()=>[V("Produtos e Servi\xE7os")]),_:1})]),_:1})]),_:1},8,["onClick"])):v("",!0),l(M,{clickable:"",onClick:n.abrirHistoricoCliente},{default:c(()=>[l(T,{avatar:""},{default:c(()=>[l(Q,{name:"mdi-account"})]),_:1}),l(T,null,{default:c(()=>[l(N,null,{default:c(()=>[V("Hist\xF3rico do Cliente")]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})),[[la]])]),_:1})]),_:1})])]),!a.carregando&&n.temRegistros&&a.tipoLista==="documentos"?(u(),p(Z,{key:0,class:"no-border"},{default:c(()=>[n.temVendasAbertas?(u(),p(j,{key:0,"model-value":!0,label:`Abertas (Total R$ ${a.totalVendasAbertas})`,group:"vendasAbertas"},{default:c(()=>[a.vendaCardPagination.vendasAbertas.max>1?(u(),I("div",ae,[l(L,{modelValue:a.vendaCardPagination.vendasAbertas.page,"onUpdate:modelValue":e[3]||(e[3]=i=>a.vendaCardPagination.vendasAbertas.page=i),min:a.vendaCardPagination.vendasAbertas.min,unelevated:"",max:a.vendaCardPagination.vendasAbertas.max,ellipses:"","max-pages":a.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):v("",!0),g("div",ee,[(u(!0),I(W,null,J(a.vendasAbertas,i=>(u(),I("div",{class:"q-px-sm full-width",key:i.id},[i.tipo==="Venda"?(u(),p(w,{key:0,id:i.id,dadosVenda:i,vendasCompletas:a.vendasCompletas,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","dadosVenda","vendasCompletas","onExecutar"])):v("",!0),i.tipo==="Envelope"?(u(),p(_,{key:1,id:i.id,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):v("",!0)]))),128))]),a.vendaCardPagination.vendasAbertas.max>1?(u(),I("div",te,[l(L,{modelValue:a.vendaCardPagination.vendasAbertas.page,"onUpdate:modelValue":e[4]||(e[4]=i=>a.vendaCardPagination.vendasAbertas.page=i),min:a.vendaCardPagination.vendasAbertas.min,unelevated:"",max:a.vendaCardPagination.vendasAbertas.max,ellipses:"","max-pages":a.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):v("",!0)]),_:1},8,["label"])):v("",!0),n.temVendasFinalizadas?(u(),p(j,{key:1,"model-value":!0,label:`Finalizadas (Total R$ ${a.totalVendasFinalizadas})`,group:"vendasFinalizadas"},{default:c(()=>[a.vendaCardPagination.vendasFinalizadas.max>1?(u(),I("div",oe,[l(L,{modelValue:a.vendaCardPagination.vendasFinalizadas.page,"onUpdate:modelValue":e[5]||(e[5]=i=>a.vendaCardPagination.vendasFinalizadas.page=i),unelevated:"",min:a.vendaCardPagination.vendasFinalizadas.min,max:a.vendaCardPagination.vendasFinalizadas.max,ellipses:"","max-pages":a.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):v("",!0),g("div",ie,[(u(!0),I(W,null,J(a.vendasFinalizadas,i=>(u(),I("div",{class:"q-px-sm full-width",key:i.id},[i.tipo==="Venda"?(u(),p(w,{key:0,id:i.id,dadosVenda:i,vendasCompletas:a.vendasCompletas,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","dadosVenda","vendasCompletas","onExecutar"])):v("",!0),i.tipo==="Envelope"?(u(),p(_,{key:1,id:i.id,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):v("",!0)]))),128))]),a.vendaCardPagination.vendasFinalizadas.max>1?(u(),I("div",ne,[l(L,{modelValue:a.vendaCardPagination.vendasFinalizadas.page,"onUpdate:modelValue":e[6]||(e[6]=i=>a.vendaCardPagination.vendasFinalizadas.page=i),min:a.vendaCardPagination.vendasFinalizadas.min,max:a.vendaCardPagination.vendasFinalizadas.max,ellipses:"",unelevated:"","max-pages":a.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):v("",!0)]),_:1},8,["label"])):v("",!0),n.temVendasCanceladas?(u(),p(j,{key:2,"model-value":!0,label:`Canceladas (Total R$ ${a.totalVendasCanceladas})`,group:"vendasCanceladas"},{default:c(()=>[a.vendaCardPagination.vendasCanceladas.max>1?(u(),I("div",se,[l(L,{modelValue:a.vendaCardPagination.vendasCanceladas.page,"onUpdate:modelValue":e[7]||(e[7]=i=>a.vendaCardPagination.vendasCanceladas.page=i),min:a.vendaCardPagination.vendasCanceladas.min,max:a.vendaCardPagination.vendasCanceladas.max,ellipses:"","max-pages":a.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):v("",!0),(u(!0),I(W,null,J(a.vendasCanceladas,i=>(u(),I("div",{key:i.id},[i.tipo==="Venda"?(u(),p(w,{key:0,id:i.id,dadosVenda:i,vendasCompletas:a.vendasCompletas,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","dadosVenda","vendasCompletas","onExecutar"])):v("",!0),i.tipo==="Envelope"?(u(),p(_,{key:1,id:i.id,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):v("",!0)]))),128)),a.vendaCardPagination.vendasCanceladas.max>1?(u(),I("div",le,[l(L,{modelValue:a.vendaCardPagination.vendasCanceladas.page,"onUpdate:modelValue":e[8]||(e[8]=i=>a.vendaCardPagination.vendasCanceladas.page=i),min:a.vendaCardPagination.vendasCanceladas.min,max:a.vendaCardPagination.vendasCanceladas.max,ellipses:"","max-pages":a.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):v("",!0)]),_:1},8,["label"])):v("",!0)]),_:1})):v("",!0),!a.carregando&&n.temRegistros&&a.tipoLista==="itens"?(u(),p(ka,{key:1,rows:a.documentosItens,columns:a.colunas,pagination:a.tablePagination,"onUpdate:pagination":e[9]||(e[9]=i=>a.tablePagination=i),class:"no-shadow text-left q-mt-md my-sticky-header-column-table"},{body:c(i=>[l(Da,{props:i},{default:c(()=>[l(R,{key:"descricao",props:i},{default:c(()=>{var b,E,A,G,B,H,U,r;return[g("div",de,[g("div",re,[l(h,{imagem:(b=a.itens[i.row.idItem])==null?void 0:b.imagem,rotulo:(E=a.itens[i.row.idItem])==null?void 0:E.descricaoConcatenada,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"])]),g("div",ce,[V(y(i.row.idItem?(A=a.itens[i.row.idItem])==null?void 0:A.descricaoConcatenada:""),1),ue,V(" "+y(i.row.idItem&&(G=a.itens[i.row.idItem])!=null&&G.referencia?"Ref. "+((B=a.itens[i.row.idItem])==null?void 0:B.referencia):""),1),me,V(" "+y(i.row.idItem&&(H=a.itens[i.row.idItem])!=null&&H.codigoItem?"#"+((U=a.itens[i.row.idItem])==null?void 0:U.codigoItem):""),1),ve,V(" "+y(i.row.idItem&&((r=a.itens[i.row.idItem])==null?void 0:r.marca)||""),1)])])]}),_:2},1032,["props"]),l(R,{key:"documento",props:i},{default:c(()=>[V(y(a.documentos[i.row.idDocumento].tipo)+" #"+y(parseInt(a.documentos[i.row.idDocumento].numero)||(a.documentos[i.row.idDocumento].id||"").slice(-6)),1),he,V(" "+y(a.documentos[i.row.idDocumento].status),1),ge,V(" "+y(t.$filters.dataHora(a.documentos[i.row.idDocumento].dataHoraFinalizado||a.documentos[i.row.idDocumento].dataHoraEmissao)),1)]),_:2},1032,["props"]),l(R,{key:"valorUnitario",props:i},{default:c(()=>[i.row.valorReal!==i.row.valorItem?(u(),I("span",fe,y(t.$filters.numero(i.row.valorItem,2)),1)):v("",!0),V(" "+y(t.$filters.numero(i.row.valorReal,2)),1)]),_:2},1032,["props"]),l(R,{key:"quantidade",props:i},{default:c(()=>[V(y(i.row.quantidade*i.row.operacaoFator*-1),1)]),_:2},1032,["props"]),l(R,{key:"valorTotal",props:i},{default:c(()=>[V(y(t.$filters.numero(i.row.valorRealTotal,2)),1)]),_:2},1032,["props"]),l(R,{key:"botao",props:i},{default:c(()=>[i.row.operacaoFator===-1?(u(),p(S,{key:0,clickable:"",class:"q-ml-sm",color:"warning",dense:"",flat:"",icon:"replay",round:"",onClick:b=>n.abrirModalDevolucaoGarantia(i.row)},{default:c(()=>[l(Fa,null,{default:c(()=>[V("Devolu\xE7\xE3o/Garantia")]),_:1})]),_:2},1032,["onClick"])):v("",!0)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):v("",!0),!a.carregando&&!n.temRegistros?(u(),I("div",pe,Ce)):v("",!0),(z=a.contato)!=null&&z.ativo?(u(),I("div",Ie,[a.sistemaPai==="optisoul"?(u(),p(Ra,{key:0,"vertical-actions-align":"right",round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},direction:"up"},{default:c(()=>[l($,{color:"primary",onClick:n.adicionarEnvelope,icon:"mdi-glasses",label:"Envelope"},null,8,["onClick"]),l($,{color:"primary",onClick:n.adicionarVenda,icon:"shopping_cart",label:"Venda"},null,8,["onClick"])]),_:1})):(u(),p(S,{key:1,round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},onClick:n.adicionarVenda},null,8,["onClick"]))])):v("",!0),l(F,{ref:"modalVenda",onExecutar:n.executar},null,8,["onExecutar"]),l(x,{ref:"modalEnvelope",onAtualizar:n.atualizar},null,8,["onAtualizar"]),l(q,{ref:"modalDevolucaoGarantia",onExecuta:n.finalizaDevolucaoGarantia},null,8,["onExecuta"]),l(O,{onFechar:n.fechouNFe},null,8,["onFechar"])])}var Oe=ia(Na,[["render",Ve]]);export{Oe as default};
