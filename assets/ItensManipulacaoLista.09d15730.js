import{_ as K,Y as W,Z as Y,$ as J,bp as X,be as oo,cc as B,cb as $,cd as eo,a5 as to,cf as L,aF as ao,p as z,o as u,d as y,f as a,w as i,K as io,G as so,A as lo,B as N,C as ro,D as w,L as no,E as T,e as f,H as co,t as m,l as g,i as _,s as j,x as l,n as G,Q as Z,j as U,k as V,N as R,P as F,R as I,S as C,a4 as H,F as O,r as S,I as uo,y as mo,bi as po,a6 as fo,d3 as ho,bw as vo,az as go}from"./index.e0611938.js";import{l as _o}from"./listaV2.90b71f6f.js";import{P as bo}from"./ItensManipulacaoApontamento.0ca99f9b.js";import"./QBreadcrumbs.b747a30b.js";import"./xlsx.47aa0a81.js";const yo={components:{Avatar:W,Badge:Y,BadgeCopiarUid:J,PromptItemV2:X,PromptApontamento:bo,SeletorCampoTabela:oo},data(){return{itens:{},documentoAnterior:{},documentoItensAnterior:[],documento:{id:"",codigoDocumento:"",idEmpresa:"",codigoEmpresa:"",descricaoEmpresa:"",numeroDocumentoEmpresa:"",inscricaoMunicipalEmpresa:"",operacao:"Manipulacao",tipo:"Produ\xE7\xE3o",status:"",dataEmissao:B(),dataFinalizacao:"",observacao:""},documentoItens:[],adicionar:{modal:{name:"",value:!1}},listaApontamentos:[],apontamento:{modal:{name:"",value:!1}},totalOrigem:0,totalDestino:0,visivel:!1,promptApontamento:{},equipamentos:[],composicoes:[],quantidadeOriginal:0,contatos:[],dataPrevistaEntrega:"",horaPrevistaEntrega:"",lote:{show:!1,readonly:!1,value:""}}},emits:["atualizar"],methods:{onHide(){this.$router.replace({params:{id:""}})},zerarCampos(){this.documentoAnterior={},this.documentoItensAnterior=[],this.documento={id:$(),idEmpresa:"",descricaoEmpresa:"",operacao:"Manipula\xE7\xE3o",tipo:"Produ\xE7\xE3o",status:"Digita\xE7\xE3o",dataHoraEmissao:B(),dataHoraFinalizado:"",observacao:""},this.documentoItens=[],this.totalOrigem=0,this.totalDestino=0,this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.lote={show:!1,readonly:!1,value:""}},async atualizar(e){var o,r;if(this.zerarCampos(),e){if(this.documentoAnterior=await $db.itemManipulacao.le({id:e}),this.documento=$utils.clonarV2(this.documentoAnterior),this.documentoItensAnterior=await $db.itemManipulacao.leItens({idDocumento:e}),this.documentoItens=eo(this.documentoItensAnterior),(o=this.documento)!=null&&o.idContato){const d=this.documento.idContato;this.contatos[d]||(this.contatos[d]=await $db.contato.le({id:d}))}if((r=this.documento)!=null&&r.idEmpresa){const d=this.documento.idEmpresa;this.contatos[d]||(this.contatos[d]=await $db.contato.le({id:d}))}this.documento.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.documento.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.documento.dataHoraPrevisto.slice(11,16));for(const d of this.documentoItens){if(!this.lote.value&&d.operacaoFator===1&&d.loteEmpresa&&(this.lote.value=d.loteEmpresa),!d.idItem)continue;const t=await $erp().item.get(d.idItem);!t||t.id in this.itens||(this.itens[t.id]={codigoItem:t.codigoItem,referencia:t.referencia})}}else{let d,t,n;if(t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(t.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(d=t[0],t.length>1){const h={ativo:!0,empresas:!0};if(d=await $g.promptContato.show({filtro:h,placeholder:"Selecione"}),!d){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(n=(await $erp().empresa.where({idContato:d.id}).toArray())[0],!n){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}this.documento.descricaoEmpresa=n.nome,this.documento.idEmpresa=n.idContato,this.documento.numeroDocumentoEmpresa=n.numeroDocumentoNacional,this.documento.inscricaoMunicipalEmpresa=n.numeroDocumentoMunicipal}this.somarValorTotal(),this.buscarApontamentos(),await this.configLote()},async configLote(){var o,r;let e;this.usaLote=!1,this.pcpLote="",e=await $db.configuracoes.le({nome:"usa.lote"}),e=(o=e.find(d=>d.idEmpresa===this.documento.idEmpresa))!=null?o:e.find(d=>!d.idEmpresa),this.usaLote=(e==null?void 0:e.valor)==="1",e=await $db.configuracoes.le({nome:"pcp.lote"}),e=(r=e.find(d=>d.idEmpresa===this.documento.idEmpresa))!=null?r:e.find(d=>!d.idEmpresa),this.pcpLote=e==null?void 0:e.valor,this.lote.show=this.usaLote,this.lote.readonly=!!this.pcpLote,!this.lote.value&&this.pcpLote&&(this.lote.value=this.pcpLote)},async salvar(e,o){try{if(this.dataPrevistaEntrega){const r=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.documento.dataHoraPrevisto=to.formatDate(r)}if(this.dataPrevistaEntrega===null&&(this.documento.dataHoraPrevisto=""),this.lote.value!==this.pcpLote)for(const r of this.documentoItens)r.operacaoFator===1&&(!r.idItem||(r.loteEmpresa=this.lote.value));await $db.itemManipulacao.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens})}catch(r){this.$q.notifyError("Erro ao salvar",r)}await this.atualizar(this.documento.id),o&&this.$q.notify(o),e||this.$emit("atualizar"),this.visivel=e},async aguardarGeracaoNroPCP(){var r,d;let e=!0,o=0;$q.loading.show({message:"Aguardando gera\xE7\xE3o do n\xFAmero do PCP para composi\xE7\xE3o do n\xFAmero do lote."}),this.numeroPCP=null;do{await new Promise((t,n)=>setTimeout(t,1e3));try{const t=await this.$utils.geeksApi({consultaNumero:{funcao:"185D6D10-9A2A-4965-8C86-90FA2F7F73A2",id:this.documento.id}});(d=(r=t==null?void 0:t.data)==null?void 0:r.consultaNumero)!=null&&d.numero&&(this.numeroPCP=t==null?void 0:t.data.consultaNumero.numero,e=!1),++o===10&&(e=!1)}catch(t){console.error(t)}}while(e);if($q.loading.hide(),!this.numeroPCP){const t="N\xE3o foi poss\xEDvel obter o n\xFAmero do lote. Por favor, tente novamente.";throw $q.notify({type:"negative",message:t}),new Error(t)}},async gerarNroLote(){const e=new Date;if(this.pcpLote){let o=this.pcpLote;o=o.replace("AAAA",e.toISOString().slice(0,4)),o=o.replace("AA",e.toISOString().slice(2,4)),o=o.replace("MM",e.toISOString().slice(5,7)),o=o.replace("DD",e.toISOString().slice(8,10)),o=o.replace("PCP",String(this.numeroPCP)),this.lote.value=o}},async finalizar(){let e;if(e=this.verificarTotal(),!!e){if(this.usaLote&&this.pcpLote){let o=!0;for(let r of this.documentoItens)if(r.operacaoFator===1&&r.loteEmpresa){o=!1;break}o&&(await this.salvar(!0),await this.aguardarGeracaoNroPCP(),await this.gerarNroLote())}this.documento.status="Finalizado",this.documento.dataHoraFinalizado=B();for(let o of this.documentoItens)o.status="Finalizado",o.dataHoraFinalizado=B();this.salvar(!1,"Produ\xE7\xE3o Finalizada")}},reabrir(){try{this.documento.status="Digita\xE7\xE3o",this.documento.dataHoraFinalizado="";for(let e of this.documentoItens)e.status="Digita\xE7\xE3o",e.dataHoraFinalizado="";this.salvar(!0,"Produ\xE7\xE3o reaberta")}catch(e){this.$q.notifyError("Erro ao reabrir",e)}},async excluirItem(e){this.documentoItens=this.documentoItens.filter(o=>o.id!==e),this.somarValorTotal()},async removerTodosItens(e){$q.dialog({title:"Remover todos os itens",message:`Deseja remover todos os itens de ${e}`,cancel:!0,persistent:!0}).onOk(()=>{let o=[];const r=e==="Destino"?1:-1;o=this.documentoItens.filter(d=>d.operacaoFator===r);for(const d of o)this.excluirItem(d.id)})},async recalcularTotal(e,o=!1){if(e.subTotal=L(e.quantidade*e.valorItem),e.total=L(e.quantidade*e.valorItem),o){let r={titulo:"Composi\xE7\xE3o",msg:"Deseja recalcular a origem?"};e.operacaoFator===1&&await this.verificarComposicao(e.idItem,e.quantidade,r)}this.somarValorTotal()},async recalcularQuantidade(e){e.quantidade=L(e.subTotal/e.valorItem),e.total=e.subTotal,this.somarValorTotal()},async recalcularValorItem(e){e.valorItem=L(e.subTotal/e.quantidade),e.total=e.subTotal,this.somarValorTotal()},somarValorTotal(){const e=this.documentoItens.filter(r=>r.operacaoFator===-1).reduce((r,d)=>r+=d.total,0),o=this.documentoItens.filter(r=>r.operacaoFator===1).reduce((r,d)=>r+=d.total,0);this.totalOrigem=$utils.arredondar(e,2),this.totalDestino=$utils.arredondar(o,2)},verificarTotal(){return this.documentoItens.length===0&&this.totalDestino===0&&this.totalOrigem===0?(this.$q.notifyError("Selecione alguns itens na lista"),!1):this.totalOrigem!==this.totalDestino?(this.$q.notifyError("Valores Totais de Origem e Destino devem ser iguais!"),!1):!0},async abrirModal(e,o=""){let r={},d=[];const t=e==="Destino"?1:-1;o?d=this.documentoItens.filter(n=>n.idItem===o):d=this.documentoItens.filter(n=>n.operacaoFator===t);for(const n of d)r[n.idItem]={item:await ao().item.get(n.idItem)||{},quantidade:n.quantidade};this.$refs.promptItem.itensSelecionados=r,this.$refs.promptItem.termo=o,this.$refs.promptItem.atualizar(),this.adicionar.modal.value=!0,this.adicionar.modal.name=e},async selecionarItens(e){var d,t,n;let o={};const r=this.adicionar.modal.name==="Destino"?1:-1;for(const h in e){let b=await $db.estoqueSaldoProdutoEmpresa.le({idEmpresa:this.documento.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:h});b=b[0];const k=await $db.configuracoes.porNome("vendas.checaestoque",this.documento.idEmpresa),q=!!Number((d=k.find(E=>E.id))==null?void 0:d.valor),p=e[h].item||{},c=e[h].quantidade||0,v=(t=(b==null?void 0:b.valorCustoMedio)||(p==null?void 0:p.valorCustoReposicao))!=null?t:0;if(p.id in this.itens||(this.itens[p.id]={codigoItem:p.codigoItem,referencia:p.referencia}),q&&r===-1&&(!(b!=null&&b.saldo)||c>(b==null?void 0:b.saldo))){this.$q.notifyError(`${p.descricao} n\xE3o dispon\xEDvel no estoque`);continue}let M=this.documentoItens.find(E=>E.idItem===h);M?(M.quantidade=c,M.quantidadeRealizado=c,M.subTotal=L(c*v),M.total=L(c*v)):this.documentoItens.push({dataHoraEmissao:B(),dataHoraFinalizado:"",descricaoItem:p.descricao,id:$(),idDocumento:this.documento.id,idItem:p.id,operacao:"Manipula\xE7\xE3o",operacaoFator:r,quantidade:c,quantidadeRealizado:c,status:"Digita\xE7\xE3o",tipoItem:p.tipo,subTotal:L(c*v),total:L(c*v),unidade:p.unidade,valorCustoMedio:(n=b==null?void 0:b.valorCustoMedio)!=null?n:0,valorItem:v,valorOriginal:v});let s=await $db.item.leCompleto({id:p.id});!this.composicoes.includes(s.atual.composicao[0].idItemUtilizado)&&s.atual.composicao[0].idItemUtilizado!==""?(o={titulo:"Composi\xE7\xE3o",msg:"O item selecionado possui itens de composi\xE7\xE3o, deseja preencher?"},r===1&&await this.verificarComposicao(p.id,c,o)):o={}}this.somarValorTotal()},async verificarComposicao(e,o,r){var h,b;let d=[],t=await $db.item.leCompleto({id:e});(b=(h=t==null?void 0:t.atual)==null?void 0:h.composicao)==null||b.sort((k,q)=>k.ordem<q.ordem?-1:1);for(let k of t.atual.composicao)k.idItemUtilizado&&(k.quantidade=k.quantidade*o,d.push(k),this.composicoes.push(k.idItemUtilizado));const n=d.reduce((k,q)=>(k[q.idItemUtilizado]||(k[q.idItemUtilizado]=q),k),{});r.titulo?$q.dialog({title:r.titulo,message:r.msg,cancel:!0,persistent:!0}).onOk(()=>{this.adicionar.modal.name="Origem",this.selecionarItens(n),r.titulo=""}):(this.adicionar.modal.name="Origem",this.selecionarItens(n))},async abrirModalApontamento(){this.$refs.promptApontamento.show()},async incluirApontamento(e){let o={id:$(),documentoItemIdContato:e.operador,idItem:e.equipamento,tipoItem:"ApontamentoPCP",quantidade:e.quantidade,dataHoraEmissao:e.dataIni,dataHoraFinalizado:e.dataFim,peso:e.peso,idDocumento:this.documento.id};try{await $db.documentoItem.grava({atual:o})}catch(r){this.$q.notifyError("Erro ao salvar",r)}this.buscarApontamentos()},async buscarApontamentos(){try{this.listaApontamentos=[],(await $db.documentoItem.leApontamento({tipoItem:"ApontamentoPCP",idDocumento:this.documento.id})).forEach((o,r)=>{this.listaApontamentos[r]={id:o.id,operador:o.documentoItemIdContato,equipamento:o.idItem,quantidade:o.quantidade,dataIni:o.dataHoraEmissao,dataFim:o.dataHoraFinalizado,peso:o.peso,idDocumento:o.idDocumento}})}catch(e){this.$q.notifyError("Erro ao consultar apontamentos",e)}},async carregarEquipamentos(){let e=await $db.item.leRefatorado({filtros:{tipo:"Servi\xE7o"}});this.equipamentos=e.data.map(o=>({descricao:o.descricao,id:o.id}))},buscaEquipamentoApontado(e){let o=this.equipamentos.find(r=>r.id===e);return o?o.descricao:""},async carregarOperadores(){let e=await $db.contato.leRefatorado({filtros:{}});this.operadores=e.data.map(o=>({nome:o.nome,id:o.id}))},async carregarOperacoes(){let e=await $db.hibrido.lista({table:"documento",where:{tipo:"Produ\xE7\xE3o"}});this.documento.operacoes=e.map(o=>({rotulo:o.operacao,valor:o.operacao}))},buscaOperadorApontado(e){let o=this.operadores.find(r=>r.id===e);return o?o.nome:""},calculoHorasProducao(e,o){let r=new Date(e)-new Date(o),d=Math.floor(r%864e5/36e5),t=Math.round(r%864e5%36e5/6e4);return d+"h "+t+"m"},async removerTodosApontamentos(){$q.dialog({title:"Remover todos os apontamentos",message:"Deseja remover todos os apontamentos de produ\xE7\xE3o",cancel:!0,persistent:!0}).onOk(()=>{for(const e of this.listaApontamentos)this.excluirApontamento(e.id)})},async excluirApontamento(e){try{await $db.documentoItem.removeApontamento(e),this.listaApontamentos=this.listaApontamentos.filter(o=>o.id!==e),this.$q.notify("Apontamento removido!")}catch{this.$q.notifyError("N\xE3o foi possivel remover o apontamento!")}},qtdOriginal(e=0){this.quantidadeOriginal=e},async abrirModalContato(){const e=await this.selecionarContato({placeholder:"Selecione o cliente",filtro:{ativo:!0}});e.id&&(this.documento.idContato=e.id),e.nome&&(this.documento.descricaoContato=e.nome),this.contatos[e.id]||(this.contatos[e.id]=await $db.contato.le({id:e.id}))},async selecionarContato(e){const{placeholder:o,filtro:r}={placeholder:"Selecione o contato",filtro:{ativo:!0},...e},d=await $g.promptContato.show({filtro:r,placeholder:o});if(!d)throw new Error("Contato n\xE3o selecionado");return d}},async beforeMount(){await this.carregarEquipamentos(),await this.carregarOperadores()}},Io={key:0},qo={ref:"form"},xo={class:"col-12 col-md"},wo={class:"col-auto"},Co={class:"col"},ko={class:"col-12 col-md"},Eo={class:"col-auto"},zo={class:"col"},Ao={key:0,class:"col-4"},Vo={class:"col-6 bg-transparent"},Po={class:"col-6 bg-transparent"},Fo={class:"col-12"},Do={class:"col-12 col-md-6"},Mo={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},Lo=l("div",{class:"col-2 col-md"},"Ref/C\xF3d.",-1),Oo=l("div",{class:"col-10 col-md-4"},"Descri\xE7\xE3o",-1),So=l("div",{class:"col-6 col-md text-right"},"Quantidade",-1),To=l("div",{class:"col-6 col-md text-right"},"Valor",-1),Ho=l("div",{class:"col-6 col-md text-right"},"Total",-1),Uo=l("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1),Qo={class:"col-2 col-md"},Bo={key:0},No={key:1},Ro={class:"col-10 col-md-4"},jo={class:"col-6 col-md text-right"},$o={class:"col-6 col-md text-right"},Go={class:"col-6 col-md text-right"},Zo={key:0,class:"col-6 col-md-1 text-right"},Ko=l("div",{class:"col-2 col-md"},null,-1),Yo=l("div",{class:"col-10 col-md-4"},null,-1),Jo=l("div",{class:"col-6 col-md text-right"},null,-1),Wo=l("div",{class:"col-6 col-md text-right"},null,-1),Xo={class:"col-6 col-md text-right"},oe=l("div",{class:"col-6 col-md-1 text-right"},"\xA0",-1),ee={class:"col-12 col-md-6"},te={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},ae=l("div",{class:"col-2 col-md"},"Ref/C\xF3d.",-1),ie=l("div",{class:"col-10 col-md-4"},"Descri\xE7\xE3o",-1),se=l("div",{class:"col-6 col-md text-right"},"Quantidade",-1),le=l("div",{class:"col-6 col-md text-right"},"Unidade",-1),re=l("div",{class:"col-6 col-md text-right"},"Valor",-1),ne=l("div",{class:"col-6 col-md text-right"},"Total",-1),de=l("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1),ce={class:"col-2 col-md"},ue={key:0},me={key:1},pe={class:"col-10 col-md-4"},fe={class:"col-6 col-md text-right"},he={class:"col-6 col-md text-right"},ve={class:"col-6 col-md text-right"},ge={class:"col-6 col-md text-right"},_e={key:0,class:"col-6 col-md-1 text-right"},be=l("div",{class:"col-2 col-md"},null,-1),ye=l("div",{class:"col-10 col-md-4"},null,-1),Ie=l("div",{class:"col-6 col-md text-right"},null,-1),qe=l("div",{class:"col-6 col-md text-right"},null,-1),xe={class:"col-6 col-md text-right"},we=l("div",{class:"col-6 col-md-1 text-right"},"\xA0",-1),Ce={class:"col-12 col-md-12"},ke={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},Ee=l("div",{class:"col-6 col-md"},"Data hora inicio",-1),ze=l("div",{class:"col-6 col-md"},"Data hora fim",-1),Ae=l("div",{class:"col-6 col-md text-right"},"Tempo total",-1),Ve=l("div",{class:"col-6 col-md text-right"},"Equipamentos",-1),Pe=l("div",{class:"col-6 col-md text-right"},"Operador",-1),Fe=l("div",{class:"col-6 col-md text-right"},"Quantidade",-1),De=l("div",{class:"col-6 col-md text-right"},"Peso",-1),Me=l("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1),Le={class:"col-6 col-md"},Oe={class:"col-6 col-md"},Se={class:"col-6 col-md text-right"},Te={class:"col-6 col-md text-right"},He={class:"col-6 col-md text-right"},Ue={class:"col-6 col-md text-right"},Qe={class:"col-6 col-md text-right"},Be={class:"col-6 col-md-1 text-right"},Ne={class:"u-container relative-position"};function Re(e,o,r,d,t,n){const h=z("badge"),b=z("BadgeCopiarUid"),k=z("avatar"),q=z("campo"),p=z("row"),c=z("SeletorCampoTabela"),v=z("PromptItemV2"),M=z("PromptApontamento");return u(),y("div",null,[a(mo,{modelValue:t.visivel,"onUpdate:modelValue":o[18]||(o[18]=s=>t.visivel=s),maximized:"",onHide:n.onHide},{default:i(()=>[a(io,{class:"bg-light",container:""},{default:i(()=>[a(so,{class:"u-container"},{default:i(()=>[a(lo,null,{default:i(()=>[a(N,null,{default:i(()=>[ro(a(w,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[no]]),a(T,null,{default:i(()=>[f("Produ\xE7\xE3o (PCP)")]),_:1}),a(w,{class:"q-ml-sm no-shadow",color:"white",unelevated:"","text-color":"primary",label:"Salvar",onClick:o[0]||(o[0]=s=>n.salvar(!1,"Produ\xE7\xE3o salva!"))})]),_:1})]),_:1}),a(co,null,{default:i(()=>[a(N,{class:"q-pa-none q-ma-none q-my-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[a(T,{class:"text-black q-px-none text-body2"},{default:i(()=>[f("Emiss\xE3o: "+m(e.$filters.data(t.documento.dataHoraEmissao))+" ",1),t.documento.dataHoraFinalizado?(u(),y("span",Io,"Cancelamento: "+m(e.$filters.data(t.documento.dataHoraFinalizado)),1)):g("",!0)]),_:1}),t.documento.status?(u(),_(h,{key:0,cor:"positive",class:"q-mx-sm",icone:"flag",escuro:""},{default:i(()=>[f(m(t.documento.status),1)]),_:1})):g("",!0),t.documento.numero?(u(),_(h,{key:1,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:i(()=>[f(" #"+m(t.documento.numero.toString().padStart(6,"0")),1)]),_:1})):(u(),_(b,{key:2,id:t.documento.id,numero:t.documento.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))]),_:1}),a(j,{class:"bg-white q-pa-md q-mt-md no-shadow"},{default:i(()=>[l("form",qo,[a(p,{class:"q-col-gutter-sm"},{default:i(()=>[l("div",xo,[a(p,null,{default:i(()=>{var s,E,A,P;return[l("div",wo,[a(k,{imagem:(E=(s=t.contatos[t.documento.idEmpresa])==null?void 0:s.imagem)!=null?E:"",rotulo:(P=(A=t.contatos[t.documento.idEmpresa])==null?void 0:A.nome)!=null?P:"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),l("div",Co,[a(q,{somenteLeitura:"",rotulo:"Empresa",tipo:"texto",class:"col-10",modelValue:t.documento.descricaoEmpresa,"onUpdate:modelValue":o[1]||(o[1]=D=>t.documento.descricaoEmpresa=D)},null,8,["modelValue"])])]}),_:1})]),l("div",ko,[a(p,null,{default:i(()=>{var s,E,A,P;return[l("div",Eo,[a(k,{imagem:(E=(s=t.contatos[t.documento.idContato])==null?void 0:s.imagem)!=null?E:"",rotulo:(P=(A=t.contatos[t.documento.idEmpresa])==null?void 0:A.nome)!=null?P:"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),l("div",zo,[a(q,{somenteLeitura:"",placeholder:"Cliente",rotulo:"Cliente",tipo:"texto",after:[{icon:"search",handler(){n.abrirModalContato()}}],modelValue:t.documento.descricaoContato,"onUpdate:modelValue":o[2]||(o[2]=D=>t.documento.descricaoContato=D)},null,8,["after","modelValue"])])]}),_:1})])]),_:1}),a(p,null,{default:i(()=>[t.lote.show?(u(),y("div",Ao,[a(q,{modelValue:t.lote.value,"onUpdate:modelValue":o[3]||(o[3]=s=>t.lote.value=s),"somente-leitura":t.lote.readonly,rotulo:"Lote",tipo:"texto"},null,8,["modelValue","somente-leitura"])])):g("",!0),l("div",{class:G(t.lote.show?"col-4":"col-6"),onClick:o[5]||(o[5]=(...s)=>n.carregarOperacoes&&n.carregarOperacoes(...s))},[a(c,{modelValue:t.documento.operacao,"onUpdate:modelValue":o[4]||(o[4]=s=>t.documento.operacao=s),filtro:{tipo:"Produ\xE7\xE3o"},tabela:"documento",campo:"operacao",label:"Opera\xE7\xE3o",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])],2),l("div",{class:G(t.lote.show?"col-4":"col-6")},[a(p,null,{default:i(()=>[l("div",Vo,[a(Z,{modelValue:t.dataPrevistaEntrega,"onUpdate:modelValue":o[6]||(o[6]=s=>t.dataPrevistaEntrega=s),type:"date",clearable:"",dense:"","stack-label":"",label:"Data Prevista de Entrega"},null,8,["modelValue"])]),l("div",Po,[a(Z,{modelValue:t.horaPrevistaEntrega,"onUpdate:modelValue":o[7]||(o[7]=s=>t.horaPrevistaEntrega=s),type:"time",clearable:"",dense:"","stack-label":"",label:"Hora Prevista de Entrega"},null,8,["modelValue"])])]),_:1})],2),l("div",Fo,[a(q,{modelValue:t.documento.observacao,"onUpdate:modelValue":o[8]||(o[8]=s=>t.documento.observacao=s),rotulo:"Observa\xE7\xE3o",rows:"1",tipo:"textoArea"},null,8,["modelValue"])])]),_:1})],512)]),_:1}),a(p,{class:"q-col-gutter-x-sm q-mt-md"},{default:i(()=>[l("div",Do,[a(j,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[a(N,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[l("p",Mo,[a(U,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),f(" Origem ")]),a(T,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),t.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:o[9]||(o[9]=s=>n.removerTodosItens("Origem"))},{default:i(()=>[a(V,null,{default:i(()=>[f("Remover todos")]),_:1})]),_:1})):g("",!0),t.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:o[10]||(o[10]=s=>n.abrirModal("Origem"))},{default:i(()=>[a(V,null,{default:i(()=>[f("Adicionar Item")]),_:1})]),_:1})):g("",!0)]),_:1}),a(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[a(F,{class:"q-pa-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[a(p,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>[Lo,Oo,So,To,Ho,Uo]),_:1})]),_:1}),a(H,{class:"q-my-xs"}),(u(!0),y(O,null,S(t.documentoItens,(s,E)=>(u(),y("div",{key:E},[s.operacaoFator===-1?(u(),_(C,{key:0,caption:""},{default:i(()=>[a(p,{class:"text-left justify-around"},{default:i(()=>{var A,P,D,Q;return[l("div",Qo,[(A=t.itens[s.idItem])!=null&&A.referencia?(u(),y("span",Bo,m((P=t.itens[s.idItem])==null?void 0:P.referencia),1)):(D=t.itens[s.idItem])!=null&&D.codigoItem?(u(),y("span",No," #"+m((Q=t.itens[s.idItem])==null?void 0:Q.codigoItem),1)):g("",!0)]),l("div",Ro,m(s.descricaoItem||"-"),1),l("div",jo,[a(q,{modelValue:s.quantidade,"onUpdate:modelValue":x=>s.quantidade=x,somenteLeitura:t.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularTotal(s,!0)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),l("div",$o,[a(q,{modelValue:s.valorItem,"onUpdate:modelValue":x=>s.valorItem=x,decimals:"4",disable:"",tipo:"decimal",somenteLeitura:t.documento.status==="Finalizado",onBlur:x=>n.recalcularTotal(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),l("div",Go,[a(q,{modelValue:s.subTotal,"onUpdate:modelValue":x=>s.subTotal=x,somenteLeitura:t.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularQuantidade(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),t.documento.status==="Digita\xE7\xE3o"?(u(),y("div",Zo,[a(w,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:x=>n.excluirItem(s.id)},{default:i(()=>[a(V,null,{default:i(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])])):g("",!0)]}),_:2},1024)]),_:2},1024)):g("",!0),s.operacaoFator===-1?(u(),_(H,{key:1,class:"q-my-xs"})):g("",!0),s.operacaoFator===-1?(u(),_(C,{key:2,caption:""})):g("",!0)]))),128))]),_:1})]),_:1}),a(F,{class:"q-pa-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[a(p,{class:"text-weight-bold text-left justify-around"},{default:i(()=>[Ko,Yo,Jo,Wo,l("div",Xo,m(e.$filters.numero(t.totalOrigem,2)),1),oe]),_:1})]),_:1})]),_:1})]),_:1}),a(F,{class:"q-px-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,{class:"text-center"},{default:i(()=>[a(w,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:o[11]||(o[11]=s=>n.abrirModal("Origem"))})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",ee,[a(j,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[a(N,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[l("p",te,[a(U,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),f(" Destino ")]),a(T,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),t.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:o[12]||(o[12]=s=>n.removerTodosItens("Destino"))},{default:i(()=>[a(V,null,{default:i(()=>[f("Remover todos")]),_:1})]),_:1})):g("",!0),t.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:o[13]||(o[13]=s=>n.abrirModal("Destino"))},{default:i(()=>[a(V,null,{default:i(()=>[f("Adicionar Item")]),_:1})]),_:1})):g("",!0)]),_:1}),a(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[a(F,{class:"q-pa-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[a(p,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>[ae,ie,se,le,re,ne,de]),_:1})]),_:1}),a(H,{class:"q-my-xs"}),(u(!0),y(O,null,S(t.documentoItens,(s,E)=>(u(),y("div",{key:E},[s.operacaoFator===1?(u(),_(C,{key:0,caption:""},{default:i(()=>[a(p,{class:"text-left justify-around"},{default:i(()=>{var A,P,D,Q;return[l("div",ce,[(A=t.itens[s.idItem])!=null&&A.referencia?(u(),y("span",ue,m((P=t.itens[s.idItem])==null?void 0:P.referencia),1)):(D=t.itens[s.idItem])!=null&&D.codigoItem?(u(),y("span",me," #"+m((Q=t.itens[s.idItem])==null?void 0:Q.codigoItem),1)):g("",!0)]),l("div",pe,m(s.descricaoItem||"-"),1),l("div",fe,[a(q,{modelValue:s.quantidade,"onUpdate:modelValue":x=>s.quantidade=x,somenteLeitura:t.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onMouseover:x=>n.qtdOriginal(s.quantidade),onBlur:x=>n.recalcularTotal(s,s.quantidade!==t.quantidadeOriginal)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onMouseover","onBlur"])]),l("div",he,m(s.unidade),1),l("div",ve,[a(q,{modelValue:s.valorItem,"onUpdate:modelValue":x=>s.valorItem=x,somenteLeitura:t.documento.status==="Finalizado",class:"col",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularTotal(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),l("div",ge,[a(q,{modelValue:s.subTotal,"onUpdate:modelValue":x=>s.subTotal=x,somenteLeitura:t.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:x=>n.recalcularValorItem(s)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),t.documento.status==="Digita\xE7\xE3o"?(u(),y("div",_e,[a(w,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:x=>n.excluirItem(s.id)},{default:i(()=>[a(V,null,{default:i(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])])):g("",!0)]}),_:2},1024)]),_:2},1024)):g("",!0),s.operacaoFator===1?(u(),_(H,{key:1,class:"q-my-xs"})):g("",!0),s.operacaoFator===1?(u(),_(C,{key:2,caption:""})):g("",!0)]))),128))]),_:1})]),_:1}),a(F,{class:"q-pa-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[a(p,{class:"text-weight-bold text-left justify-around"},{default:i(()=>[be,ye,Ie,qe,l("div",xe,m(e.$filters.numero(t.totalDestino,2)),1),we]),_:1})]),_:1})]),_:1})]),_:1}),a(F,{class:"q-px-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,{class:"text-center"},{default:i(()=>[a(w,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:o[14]||(o[14]=s=>n.abrirModal("Destino"))})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),a(p,{class:"q-col-gutter-x-sm q-mt-md"},{default:i(()=>[l("div",Ce,[a(j,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[a(N,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[l("p",ke,[a(U,{class:"q-mr-md",name:"content_paste",size:"24px",style:{color:"#737373"}}),f(" Apontamentos ")]),a(T,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),t.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:o[15]||(o[15]=s=>n.removerTodosApontamentos())},{default:i(()=>[a(V,null,{default:i(()=>[f("Remover todos")]),_:1})]),_:1})):g("",!0),t.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:o[16]||(o[16]=s=>n.abrirModalApontamento())},{default:i(()=>[a(V,null,{default:i(()=>[f("Adicionar Apontamento")]),_:1})]),_:1})):g("",!0)]),_:1}),a(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[a(F,{class:"q-pa-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[a(p,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>[Ee,ze,Ae,Ve,Pe,Fe,De,Me]),_:1})]),_:1}),a(H,{class:"q-my-xs"}),(u(!0),y(O,null,S(t.listaApontamentos,(s,E)=>(u(),y("div",{key:E},[a(C,{caption:""},{default:i(()=>[a(p,{class:"text-left justify-around"},{default:i(()=>[l("div",Le,m(e.$filters.dataHora(s.dataIni)),1),l("div",Oe,m(e.$filters.dataHora(s.dataFim)),1),l("div",Se,m(n.calculoHorasProducao(s.dataFim,s.dataIni)),1),l("div",Te,m(n.buscaEquipamentoApontado(s.equipamento)),1),l("div",He,m(n.buscaOperadorApontado(s.operador)),1),l("div",Ue,m(e.$filters.numeroZerosDireita(s.quantidade,4,0)),1),l("div",Qe,m(e.$filters.numeroZerosDireita(s.peso,4,0)),1),l("div",Be,[a(w,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:A=>n.excluirApontamento(s.id)},{default:i(()=>[a(V,null,{default:i(()=>[f("Excluir")]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1}),a(F,{class:"q-px-none"},{default:i(()=>[a(I,null,{default:i(()=>[a(C,{class:"text-center"},{default:i(()=>[a(w,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar apontamento",outline:"",size:"xs",onClick:o[17]||(o[17]=s=>n.abrirModalApontamento())})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),a(uo,{class:"bg-light no-shadow q-pa-sm text-right",bordered:""},{default:i(()=>[l("div",Ne,[a(T,{class:"text-right"},{default:i(()=>[t.documento.status==="Finalizado"?(u(),_(w,{key:0,color:"primary",label:"Reabrir",onClick:n.reabrir},null,8,["onClick"])):g("",!0),t.documento.status==="Digita\xE7\xE3o"?(u(),_(w,{key:1,color:"primary",label:"Finalizar",onClick:n.finalizar},null,8,["onClick"])):g("",!0)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"]),a(v,{modelValue:t.adicionar.modal.value,"onUpdate:modelValue":o[19]||(o[19]=s=>t.adicionar.modal.value=s),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:t.documento.idEmpresa},exibirValorVenda:!1,onSelecionarItens:n.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"]),a(M,{onIncluirApontamento:n.incluirApontamento,habilitarQuantidade:!0,ref:"promptApontamento"},null,8,["onIncluirApontamento"])])}var je=K(yo,[["render",Re]]);const $e={components:{lista:_o,Badge:Y,ItensManipulacao:je,BadgeCopiarUid:J},data(){return{paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25},filtros:{tab:"digitacao",empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},documentos:[],tabs:[{rotulo:"Digita\xE7\xE3o",value:"digitacao"},{rotulo:"Finalizados",value:"finalizado"},{rotulo:"Todos",value:"Todos"}],tabSelecionada:{valor:"digitacao"},listaLayout:{},buscaCampo:"",checkboxModel:[],configImpressao:[]}},watch:{showFilters:function(e){e===!0?this.showList=!1:(this.section===!0||this.kanban===!0||this.gantt===!0)&&(this.showList=!0)}},methods:{async atualizar(){var o;const e=$utils.logarIni("ItensManipulacaoLista");await $tryLoading(async()=>{this.filtros.tab=this.tabSelecionada.valor;let r="";this.filtros.tab==="digitacao"?r="Digita\xE7\xE3o":this.filtros.tab==="finalizado"&&(r="Finalizado");let d=this.filtros.empresa.selecionada.value||"";this.filtros.idEmpresa=d;let t=this.$utils.eliminarVazios(this.filtros);this.buscaCampo&&(t.termoBusca=this.buscaCampo),t.status=r;const n=await $db.itemManipulacao.leListaCompleta({filtros:t,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["codigoDocumento"],dir:["desc"]});this.listaLayout={};for(let h of n.data)this.listaLayout[h.id]={detalhes:!1};this.documentos=n.data,this.calcularPorcentagem(this.documentos),this.paginacao.total=n.total,this.paginacao.maximo=n.totalPages,this.configuraImpressao(this.filtros.idEmpresa)},{mensagem:"Carregando...",erro:"Ocorreu um erro ao consultar"}),$utils.logarFim(e,((o=this.documentos)==null?void 0:o.length)||0)},limparFiltros_click(){this.filtros={tab:this.tabAtiva,empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},this.atualizar()},async showDetails(e){let o=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:e.id}});e.documentoItens=o,e.showPreviewDetail=!e.showPreviewDetail},async editarManipulacao(e){this.$router.replace({params:{id:e}}),await this.$refs.itensManipulacao.atualizar(e),this.$refs.itensManipulacao.visivel=!0},async adicionarManipulacaoItens(){await this.$refs.itensManipulacao.atualizar(),this.$refs.itensManipulacao.visivel=!0},async filtrar(e=1){this.buscaCampo="";const o=(e-1)*this.pageSize;this.documentos.status="digitacao";let r=await $db.itemManipulacao.le({periodoEmissao:{ini:this.filtro.periodoEmissao.ini,fim:this.filtro.periodoEmissao.fim},periodoFinalizado:{ini:this.filtro.periodoFinalizado.ini,fim:this.filtro.periodoFinalizado.fim},status:this.page.ativa,idEmpresa:this.filtro.empresas.selected,offset:o,limit:this.pageSize});this.documentos=r[0].map(t=>({...t,showPreviewDetail:!1,documentoItens:[]})),this.documentos=po.exports.orderBy(this.documentos,["dataHoraFinalizado","dataHoraEmissao"],["desc","desc"]);let d=r[1];this.page.digitacao.max=Math.ceil(d/this.pageSize),this.page.finalizado.max=Math.ceil(d/this.pageSize)},excluir(e){$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show(),await $db.itemManipulacao.remove(e),this.atualizar(),$q.notifyPositive("O item foi exclu\xEDdo com sucesso.")}catch(o){$q.notifyError("Ocorreu um erro ao remover item",o)}finally{$q.loading.hide()}})},async empresaOpcoesCarregar(){console.log("carregar empresas"),this.filtros.empresa.opcoes=(await $db.empresa.le()).map(e=>({rotulo:e.nome,valor:e.idContato}))},async configuraImpressao(e){const o=await $db.configuracoes.porNome("impressao.producao",e);this.configImpressao=[...o.length?o.map(r=>({texto:"Imprimir Composi\xE7\xE3o",...r})):[{valor:"Impressao-ordem-producao",texto:"Ordem de Produ\xE7\xE3o"},{valor:"impressao-etiqueta-pcp1",texto:"Etiq. 2 - Semi Acabado"},{valor:"impressao-etiqueta-pcp2",texto:"Etiq. 1 - Acabado"}]]},async calcularPorcentagem(e){for(let o=0;o<e.length;o++){let r=0,d=0,t=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:e[o].id}}),n=t.filter(({tipoItem:h})=>h==="ApontamentoPCP");t.forEach((h,b)=>{h?h.operacaoFator===1&&(r+=h.quantidade):r+=0}),n.forEach((h,b)=>{h?h.tipoItem==="ApontamentoPCP"&&(d+=h.quantidade):d+=0}),r===0?(e[o].porcentagemApontamento=0,e[o].porcentagemApontamentoLabel="0 %"):(e[o].porcentagemApontamento=d/r,e[o].porcentagemApontamentoLabel=`${Math.round(d/r*100)} %`)}}},created(){this.atualizar()},mounted(){this.$route.params.id&&this.$route.params.id.length&&(this.$refs.itensManipulacao.atualizar(this.$route.params.id),this.$refs.itensManipulacao.visivel=!0)}},Ge={class:"row"},Ze={class:"col-12 row q-px-md q-mt-lg"},Ke=l("strong",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Emiss\xE3o",-1),Ye={class:"col-12"},Je={class:"col-12"},We={class:"col-12 row q-px-md q-mt-lg"},Xe=l("strong",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Finaliza\xE7\xE3o",-1),ot={class:"col-12"},et={class:"col-12"},tt={class:"col-12 row q-px-md q-mt-lg"},at={class:"row items-center"},it={key:0},st={class:"absolute-full flex flex-center"},lt={class:"text-tertiary q-gutter-xs"};function rt(e,o,r,d,t,n){const h=z("campo"),b=z("badge"),k=z("BadgeCopiarUid"),q=z("lista"),p=z("ItensManipulacao");return u(),y("div",null,[a(q,{titulo:"Produ\xE7\xE3o (PCP)",onCriar_click:n.adicionarManipulacaoItens,showAdd:!1,showToolbar:!1,icone:"mdi-set-center-right",onFiltro_change:n.atualizar,onLimparFiltros_click:n.limparFiltros_click,tabSelecionada:t.tabSelecionada,tabs:t.tabs,listaLayout:t.listaLayout,paginacao:t.paginacao,filtros:t.filtros,buscaCampo:t.buscaCampo,"onUpdate:buscaCampo":o[7]||(o[7]=c=>t.buscaCampo=c),checkboxModel:t.checkboxModel,"onUpdate:checkboxModel":o[8]||(o[8]=c=>t.checkboxModel=c)},{filtroCampos:i(()=>[l("div",Ge,[l("div",{class:"col-12 q-px-sm",onClick:o[1]||(o[1]=(...c)=>n.empresaOpcoesCarregar&&n.empresaOpcoesCarregar(...c))},[a(h,{modelValue:t.filtros.empresa.selecionada,"onUpdate:modelValue":o[0]||(o[0]=c=>t.filtros.empresa.selecionada=c),opcoes:t.filtros.empresa.opcoes,rotulo:"Por Empresa",tipo:"seletor"},null,8,["modelValue","opcoes"])]),l("div",Ze,[Ke,l("div",Ye,[a(h,{modelValue:t.filtros.periodoEmissao.ini,"onUpdate:modelValue":o[2]||(o[2]=c=>t.filtros.periodoEmissao.ini=c),after:[{icon:"mdi-close-circle",handler(){t.filtros.periodoEmissao.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),l("div",Je,[a(h,{modelValue:t.filtros.periodoEmissao.fim,"onUpdate:modelValue":o[3]||(o[3]=c=>t.filtros.periodoEmissao.fim=c),after:[{icon:"mdi-close-circle",handler(){t.filtros.periodoEmissao.fim=""}}],class:"no-shadow full-width",rotulo:"at\xE9",tipo:"data"},null,8,["modelValue","after"])])]),l("div",We,[Xe,l("div",ot,[a(h,{modelValue:t.filtros.periodoFinalizado.ini,"onUpdate:modelValue":o[4]||(o[4]=c=>t.filtros.periodoFinalizado.ini=c),after:[{icon:"mdi-close-circle",handler(){t.filtros.periodoFinalizado.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),l("div",et,[a(h,{modelValue:t.filtros.periodoFinalizado.fim,"onUpdate:modelValue":o[5]||(o[5]=c=>t.filtros.periodoFinalizado.fim=c),after:[{icon:"mdi-close-circle",handler(){t.filtros.periodoFinalizado.fim=""}}],class:"no-shadow full-width",rotulo:"at\xE9",tipo:"data"},null,8,["modelValue","after"])])]),l("div",tt,[a(fo,{modelValue:t.paginacao.limite,"onUpdate:modelValue":o[6]||(o[6]=c=>t.paginacao.limite=c),options:[10,25,50,100],placeholder:"Quantidade por p\xE1gina"},null,8,["modelValue"])])])]),itemLista:i(()=>[(u(!0),y(O,null,S(t.documentos,c=>(u(),_(R,{key:c.id,class:"q-py-none qListaItems",style:{border:"none !important"}},{default:i(()=>[a(F,{class:"items-center d-flex"},{default:i(()=>[a(I,{avatar:"",center:""},{default:i(()=>[l("div",at,[c.numero?(u(),_(b,{key:0,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:i(()=>[f(" #"+m(c.numero.toString().padStart(6,"0")),1)]),_:2},1024)):(u(),_(k,{key:1,id:c.id,numero:c.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))])]),_:2},1024),a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[f(m(c.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024),a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[f(m(c.descricaoContato),1)]),_:2},1024)]),_:2},1024),a(I,{caption:""},{default:i(()=>[a(C,null,{default:i(()=>[a(U,{class:"text-tertiary",name:"event"}),f(" "+m(e.$filters.data(c.dataHoraEmissao)),1)]),_:2},1024),a(V,null,{default:i(()=>[f("Data Emiss\xE3o "+m(e.$filters.dataHora(c.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024),t.tabSelecionada.valor!=="digitacao"?(u(),_(I,{key:0,caption:""},{default:i(()=>[a(C,null,{default:i(()=>[a(U,{class:"text-tertiary",name:"event"}),f(" "+m(e.$filters.data(c.dataHoraFinalizado)),1)]),_:2},1024),a(V,null,{default:i(()=>[f("Data Finalizado "+m(e.$filters.dataHora(c.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):g("",!0),a(I,{caption:""},{default:i(()=>[c.porcentagemApontamento>0?(u(),y("div",it,[a(C,null,{default:i(()=>[a(ho,{stripe:"",rounded:"",size:"20px",value:c.porcentagemApontamento,color:"secondary",class:"q-mt-sm"},{default:i(()=>[l("div",st,[a(vo,{color:"white","text-color":"secondary",label:c.porcentagemApontamentoLabel},null,8,["label"])])]),_:2},1032,["value"])]),_:2},1024),a(V,null,{default:i(()=>[f(m(c.porcentagemApontamentoLabel)+" Conclu\xEDda ",1)]),_:2},1024)])):g("",!0)]),_:2},1024),a(I,{avatar:""},{default:i(()=>[a(b,{class:"q-mr-sm",cor:"warning",escuro:""},{default:i(()=>[f(m(c.status),1)]),_:2},1024)]),_:2},1024),a(I,{avatar:""},{default:i(()=>[a(b,{class:"q-mr-sm",cor:"primary",escuro:""},{default:i(()=>[f(m(c.operacao),1)]),_:2},1024)]),_:2},1024),a(I,{side:"",top:""},{default:i(()=>[l("div",lt,[a(w,{icon:c.showPreviewDetail?"keyboard_arrow_up":"keyboard_arrow_down",class:"buttons",color:"tertiary",dense:"",flat:"",round:"",size:"md",onClick:v=>n.showDetails(c)},null,8,["icon","onClick"]),a(w,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:i(()=>[a(go,null,{default:i(()=>[a(R,{link:"",separator:""},{default:i(()=>[(u(!0),y(O,null,S(t.configImpressao.filter(v=>v.valor),v=>(u(),_(F,{clickable:"",key:v.valor,onClick:M=>e.$imprimir(v.valor,(c||{}).id||"0")},{default:i(()=>[a(I,{avatar:""},{default:i(()=>[a(U,{name:"print"})]),_:1}),a(I,null,{default:i(()=>[a(C,null,{default:i(()=>[f(m(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),a(w,{class:"buttons",color:"primary",dense:"",flat:"",icon:"edit",round:"",size:"md",onClick:v=>n.editarManipulacao(c.id)},null,8,["onClick"]),t.tabSelecionada.valor==="digitacao"?(u(),_(w,{key:0,class:"buttons",color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:v=>n.excluir(c.id)},null,8,["onClick"])):g("",!0)])]),_:2},1024)]),_:2},1024),c.showPreviewDetail?(u(),_(F,{key:0,class:"q-pa-md"},{default:i(()=>[a(I,null,{default:i(()=>[f(" Origem "),(u(!0),y(O,null,S(c.documentoItens,v=>(u(),y("div",{key:v.id},[v.operacaoFator===-1?(u(),_(I,{key:0,stamp:""},{default:i(()=>[f(m(v.quantidade)+" "+m(v.unidade)+" - "+m(v.descricaoItem),1)]),_:2},1024)):g("",!0)]))),128))]),_:2},1024),a(C,null,{default:i(()=>[f(" Destino "),(u(!0),y(O,null,S(c.documentoItens,v=>(u(),y("div",{key:v.id},[v.operacaoFator===1?(u(),_(I,{key:0,stamp:""},{default:i(()=>[f(m(v.quantidade)+" "+m(v.unidade)+" - "+m(v.descricaoItem),1)]),_:2},1024)):g("",!0)]))),128))]),_:2},1024)]),_:2},1024)):g("",!0),a(H)]),_:2},1024))),128))]),_:1},8,["onCriar_click","onFiltro_change","onLimparFiltros_click","tabSelecionada","tabs","listaLayout","paginacao","filtros","buscaCampo","checkboxModel"]),a(p,{ref:"itensManipulacao",onAtualizar:n.atualizar},null,8,["onAtualizar"])])}var pt=K($e,[["render",rt]]);export{pt as default};
