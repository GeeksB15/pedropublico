import{_ as w,r as u,o as m,d as C,w as l,f as e,y as P,h as q,i as A,k as g,G as D,Q as v,M as _,N as z,B as d,ar as X,n as x,t as M,C as O,D as T,R as L,at as Y,bf as J,S as k,T as I,aq as Q,cP as $,bK as U,by as Z,bx as V,cX as aa,cY as F,F as E,s as y,z as S,O as N,e as H}from"./index.188ab8e6.js";import{C as oa}from"./CaixaFechar.2aea1e8d.js";import{F as ia}from"./FaturaCard.5e1430c0.js";import{V as ea}from"./VendaCard.ae4ba91e.js";import"./emitirNFe.35117289.js";import"./nfePrincipal.e422e0b1.js";import"./compactarValidarNFe.fa14073c.js";import"./obterItens.304de8cb.js";import"./codigosANP.a6c1a264.js";import"./FaturaModal.7945239e.js";import"./DocumentosFiscais.faec51ff.js";import"./Campo.d9b8e121.js";import"./EnvelopeCard.3fec4b25.js";import"./ModalHistoricoStatus.544a4c46.js";import"./QSpinnerHourglass.8a0d2be5.js";import"./QSpinnerDots.3f1f1f17.js";const ta={computed:{documentosCaixaEncontrados(){return!!this.documentosCaixa.filter(o=>o.valor).length}},data(){return{abrindo:!1,documentosCaixa:[],empresa:{},idDocumentoCaixa:"",msg:"",periodo:{},visivel:!1}},methods:{async abrir(){this.idDocumentoCaixa&&(this.abrindo=!0,this.$imprimir("conferencia-de-caixa",this.idDocumentoCaixa),this.visivel=!1)},async abrirModalContatoEmpresas(){if(this.abrindo)return;const o=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione a empresa"});this.selecionarEmpresa((o||{}).id)},async getDocumentosCaixa(){try{if(!this.empresa.id)return;this.documentosCaixa=[],this.idDocumentoCaixa="",this.msg="Carregando caixas...",await $utils.dormir(500);const o=await $db.hibrido.lista({table:"documento",where:{tipo:"Caixa",idEmpresa:this.empresa.id}}),a=new Date(new Date(this.periodo.de).toDateString()),s=new Date(new Date(this.periodo.ate).toDateString());let t=o.filter(i=>{const r=new Date(new Date(i.dataHoraEmissao).toDateString());return["Aguardando Confer\xEAncia","Fechado"].includes(i.status)&&r>=a&&r<=s});t=$lodash.orderBy(t,"dataHoraEmissao","desc");for(const i of t)i.rotulo=((await $db.caixa.leCache({id:i.idCaixa})||{}).descricao||"")+" - Aberto em "+this.$filters.dataHora(i.dataHoraEmissao)+" - Fechado em "+this.$filters.dataHora(i.dataHoraFinalizado),i.valor=i.id;this.documentosCaixa=[{rotulo:"Selecione um caixa",valor:""},...t],this.documentosCaixaEncontrados||(this.msg="Nenhum caixa encontrado para este filtro")}catch{this.$q.notifyError("Erro ao carregar caixas.")}},limparSeletor(){this.documentosCaixa=this.documentosCaixa.filter(o=>o.valor)},async selecionarEmpresa(o){try{if(!o)return;const a=await $db.empresa.le({idContato:o});$utils.verificarErro(!a.length||!a[0].id,"N\xE3o foi poss\xEDvel recuperar os dados da empresa."),this.empresa={id:o,descricao:a[0].nome||"Empresa sem nome"},this.getDocumentosCaixa()}catch(a){this.limpar(),this.$q.notifyError("Erro ao selecionar a empresa.",a)}},mostrar(){this.visivel=!0},onShow(){this.limpar()},limpar(){this.abrindo=!1,this.empresa={id:"",descricao:""},this.idDocumentoCaixa="",this.documentosCaixa=[];const o=new Date;this.periodo={de:new Date(o.setDate(o.getDate()-7)),ate:new Date},this.msg="Preencha o filtro para buscar caixas"}}},sa={class:"row"},na={class:"col-6"},ra={class:"col-6"},la={key:1,class:"text-center q-mt-md"},ca={style:{"font-size":"80%"}},da={class:"q-mt-lg text-center"};function ma(o,a,s,t,i,r){const n=u("campo");return m(),C(O,{modelValue:i.visivel,"onUpdate:modelValue":a[7]||(a[7]=c=>i.visivel=c),onShow:r.onShow,"content-css":{minWidth:"30vw"}},{default:l(()=>[e(P,null,{default:l(()=>[e(q,{class:"bg-primary text-white"},{default:l(()=>[e(A,null,{default:l(()=>a[8]||(a[8]=[g("Confer\xEAncia de Caixa")])),_:1}),D(e(v,{dense:"",flat:"",icon:"close",round:""},null,512),[[_]])]),_:1}),e(z,null,{default:l(()=>[d("form",{class:"layout-padding",onSubmit:a[6]||(a[6]=X((...c)=>r.abrir&&r.abrir(...c),["prevent"]))},[e(n,{modelValue:i.empresa.descricao,"onUpdate:modelValue":a[0]||(a[0]=c=>i.empresa.descricao=c),before:[{icon:"search",handler:r.abrirModalContatoEmpresas}],placeholder:"Selecione","rotulo-fixo":i.empresa.descricao?"Empresa":"","somente-leitura":"",disable:i.abrindo},null,8,["modelValue","before","rotulo-fixo","disable"]),d("div",sa,[a[9]||(a[9]=d("div",{class:"col-12 q-mt-md"},[d("span",null,"Data de abertura do caixa")],-1)),d("div",na,[e(n,{modelValue:i.periodo.de,"onUpdate:modelValue":[a[1]||(a[1]=c=>i.periodo.de=c),a[2]||(a[2]=c=>r.getDocumentosCaixa())],tipo:"data",rotulo:"De",disable:i.abrindo},null,8,["modelValue","disable"])]),d("div",ra,[e(n,{modelValue:i.periodo.ate,"onUpdate:modelValue":[a[3]||(a[3]=c=>i.periodo.ate=c),a[4]||(a[4]=c=>r.getDocumentosCaixa())],tipo:"data",rotulo:"At\xE9",disable:i.abrindo},null,8,["modelValue","disable"])])]),r.documentosCaixaEncontrados?(m(),C(n,{key:0,modelValue:i.idDocumentoCaixa,"onUpdate:modelValue":[a[5]||(a[5]=c=>i.idDocumentoCaixa=c),r.limparSeletor],opcoes:i.documentosCaixa,tipo:"seletor",disable:i.abrindo},null,8,["modelValue","opcoes","disable","onUpdate:modelValue"])):(m(),x("div",la,[d("span",ca,M(i.msg),1)])),d("div",da,[e(v,{loading:i.abrindo,color:"primary",class:"q-ml-sm no-shadow",label:"Abrir",type:"submit",disable:!i.idDocumentoCaixa},null,8,["loading","disable"])])],32)]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"])}var ua=w(ta,[["render",ma]]);const pa={data(){return{visivel:!1,campos:{},contaOrigem:"",contaDestino:""}},methods:{async atualizar(){try{let o={},a={};o=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa}),$utils.verificarAlerta(!(o.tipo==="Caixa"&&["Aberto","Reaberto"].includes(o.status)),"Selecione um caixa aberto"),$utils.verificarErro(!o.idEmpresa,"Caixa sem empresa"),a=await $db.caixa.leCache({id:o.idCaixa}),$utils.verificarErro(!a.id,"Caixa n\xE3o existe"),this.contaOrigem=await $db.financeiroPlanoConta.le({id:a.idPlanoConta}),this.contaDestino=await $db.financeiroPlanoConta.le({id:a.idPlanoContaSangria}),this.campos.valor=0,this.campos.descricao=`Transf. de ${this.contaOrigem.descricao.trim()||""} para ${this.contaDestino.descricao.trim()||""}`,this.idContatoEmpresa=o.idEmpresa;const s=await $db.empresa.le({idContato:this.idContatoEmpresa});$utils.verificarErro(!s||!s.length||!s[0].id,"Caixa sem empresa v\xE1lida"),this.idEmpresa=s[0].idContato,this.visivel=!0}catch(o){this.$q.notifyError("Erro no lancamento de Sangria",o)}},async lancar(){try{$q.loading.show({message:"Processando..."});const o=$utils.dataAtual(),a=(await $db.contato.le({numeroDocumentoNacional:$db.usuario.logado.numeroDocumentoNacional}))[0];$utils.verificarAlerta(!a,"Usu\xE1rio n\xE3o cadastrado"),$utils.verificarAlerta(!this.campos.valor,"Valor n\xE3o preenchido");const s={id:$utils.uuid(),idEmpresa:this.idEmpresa,tipo:"Financeiro",operacao:"Sangria",status:"Finalizado",dataHoraEmissao:o,dataHoraFinalizado:o,totalDocumento:this.campos.valor,idContato:a.id,descricao:`Sangria de ${a.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:this.campos.observacao,idDocumentoAdicional:this.idDocumentoCaixa,idDocumentoOperacao:""},t=$utils.uuid(),i={id:$utils.uuid(),idFinanceiroMovimentacaoN:t,idEmpresa:this.idEmpresa,idContato:a.id,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:0,valorCredito:this.campos.valor,descricao:`${s.observacao?s.observacao+" | ":""}Sangria de ${a.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Sangria",documentoId:s.id,idDocumentoCaixa:this.idDocumentoCaixa},r={id:$utils.uuid(),idFinanceiroMovimentacaoN:t,idEmpresa:this.idEmpresa,idContato:a.id,idFinanceiroPlanoConta:this.contaDestino.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:this.campos.valor,valorCredito:0,descricao:`${s.observacao?s.observacao+" | ":""}Sangria de ${a.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Sangria",documentoId:s.id,idDocumentoCaixa:this.idDocumentoCaixa};await $db.financeiroMovimentacaoN.grava({atual:{id:t}}),await $db.documento.grava({atual:s}),await $db.financeiroMovimentacao.grava({atual:i}),await $db.financeiroMovimentacao.grava({atual:r}),this.visivel=!1,$q.notifyPositive("Sangria lan\xE7ada com sucesso"),this.$imprimir("recibo-sangria-suprimento",{id:i.id})}catch(o){$q.notifyError("Erro no lancamento de Sangria",o)}finally{$q.loading.hide()}},mostrar(o){const{idDocumentoCaixa:a}=o;this.campos={valor:0,descricao:""},this.contaOrigem="",this.contaDestino="",this.idDocumentoCaixa=a,this.atualizar()}}},ha={class:"col-12"},fa={class:"col-12"},Ca={class:"q-mt-lg text-right"};function va(o,a,s,t,i,r){const n=u("campo"),c=u("row");return m(),C(O,{modelValue:i.visivel,"onUpdate:modelValue":a[2]||(a[2]=p=>i.visivel=p)},{default:l(()=>[e(P,null,{default:l(()=>[e(q,{class:"bg-primary text-white"},{default:l(()=>[e(A,null,{default:l(()=>a[3]||(a[3]=[g("Lan\xE7ar Sangria")])),_:1}),D(e(v,{dense:"",flat:"",icon:"close",round:""},null,512),[[_]])]),_:1}),e(z,null,{default:l(()=>[e(T,{onSubmit:r.lancar},{default:l(()=>[e(c,{class:"q-col-gutter-md"},{default:l(()=>[d("div",ha,[e(n,{modelValue:i.campos.valor,"onUpdate:modelValue":a[0]||(a[0]=p=>i.campos.valor=p),before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},null,8,["modelValue"])]),d("div",fa,[e(n,{modelValue:i.campos.observacao,"onUpdate:modelValue":a[1]||(a[1]=p=>i.campos.observacao=p),before:[{icon:"message"}],rotulo:"Observa\xE7\xE3o",tipo:"textoArea",rows:"3"},null,8,["modelValue"])])]),_:1}),d("div",Ca,[D(e(v,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[_]]),e(v,{color:"primary",class:"q-ml-sm",unelevated:"",label:"Lan\xE7ar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var xa=w(pa,[["render",va]]);const ba={data(){return{visivel:!1,campos:{},contaOrigem:"",contaDestino:"",idDocumentoCaixa:""}},methods:{async atualizar(){try{let o={},a={};o=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa}),$utils.verificarAlerta(!(o.tipo==="Caixa"&&["Aberto","Reaberto"].includes(o.status)),"Selecione um caixa aberto"),$utils.verificarErro(!o.idEmpresa,"Caixa sem empresa"),a=await $db.caixa.leCache({id:o.idCaixa}),$utils.verificarErro(!a.id,"Caixa n\xE3o existe"),this.contaOrigem=await $db.financeiroPlanoConta.le({id:a.idPlanoContaSangria}),this.contaDestino=await $db.financeiroPlanoConta.le({id:a.idPlanoConta}),this.campos.valor=0,this.campos.descricao=`Transf. de ${this.contaOrigem.descricao.trim()||""} para ${this.contaDestino.descricao.trim()||""}`,this.idContatoEmpresa=o.idEmpresa;const s=await $db.empresa.le({idContato:this.idContatoEmpresa});$utils.verificarErro(!s||!s.length||!s[0].id,"Caixa sem empresa v\xE1lida"),this.idEmpresa=s[0].idContato,this.visivel=!0}catch(o){this.$q.notifyError("Erro no lancamento de Suprimento",o),this.eventoInput(!1)}},async lancar(o){o.preventDefault();try{$q.loading.show({message:"Processando..."});const a=$utils.dataAtual(),s=(await $db.contato.le({numeroDocumentoNacional:$db.usuario.logado.numeroDocumentoNacional}))[0];$utils.verificarAlerta(!s,"Usu\xE1rio n\xE3o cadastrado"),$utils.verificarAlerta(!this.campos.valor,"Valor n\xE3o preenchido");const t={id:$utils.uuid(),idEmpresa:this.idEmpresa,tipo:"Financeiro",operacao:"Suprimento",status:"Finalizado",dataHoraEmissao:a,dataHoraFinalizado:a,totalDocumento:this.campos.valor,idContato:s.id,descricao:`Suprimento de ${s.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:this.campos.observacao,idDocumentoAdicional:this.idDocumentoCaixa,idDocumentoOperacao:""},i=$utils.uuid(),r={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idContato:s.id,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:a,dataCompetencia:a,dataVencimento:a,dataMovimento:a,valorDebito:0,valorCredito:this.campos.valor,descricao:`${t.observacao?t.observacao+" | ":""}Suprimento de ${s.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Suprimento",documentoId:t.id,idDocumentoCaixa:this.idDocumentoCaixa},n={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idContato:s.id,idFinanceiroPlanoConta:this.contaDestino.id,dataEmissao:a,dataCompetencia:a,dataVencimento:a,dataMovimento:a,valorDebito:this.campos.valor,valorCredito:0,descricao:`${t.observacao?t.observacao+" | ":""}Suprimento de ${s.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Suprimento",documentoId:t.id,idDocumentoCaixa:this.idDocumentoCaixa};await $db.financeiroMovimentacaoN.grava({atual:{id:i}}),await $db.documento.grava({atual:t}),await $db.financeiroMovimentacao.grava({atual:r}),await $db.financeiroMovimentacao.grava({atual:n}),this.visivel=!1,$q.notifyPositive("Suprimento lan\xE7ado com sucesso"),this.$imprimir("recibo-sangria-suprimento",{id:r.id})}catch(a){$q.notifyError("Erro no lancamento de Suprimento",a)}finally{$q.loading.hide()}},mostrar(o){const{idDocumentoCaixa:a}=o;this.campos={valor:0,descricao:""},this.contaOrigem="",this.contaDestino="",this.idDocumentoCaixa=a,this.atualizar()}}},ga={class:"col-12"},Da={class:"col-12"},_a={class:"q-mt-lg text-right"};function $a(o,a,s,t,i,r){const n=u("campo"),c=u("row");return m(),C(O,{modelValue:i.visivel,"onUpdate:modelValue":a[2]||(a[2]=p=>i.visivel=p),"content-css":{minWidth:"30vw"}},{default:l(()=>[e(P,null,{default:l(()=>[e(q,{class:"bg-primary text-white"},{default:l(()=>[e(A,null,{default:l(()=>a[3]||(a[3]=[g("Lan\xE7ar Suprimento")])),_:1}),D(e(v,{dense:"",flat:"",icon:"close",round:""},null,512),[[_]])]),_:1}),e(z,null,{default:l(()=>[e(T,{onSubmit:r.lancar},{default:l(()=>[e(c,{class:"q-col-gutter-md"},{default:l(()=>[d("div",ga,[e(n,{modelValue:i.campos.valor,"onUpdate:modelValue":a[0]||(a[0]=p=>i.campos.valor=p),before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},null,8,["modelValue"])]),d("div",Da,[e(n,{modelValue:i.campos.observacao,"onUpdate:modelValue":a[1]||(a[1]=p=>i.campos.observacao=p),before:[{icon:"message"}],rotulo:"Observa\xE7\xE3o",tipo:"textoArea",rows:"3"},null,8,["modelValue"])])]),_:1}),d("div",_a,[D(e(v,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[_]]),e(v,{color:"primary",class:"q-ml-sm",unelevated:"",label:"Lan\xE7ar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var wa=w(ba,[["render",$a]]);const Ea={data(){return{opcoes:[]}},emits:["update:modelValue"],methods:{async atualizar(o,a,s){let t=await $db.financeiroPlanoConta.le(this.filtro);t=t.map(i=>({id:i.id,apelido:i.apelido||"",descricao:i.descricao||"",caminho:i.caminho||"",codigoFinanceiroPlanoConta:i.codigoFinanceiroPlanoConta,textoPesquisa:($utils.removerAcentos((i.descricao||"").trim()+" "+(i.apelido||"").trim())+" "+String(i.codigoFinanceiroPlanoConta)).toLowerCase()})),o&&(t=t.filter(i=>i.textoPesquisa.includes(o))),t.sort((i,r)=>i.textoPesquisa<r.textoPesquisa?-1:1),this.opcoes=t,typeof a=="function"&&a()},selecionar(o){console.log(o),this.$emit("update:modelValue",o)}},props:{modelValue:{default:"",type:String},somenteLeitura:{type:Boolean},filtro:{default:()=>({}),type:Object},rotulo:{default:"",type:String}},created(){this.atualizar()}};function ya(o,a,s,t,i,r){return m(),C(Q,{"model-value":s.modelValue,options:i.opcoes,"option-value":"id","option-label":"descricao",onFilter:r.atualizar,"onUpdate:modelValue":r.selecionar,"emit-value":"","map-options":"","use-input":"","input-debounce":"400",label:s.rotulo},{option:l(n=>[e(L,Y(J(n.itemProps)),{default:l(()=>[e(k,null,{default:l(()=>[e(I,{header:""},{default:l(()=>[g(M((n.opt.apelido||"").trim()+" - "+(n.opt.descricao||"").trim()),1)]),_:2},1024),e(I,{caption:""},{default:l(()=>[g(M(n.opt.caminho),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":l(()=>[e(L,null,{default:l(()=>[e(k,{class:"text-grey"},{default:l(()=>a[0]||(a[0]=[g(" Resultado n\xE3o encontrado ")])),_:1})]),_:1})]),_:1},8,["model-value","options","onFilter","onUpdate:modelValue","label"])}var Va=w(Ea,[["render",ya]]);const Fa={components:{seletorFinContas:Va},data(){return{campos:{idFinanceiroPlanoConta:"",valor:0,descricao:""},contaOrigem:{},contato:{nome:""},idEmpresa:"",idContatoEmpresa:"",idDocumentoCaixa:"",visivel:!1}},methods:{async atualizar(){try{let o=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa});$(!(o.tipo==="Caixa"&&["Aberto","Reaberto"].includes(o.status)),"Selecione um caixa aberto"),U(!o.idEmpresa,"Caixa sem empresa");let a=await $db.caixa.leCache({id:o.idCaixa});U(!a.id,"Caixa n\xE3o existe"),this.contaOrigem=await $db.financeiroPlanoConta.le({id:a.idPlanoConta}),this.contato={},this.campos.valor=0,this.campos.descricao="",this.idContatoEmpresa=o.idEmpresa;const s=await $db.empresa.le({idContato:this.idContatoEmpresa});U(!s||!s.length||!s[0].id,"Caixa sem empresa v\xE1lida"),this.idEmpresa=s[0].idContato,this.visivel=!0}catch(o){this.$q.notifyError("Erro no lancamento de Despesa",o)}},async lancar(){try{$q.loading.show({message:"Processando..."});const o=Z(),a=V(),s=await $db.configuracoes.le({nome:"financeiro.planocontas.duplicatapagar"});$(!s||!s.length,"Falta configura\xE7\xE3o para 'financeiro.planocontas.duplicatapagar'");const t=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Number(s[0].valor)});$(!t||!t.id,"Falta plano de conta para 'financeiro.planocontas.duplicatapagar'"),$(!this.campos.idFinanceiroPlanoConta,"Conta destino n\xE3o selecionada"),$(!this.contato||!this.contato.id,"Contato para pagamento n\xE3o selecionado"),$(!this.campos.valor,"Valor n\xE3o preenchido");const i={id:V(),idEmpresa:this.idEmpresa,idContato:this.contato.id,idFinanceiroPlanoConta:this.campos.idFinanceiroPlanoConta,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataVencimentoOriginal:o,dataPagamento:o,dataMovimento:o,valor:this.campos.valor,descricao:(this.campos.descricao||"").substr(0,100),observacao:this.campos.descricao||"",receberPagar:0,valorOriginal:this.campos.valor,valorTotal:this.campos.valor,valorARealizar:this.campos.valor,valorRealizado:this.campos.valor,documentoTipo:"DespesaSimples",formaDePagamento:"Caixa",documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa,idDocumentoCaixaLiquidacao:this.idDocumentoCaixa,idFinanceiroMovimentacaoAgrupamento:a},r={id:V(),idFinanceiroMovimentacaoN:a,idEmpresa:this.idEmpresa,idFinanceiroPlanoConta:t.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:this.campos.valor,valorCredito:0,descricao:`Pagamento de despesa simples por ${$db.usuario.logado.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Liquida\xE7\xE3o Despesa Simples - T\xEDtulo",documentoTipo:"DespesaSimples",automatico:0,liquidando:0,documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},n={id:V(),idFinanceiroMovimentacaoN:a,idEmpresa:this.idEmpresa,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:0,valorCredito:this.campos.valor,descricao:`Pagamento de despesa simples por ${$db.usuario.logado.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Liquida\xE7\xE3o Despesa Simples - T\xEDtulo",documentoTipo:"DespesaSimples",automatico:0,liquidando:0,documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa};await $db.financeiroMovimentacaoN.grava({atual:{id:a}}),await $db.financeiroTitulo.grava({atual:i}),await $db.financeiroMovimentacao.grava({atual:r}),await $db.financeiroMovimentacao.grava({atual:n}),$q.notifyPositive("Despesa lan\xE7ada com sucesso"),this.$imprimir("titulo-recibo",i.id),this.visivel=!1}catch(o){$q.notifyError("Erro no lancamento de Despesa",o)}finally{$q.loading.hide()}},async abrirModalFinanceiroContas(){this.modalFinanceiroContas.filtros.despesa={idContatoEmpresa:this.idContatoEmpresa}},async abrirModalContato(){const o=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione "});$lodash.get(o,"id")&&(this.contato=o)},mostrar(o){const{idDocumentoCaixa:a}=o;this.campos={idFinanceiroPlanoConta:"",valor:0,descricao:""},this.contaOrigem={},this.contato={nome:""},this.idEmpresa="",this.idContatoEmpresa="",this.idDocumentoCaixa=a,this.atualizar()}}},Sa={class:"col-12"},Pa={class:"col-12"},qa={class:"col-12"},Aa={class:"col-12"},za={class:"q-mt-lg text-right"};function Oa(o,a,s,t,i,r){const n=u("seletorFinContas"),c=u("campo"),p=u("row");return m(),C(O,{modelValue:i.visivel,"onUpdate:modelValue":a[4]||(a[4]=h=>i.visivel=h),"content-css":{minWidth:"30vw"}},{default:l(()=>[e(P,null,{default:l(()=>[e(q,{class:"bg-primary text-white"},{default:l(()=>[e(A,null,{default:l(()=>a[5]||(a[5]=[g("Lan\xE7ar Despesa")])),_:1}),D(e(v,{dense:"",flat:"",icon:"close",round:""},null,512),[[_]])]),_:1}),e(z,null,{default:l(()=>[e(T,{onSubmit:r.lancar},{default:l(()=>[e(p,{class:"q-col-gutter-md"},{default:l(()=>[d("div",Sa,[e(n,{modelValue:i.campos.idFinanceiroPlanoConta,"onUpdate:modelValue":a[0]||(a[0]=h=>i.campos.idFinanceiroPlanoConta=h),class:"q-pb-none",rules:[h=>h&&h.length>2||"obrigat\xF3rio."],rotulo:"Destino",filtro:{despesa:{idContatoEmpresa:i.idContatoEmpresa}}},null,8,["modelValue","rules","filtro"])]),d("div",Pa,[e(Q,{dense:"",rounded:"",modelValue:i.contato.nome,"onUpdate:modelValue":a[1]||(a[1]=h=>i.contato.nome=h),label:"Pagar a",options:["a","b"],onFilter:r.abrirModalContato},null,8,["modelValue","onFilter"])]),d("div",qa,[e(c,{modelValue:i.campos.valor,"onUpdate:modelValue":a[2]||(a[2]=h=>i.campos.valor=h),before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},null,8,["modelValue"])]),d("div",Aa,[e(c,{modelValue:i.campos.descricao,"onUpdate:modelValue":a[3]||(a[3]=h=>i.campos.descricao=h),before:[{icon:"message"}],rotulo:"Descri\xE7\xE3o",tipo:"texto",autogrow:""},null,8,["modelValue"])])]),_:1}),d("div",za,[D(e(v,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[_]]),e(v,{color:"primary",class:"q-ml-sm",unelevated:"",label:"Lan\xE7ar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Ua=w(Fa,[["render",Oa]]);const Ma={components:{CaixaAbrir:aa,CaixaConferencia:ua,CaixaFechar:oa,CaixaSangriaLancar:xa,CaixaSuprimentoLancar:wa,CaixaDespesaLancar:Ua,FaturaCard:ia,VendaCard:ea},data(){return{idDocumentoCaixa:"",caixas:[],vendas:{},faturas:{},intervaloAtualizar:void 0,intervaloCarregaCaixas:void 0,menuFaturamento:[{icone:"lock_open",rotulo:"Abrir caixa",manipulador:()=>{this.$refs.Abrir.mostrar()}},{icone:"attach_money",rotulo:"Suprimento",manipulador:()=>{this.$refs.Suprimento.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}},{icone:"money_off",rotulo:"Sangria",manipulador:()=>{this.$refs.Sangria.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}},{icone:"payment",rotulo:"Despesa",manipulador:()=>{this.$refs.Despesa.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}},{icone:"lock",rotulo:"Fechar caixa",manipulador:()=>{this.$refs.Fechar.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}}]}},methods:{async admTef(){const o=await F.oper("adm");if(o.fileContent){const a=await F.extrairCampo("mensagemOperador",o.fileContent),s=await F.extrairComprovantes(o.fileContent,{todos:!0});for(const t of s)await F.oper("print",{content:t,opts:{txt:!0}});a&&$q.notify({message:a,type:"positive"})}},async atualizar(){const o=await $db.formaPagamento.listaCache();!this.menuFaturamento.find(a=>a.rotulo==="Imprimir Confer\xEAncia de caixa")&&await $db.permissao.objeto("Diretiva_Caixa_ImprimirConferenciaCaixa")&&(this.menuFaturamento=[...this.menuFaturamento,{icone:"print",rotulo:"Imprimir Confer\xEAncia de caixa",manipulador:()=>{this.idDocumentoCaixa?this.$imprimir("conferencia-de-caixa",this.idDocumentoCaixa):this.$q.notifyError("Caixa n\xE3o selecionada")}}]),!this.menuFaturamento.find(a=>a.rotulo==="Reimprimir Confer\xEAncia de caixa")&&await $db.permissao.objeto("Diretiva_Caixa_VisualizaDiferenca")&&(this.menuFaturamento=[...this.menuFaturamento,{icone:"print",rotulo:"Reimprimir Confer\xEAncia de caixa",manipulador:()=>{this.$refs.Conferencia.mostrar()}}]),o.some(a=>a.ativo&&a.tef)&&(this.menuFaturamento=[...this.menuFaturamento,{icone:"payment",rotulo:"TEF",manipulador:async()=>{await this.admTef()}}]),this.vendas={},this.faturas={},this.idDocumentoCaixa="",this.caixas=[],await this.carregaCaixasAberto(),this.idDocumentoCaixa=(this.caixas[0]||{}).valor||"",this.idDocumentoCaixa&&this.carregarDocumentos()},async carregaCaixasAberto(){let o=await $db.contatoCpf.leCache($db.usuario.logado.cpf);try{await $db.permissao.objeto("Diretiva_Caixa_LivreUtilizacao")&&(o=null)}catch{this.$q.notify("N\xE3o foi poss\xEDvel recuperar informa\xE7\xF5es de permiss\xE3o.")}let a=await $db.hibrido.lista({table:"documento",columns:["id","idCaixa","idEmpresa","dataHoraEmissao","status"],where:{tipo:"Caixa"},whereFilter:{status:["Aberto","Reaberto"],idContato:o?o==null?void 0:o.id:null}}),s=(await $db.contatoEmpresa.listaCache()).map(t=>t.id);if(a=a.filter(t=>s.includes(t.idEmpresa)),a.length)for(const t of a)t.rotulo=((await $db.caixa.leCache({id:t.idCaixa})||{}).descricao||"")+" - Aberto em "+this.$filters.dataHora(t.dataHoraEmissao)+(t.status==="Reaberto"?" - Reaberto":""),t.valor=t.id;this.caixas=a.length?$lodash.orderBy(a,"dataHoraEmissao","desc"):[{rotulo:"N\xE3o h\xE1 caixas abertos",valor:""}]},carregarDocumentos(){$db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumentoCaixa:this.idDocumentoCaixa}}).then(async a=>{const s=[];a.reduce((n,c)=>(n.includes(c.idDocumento)||(n.push(c.idDocumento),s.push($db.hibrido.le({table:"documento",id:c.idDocumento}))),n),[]);let t=[];for await(const n of s)t.push(n);t=$lodash.orderBy(t,"dataHoraEmissao","desc");const i={},r={};for(const n of t)n.tipo==="Venda"&&n.status&&(i[n.status]||(i[n.status]=[]),i[n.status].push(n)),n.tipo==="Fatura"&&n.status&&(r[n.status]||(r[n.status]=[]),r[n.status].push(n));this.vendas=i,this.vendas.encontradas=!!Object.keys(i).length,this.vendas.status=Object.keys(i).filter(n=>n!=="encontradas"),this.faturas=r,this.faturas.encontradas=!!Object.keys(r).length,this.faturas.status=Object.keys(r).filter(n=>n!=="encontradas")});const o=this.caixas.find(a=>a.id===this.idDocumentoCaixa).status;this.menuFaturamento.forEach(a=>{["Suprimento","Sangria","Despesa"].includes(a.rotulo)&&(o==="Reaberto"?a.desabilitar=!0:a.desabilitar=!1)})}},async mounted(){this.caixas=[{rotulo:"Carregando caixas...",valor:""}];let o=!1,a=await $db.contatoEmpresa.listaCache();if(a.length)this.atualizar(),o=!0;else{let r=0;this.intervaloAtualizar=setInterval(async()=>{r++,(r>60||a.length)&&(clearInterval(this.intervaloAtualizar),this.atualizar(),o=!0),a=await $db.contatoEmpresa.listaCache()},3e3)}let s=0,t=5e4;const i=()=>{this.intervaloCarregaCaixas=setInterval(async()=>{o&&(s++,s>5&&(t=5e3,clearInterval(this.intervaloCarregaCaixas),i()),await this.carregaCaixasAberto(),this.caixas.find(n=>n.valor===this.idDocumentoCaixa)||(this.idDocumentoCaixa=(this.caixas[0]||{}).valor||"",this.idDocumentoCaixa&&await this.carregarDocumentos()))},t)};i()},beforeUnmount(){this.intervaloAtualizar&&clearInterval(this.intervaloAtualizar),this.intervaloCarregaCaixas&&clearInterval(this.intervaloCarregaCaixas)}},Ta={class:"CaixaEmpresas"},La={class:"q-pb-md"},ka={class:"no-shadow"};function Ia(o,a,s,t,i,r){const n=u("campo"),c=u("row"),p=u("venda-card"),h=u("fatura-card"),R=u("caixa-abrir"),B=u("CaixaFechar"),j=u("caixa-sangria-lancar"),W=u("caixa-suprimento-lancar"),G=u("caixa-despesa-lancar"),K=u("caixa-conferencia");return m(),x("div",Ta,[d("div",La,[e(n,{modelValue:i.idDocumentoCaixa,"onUpdate:modelValue":[a[0]||(a[0]=f=>i.idDocumentoCaixa=f),r.carregarDocumentos],opcoes:i.caixas,class:"q-mx-md",tipo:"seletor"},null,8,["modelValue","onUpdate:modelValue","opcoes"]),e(c,{class:"q-col-gutter-md q-pa-md"},{default:l(()=>[(m(!0),x(E,null,y(i.menuFaturamento,(f,b)=>(m(),x("div",{class:"col-6 col-md",key:b},[e(v,{onClick:f.manipulador,icon:f.icone,label:f.rotulo,outline:"",disabled:f.desabilitar,size:"lg",class:"botaoAcesso full-width",color:"primary"},null,8,["onClick","icon","label","disabled"])]))),128))]),_:1}),d("div",ka,[i.vendas.encontradas?(m(),C(N,{key:0},{default:l(()=>[e(S,{"default-opened":"",label:"Vendas"},{default:l(()=>[(m(!0),x(E,null,y(i.vendas.status,f=>(m(),C(S,{key:f,"default-opened":"",label:f},{default:l(()=>[(m(!0),x(E,null,y(i.vendas[f],b=>(m(),C(p,{key:b.id,id:b.id,onAtualizar:r.atualizar,class:"q-mb-md q-mx-md"},null,8,["id","onAtualizar"]))),128))]),_:2},1032,["label"]))),128))]),_:1})]),_:1})):H("",!0),i.faturas.encontradas?(m(),C(N,{key:1},{default:l(()=>[e(S,{"default-opened":"",label:"Faturas"},{default:l(()=>[(m(!0),x(E,null,y(i.faturas.status,f=>(m(),C(S,{key:f,"default-opened":"",label:f},{default:l(()=>[(m(!0),x(E,null,y(i.faturas[f],b=>(m(),C(h,{key:b.id,id:b.id,onAtualizar:r.atualizar,class:"q-mb-md q-mx-md"},null,8,["id","onAtualizar"]))),128))]),_:2},1032,["label"]))),128))]),_:1})]),_:1})):H("",!0)])]),e(R,{ref:"Abrir",onAberto:r.atualizar},null,8,["onAberto"]),e(B,{ref:"Fechar",onFechado:r.atualizar},null,8,["onFechado"]),e(j,{ref:"Sangria"},null,512),e(W,{ref:"Suprimento"},null,512),e(G,{ref:"Despesa"},null,512),e(K,{ref:"Conferencia"},null,512)])}var eo=w(Ma,[["render",Ia]]);export{eo as default};
