import{_ as A,Y as j,dz as F,r as z,o as p,n as k,B as c,f as e,w as a,j as I,aq as Q,p as H,R as V,at as P,bf as L,S as y,T as C,U,t as f,e as w,F as E,s as T,i as G,k as u,d as R,Q as q,ax as D,O,G as B,M as S,h as Y,be as J,dj as N,dA as $,dk as x}from"./index.129a5639.js";import{E as K}from"./EnvelopeCard.bfc1726f.js";import"./emitirNFe.35117289.js";import"./DocumentosFiscais.765df2e1.js";import"./Campo.2ebba21e.js";import"./compactarValidarNFe.c3faa32e.js";import"./obterItens.7428dd74.js";import"./codigosANP.a6c1a264.js";import"./ModalHistoricoStatus.29ca6929.js";const W={components:{Badge:j,EnvelopeCard:K,Receita:F},data(){return{columns:[{name:"distancia",align:"left",field:"distancia",style:"font-weight:bold;min-width:110px"},{name:"adicao",align:"center",field:"adicao"},{name:"esferico",align:"center",field:"esferico"},{name:"cilindrico",align:"center",field:"cilindrico"},{name:"eixo",align:"center",field:"eixo"},{name:"prisma",align:"center",field:"prisma"},{name:"base",align:"center",field:"base"},{name:"dnp",align:"center",field:"dnp"}],contato:{},configImpressaoReceita:{},receitas:[],idsEnvelopeReceita:{},permissaoVisualizarEnvelopes:!1,filtro:{},filtros:{pacientes:{todos:[],selecionados:[]},medicos:{todos:[],selecionados:[]},validade:{todos:[{label:"Vencido",value:"vencido"},{label:"\xC0 vencer",value:"aVencer"}],selecionados:[]}}}},methods:{async permissoes(){this.permissaoVisualizarEnvelopes=await $db.permissao.objeto("atendimento//venda")},async configuraImpressaoReceita(t){if(this.configImpressaoReceita[t])return;let o=[];const s=await $db.configuracoes.porNome("impressao.receita",t);s.length?o=s.map(d=>({texto:"Imprimir Receita",...d})):o=[{valor:"receita-qrcode",texto:"Imprimir Receita"},{valor:"laudo-optometrico",texto:"Imprimir Laudo Optom\xE9trico"}];const v=$utils.clonarV2(this.configImpressaoReceita);v[t]=o,this.configImpressaoReceita=v},dadosTabela(t,o){const s=[],v=$lodash.get(o,`prisma.${t}.valor`),d=$lodash.get(o,`prisma.${t}.base`,"").trim();let g,h,n,m,_,i=[{label:"Longe",value:"longe"},{label:"M\xE9dio",value:"medio"},{label:"Perto",value:"perto"}];for(const r of i)g=$lodash.get(o,`dioptria.${t}.${r.value}.adicao`),h=$lodash.get(o,`dioptria.${t}.${r.value}.esferico`),n=$lodash.get(o,`dioptria.${t}.${r.value}.cilindrico`),m=$lodash.get(o,`dioptria.${t}.${r.value}.eixo`),_=$lodash.get(o,`dioptria.${t}.${r.value}.dnp`),(h||n||m||_)&&s.push({distancia:r.label,adicao:g,esferico:h,cilindrico:n,eixo:m,prisma:v,base:d,dnp:_});return s},habilitaPerto(t){let o=!1,s=!1;return($lodash.get(t,"dioptria.od.longe.esferico")||$lodash.get(t,"dioptria.od.longe.cilindrico")||$lodash.get(t,"dioptria.od.longe.eixo")||$lodash.get(t,"dioptria.od.longe.dnp")||$lodash.get(t,"dioptria.oe.longe.esferico")||$lodash.get(t,"dioptria.oe.longe.cilindrico")||$lodash.get(t,"dioptria.oe.longe.eixo")||$lodash.get(t,"dioptria.oe.longe.dnp"))&&(s=!0),!s&&($lodash.get(t,"dioptria.od.perto.cilindrico")||$lodash.get(t,"dioptria.od.perto.eixo")||$lodash.get(t,"dioptria.oe.perto.cilindrico")||$lodash.get(t,"dioptria.oe.perto.eixo"))&&(o=!0),o},async abrirModalReceita(t,o){try{let s;if(t){const v=await $db.hibrido.le({table:"documento",id:t});v.idEmpresa&&(s=v.idEmpresa)}if((!t||!s)&&(s=(await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione a empresa"})||{}).id),!s)return;this.$refs.modalReceita.mostrar({id:t||$utils.uuid(),idEmpresa:s,duplicarReceita:o})}catch(s){this.$q.notifyError("Ocorreu um erro ao carregar a receita.",s)}},async atualizar(){const t=$utils.logarIni("AtendimentoOticaReceita",this.contato.id);await $tryLoading(async()=>{const o={idContato:this.contato.id,idsPaciente:[],idsMedico:[],validade:"",...this.filtro};if(!o.idContato)return;let s=(await $db.receita.leListaCompleta({where:{idContato:o.idContato}})).map($db.receita.montaReceita);const v={},d={};for(let n in s)v[s[n].medico.id]={nome:s[n].medico.nome},d[s[n].paciente.id]={nome:s[n].paciente.nome};const g=[];for(const n in v)g.push({value:n,label:v[n].nome});this.filtros.medicos.todos=g;const h=[];for(const n in d)h.push({value:n,label:d[n].nome});if(this.filtros.pacientes.todos=h,this.filtros.pacientes.selecionados.length&&(s=s.filter(n=>this.filtros.pacientes.selecionados.find(m=>m.value===n.paciente.id))),this.filtros.medicos.selecionados.length&&(s=s.filter(n=>this.filtros.medicos.selecionados.find(m=>m.value===n.medico.id))),this.filtros.validade.selecionados.length===1){const n=new Date().setHours(0,0,0,0);this.filtros.validade.selecionados.find(m=>m.value==="vencido")&&(s=s.filter(m=>new Date(m.validade).setHours(0,0,0,0)<n)),this.filtros.validade.selecionados.find(m=>m.value==="aVencer")&&(s=s.filter(m=>new Date(m.validade).setHours(0,0,0,0)>=n))}for(const n of s)this.idsEnvelopeReceita[n.id]=n.envelopes.sort((m,_)=>new Date(_.dataHoraEmissao)-new Date(m.dataHoraEmissao)).map(({id:m})=>m),this.configuraImpressaoReceita(n.idEmpresa);this.receitas=$lodash.orderBy(s,"data","desc")}),$utils.logarFim(t,1)},async excluirReceita(t){this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 excluir a receita.",title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{await $db.receita.exclui(t),this.$q.notifyPositive("Receita exclu\xEDda com sucesso.")}catch(o){this.$q.notifyError("Ocorreu um erro ao excluir a receita.",o)}this.atualizar()})},async carregarContato(){const t=this.$route.params.id;this.contato=await $db.contato.le({id:t})}},watch:{async"$route.params.id"(){await this.carregarContato(),this.atualizar()}},async mounted(){await this.permissoes(),await this.carregarContato(),this.atualizar()}},X={class:"q-mt-md full-width float-left"},Z={class:"bg-white q-px-md q-pb-md rounded-borders"},ee={class:"col-1 col-md-auto"},oe={class:"col-11 col-md",icon:"person"},ae={class:"col-6 col-md",icon:"healing"},te={class:"col-6 col-md",icon:"calendar_today"},ie={key:0,class:"bg-white q-pa-xl text-center rounded-borders"},le={class:"q-pa-md"},se={class:"col-12 col-md-4"},de={class:"col-12 col-md-4"},ne={class:"col-12 col-md-2"},re={class:"col-12 col-md-2"},ce={key:0,class:"col-12",style:{"word-wrap":"break-word"}},ue={style:{"font-weight":"bold !important","font-size":"120%",color:"black"}};function me(t,o,s,v,d,g){const h=z("row"),n=z("badge"),m=z("envelopeCard"),_=z("receita");return p(),k("div",X,[c("div",Z,[e(h,{class:"q-col-gutter-md items-center"},{default:a(()=>[c("div",ee,[e(I,{name:"mdi-filter",size:"sm",class:"text-tertiary"})]),c("div",oe,[e(Q,{outlined:"",dense:"",modelValue:d.filtros.pacientes.selecionados,"onUpdate:modelValue":[o[0]||(o[0]=i=>d.filtros.pacientes.selecionados=i),g.atualizar],multiple:"",options:d.filtros.pacientes.todos,label:"Paciente"},H({_:2},[d.filtros.pacientes.todos.length>1?{name:"option",fn:a(({itemProps:i,opt:r,selected:l,toggleOption:b})=>[e(V,P(L(i)),{default:a(()=>[e(y,null,{default:a(()=>[e(C,{innerHTML:r.label},null,8,["innerHTML"])]),_:2},1024),e(y,{side:""},{default:a(()=>[e(U,{"model-value":l,"onUpdate:modelValue":M=>b(r)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),key:"0"}:void 0]),1032,["modelValue","options","onUpdate:modelValue"])]),c("div",ae,[e(Q,{outlined:"",dense:"",modelValue:d.filtros.medicos.selecionados,"onUpdate:modelValue":[o[1]||(o[1]=i=>d.filtros.medicos.selecionados=i),g.atualizar],"map-options":"",multiple:"",options:d.filtros.medicos.todos,label:"M\xE9dico"},H({_:2},[d.filtros.medicos.todos.length>1?{name:"option",fn:a(({itemProps:i,opt:r,selected:l,toggleOption:b})=>[e(V,P(L(i)),{default:a(()=>[e(y,null,{default:a(()=>[e(C,{innerHTML:r.label},null,8,["innerHTML"])]),_:2},1024),e(y,{side:""},{default:a(()=>[e(U,{"model-value":l,"onUpdate:modelValue":M=>b(r)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),key:"0"}:void 0]),1032,["modelValue","options","onUpdate:modelValue"])]),c("div",te,[e(Q,{outlined:"",dense:"",modelValue:d.filtros.validade.selecionados,"onUpdate:modelValue":[o[2]||(o[2]=i=>d.filtros.validade.selecionados=i),g.atualizar],multiple:"",options:d.filtros.validade.todos,label:"Validade"},{option:a(({itemProps:i,opt:r,selected:l,toggleOption:b})=>[e(V,P(L(i)),{default:a(()=>[e(y,null,{default:a(()=>[e(C,{innerHTML:r.label},null,8,["innerHTML"])]),_:2},1024),e(y,{side:""},{default:a(()=>[e(U,{"model-value":l,"onUpdate:modelValue":M=>b(r)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onUpdate:modelValue"])])]),_:1})]),d.receitas.length?w("",!0):(p(),k("div",ie,[c("p",null,"N\xE3o h\xE1 receitas cadastradas para o contato "+f((d.contato.nome||"").trim())+".",1),o[4]||(o[4]=c("p",{class:"text-caption"},"Para incluir, utilize o bot\xE3o de adi\xE7\xE3o.",-1))])),c("div",null,[(p(!0),k(E,null,T(d.receitas,i=>(p(),k("div",{class:"bg-white q-mt-md rounded-borders",key:i.id},[e(Y,null,{default:a(()=>{var r,l;return[e(G,null,{default:a(()=>o[5]||(o[5]=[u("Receita")])),_:1}),e(n,{class:"q-mr-md",cor:"positive",escuro:""},{default:a(()=>[u(f(i.id?"#"+i.id.substr(-6,6):""),1)]),_:2},1024),((r=d.configImpressaoReceita[i.idEmpresa])==null?void 0:r.length)>1?(p(),R(q,{key:0,color:"tertiary",dense:"",flat:"",icon:"print",round:""},{default:a(()=>[e(D,null,{default:a(()=>[e(O,{link:"",separator:""},{default:a(()=>[(p(!0),k(E,null,T(d.configImpressaoReceita[i.idEmpresa],b=>(p(),R(V,{clickable:"",key:b.valor,onClick:M=>t.$imprimir(b.valor,(i||{}).id||"0")},{default:a(()=>[e(y,{avatar:""},{default:a(()=>[e(I,{name:"print"})]),_:1}),e(y,null,{default:a(()=>[e(C,null,{default:a(()=>[u(f(b.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)):w("",!0),((l=d.configImpressaoReceita[i.idEmpresa])==null?void 0:l.length)===1?(p(),R(q,{key:1,color:"tertiary",dense:"",flat:"",icon:"print",round:"",onClick:b=>t.$imprimir(d.configImpressaoReceita[i.idEmpresa][0].valor,(i||{}).id||"0")},null,8,["onClick"])):w("",!0),e(q,{color:"primary",dense:"",flat:"",icon:"edit",onClick:b=>g.abrirModalReceita(i.id,!1),round:""},null,8,["onClick"]),e(q,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:a(()=>[e(D,null,{default:a(()=>[e(O,{link:"",separator:""},{default:a(()=>[B((p(),R(V,{clickable:"",onClick:b=>g.abrirModalReceita(i.id,!0)},{default:a(()=>[e(y,{avatar:""},{default:a(()=>[e(I,{name:"file_copy"})]),_:1}),e(y,null,{default:a(()=>[e(C,null,{default:a(()=>o[6]||(o[6]=[u("Duplicar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[S]]),d.idsEnvelopeReceita[i.id].length?w("",!0):B((p(),R(V,{key:0,clickable:"",onClick:b=>g.excluirReceita(i.id)},{default:a(()=>[e(y,{avatar:""},{default:a(()=>[e(I,{name:"delete"})]),_:1}),e(y,null,{default:a(()=>[e(C,null,{default:a(()=>o[7]||(o[7]=[u("Remover")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[S]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]}),_:2},1024),c("div",le,[e(h,{class:"q-col-gutter-md q-mb-md"},{default:a(()=>[c("div",se,[o[8]||(o[8]=c("span",{class:"text-body2"},"Paciente: ",-1)),c("strong",null,f(i.paciente.nome),1)]),c("div",de,[o[9]||(o[9]=c("span",{class:"text-body2"},"M\xE9dico: ",-1)),c("strong",null,f(i.medico.nome),1)]),c("div",ne,[o[10]||(o[10]=c("span",{class:"text-body2"},"Data: ",-1)),c("strong",null,f(t.$filters.data(i.data)),1)]),c("div",re,[o[11]||(o[11]=c("span",{class:"text-body2"},"Validade: ",-1)),c("strong",null,f(t.$filters.data(i.validade)),1)]),i.observacoes?(p(),k("div",ce,[o[12]||(o[12]=c("strong",{class:"text-body2"},"Observa\xE7\xE3o:",-1)),c("p",null,f(i.observacoes),1)])):w("",!0)]),_:2},1024),e(h,{class:"q-col-gutter-md q-mb-md"},{default:a(()=>[(p(),k(E,null,T(["od","oe"],r=>e(J,{key:r,class:"col-xs-12 col-md-6 no-shadow",rows:g.dadosTabela(r,i.prescricao),columns:d.columns,"row-key":"name",separator:"cell",dense:"","hide-bottom":""},{header:a(l=>[e(N,null,{default:a(()=>[e($,{key:"distancia",props:l,style:{"min-width":"110px","max-width":"110px"}},{default:a(()=>[c("span",ue,[r==="od"?(p(),k(E,{key:0},[u("Olho Direito")],64)):w("",!0),r==="oe"?(p(),k(E,{key:1},[u("Olho Esquerdo")],64)):w("",!0)])]),_:2},1032,["props"]),e($,{key:"adicao",props:l},{default:a(()=>o[13]||(o[13]=[u("Adi\xE7\xE3o")])),_:2},1032,["props"]),e($,{key:"esferico",props:l},{default:a(()=>o[14]||(o[14]=[u("Esf\xE9rico")])),_:2},1032,["props"]),e($,{key:"cilindrico",props:l},{default:a(()=>o[15]||(o[15]=[u("Cil\xEDndrico")])),_:2},1032,["props"]),e($,{key:"eixo",props:l},{default:a(()=>o[16]||(o[16]=[u("Eixo")])),_:2},1032,["props"]),e($,{key:"prisma",props:l},{default:a(()=>o[17]||(o[17]=[u("Prisma")])),_:2},1032,["props"]),e($,{key:"base",props:l},{default:a(()=>o[18]||(o[18]=[u("Base")])),_:2},1032,["props"]),e($,{key:"dnp",props:l},{default:a(()=>o[19]||(o[19]=[u("DNP")])),_:2},1032,["props"])]),_:2},1024)]),body:a(l=>[e(N,{props:l},{default:a(()=>[e(x,{key:"distancia",props:l},{default:a(()=>[u(f(l.row.distancia),1)]),_:2},1032,["props"]),e(x,{key:"adicao",props:l},{default:a(()=>[u(f(t.$filters.numeroSinal(l.row.adicao,2)),1)]),_:2},1032,["props"]),e(x,{key:"esferico",props:l},{default:a(()=>[u(f(t.$filters.numeroSinal(l.row.esferico,2)),1)]),_:2},1032,["props"]),e(x,{key:"cilindrico",props:l},{default:a(()=>[u(f(t.$filters.numeroSinal(l.row.cilindrico,2)),1)]),_:2},1032,["props"]),e(x,{key:"eixo",props:l},{default:a(()=>[u(f(l.row.eixo),1)]),_:2},1032,["props"]),e(x,{key:"prisma",props:l},{default:a(()=>[u(f(l.row.prisma),1)]),_:2},1032,["props"]),e(x,{key:"base",props:l},{default:a(()=>[u(f(l.row.base),1)]),_:2},1032,["props"]),e(x,{key:"dnp",props:l},{default:a(()=>[u(f(t.$filters.numeroOuBranco(l.row.dnp,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:2},1032,["rows","columns"])),64))]),_:2},1024),d.permissaoVisualizarEnvelopes?(p(),R(h,{key:0,class:"q-col-gutter-md"},{default:a(()=>[(p(!0),k(E,null,T(d.idsEnvelopeReceita[i.id],r=>(p(),R(m,{key:r,id:r,class:"col-12"},null,8,["id"]))),128))]),_:2},1024)):w("",!0)])]))),128))]),e(_,{ref:"modalReceita",onAtualizar:g.atualizar},null,8,["onAtualizar"]),e(q,{round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},onClick:o[3]||(o[3]=i=>g.abrirModalReceita("",!1))})])}var we=A(W,[["render",me]]);export{we as default};
