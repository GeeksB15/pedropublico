import{_ as J,X as K,Y as X,Z as Y,bw as W,dw as oo,by as B,bx as G,bz as to,ap as eo,bB as L,aD as ao,r as z,o as u,n as I,f as e,w as i,L as io,H as lo,E as so,h as N,G as ro,Q as x,M as no,i as S,k as f,I as co,t as m,e as g,d as y,y as j,B as s,u as $,q as Z,j as U,m as V,O as R,R as F,S as _,T as C,l as H,F as O,s as T,J as uo,C as mo,a$ as po,aq as fo,dm as ho,c$ as vo,ax as go}from"./index.188ab8e6.js";import{l as bo}from"./listaV2.9c115791.js";import{P as yo}from"./ItensManipulacaoApontamento.6b67a2da.js";import"./QBreadcrumbs.18b35aaa.js";import"./xlsx.d35bdce8.js";const Io={components:{Avatar:K,Badge:X,BadgeCopiarUid:Y,PromptItemV2:W,PromptApontamento:yo,SeletorCampoTabela:oo},data(){return{itens:{},documentoAnterior:{},documentoItensAnterior:[],documento:{id:"",codigoDocumento:"",idEmpresa:"",codigoEmpresa:"",descricaoEmpresa:"",numeroDocumentoEmpresa:"",inscricaoMunicipalEmpresa:"",operacao:"Manipulacao",tipo:"Produ\xE7\xE3o",status:"",dataEmissao:B(),dataFinalizacao:"",observacao:""},documentoItens:[],adicionar:{modal:{name:"",value:!1}},listaApontamentos:[],apontamento:{modal:{name:"",value:!1}},totalOrigem:0,totalDestino:0,visivel:!1,promptApontamento:{},equipamentos:[],composicoes:[],quantidadeOriginal:0,contatos:[],dataPrevistaEntrega:"",horaPrevistaEntrega:"",lote:{show:!1,readonly:!1,value:""}}},emits:["atualizar"],methods:{onHide(){this.$router.replace({params:{id:""}})},zerarCampos(){this.documentoAnterior={},this.documentoItensAnterior=[],this.documento={id:G(),idEmpresa:"",descricaoEmpresa:"",operacao:"Manipula\xE7\xE3o",tipo:"Produ\xE7\xE3o",status:"Digita\xE7\xE3o",dataHoraEmissao:B(),dataHoraFinalizado:"",observacao:""},this.documentoItens=[],this.totalOrigem=0,this.totalDestino=0,this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.lote={show:!1,readonly:!1,value:""}},async atualizar(t){var o,r;if(this.zerarCampos(),t){if(this.documentoAnterior=await $db.itemManipulacao.le({id:t}),this.documento=$utils.clonarV2(this.documentoAnterior),this.documentoItensAnterior=await $db.itemManipulacao.leItens({idDocumento:t}),this.documentoItens=to(this.documentoItensAnterior),(o=this.documento)!=null&&o.idContato){const d=this.documento.idContato;this.contatos[d]||(this.contatos[d]=await $db.contato.le({id:d}))}if((r=this.documento)!=null&&r.idEmpresa){const d=this.documento.idEmpresa;this.contatos[d]||(this.contatos[d]=await $db.contato.le({id:d}))}this.documento.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.documento.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.documento.dataHoraPrevisto.slice(11,16));for(const d of this.documentoItens){if(!this.lote.value&&d.operacaoFator===1&&d.loteEmpresa&&(this.lote.value=d.loteEmpresa),!d.idItem)continue;const a=await $erp().item.get(d.idItem);!a||a.id in this.itens||(this.itens[a.id]={codigoItem:a.codigoItem,referencia:a.referencia})}}else{let d,a,n;if(a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(a.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(d=a[0],a.length>1){const h={ativo:!0,empresas:!0};if(d=await $g.promptContato.show({filtro:h,placeholder:"Selecione"}),!d){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(n=(await $erp().empresa.where({idContato:d.id}).toArray())[0],!n){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}this.documento.descricaoEmpresa=n.nome,this.documento.idEmpresa=n.idContato,this.documento.numeroDocumentoEmpresa=n.numeroDocumentoNacional,this.documento.inscricaoMunicipalEmpresa=n.numeroDocumentoMunicipal}this.somarValorTotal(),this.buscarApontamentos(),await this.configLote()},async configLote(){var o,r;let t;this.usaLote=!1,this.pcpLote="",t=await $db.configuracoes.le({nome:"usa.lote"}),t=(o=t.find(d=>d.idEmpresa===this.documento.idEmpresa))!=null?o:t.find(d=>!d.idEmpresa),this.usaLote=(t==null?void 0:t.valor)==="1",t=await $db.configuracoes.le({nome:"pcp.lote"}),t=(r=t.find(d=>d.idEmpresa===this.documento.idEmpresa))!=null?r:t.find(d=>!d.idEmpresa),this.pcpLote=t==null?void 0:t.valor,this.lote.show=this.usaLote,this.lote.readonly=!!this.pcpLote,!this.lote.value&&this.pcpLote&&(this.lote.value=this.pcpLote)},async salvar(t,o){try{if(this.dataPrevistaEntrega){const r=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.documento.dataHoraPrevisto=eo.formatDate(r)}if(this.dataPrevistaEntrega===null&&(this.documento.dataHoraPrevisto=""),this.lote.value!==this.pcpLote)for(const r of this.documentoItens)r.operacaoFator===1&&(!r.idItem||(r.loteEmpresa=this.lote.value));await $db.itemManipulacao.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens})}catch(r){this.$q.notifyError("Erro ao salvar",r)}await this.atualizar(this.documento.id),o&&this.$q.notify(o),t||this.$emit("atualizar"),this.visivel=t},async aguardarGeracaoNroPCP(){var r,d;let t=!0,o=0;$q.loading.show({message:"Aguardando gera\xE7\xE3o do n\xFAmero do PCP para composi\xE7\xE3o do n\xFAmero do lote."}),this.numeroPCP=null;do{await new Promise((a,n)=>setTimeout(a,1e3));try{const a=await this.$utils.geeksApi({consultaNumero:{funcao:"185D6D10-9A2A-4965-8C86-90FA2F7F73A2",id:this.documento.id}});(d=(r=a==null?void 0:a.data)==null?void 0:r.consultaNumero)!=null&&d.numero&&(this.numeroPCP=a==null?void 0:a.data.consultaNumero.numero,t=!1),++o===10&&(t=!1)}catch(a){console.error(a)}}while(t);if($q.loading.hide(),!this.numeroPCP){const a="N\xE3o foi poss\xEDvel obter o n\xFAmero do lote. Por favor, tente novamente.";throw $q.notify({type:"negative",message:a}),new Error(a)}},async gerarNroLote(){const t=new Date;if(this.pcpLote){let o=this.pcpLote;o=o.replace("AAAA",t.toISOString().slice(0,4)),o=o.replace("AA",t.toISOString().slice(2,4)),o=o.replace("MM",t.toISOString().slice(5,7)),o=o.replace("DD",t.toISOString().slice(8,10)),o=o.replace("PCP",String(this.numeroPCP)),this.lote.value=o}},async finalizar(){let t;if(t=this.verificarTotal(),!!t){if(this.usaLote&&this.pcpLote){let o=!0;for(let r of this.documentoItens)if(r.operacaoFator===1&&r.loteEmpresa){o=!1;break}o&&(await this.salvar(!0),await this.aguardarGeracaoNroPCP(),await this.gerarNroLote())}this.documento.status="Finalizado",this.documento.dataHoraFinalizado=B();for(let o of this.documentoItens)o.status="Finalizado",o.dataHoraFinalizado=B();this.salvar(!1,"Produ\xE7\xE3o Finalizada")}},reabrir(){try{this.documento.status="Digita\xE7\xE3o",this.documento.dataHoraFinalizado="";for(let t of this.documentoItens)t.status="Digita\xE7\xE3o",t.dataHoraFinalizado="";this.salvar(!0,"Produ\xE7\xE3o reaberta")}catch(t){this.$q.notifyError("Erro ao reabrir",t)}},async excluirItem(t){this.documentoItens=this.documentoItens.filter(o=>o.id!==t),this.somarValorTotal()},async removerTodosItens(t){$q.dialog({title:"Remover todos os itens",message:`Deseja remover todos os itens de ${t}`,cancel:!0,persistent:!0}).onOk(()=>{let o=[];const r=t==="Destino"?1:-1;o=this.documentoItens.filter(d=>d.operacaoFator===r);for(const d of o)this.excluirItem(d.id)})},async recalcularTotal(t,o=!1){if(t.subTotal=L(t.quantidade*t.valorItem),t.total=L(t.quantidade*t.valorItem),o){let r={titulo:"Composi\xE7\xE3o",msg:"Deseja recalcular a origem?"};t.operacaoFator===1&&await this.verificarComposicao(t.idItem,t.quantidade,r)}this.somarValorTotal()},async recalcularQuantidade(t){t.quantidade=L(t.subTotal/t.valorItem),t.total=t.subTotal,this.somarValorTotal()},async recalcularValorItem(t){t.valorItem=L(t.subTotal/t.quantidade),t.total=t.subTotal,this.somarValorTotal()},somarValorTotal(){const t=this.documentoItens.filter(r=>r.operacaoFator===-1).reduce((r,d)=>r+=d.total,0),o=this.documentoItens.filter(r=>r.operacaoFator===1).reduce((r,d)=>r+=d.total,0);this.totalOrigem=$utils.arredondar(t,2),this.totalDestino=$utils.arredondar(o,2)},verificarTotal(){return this.documentoItens.length===0&&this.totalDestino===0&&this.totalOrigem===0?(this.$q.notifyError("Selecione alguns itens na lista"),!1):this.totalOrigem!==this.totalDestino?(this.$q.notifyError("Valores Totais de Origem e Destino devem ser iguais!"),!1):!0},async abrirModal(t,o=""){let r={},d=[];const a=t==="Destino"?1:-1;o?d=this.documentoItens.filter(n=>n.idItem===o):d=this.documentoItens.filter(n=>n.operacaoFator===a);for(const n of d)r[n.idItem]={item:await ao().item.get(n.idItem)||{},quantidade:n.quantidade};this.$refs.promptItem.itensSelecionados=r,this.$refs.promptItem.termo=o,this.$refs.promptItem.atualizar(),this.adicionar.modal.value=!0,this.adicionar.modal.name=t},async selecionarItens(t){var d,a,n;let o={};const r=this.adicionar.modal.name==="Destino"?1:-1;for(const h in t){let b=await $db.estoqueSaldoProdutoEmpresa.le({idEmpresa:this.documento.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:h});b=b[0];const k=await $db.configuracoes.porNome("vendas.checaestoque",this.documento.idEmpresa),q=!!Number((d=k.find(E=>E.id))==null?void 0:d.valor),p=t[h].item||{},c=t[h].quantidade||0,v=(a=(b==null?void 0:b.valorCustoMedio)||(p==null?void 0:p.valorCustoReposicao))!=null?a:0;if(p.id in this.itens||(this.itens[p.id]={codigoItem:p.codigoItem,referencia:p.referencia}),q&&r===-1&&(!(b!=null&&b.saldo)||c>(b==null?void 0:b.saldo))){this.$q.notifyError(`${p.descricao} n\xE3o dispon\xEDvel no estoque`);continue}let M=this.documentoItens.find(E=>E.idItem===h);M?(M.quantidade=c,M.quantidadeRealizado=c,M.subTotal=L(c*v),M.total=L(c*v)):this.documentoItens.push({dataHoraEmissao:B(),dataHoraFinalizado:"",descricaoItem:p.descricao,id:G(),idDocumento:this.documento.id,idItem:p.id,operacao:"Manipula\xE7\xE3o",operacaoFator:r,quantidade:c,quantidadeRealizado:c,status:"Digita\xE7\xE3o",tipoItem:p.tipo,subTotal:L(c*v),total:L(c*v),unidade:p.unidade,valorCustoMedio:(n=b==null?void 0:b.valorCustoMedio)!=null?n:0,valorItem:v,valorOriginal:v});let l=await $db.item.leCompleto({id:p.id});!this.composicoes.includes(l.atual.composicao[0].idItemUtilizado)&&l.atual.composicao[0].idItemUtilizado!==""?(o={titulo:"Composi\xE7\xE3o",msg:"O item selecionado possui itens de composi\xE7\xE3o, deseja preencher?"},r===1&&await this.verificarComposicao(p.id,c,o)):o={}}this.somarValorTotal()},async verificarComposicao(t,o,r){var h,b;let d=[],a=await $db.item.leCompleto({id:t});(b=(h=a==null?void 0:a.atual)==null?void 0:h.composicao)==null||b.sort((k,q)=>k.ordem<q.ordem?-1:1);for(let k of a.atual.composicao)k.idItemUtilizado&&(k.quantidade=k.quantidade*o,d.push(k),this.composicoes.push(k.idItemUtilizado));const n=d.reduce((k,q)=>(k[q.idItemUtilizado]||(k[q.idItemUtilizado]=q),k),{});r.titulo?$q.dialog({title:r.titulo,message:r.msg,cancel:!0,persistent:!0}).onOk(()=>{this.adicionar.modal.name="Origem",this.selecionarItens(n),r.titulo=""}):(this.adicionar.modal.name="Origem",this.selecionarItens(n))},async abrirModalApontamento(){this.$refs.promptApontamento.show()},async incluirApontamento(t){let o={id:G(),documentoItemIdContato:t.operador,idItem:t.equipamento,tipoItem:"ApontamentoPCP",quantidade:t.quantidade,dataHoraEmissao:t.dataIni,dataHoraFinalizado:t.dataFim,peso:t.peso,idDocumento:this.documento.id};try{await $db.documentoItem.grava({atual:o})}catch(r){this.$q.notifyError("Erro ao salvar",r)}this.buscarApontamentos()},async buscarApontamentos(){try{this.listaApontamentos=[],(await $db.documentoItem.leApontamento({tipoItem:"ApontamentoPCP",idDocumento:this.documento.id})).forEach((o,r)=>{this.listaApontamentos[r]={id:o.id,operador:o.documentoItemIdContato,equipamento:o.idItem,quantidade:o.quantidade,dataIni:o.dataHoraEmissao,dataFim:o.dataHoraFinalizado,peso:o.peso,idDocumento:o.idDocumento}})}catch(t){this.$q.notifyError("Erro ao consultar apontamentos",t)}},async carregarEquipamentos(){let t=await $db.item.leRefatorado({filtros:{tipo:"Servi\xE7o"}});this.equipamentos=t.data.map(o=>({descricao:o.descricao,id:o.id}))},buscaEquipamentoApontado(t){let o=this.equipamentos.find(r=>r.id===t);return o?o.descricao:""},async carregarOperadores(){let t=await $db.contato.leRefatorado({filtros:{}});this.operadores=t.data.map(o=>({nome:o.nome,id:o.id}))},async carregarOperacoes(){let t=await $db.hibrido.lista({table:"documento",where:{tipo:"Produ\xE7\xE3o"}});this.documento.operacoes=t.map(o=>({rotulo:o.operacao,valor:o.operacao}))},buscaOperadorApontado(t){let o=this.operadores.find(r=>r.id===t);return o?o.nome:""},calculoHorasProducao(t,o){let r=new Date(t)-new Date(o),d=Math.floor(r%864e5/36e5),a=Math.round(r%864e5%36e5/6e4);return d+"h "+a+"m"},async removerTodosApontamentos(){$q.dialog({title:"Remover todos os apontamentos",message:"Deseja remover todos os apontamentos de produ\xE7\xE3o",cancel:!0,persistent:!0}).onOk(()=>{for(const t of this.listaApontamentos)this.excluirApontamento(t.id)})},async excluirApontamento(t){try{await $db.documentoItem.removeApontamento(t),this.listaApontamentos=this.listaApontamentos.filter(o=>o.id!==t),this.$q.notify("Apontamento removido!")}catch{this.$q.notifyError("N\xE3o foi possivel remover o apontamento!")}},qtdOriginal(t=0){this.quantidadeOriginal=t},async abrirModalContato(){const t=await this.selecionarContato({placeholder:"Selecione o cliente",filtro:{ativo:!0}});t.id&&(this.documento.idContato=t.id),t.nome&&(this.documento.descricaoContato=t.nome),this.contatos[t.id]||(this.contatos[t.id]=await $db.contato.le({id:t.id}))},async selecionarContato(t){const{placeholder:o,filtro:r}={placeholder:"Selecione o contato",filtro:{ativo:!0},...t},d=await $g.promptContato.show({filtro:r,placeholder:o});if(!d)throw new Error("Contato n\xE3o selecionado");return d}},async beforeMount(){await this.carregarEquipamentos(),await this.carregarOperadores()}},_o={key:0},qo={ref:"form"},wo={class:"col-12 col-md"},xo={class:"col-auto"},Co={class:"col"},ko={class:"col-12 col-md"},Eo={class:"col-auto"},zo={class:"col"},Ao={key:0,class:"col-4"},Vo={class:"col-6 bg-transparent"},Po={class:"col-6 bg-transparent"},Fo={class:"col-12"},Do={class:"col-12 col-md-6"},Mo={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},Lo={class:"col-2 col-md"},Oo={key:0},To={key:1},So={class:"col-10 col-md-4"},Ho={class:"col-6 col-md text-right"},Uo={class:"col-6 col-md text-right"},Qo={class:"col-6 col-md text-right"},Bo={key:0,class:"col-6 col-md-1 text-right"},No={class:"col-6 col-md text-right"},Ro={class:"col-12 col-md-6"},jo={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},Go={class:"col-2 col-md"},$o={key:0},Zo={key:1},Jo={class:"col-10 col-md-4"},Xo={class:"col-6 col-md text-right"},Yo={class:"col-6 col-md text-right"},Ko={class:"col-6 col-md text-right"},Wo={class:"col-6 col-md text-right"},ot={key:0,class:"col-6 col-md-1 text-right"},tt={class:"col-6 col-md text-right"},et={class:"col-12 col-md-12"},at={class:"q-item-label q-mb-none",style:{color:"#0c0c0c"}},it={class:"col-6 col-md"},lt={class:"col-6 col-md"},st={class:"col-6 col-md text-right"},rt={class:"col-6 col-md text-right"},nt={class:"col-6 col-md text-right"},dt={class:"col-6 col-md text-right"},ct={class:"col-6 col-md text-right"},ut={class:"col-6 col-md-1 text-right"},mt={class:"u-container relative-position"};function pt(t,o,r,d,a,n){const h=z("badge"),b=z("BadgeCopiarUid"),k=z("avatar"),q=z("campo"),p=z("row"),c=z("SeletorCampoTabela"),v=z("PromptItemV2"),M=z("PromptApontamento");return u(),I("div",null,[e(mo,{modelValue:a.visivel,"onUpdate:modelValue":o[18]||(o[18]=l=>a.visivel=l),maximized:"",onHide:n.onHide},{default:i(()=>[e(io,{class:"bg-light",container:""},{default:i(()=>[e(lo,{class:"u-container"},{default:i(()=>[e(so,null,{default:i(()=>[e(N,null,{default:i(()=>[ro(e(x,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[no]]),e(S,null,{default:i(()=>o[20]||(o[20]=[f("Produ\xE7\xE3o (PCP)")])),_:1}),e(x,{class:"q-ml-sm no-shadow",color:"white",unelevated:"","text-color":"primary",label:"Salvar",onClick:o[0]||(o[0]=l=>n.salvar(!1,"Produ\xE7\xE3o salva!"))})]),_:1})]),_:1}),e(co,null,{default:i(()=>[e(N,{class:"q-pa-none q-ma-none q-my-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[e(S,{class:"text-black q-px-none text-body2"},{default:i(()=>[f("Emiss\xE3o: "+m(t.$filters.data(a.documento.dataHoraEmissao))+" ",1),a.documento.dataHoraFinalizado?(u(),I("span",_o,"Cancelamento: "+m(t.$filters.data(a.documento.dataHoraFinalizado)),1)):g("",!0)]),_:1}),a.documento.status?(u(),y(h,{key:0,cor:"positive",class:"q-mx-sm",icone:"flag",escuro:""},{default:i(()=>[f(m(a.documento.status),1)]),_:1})):g("",!0),a.documento.numero?(u(),y(h,{key:1,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:i(()=>[f(" #"+m(a.documento.numero.toString().padStart(6,"0")),1)]),_:1})):(u(),y(b,{key:2,id:a.documento.id,numero:a.documento.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))]),_:1}),e(j,{class:"bg-white q-pa-md q-mt-md no-shadow"},{default:i(()=>[s("form",qo,[e(p,{class:"q-col-gutter-sm"},{default:i(()=>[s("div",wo,[e(p,null,{default:i(()=>{var l,E,A,P;return[s("div",xo,[e(k,{imagem:(E=(l=a.contatos[a.documento.idEmpresa])==null?void 0:l.imagem)!=null?E:"",rotulo:(P=(A=a.contatos[a.documento.idEmpresa])==null?void 0:A.nome)!=null?P:"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),s("div",Co,[e(q,{somenteLeitura:"",rotulo:"Empresa",tipo:"texto",class:"col-10",modelValue:a.documento.descricaoEmpresa,"onUpdate:modelValue":o[1]||(o[1]=D=>a.documento.descricaoEmpresa=D)},null,8,["modelValue"])])]}),_:1})]),s("div",ko,[e(p,null,{default:i(()=>{var l,E,A,P;return[s("div",Eo,[e(k,{imagem:(E=(l=a.contatos[a.documento.idContato])==null?void 0:l.imagem)!=null?E:"",rotulo:(P=(A=a.contatos[a.documento.idEmpresa])==null?void 0:A.nome)!=null?P:"",tamanho:"30",style:{float:"left"},class:"q-mr-sm"},null,8,["imagem","rotulo"])]),s("div",zo,[e(q,{somenteLeitura:"",placeholder:"Cliente",rotulo:"Cliente",tipo:"texto",after:[{icon:"search",handler(){n.abrirModalContato()}}],modelValue:a.documento.descricaoContato,"onUpdate:modelValue":o[2]||(o[2]=D=>a.documento.descricaoContato=D)},null,8,["after","modelValue"])])]}),_:1})])]),_:1}),e(p,null,{default:i(()=>[a.lote.show?(u(),I("div",Ao,[e(q,{modelValue:a.lote.value,"onUpdate:modelValue":o[3]||(o[3]=l=>a.lote.value=l),"somente-leitura":a.lote.readonly,rotulo:"Lote",tipo:"texto"},null,8,["modelValue","somente-leitura"])])):g("",!0),s("div",{class:$(a.lote.show?"col-4":"col-6"),onClick:o[5]||(o[5]=(...l)=>n.carregarOperacoes&&n.carregarOperacoes(...l))},[e(c,{modelValue:a.documento.operacao,"onUpdate:modelValue":o[4]||(o[4]=l=>a.documento.operacao=l),filtro:{tipo:"Produ\xE7\xE3o"},tabela:"documento",campo:"operacao",label:"Opera\xE7\xE3o",buscarSemCaractere:!0,enableAdd:""},null,8,["modelValue"])],2),s("div",{class:$(a.lote.show?"col-4":"col-6")},[e(p,null,{default:i(()=>[s("div",Vo,[e(Z,{modelValue:a.dataPrevistaEntrega,"onUpdate:modelValue":o[6]||(o[6]=l=>a.dataPrevistaEntrega=l),type:"date",clearable:"",dense:"","stack-label":"",label:"Data Prevista de Entrega"},null,8,["modelValue"])]),s("div",Po,[e(Z,{modelValue:a.horaPrevistaEntrega,"onUpdate:modelValue":o[7]||(o[7]=l=>a.horaPrevistaEntrega=l),type:"time",clearable:"",dense:"","stack-label":"",label:"Hora Prevista de Entrega"},null,8,["modelValue"])])]),_:1})],2),s("div",Fo,[e(q,{modelValue:a.documento.observacao,"onUpdate:modelValue":o[8]||(o[8]=l=>a.documento.observacao=l),rotulo:"Observa\xE7\xE3o",rows:"1",tipo:"textoArea"},null,8,["modelValue"])])]),_:1})],512)]),_:1}),e(p,{class:"q-col-gutter-x-sm q-mt-md"},{default:i(()=>[s("div",Do,[e(j,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[e(N,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[s("p",Mo,[e(U,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),o[21]||(o[21]=f(" Origem "))]),e(S,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),a.documento.status==="Digita\xE7\xE3o"?(u(),y(x,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:o[9]||(o[9]=l=>n.removerTodosItens("Origem"))},{default:i(()=>[e(V,null,{default:i(()=>o[22]||(o[22]=[f("Remover todos")])),_:1})]),_:1})):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),y(x,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:o[10]||(o[10]=l=>n.abrirModal("Origem"))},{default:i(()=>[e(V,null,{default:i(()=>o[23]||(o[23]=[f("Adicionar Item")])),_:1})]),_:1})):g("",!0)]),_:1}),e(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[e(F,{class:"q-pa-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[e(p,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>o[24]||(o[24]=[s("div",{class:"col-2 col-md"},"Ref/C\xF3d.",-1),s("div",{class:"col-10 col-md-4"},"Descri\xE7\xE3o",-1),s("div",{class:"col-6 col-md text-right"},"Quantidade",-1),s("div",{class:"col-6 col-md text-right"},"Valor",-1),s("div",{class:"col-6 col-md text-right"},"Total",-1),s("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1)])),_:1})]),_:1}),e(H,{class:"q-my-xs"}),(u(!0),I(O,null,T(a.documentoItens,(l,E)=>(u(),I("div",{key:E},[l.operacaoFator===-1?(u(),y(C,{key:0,caption:""},{default:i(()=>[e(p,{class:"text-left justify-around"},{default:i(()=>{var A,P,D,Q;return[s("div",Lo,[(A=a.itens[l.idItem])!=null&&A.referencia?(u(),I("span",Oo,m((P=a.itens[l.idItem])==null?void 0:P.referencia),1)):(D=a.itens[l.idItem])!=null&&D.codigoItem?(u(),I("span",To," #"+m((Q=a.itens[l.idItem])==null?void 0:Q.codigoItem),1)):g("",!0)]),s("div",So,m(l.descricaoItem||"-"),1),s("div",Ho,[e(q,{modelValue:l.quantidade,"onUpdate:modelValue":w=>l.quantidade=w,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:w=>n.recalcularTotal(l,!0)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),s("div",Uo,[e(q,{modelValue:l.valorItem,"onUpdate:modelValue":w=>l.valorItem=w,decimals:"4",disable:"",tipo:"decimal",somenteLeitura:a.documento.status==="Finalizado",onBlur:w=>n.recalcularTotal(l)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),s("div",Qo,[e(q,{modelValue:l.subTotal,"onUpdate:modelValue":w=>l.subTotal=w,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:w=>n.recalcularQuantidade(l)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),a.documento.status==="Digita\xE7\xE3o"?(u(),I("div",Bo,[e(x,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:w=>n.excluirItem(l.id)},{default:i(()=>[e(V,null,{default:i(()=>o[25]||(o[25]=[f("Excluir")])),_:1})]),_:2},1032,["onClick"])])):g("",!0)]}),_:2},1024)]),_:2},1024)):g("",!0),l.operacaoFator===-1?(u(),y(H,{key:1,class:"q-my-xs"})):g("",!0),l.operacaoFator===-1?(u(),y(C,{key:2,caption:""})):g("",!0)]))),128))]),_:1})]),_:1}),e(F,{class:"q-pa-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[e(p,{class:"text-weight-bold text-left justify-around"},{default:i(()=>[o[26]||(o[26]=s("div",{class:"col-2 col-md"},null,-1)),o[27]||(o[27]=s("div",{class:"col-10 col-md-4"},null,-1)),o[28]||(o[28]=s("div",{class:"col-6 col-md text-right"},null,-1)),o[29]||(o[29]=s("div",{class:"col-6 col-md text-right"},null,-1)),s("div",No,m(t.$filters.numero(a.totalOrigem,2)),1),o[30]||(o[30]=s("div",{class:"col-6 col-md-1 text-right"},"\xA0",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(F,{class:"q-px-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,{class:"text-center"},{default:i(()=>[e(x,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:o[11]||(o[11]=l=>n.abrirModal("Origem"))})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),s("div",Ro,[e(j,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[e(N,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[s("p",jo,[e(U,{class:"q-mr-md",name:"shopping_cart",size:"24px",style:{color:"#737373"}}),o[31]||(o[31]=f(" Destino "))]),e(S,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),a.documento.status==="Digita\xE7\xE3o"?(u(),y(x,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:o[12]||(o[12]=l=>n.removerTodosItens("Destino"))},{default:i(()=>[e(V,null,{default:i(()=>o[32]||(o[32]=[f("Remover todos")])),_:1})]),_:1})):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),y(x,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:o[13]||(o[13]=l=>n.abrirModal("Destino"))},{default:i(()=>[e(V,null,{default:i(()=>o[33]||(o[33]=[f("Adicionar Item")])),_:1})]),_:1})):g("",!0)]),_:1}),e(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[e(F,{class:"q-pa-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[e(p,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>o[34]||(o[34]=[s("div",{class:"col-2 col-md"},"Ref/C\xF3d.",-1),s("div",{class:"col-10 col-md-4"},"Descri\xE7\xE3o",-1),s("div",{class:"col-6 col-md text-right"},"Quantidade",-1),s("div",{class:"col-6 col-md text-right"},"Unidade",-1),s("div",{class:"col-6 col-md text-right"},"Valor",-1),s("div",{class:"col-6 col-md text-right"},"Total",-1),s("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1)])),_:1})]),_:1}),e(H,{class:"q-my-xs"}),(u(!0),I(O,null,T(a.documentoItens,(l,E)=>(u(),I("div",{key:E},[l.operacaoFator===1?(u(),y(C,{key:0,caption:""},{default:i(()=>[e(p,{class:"text-left justify-around"},{default:i(()=>{var A,P,D,Q;return[s("div",Go,[(A=a.itens[l.idItem])!=null&&A.referencia?(u(),I("span",$o,m((P=a.itens[l.idItem])==null?void 0:P.referencia),1)):(D=a.itens[l.idItem])!=null&&D.codigoItem?(u(),I("span",Zo," #"+m((Q=a.itens[l.idItem])==null?void 0:Q.codigoItem),1)):g("",!0)]),s("div",Jo,m(l.descricaoItem||"-"),1),s("div",Xo,[e(q,{modelValue:l.quantidade,"onUpdate:modelValue":w=>l.quantidade=w,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onMouseover:w=>n.qtdOriginal(l.quantidade),onBlur:w=>n.recalcularTotal(l,l.quantidade!==a.quantidadeOriginal)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onMouseover","onBlur"])]),s("div",Yo,m(l.unidade),1),s("div",Ko,[e(q,{modelValue:l.valorItem,"onUpdate:modelValue":w=>l.valorItem=w,somenteLeitura:a.documento.status==="Finalizado",class:"col",decimals:"4",tipo:"decimal",onBlur:w=>n.recalcularTotal(l)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),s("div",Wo,[e(q,{modelValue:l.subTotal,"onUpdate:modelValue":w=>l.subTotal=w,somenteLeitura:a.documento.status==="Finalizado",decimals:"4",tipo:"decimal",onBlur:w=>n.recalcularValorItem(l)},null,8,["modelValue","onUpdate:modelValue","somenteLeitura","onBlur"])]),a.documento.status==="Digita\xE7\xE3o"?(u(),I("div",ot,[e(x,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:w=>n.excluirItem(l.id)},{default:i(()=>[e(V,null,{default:i(()=>o[35]||(o[35]=[f("Excluir")])),_:1})]),_:2},1032,["onClick"])])):g("",!0)]}),_:2},1024)]),_:2},1024)):g("",!0),l.operacaoFator===1?(u(),y(H,{key:1,class:"q-my-xs"})):g("",!0),l.operacaoFator===1?(u(),y(C,{key:2,caption:""})):g("",!0)]))),128))]),_:1})]),_:1}),e(F,{class:"q-pa-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[e(p,{class:"text-weight-bold text-left justify-around"},{default:i(()=>[o[36]||(o[36]=s("div",{class:"col-2 col-md"},null,-1)),o[37]||(o[37]=s("div",{class:"col-10 col-md-4"},null,-1)),o[38]||(o[38]=s("div",{class:"col-6 col-md text-right"},null,-1)),o[39]||(o[39]=s("div",{class:"col-6 col-md text-right"},null,-1)),s("div",tt,m(t.$filters.numero(a.totalDestino,2)),1),o[40]||(o[40]=s("div",{class:"col-6 col-md-1 text-right"},"\xA0",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(F,{class:"q-px-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,{class:"text-center"},{default:i(()=>[e(x,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar item",outline:"",size:"xs",onClick:o[14]||(o[14]=l=>n.abrirModal("Destino"))})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),e(p,{class:"q-col-gutter-x-sm q-mt-md"},{default:i(()=>[s("div",et,[e(j,{class:"no-shadow bg-white full-width fit q-pa-md"},{default:i(()=>[e(N,{class:"q-pa-none q-ma-none q-mb-md",color:"none","text-color":"black",style:{"min-height":"auto"}},{default:i(()=>[s("p",at,[e(U,{class:"q-mr-md",name:"content_paste",size:"24px",style:{color:"#737373"}}),o[41]||(o[41]=f(" Apontamentos "))]),e(S,{class:"q-pa-none q-ma-none",style:{height:"0 !important","min-height":"auto"}}),a.documento.status==="Digita\xE7\xE3o"?(u(),y(x,{key:0,color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:o[15]||(o[15]=l=>n.removerTodosApontamentos())},{default:i(()=>[e(V,null,{default:i(()=>o[42]||(o[42]=[f("Remover todos")])),_:1})]),_:1})):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),y(x,{key:1,color:"positive",dense:"",flat:"",icon:"add",round:"",size:"md",onClick:o[16]||(o[16]=l=>n.abrirModalApontamento())},{default:i(()=>[e(V,null,{default:i(()=>o[43]||(o[43]=[f("Adicionar Apontamento")])),_:1})]),_:1})):g("",!0)]),_:1}),e(R,{class:"col-12 no-border q-mx-none q-pa-none"},{default:i(()=>[e(F,{class:"q-pa-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[e(p,{class:"q-col-gutter-md text-weight-bold text-left justify-around"},{default:i(()=>o[44]||(o[44]=[s("div",{class:"col-6 col-md"},"Data hora inicio",-1),s("div",{class:"col-6 col-md"},"Data hora fim",-1),s("div",{class:"col-6 col-md text-right"},"Tempo total",-1),s("div",{class:"col-6 col-md text-right"},"Equipamentos",-1),s("div",{class:"col-6 col-md text-right"},"Operador",-1),s("div",{class:"col-6 col-md text-right"},"Quantidade",-1),s("div",{class:"col-6 col-md text-right"},"Peso",-1),s("div",{class:"col-6 col-md-1 text-right"},"A\xE7\xF5es",-1)])),_:1})]),_:1}),e(H,{class:"q-my-xs"}),(u(!0),I(O,null,T(a.listaApontamentos,(l,E)=>(u(),I("div",{key:E},[e(C,{caption:""},{default:i(()=>[e(p,{class:"text-left justify-around"},{default:i(()=>[s("div",it,m(t.$filters.dataHora(l.dataIni)),1),s("div",lt,m(t.$filters.dataHora(l.dataFim)),1),s("div",st,m(n.calculoHorasProducao(l.dataFim,l.dataIni)),1),s("div",rt,m(n.buscaEquipamentoApontado(l.equipamento)),1),s("div",nt,m(n.buscaOperadorApontado(l.operador)),1),s("div",dt,m(t.$filters.numeroZerosDireita(l.quantidade,4,0)),1),s("div",ct,m(t.$filters.numeroZerosDireita(l.peso,4,0)),1),s("div",ut,[e(x,{dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:A=>n.excluirApontamento(l.id)},{default:i(()=>[e(V,null,{default:i(()=>o[45]||(o[45]=[f("Excluir")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1}),e(F,{class:"q-px-none"},{default:i(()=>[e(_,null,{default:i(()=>[e(C,{class:"text-center"},{default:i(()=>[e(x,{class:"q-mx-auto",color:"positive",icon:"add",label:"Adicionar apontamento",outline:"",size:"xs",onClick:o[17]||(o[17]=l=>n.abrirModalApontamento())})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),e(uo,{class:"bg-light no-shadow q-pa-sm text-right",bordered:""},{default:i(()=>[s("div",mt,[e(S,{class:"text-right"},{default:i(()=>[a.documento.status==="Finalizado"?(u(),y(x,{key:0,color:"primary",label:"Reabrir",onClick:n.reabrir},null,8,["onClick"])):g("",!0),a.documento.status==="Digita\xE7\xE3o"?(u(),y(x,{key:1,color:"primary",label:"Finalizar",onClick:n.finalizar},null,8,["onClick"])):g("",!0)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"]),e(v,{modelValue:a.adicionar.modal.value,"onUpdate:modelValue":o[19]||(o[19]=l=>a.adicionar.modal.value=l),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:a.documento.idEmpresa},exibirValorVenda:!1,onSelecionarItens:n.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"]),e(M,{onIncluirApontamento:n.incluirApontamento,habilitarQuantidade:!0,ref:"promptApontamento"},null,8,["onIncluirApontamento"])])}var ft=J(Io,[["render",pt]]);const ht={components:{lista:bo,Badge:X,ItensManipulacao:ft,BadgeCopiarUid:Y},data(){return{paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25},filtros:{tab:"digitacao",empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},documentos:[],tabs:[{rotulo:"Digita\xE7\xE3o",value:"digitacao"},{rotulo:"Finalizados",value:"finalizado"},{rotulo:"Todos",value:"Todos"}],tabSelecionada:{valor:"digitacao"},listaLayout:{},buscaCampo:"",checkboxModel:[],configImpressao:[]}},watch:{showFilters:function(t){t===!0?this.showList=!1:(this.section===!0||this.kanban===!0||this.gantt===!0)&&(this.showList=!0)}},methods:{async atualizar(){var o;const t=$utils.logarIni("ItensManipulacaoLista");await $tryLoading(async()=>{this.filtros.tab=this.tabSelecionada.valor;let r="";this.filtros.tab==="digitacao"?r="Digita\xE7\xE3o":this.filtros.tab==="finalizado"&&(r="Finalizado");let d=this.filtros.empresa.selecionada.value||"";this.filtros.idEmpresa=d;let a=this.$utils.eliminarVazios(this.filtros);this.buscaCampo&&(a.termoBusca=this.buscaCampo),a.status=r;const n=await $db.itemManipulacao.leListaCompleta({filtros:a,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["codigoDocumento"],dir:["desc"]});this.listaLayout={};for(let h of n.data)this.listaLayout[h.id]={detalhes:!1};this.documentos=n.data,this.calcularPorcentagem(this.documentos),this.paginacao.total=n.total,this.paginacao.maximo=n.totalPages,this.configuraImpressao(this.filtros.idEmpresa)},{mensagem:"Carregando...",erro:"Ocorreu um erro ao consultar"}),$utils.logarFim(t,((o=this.documentos)==null?void 0:o.length)||0)},limparFiltros_click(){this.filtros={tab:this.tabAtiva,empresa:{selecionada:"",opcoes:[]},periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},this.atualizar()},async showDetails(t){let o=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:t.id}});t.documentoItens=o,t.showPreviewDetail=!t.showPreviewDetail},async editarManipulacao(t){this.$router.replace({params:{id:t}}),await this.$refs.itensManipulacao.atualizar(t),this.$refs.itensManipulacao.visivel=!0},async adicionarManipulacaoItens(){await this.$refs.itensManipulacao.atualizar(),this.$refs.itensManipulacao.visivel=!0},async filtrar(t=1){this.buscaCampo="";const o=(t-1)*this.pageSize;this.documentos.status="digitacao";let r=await $db.itemManipulacao.le({periodoEmissao:{ini:this.filtro.periodoEmissao.ini,fim:this.filtro.periodoEmissao.fim},periodoFinalizado:{ini:this.filtro.periodoFinalizado.ini,fim:this.filtro.periodoFinalizado.fim},status:this.page.ativa,idEmpresa:this.filtro.empresas.selected,offset:o,limit:this.pageSize});this.documentos=r[0].map(a=>({...a,showPreviewDetail:!1,documentoItens:[]})),this.documentos=po.exports.orderBy(this.documentos,["dataHoraFinalizado","dataHoraEmissao"],["desc","desc"]);let d=r[1];this.page.digitacao.max=Math.ceil(d/this.pageSize),this.page.finalizado.max=Math.ceil(d/this.pageSize)},excluir(t){$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show(),await $db.itemManipulacao.remove(t),this.atualizar(),$q.notifyPositive("O item foi exclu\xEDdo com sucesso.")}catch(o){$q.notifyError("Ocorreu um erro ao remover item",o)}finally{$q.loading.hide()}})},async empresaOpcoesCarregar(){console.log("carregar empresas"),this.filtros.empresa.opcoes=(await $db.empresa.le()).map(t=>({rotulo:t.nome,valor:t.idContato}))},async configuraImpressao(t){const o=await $db.configuracoes.porNome("impressao.producao",t);this.configImpressao=[...o.length?o.map(r=>({texto:"Imprimir Composi\xE7\xE3o",...r})):[{valor:"Impressao-ordem-producao",texto:"Ordem de Produ\xE7\xE3o"},{valor:"impressao-etiqueta-pcp1",texto:"Etiq. 2 - Semi Acabado"},{valor:"impressao-etiqueta-pcp2",texto:"Etiq. 1 - Acabado"}]]},async calcularPorcentagem(t){for(let o=0;o<t.length;o++){let r=0,d=0,a=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:t[o].id}}),n=a.filter(({tipoItem:h})=>h==="ApontamentoPCP");a.forEach((h,b)=>{h?h.operacaoFator===1&&(r+=h.quantidade):r+=0}),n.forEach((h,b)=>{h?h.tipoItem==="ApontamentoPCP"&&(d+=h.quantidade):d+=0}),r===0?(t[o].porcentagemApontamento=0,t[o].porcentagemApontamentoLabel="0 %"):(t[o].porcentagemApontamento=d/r,t[o].porcentagemApontamentoLabel=`${Math.round(d/r*100)} %`)}}},created(){this.atualizar()},mounted(){this.$route.params.id&&this.$route.params.id.length&&(this.$refs.itensManipulacao.atualizar(this.$route.params.id),this.$refs.itensManipulacao.visivel=!0)}},vt={class:"row"},gt={class:"col-12 row q-mt-lg"},bt={class:"col-12"},yt={class:"col-12"},It={class:"col-12 row q-mt-lg"},_t={class:"col-12"},qt={class:"col-12"},wt={class:"col-12 row q-mt-lg"},xt={class:"row items-center"},Ct={key:0},kt={class:"absolute-full flex flex-center"},Et={class:"text-tertiary q-gutter-xs"};function zt(t,o,r,d,a,n){const h=z("campo"),b=z("badge"),k=z("BadgeCopiarUid"),q=z("lista"),p=z("ItensManipulacao");return u(),I("div",null,[e(q,{titulo:"Produ\xE7\xE3o (PCP)",onCriar_click:n.adicionarManipulacaoItens,showAdd:!1,showToolbar:!1,icone:"mdi-set-center-right",onFiltro_change:n.atualizar,onLimparFiltros_click:n.limparFiltros_click,tabSelecionada:a.tabSelecionada,tabs:a.tabs,listaLayout:a.listaLayout,paginacao:a.paginacao,filtros:a.filtros,buscaCampo:a.buscaCampo,"onUpdate:buscaCampo":o[7]||(o[7]=c=>a.buscaCampo=c),checkboxModel:a.checkboxModel,"onUpdate:checkboxModel":o[8]||(o[8]=c=>a.checkboxModel=c)},{filtroCampos:i(()=>[s("div",vt,[s("div",{class:"col-12",onClick:o[1]||(o[1]=(...c)=>n.empresaOpcoesCarregar&&n.empresaOpcoesCarregar(...c))},[e(h,{modelValue:a.filtros.empresa.selecionada,"onUpdate:modelValue":o[0]||(o[0]=c=>a.filtros.empresa.selecionada=c),opcoes:a.filtros.empresa.opcoes,rotulo:"Por Empresa",tipo:"seletor"},null,8,["modelValue","opcoes"])]),s("div",gt,[o[9]||(o[9]=s("strong",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Emiss\xE3o",-1)),s("div",bt,[e(h,{modelValue:a.filtros.periodoEmissao.ini,"onUpdate:modelValue":o[2]||(o[2]=c=>a.filtros.periodoEmissao.ini=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoEmissao.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),s("div",yt,[e(h,{modelValue:a.filtros.periodoEmissao.fim,"onUpdate:modelValue":o[3]||(o[3]=c=>a.filtros.periodoEmissao.fim=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoEmissao.fim=""}}],class:"no-shadow full-width",rotulo:"at\xE9",tipo:"data"},null,8,["modelValue","after"])])]),s("div",It,[o[10]||(o[10]=s("strong",{class:"col-12 text-body1 text-dark"},"Per\xEDodo de Finaliza\xE7\xE3o",-1)),s("div",_t,[e(h,{modelValue:a.filtros.periodoFinalizado.ini,"onUpdate:modelValue":o[4]||(o[4]=c=>a.filtros.periodoFinalizado.ini=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoFinalizado.ini=""}}],class:"no-shadow full-width",rotulo:"De",tipo:"data"},null,8,["modelValue","after"])]),s("div",qt,[e(h,{modelValue:a.filtros.periodoFinalizado.fim,"onUpdate:modelValue":o[5]||(o[5]=c=>a.filtros.periodoFinalizado.fim=c),after:[{icon:"mdi-close-circle",handler(){a.filtros.periodoFinalizado.fim=""}}],class:"no-shadow full-width",rotulo:"at\xE9",tipo:"data"},null,8,["modelValue","after"])])]),s("div",wt,[e(fo,{modelValue:a.paginacao.limite,"onUpdate:modelValue":o[6]||(o[6]=c=>a.paginacao.limite=c),options:[10,25,50,100],placeholder:"Quantidade por p\xE1gina"},null,8,["modelValue"])])])]),itemLista:i(()=>[e(R,{bordered:"",class:"bg-white q-mb-xs rounded-borders qListaItems"},{default:i(()=>[(u(!0),I(O,null,T(a.documentos,c=>(u(),I("div",{key:c.id,class:"itemHover"},[e(F,{"manual-focus":"",class:"q-py-sm q-px-xs items-center d-flex"},{default:i(()=>[e(_,{avatar:"",center:""},{default:i(()=>[s("div",xt,[c.numero?(u(),y(b,{key:0,class:"q-mr-sm",cor:"tertiary",escuro:""},{default:i(()=>[f(" #"+m(c.numero.toString().padStart(6,"0")),1)]),_:2},1024)):(u(),y(k,{key:1,id:c.id,numero:c.id.slice(-8),cor:"tertiary"},null,8,["id","numero"]))])]),_:2},1024),e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[f(m(c.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024),e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[f(m(c.descricaoContato),1)]),_:2},1024)]),_:2},1024),e(_,{caption:""},{default:i(()=>[e(C,null,{default:i(()=>[e(U,{class:"text-tertiary",name:"event"}),f(" "+m(t.$filters.data(c.dataHoraEmissao)),1)]),_:2},1024),e(V,null,{default:i(()=>[f("Data Emiss\xE3o "+m(t.$filters.dataHora(c.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024),a.tabSelecionada.valor!=="digitacao"?(u(),y(_,{key:0,caption:""},{default:i(()=>[e(C,null,{default:i(()=>[e(U,{class:"text-tertiary",name:"event"}),f(" "+m(t.$filters.data(c.dataHoraFinalizado)),1)]),_:2},1024),e(V,null,{default:i(()=>[f("Data Finalizado "+m(t.$filters.dataHora(c.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):g("",!0),e(_,{caption:""},{default:i(()=>[c.porcentagemApontamento>0?(u(),I("div",Ct,[e(C,null,{default:i(()=>[e(ho,{stripe:"",rounded:"",size:"20px",value:c.porcentagemApontamento,color:"secondary",class:"q-mt-sm"},{default:i(()=>[s("div",kt,[e(vo,{color:"white","text-color":"secondary",label:c.porcentagemApontamentoLabel},null,8,["label"])])]),_:2},1032,["value"])]),_:2},1024),e(V,null,{default:i(()=>[f(m(c.porcentagemApontamentoLabel)+" Conclu\xEDda ",1)]),_:2},1024)])):g("",!0)]),_:2},1024),e(_,{avatar:""},{default:i(()=>[e(b,{class:"q-mr-sm",cor:"warning",escuro:""},{default:i(()=>[f(m(c.status),1)]),_:2},1024)]),_:2},1024),e(_,{avatar:""},{default:i(()=>[e(b,{class:"q-mr-sm",cor:"primary",escuro:""},{default:i(()=>[f(m(c.operacao),1)]),_:2},1024)]),_:2},1024),e(_,{side:"",top:""},{default:i(()=>[s("div",Et,[e(x,{icon:c.showPreviewDetail?"keyboard_arrow_up":"keyboard_arrow_down",class:"buttons",color:"tertiary",dense:"",flat:"",round:"",size:"md",onClick:v=>n.showDetails(c)},null,8,["icon","onClick"]),e(x,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-mx-xs",size:"md",style:{float:"right"}},{default:i(()=>[e(go,null,{default:i(()=>[e(R,{link:"",separator:""},{default:i(()=>[(u(!0),I(O,null,T(a.configImpressao.filter(v=>v.valor),v=>(u(),y(F,{clickable:"",key:v.valor,onClick:M=>t.$imprimir(v.valor,(c||{}).id||"0")},{default:i(()=>[e(_,{avatar:""},{default:i(()=>[e(U,{name:"print"})]),_:1}),e(_,null,{default:i(()=>[e(C,null,{default:i(()=>[f(m(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(x,{class:"buttons",color:"primary",dense:"",flat:"",icon:"edit",round:"",size:"md",onClick:v=>n.editarManipulacao(c.id)},null,8,["onClick"]),a.tabSelecionada.valor==="digitacao"?(u(),y(x,{key:0,class:"buttons",color:"tertiary",dense:"",flat:"",icon:"delete",round:"",size:"md",onClick:v=>n.excluir(c.id)},null,8,["onClick"])):g("",!0)])]),_:2},1024)]),_:2},1024),c.showPreviewDetail?(u(),y(F,{key:0,class:"q-pa-sm"},{default:i(()=>[e(_,null,{default:i(()=>[o[11]||(o[11]=f(" Origem ")),(u(!0),I(O,null,T(c.documentoItens,v=>(u(),I("div",{key:v.id},[v.operacaoFator===-1?(u(),y(_,{key:0,stamp:""},{default:i(()=>[f(m(v.quantidade)+" "+m(v.unidade)+" - "+m(v.descricaoItem),1)]),_:2},1024)):g("",!0)]))),128))]),_:2},1024),e(C,null,{default:i(()=>[o[12]||(o[12]=f(" Destino ")),(u(!0),I(O,null,T(c.documentoItens,v=>(u(),I("div",{key:v.id},[v.operacaoFator===1?(u(),y(_,{key:0,stamp:""},{default:i(()=>[f(m(v.quantidade)+" "+m(v.unidade)+" - "+m(v.descricaoItem),1)]),_:2},1024)):g("",!0)]))),128))]),_:2},1024)]),_:2},1024)):g("",!0),e(H)]))),128))]),_:1})]),_:1},8,["onCriar_click","onFiltro_change","onLimparFiltros_click","tabSelecionada","tabs","listaLayout","paginacao","filtros","buscaCampo","checkboxModel"]),e(p,{ref:"itensManipulacao",onAtualizar:n.atualizar},null,8,["onAtualizar"])])}var Mt=J(ht,[["render",zt]]);export{Mt as default};
