import{_ as G,bp as X,cb as T,cc as z,cd as A,cf as D,p as b,o as u,i as p,w as o,f as e,K as Z,A as W,B as M,D as g,E as N,e as n,G as Y,H as $,t as V,d as S,l as v,F as B,az as J,N as L,r as O,P as w,R as h,S as F,x as E,k as _,a4 as K,I as ee,y as oe,j as P,a6 as U,b1 as j,C as R,bw as te,b0 as ae,L as le}from"./index.20d4d726.js";import{L as ie}from"./Lista.bd8bcfbd.js";import{P as re}from"./PromptContatoV2.ed3407af.js";import"./QBtnDropdown.5eaf2dec.js";import"./QBtnGroup.bac59a4f.js";import"./QDate.d9b0668c.js";import"./xlsx.699bbdd2.js";const se={components:{PromptItemV2:X,PromptContatoV2:re},data(){return{visivel:!1,cliente:{},emitente:{},diaVencimento:"",documentoAnterior:{},documento:{id:T(),dataHoraEmissao:z(),numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",numeroVolumeTransporte:"",status:"Ativo",tipo:"Contrato"},documentoItens:[],documentoItensAnterior:[],totalItens:0,itensModal:!1,contatosModal:!1,emitenteModal:!1,empresas:[],configImpressaoContrato:[]}},emits:["atualizar"],methods:{async atualizar(a){if($q.loading.show(),a=a||this.$route.params.id,a)this.documentoAnterior=await $db.hibrido.le({table:"documento",id:a}),this.documento=A(this.documentoAnterior),this.documentoItensAnterior=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:a}}),this.documentoItens=A(this.documentoItensAnterior),this.cliente.id=this.documento.idContato,this.cliente.nome=this.documento.descricaoContato,this.emitente.id=this.documento.idEmpresa,this.emitente.nome=this.documento.descricaoEmpresa,this.diaVencimento=this.documento.numeroVolumeTransporte;else{this.limparCampos(),this.documento.id=T(),this.documento.dataHoraEmissao=z(),this.documento.status="Ativo",this.documento.tipo="Contrato";const l=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione"});this.emitente=A(l),this.documento.idEmpresa=this.emitente.id,this.documento.descricaoEmpresa=this.emitente.nome}this.empresas=await $db.hibrido.lista({table:"empresa"}),this.somarValorTotal(),this.configuraImpressaoContrato(this.documento.idEmpresa),$q.loading.hide()},fechar(){this.$router.replace({params:{id:""}}),this.limparCampos(),this.visivel=!1},limparCampos(){this.documentoAnterior={},this.documento={id:"",dataHoraEmissao:null,numero:"",descricaoContato:"",idContato:"",descricaoEmpresa:"",idEmpresa:"",numeroVolumeTransporte:"",status:"",tipo:""},this.documentoItensAnterior=[],this.documentoItens=[],this.cliente.id="",this.cliente.nome="",this.emitente.id="",this.emitente.nome="",this.diaVencimento=""},async configuraImpressaoContrato(a){const l=await $db.configuracoes.porNome("impressao.contrato",a);this.configImpressaoContrato=l},async abrirModal(a=""){let l={},c=[];a?c=this.documentoItens.filter(m=>m.idItem===a):c=this.documentoItens;for(const m of c)l[m.idItem]={item:await $db.hibrido.le({table:"item",id:m.idItem}),quantidade:m.quantidade};this.$refs.promptItem.itensSelecionados=l,this.$refs.promptItem.termo=a,this.$refs.promptItem.atualizar(),this.itensModal=!0},recalcularTotal(a){a.subTotal=D(a.quantidade*a.valorItem),a.total=D(a.quantidade*a.valorItem),this.somarValorTotal()},aoSelecionarCliente(a,l){},async selecionarCliente(){if(this.documento.status!=="Cancelado"){const a=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione"});this.cliente=A(a),this.contatosModal=!1,this.documento.idContato=this.cliente.id,this.documento.descricaoContato=this.cliente.nome}},async selecionarEmitente(a,l){if(!a){this.emitenteModal=!1;return}this.emitente=A(l),this.emitenteModal=!1,this.documento.idEmpresa=this.emitente.id,this.documento.descricaoEmpresa=this.emitente.nome},aoSelecionarVencimento(){this.documento.numeroVolumeTransporte=this.diaVencimento},selecionarItens:function(a){for(const l in a){const c=a[l].item||{},m=a[l].quantidade||0;let t=this.documentoItens.find(s=>s.idItem===l);t?(t.quantidade=m,t.quantidadeRealizado=m,t.total=D(m*c.valorVenda)):this.documentoItens.push({dataHoraEmissao:z(),descricaoItem:c.descricao,id:T(),idDocumento:this.documento.id,idItem:c.id,operacao:"-",quantidade:m,unidade:c.unidade,quantidadeRealizado:m,tipoItem:c.tipo,total:D(m*c.valorVenda),valorItem:c.valorVenda})}this.somarValorTotal()},somarValorTotal(){this.totalItens=this.documentoItens.reduce((a,l)=>a+=l.total,0)},excluirItem(a){this.documentoItens=this.documentoItens.filter(l=>l.id!==a),this.somarValorTotal()},validaDia(){if(this.diaVencimento<1||this.diaVencimento>28){this.$q.notifyAlert("O dia deve ser um valor entre 1 e 28"),this.diaVencimento="";return}this.aoSelecionarVencimento()},async gravar(a=!1){if(!this.cliente.id){this.$q.notifyAlert("Selecione um Cliente");return}if(!this.emitente.id){this.$q.notifyAlert("Selecione um Emitente");return}if(!this.diaVencimento){this.$q.notifyAlert("Selecione um dia de Vencimento");return}if(!this.totalItens){this.$q.notifyAlert("Adicione alguns itens ao contrato");return}try{await $db.contrato.grava({documentoAnterior:this.documentoAnterior,documento:this.documento,documentoItensAnterior:this.documentoItensAnterior,documentoItens:this.documentoItens}),this.visivel=a,this.atualizar(this.documento.id),this.$emit("atualizar")}catch(l){this.$q.notifyError("Erro ao salvar",l)}},cancelar(){this.documento.status="Cancelado",this.documento.dataHoraFinalizado=z(),this.gravar(!0),$q.notifyPositive("Contrato Cancelado")},ativar(){this.documento.status="Ativo",this.documento.dataHoraFinalizado="",this.gravar(!0),$q.notifyPositive("Contrato Reativado")}}},ne={key:0},de={ref:"form"},ue={class:"u-container"};function ce(a,l,c,m,t,s){const x=b("badge"),y=b("BadgeCopiarUid"),I=b("avatar"),r=b("g-col"),k=b("campo"),f=b("g-row"),i=b("g-label"),C=b("PromptItemV2"),Q=b("PromptContatoV2");return u(),p(oe,{modelValue:t.visivel,"onUpdate:modelValue":l[11]||(l[11]=d=>t.visivel=d),maximized:"",onHide:l[12]||(l[12]=d=>s.fechar())},{default:o(()=>[e(Z,{view:"hHh LpR fFf",container:"",class:"bg-light"},{default:o(()=>[e(W,null,{default:o(()=>[e(M,null,{default:o(()=>[e(g,{onClick:l[0]||(l[0]=d=>s.fechar()),icon:"arrow_back",round:"",dense:"",flat:""}),e(N,null,{default:o(()=>[n("Contrato")]),_:1}),e(g,{onClick:l[1]||(l[1]=d=>s.gravar(!1)),label:"Salvar",color:"white","text-color":"primary",unelevated:""})]),_:1})]),_:1}),e(Y,{class:"u-container"},{default:o(()=>[e($,null,{default:o(()=>[e(M,{color:"transparent",class:"q-my-md"},{default:o(()=>[e(N,{class:"text-body2"},{default:o(()=>[n(" Emiss\xE3o: "+V(a.$filters.data(t.documento.dataHoraEmissao))+" ",1),t.documento.dataHoraFinalizado?(u(),S("span",ne,", Cancelamento: "+V(a.$filters.data(t.documento.dataHoraFinalizado)),1)):v("",!0)]),_:1}),t.documento.status?(u(),p(x,{key:0,rotulo:t.documento.status,escuro:"",dica:"Status",class:"q-ml-sm",cor:t.documento.status==="Ativo"?"primary":"tertiary"},null,8,["rotulo","cor"])):v("",!0),t.documento.numero?(u(),p(y,{key:1,id:t.documento.id,numero:t.documento.numero,cor:t.documento.status==="Ativo"?"positive":"tertiary",dica:"C\xF3digo: "+t.documento.codigoDocumento,class:"q-ml-sm"},null,8,["id","numero","cor","dica"])):v("",!0),t.documento.numero?(u(),S(B,{key:2},[t.configImpressaoContrato.length>1?(u(),p(g,{key:0,icon:"print",color:"primary",round:"",dense:"",flat:"",class:"q-ml-xs"},{default:o(()=>[e(J,{self:"top middle",anchor:"bottom middle"},{default:o(()=>[e(L,{link:"",separator:""},{default:o(()=>[(u(!0),S(B,null,O(t.configImpressaoContrato.filter(d=>d.valor),d=>(u(),p(w,{key:d.valor,onClick:H=>a.$imprimir(d.valor,{id:(t.documento||{}).id||"0",Oculto:"0"})},{default:o(()=>[e(h,{icon:"print"}),e(F,{label:d.texto},null,8,["label"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})):(u(),p(g,{key:1,icon:"print",color:"primary",round:"",dense:"",flat:"",class:"q-ml-xs",onClick:l[2]||(l[2]=d=>a.$imprimir(t.configImpressaoContrato[0].valor,{id:(t.documento||{}).id||"0",Oculto:"0"}))}))],64)):v("",!0)]),_:1}),E("form",de,[e(f,{gutter:"md",mg:"md-y",bg:"bg-white","rounded-borders":""},{default:o(()=>[e(r,{col:"12 sm"},{default:o(()=>[e(f,null,{default:o(()=>[e(r,{col:"shrink"},{default:o(()=>[e(I,{imagem:t.emitente.imagem,rotulo:t.emitente.nome,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"])]),_:1}),e(r,{col:"grow"},{default:o(()=>[e(k,{modelValue:t.emitente.nome,"onUpdate:modelValue":l[3]||(l[3]=d=>t.emitente.nome=d),rotulo:"Emitente",tipo:"texto",disable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{col:"12 sm"},{default:o(()=>[e(f,null,{default:o(()=>[e(r,{col:"shrink"},{default:o(()=>[e(I,{imagem:t.cliente.imagem,rotulo:t.cliente.nome,tamanho:"30",style:{float:"left"}},null,8,["imagem","rotulo"])]),_:1}),e(r,{col:"grow"},{default:o(()=>[e(k,{modelValue:t.cliente.nome,"onUpdate:modelValue":[l[4]||(l[4]=d=>t.cliente.nome=d),s.aoSelecionarCliente],onClick:s.selecionarCliente,after:[{icon:"edit",handler(){s.selecionarCliente()}}],somenteLeitura:t.documento.status==="Cancelado",placeholder:"Cliente",rotulo:"Cliente",tipo:"texto"},null,8,["modelValue","onUpdate:modelValue","onClick","after","somenteLeitura"])]),_:1})]),_:1})]),_:1}),e(r,{col:"12 sm"},{default:o(()=>[e(k,{modelValue:t.diaVencimento,"onUpdate:modelValue":l[5]||(l[5]=d=>t.diaVencimento=d),onBlur:s.validaDia,opcoes:{minimumValue:1,maximumValue:28},error:t.diaVencimento>28||t.diaVencimento<1,rotulo:"Dia de Vencimento",tipo:"numero",errorMessage:"Dia entre 1 e 28",placeholder:"Dia Vencimento"},null,8,["modelValue","onBlur","error"])]),_:1})]),_:1})],512),e(f,{gutter:"md",mg:"md-y",bg:"bg-white","rounded-borders":""},{default:o(()=>[e(r,{col:"grow"},{default:o(()=>[e(i,{icon:"shopping_cart sm tertiary left"},{default:o(()=>[n("Produtos e Servi\xE7os")]),_:1})]),_:1}),e(r,{col:"shrink"},{default:o(()=>[t.documento.status!=="Cancelado"?(u(),p(g,{key:0,onClick:l[6]||(l[6]=d=>s.abrirModal()),icon:"add",size:"md",color:"positive",round:"",dense:"",flat:""},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Adicionar Item")]),_:1})]),_:1})):v("",!0)]),_:1}),e(r,{col:"12"},{default:o(()=>[e(L,null,{default:o(()=>[e(f,{class:"hideonmobile",justify:"around",text:"bold"},{default:o(()=>[e(r,{col:"2 md"},{default:o(()=>[n("C\xF3digo")]),_:1}),e(r,{col:"10 md4 "},{default:o(()=>[n("Descri\xE7\xE3o")]),_:1}),e(r,{col:"6 md",text:"right"},{default:o(()=>[n("Quantidade")]),_:1}),e(r,{col:"6 md",text:"right"},{default:o(()=>[n("Valor")]),_:1}),e(r,{col:"6 md",text:"right"},{default:o(()=>[n("Total")]),_:1}),e(r,{col:"6 md1",text:"center"},{default:o(()=>[n("A\xE7\xF5es")]),_:1})]),_:1}),e(K,{class:"q-mt-xs q-mb-sm"}),(u(!0),S(B,null,O(t.documentoItens,(d,H)=>(u(),p(f,{key:H,items:"center",justify:"center",bordered:"bottom"},{default:o(()=>[e(r,{col:"grow md",order:"xs0 sm0"},{default:o(()=>[e(f,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[n(" C\xF3d.: ")]),_:1}),e(r,{col:"grow"},{default:o(()=>[n(V(d.codigoItem||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md4",order:"xs2 sm1"},{default:o(()=>[e(f,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[n(" Desc.: ")]),_:1}),e(r,{col:"grow"},{default:o(()=>[n(V(d.descricaoItem||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md",order:"xs3 sm2"},{default:o(()=>[e(f,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[e(i,{class:"q-mr-xs"},{default:o(()=>[n("Qtd.:")]),_:1})]),_:1}),e(r,{col:"grow sm10",text:"right"},{default:o(()=>[e(k,{modelValue:d.quantidade,"onUpdate:modelValue":q=>d.quantidade=q,onBlur:q=>s.recalcularTotal(d),tipo:"decimal",decimals:"4",filled:""},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024),e(r,{col:"2",text:"center"},{default:o(()=>[e(i,null,{default:o(()=>[n(V(d.unidade||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md",order:"xs4 sm3"},{default:o(()=>[e(f,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[n(" Valor: ")]),_:1}),e(r,{col:"grow",text:"right"},{default:o(()=>[e(k,{modelValue:d.valorItem,"onUpdate:modelValue":q=>d.valorItem=q,onBlur:q=>s.recalcularTotal(d),tipo:"decimal",decimals:"4",filled:""},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"12 md",order:"xs5 sm4"},{default:o(()=>[e(f,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"2",text:"left",class:"hideondesktop"},{default:o(()=>[n(" Total: ")]),_:1}),e(r,{col:"grow",text:"right"},{default:o(()=>[n(V(a.$filters.numero(d.total,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(r,{col:"shrink md1",order:"xs1 sm5",text:"center"},{default:o(()=>[e(g,{onClick:q=>s.abrirModal(d.idItem),icon:"edit",round:"",dense:"",flat:""},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Editar")]),_:1})]),_:2},1032,["onClick"]),e(g,{onClick:q=>s.excluirItem(d.id),icon:"delete",round:"",dense:"",flat:""},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Excluir")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(f,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"grow md"},{default:o(()=>[n("\xA0")]),_:1}),e(r,{col:"10 md4"},{default:o(()=>[n("\xA0")]),_:1}),e(r,{col:"12 md",text:"right"},{default:o(()=>[n("\xA0")]),_:1}),e(r,{col:"12 md",text:"right"},{default:o(()=>[n("\xA0")]),_:1}),e(r,{col:"12 md",text:"right"},{default:o(()=>[n(V(a.$filters.numero(t.totalItens,2)),1)]),_:1}),e(r,{col:"12 md1",text:"right"},{default:o(()=>[n("\xA0")]),_:1})]),_:1}),e(f,{items:"center",justify:"center"},{default:o(()=>[e(r,{col:"12",text:"center"},{default:o(()=>[e(g,{onClick:l[7]||(l[7]=d=>s.abrirModal()),label:"Adicionar item",icon:"add",size:"xs",color:"positive",outline:"",class:"q-mx-auto"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{modelValue:t.itensModal,"onUpdate:modelValue":l[8]||(l[8]=d=>t.itensModal=d),onSelecionarItens:s.selecionarItens,filtro:{ativo:!0,idEmpresa:t.documento.idEmpresa},habilitarQuantidade:!0,ref:"promptItem"},null,8,["modelValue","onSelecionarItens","filtro"]),e(Q,{modelValue:t.contatosModal,"onUpdate:modelValue":l[9]||(l[9]=d=>t.contatosModal=d),onSelecionar:s.aoSelecionarCliente,filtro:{ativo:!0},placeholder:"Seleciona o Cliente"},null,8,["modelValue","onSelecionar"]),e(Q,{modelValue:t.emitenteModal,"onUpdate:modelValue":l[10]||(l[10]=d=>t.emitenteModal=d),onSelecionar:s.selecionarEmitente,filtro:{ativo:!0,empresas:!0},placeholder:"Seleciona a empresa emitente"},null,8,["modelValue","onSelecionar"])]),_:1})]),_:1}),e(ee,{class:"q-pa-sm bg-white text-right",bordered:""},{default:o(()=>[E("div",ue,[t.documento.status==="Cancelado"?(u(),p(g,{key:0,onClick:s.ativar,label:"Ativar",color:"primary",unelevated:""},null,8,["onClick"])):v("",!0),t.documento.status==="Ativo"?(u(),p(g,{key:1,onClick:s.cancelar,label:"Cancelar",color:"negative",flat:""},null,8,["onClick"])):v("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var me=G(se,[["render",ce]]);const fe={components:{lista:ie,contrato:me},data(){return{lista:[],listaOriginal:[],listaLayout:{},mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"gavel",titulo:"Contratos",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!0,btnRemover:!0,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!0,toolbarAdicao:!1,bannerMsg:""},tabSelecionada:{valor:"Ativos"},tabs:[{valor:"Ativo",rotulo:"Ativos"},{valor:"Suspenso",rotulo:"Suspensos"},{valor:"Cancelado",rotulo:"Cancelados"},{valor:"Todos",rotulo:"Todos"}],filtros:{status:"Ativo",termoBusca:"",empresa:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},busca:"",checkBox:!1,empresa:"",empresaOpcoes:[],sort:{label:"N\xFAmero Contrato",value:"numero"},sortOpcoes:[{label:"N\xFAmero Contrato",value:"numero"},{label:"C\xF3digo Documento",value:"codigoDocumento"},{label:"Data emiss\xE3o",value:"dataHoraEmissao"},{label:"Data finaliza\xE7\xE3o",value:"codigoDocumento"}],order:{label:"Decrescente",value:"desc"},orderOpcoes:[{label:"Crescente",value:"asc"},{label:"Decrescente",value:"desc"}],paginacao:{atual:1,minimo:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(){var l;const a=$utils.logarIni("ContratosLista");await $tryLoading(async()=>{var I,r,k;let c=this.filtros;const m=this.paginacao.limite,t=this.paginacao.atual,s=[this.sort.value],x=[this.order.value];delete c.status,((I=this.tabSelecionada)==null?void 0:I.valor)!="Todos"&&(c.status=((r=this.tabSelecionada)==null?void 0:r.valor)||"Ativo"),c.empresa=((k=this.empresa)==null?void 0:k.value)||"",c.termoBusca=this.busca||"",c=$utils.eliminarVazios(c);let y={data:[],totalPages:0,total:0};y=await $db.contrato.leListaCompleta({filtros:c,limit:m,page:t,sort:s,order:x});for(let f of y.data)$db.hibrido.isOnline()||(f.documentoItens=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:f.id}})),f.totalContrato=$utils.somar(f.documentoItens,"total"),this.listaLayout[f.id]={detalhes:!1,remover:!1};this.listaOriginal=A(y.data),this.lista=y.data,this.paginacao.total=y.total,this.paginacao.maximo=y.totalPages,this.storage()}),$utils.logarFim(a,((l=this.paginacao)==null?void 0:l.total)||1)},async gerarLoteNFSe(){await this.$q.dialog({title:"Gerar lote de NFS-e",message:"Deseja gerar as notas de servi\xE7o a partir dos contratos?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async()=>{const a=$utils.logarIni("ContratosLista");await $tryLoading(async()=>{await $db.contrato.gerarNFSEapartirContrato(),$q.notifyPositive("Exporta\xE7\xE3o das notas finalizada.")},{mensagem:"Exportando Contratos para NFSe...",erro:"Ocorreu um erro ao exportar contratos"}),$utils.logarFim(a,1)}).onCancel(()=>{}).onDismiss(()=>{})},async criarClick(){await this.$refs.contrato.atualizar(),this.$refs.contrato.visivel=!0},async abrirItem(a){this.$router.replace({params:{id:a}}),await this.$refs.contrato.atualizar(a),this.$refs.contrato.visivel=!0},checkBoxClick(){for(let a of this.lista)this.listaLayout[a.id].remover=this.checkBox},async removerItem(a){$q.dialog({title:"Remover",message:"Ao continuar voc\xEA ir\xE1 remover este item.",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show(),await $db.contrato.remove(a.id),this.atualizar(),$q.notifyPositive("O contrato foi exclu\xEDdo com sucesso.")}catch(l){$q.notifyError("Ocorreu um erro ao remover contrato.",l)}finally{$q.loading.hide()}})},async removerTodos(){$q.dialog({title:"Remover contratos",message:"Deseja remover todos os contratos selecionados?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{$q.loading.show();for(let a of this.lista)if(this.listaLayout[a.id].remover)try{await $db.contrato.remove(a.id)}catch{$q.notify("Ocorreu um erro ao remover os contratos selecionados. Tente novamente.")}this.atualizar(),$q.notifyPositive("Os contratos foram removidos com sucesso.")}catch(a){$q.notifyError("Ocorreu um erro ao remover todos os contratos selecionados.",a)}finally{$q.loading.hide()}})},limparFiltrosClick(){this.empresa="",this.sort={label:"N\xFAmero Contrato",value:"numero"},this.order={label:"Decrescente",value:"desc"},this.filtros={status:"Ativo",termoBusca:"",empresa:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""}},this.atualizar()},storage(){const a={busca:this.busca||"",empresa:this.empresa||"",filtros:this.filtros||{},sort:this.sort||{},order:this.order||{},tabSelecionada:this.tabSelecionada||{valor:"Ativo"}};localStorage.setItem("storageContratosLista",JSON.stringify(a))}},computed:{storageTabSelecionada(){return this.storage(),this.tabSelecionada}},async mounted(){var l,c;if($db.hibrido.isOnline()){const m=(await $db.hibrido.lista({table:"empresa",where:{ativo:!0}})).map(t=>(t.ordenar=this.$utils.removerCaracteresEspeciais(t.apelido),t)).sort((t,s)=>t.ordenar>s.ordenar?1:s.ordenar>t.ordenar?-1:0);for(const t of m)this.empresaOpcoes.push({label:t.apelido,value:t.idContato})}else{const m=(await $erp().empresa.toArray()).filter(t=>t.ativo===!0).map(t=>(t.ordenar=this.$utils.removerCaracteresEspeciais(t.apelido),t)).sort((t,s)=>t.ordenar>s.ordenar?1:s.ordenar>t.ordenar?-1:0);for(const t of m)this.empresaOpcoes.push({label:t.apelido,value:t.idContato})}const a=JSON.parse(localStorage.getItem("storageContratosLista"));if(a){const m=$utils.diferencaObjetos(a==null?void 0:a.filtros,this.filtros);Object.keys(m).filter(t=>t!=="status").length>0&&(this.$refs.lista.showFilters=!0),this.busca=(a==null?void 0:a.busca)||"",this.empresa=(a==null?void 0:a.empresa)||"",this.filtros=a==null?void 0:a.filtros,this.filtros.termoBusca=(a==null?void 0:a.busca)||"",this.filtros.empresa=(a==null?void 0:a.empresa.value)||"",this.sort=a==null?void 0:a.sort,this.order=a==null?void 0:a.order,this.tabSelecionada=(a==null?void 0:a.tabSelecionada)||{valor:"Ativo"},((l=a==null?void 0:a.tabSelecionada)==null?void 0:l.valor)!="Todos"&&(this.filtros.status=((c=a==null?void 0:a.tabSelecionada)==null?void 0:c.valor)||"Ativo")}this.atualizar(),this.$route.params.id&&this.$route.params.id.length&&this.abrirItem(this.$route.params.id)}},pe={class:"mw80 text-center"},he={class:"q-mt-sm"};function be(a,l,c,m,t,s){const x=b("campo"),y=b("BadgeCopiarUid"),I=b("avatar"),r=b("badge"),k=b("lista",!0),f=b("contrato");return u(),S("div",null,[e(k,{ref:"lista",busca:t.busca,"onUpdate:busca":l[9]||(l[9]=i=>t.busca=i),checkBox:t.checkBox,"onUpdate:checkBox":l[10]||(l[10]=i=>t.checkBox=i),onAtualizar:s.atualizar,onCriarClick:s.criarClick,onRemoverClick:s.removerTodos,onCheckBoxClick:s.checkBoxClick,onLimparFiltrosClick:s.limparFiltrosClick,lista:t.lista,tabs:t.tabs,tabSelecionada:t.tabSelecionada,paginacao:t.paginacao,mostrar:t.mostrar},{menuExtras:o(()=>[e(w,{onClick:l[0]||(l[0]=i=>s.gerarLoteNFSe()),clickable:""},{default:o(()=>[e(h,{avatar:""},{default:o(()=>[e(P,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(h,null,{default:o(()=>[n("Gerar notas de servi\xE7o")]),_:1})]),_:1})]),filtroCampos:o(()=>[e(U,{modelValue:t.empresa,"onUpdate:modelValue":l[1]||(l[1]=i=>t.empresa=i),options:t.empresaOpcoes,clearable:"",dense:"",label:"Por empresa",class:"q-mb-xl"},null,8,["modelValue","options"]),e(x,{modelValue:t.filtros.periodoEmissao.ini,"onUpdate:modelValue":l[2]||(l[2]=i=>t.filtros.periodoEmissao.ini=i),rotulo:"Data emiss\xE3o",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),e(x,{modelValue:t.filtros.periodoEmissao.fim,"onUpdate:modelValue":l[3]||(l[3]=i=>t.filtros.periodoEmissao.fim=i),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),e(x,{modelValue:t.filtros.periodoFinalizado.ini,"onUpdate:modelValue":l[4]||(l[4]=i=>t.filtros.periodoFinalizado.ini=i),rotulo:"Data finalizado",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),e(x,{modelValue:t.filtros.periodoFinalizado.fim,"onUpdate:modelValue":l[5]||(l[5]=i=>t.filtros.periodoFinalizado.fim=i),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),e(U,{modelValue:t.sort,"onUpdate:modelValue":l[6]||(l[6]=i=>t.sort=i),options:t.sortOpcoes,dense:"",label:"Ordenar por",class:"q-mb-xs"},null,8,["modelValue","options"]),e(U,{modelValue:t.order,"onUpdate:modelValue":l[7]||(l[7]=i=>t.order=i),options:t.orderOpcoes,dense:"",label:"Crescente/Decrescente",class:"q-mb-xl"},null,8,["modelValue","options"]),e(x,{modelValue:t.paginacao.limite,"onUpdate:modelValue":l[8]||(l[8]=i=>t.paginacao.limite=i),rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",min:"1",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:o(()=>[e(L,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:o(()=>[(u(!0),S(B,null,O(t.lista,i=>(u(),S("div",{key:i.id,class:"itemHover"},[e(w,{class:"items-center d-flex q-pa-xs",clickable:""},{default:o(()=>[e(h,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:o(()=>[e(w,{class:"q-pa-none"},{default:o(()=>[e(h,{side:"",class:"col-auto q-pa-none"},{default:o(()=>[e(j,{modelValue:t.listaLayout[i.id].remover,"onUpdate:modelValue":C=>t.listaLayout[i.id].remover=C},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(h,{side:"",class:"col-auto q-pa-none"},{default:o(()=>[E("div",pe,[e(y,{id:i.id,numero:i.numero,cor:i.status==="Ativo"?"positive":"tertiary",class:"q-mr-sm hideonmobile"},null,8,["id","numero","cor"])])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(h,{class:"col no-margin"},{default:o(()=>[e(w,{class:"q-pa-none"},{default:o(()=>[e(h,{onClick:C=>s.abrirItem(i.id),class:"col-auto items-center"},{default:o(()=>[e(I,{rotulo:i.descricaoContato,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["rotulo"]),e(j,{modelValue:t.listaLayout[i.id].remover,"onUpdate:modelValue":C=>t.listaLayout[i.id].remover=C,class:"hideondesktop q-mt-md"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onClick"]),e(h,{onClick:C=>s.abrirItem(i.id),class:"col"},{default:o(()=>[i.descricaoContato?(u(),p(F,{key:0,lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:o(()=>[n(V(i.descricaoContato)+" ",1),e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Descri\xE7\xE3o")]),_:1})]),_:2},1024)):v("",!0),i.codigoDocumento?(u(),p(F,{key:1,caption:"",lines:"1",class:"text-tertiary ellipsis hideonmobile"},{default:o(()=>[e(r,{rotulo:"#"+i.codigoDocumento,cor:"light",class:"q-mr-xs"},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("C\xF3digo Documento")]),_:1})]),_:2},1032,["rotulo"])]),_:2},1024)):v("",!0),e(h,{class:"hideondesktop q-mt-sm"},{default:o(()=>[E("div",null,[e(y,{id:i.id,numero:i.numero,cor:i.status==="Ativo"?"positive":"tertiary",class:"q-mr-sm"},null,8,["id","numero","cor"]),e(r,{rotulo:"#"+i.codigoDocumento,cor:"light",class:"q-mr-sm"},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("C\xF3digo Documento")]),_:1})]),_:2},1032,["rotulo"])]),E("div",he,[i.dataHoraEmissao?(u(),p(r,{key:0,rotulo:a.$filters.data(i.dataHoraEmissao),escuro:"",icone:"today",cor:"tertiary",class:"q-mr-xs"},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Data Emiss\xE3o")]),_:1})]),_:2},1032,["rotulo"])):v("",!0),i.dataHoraFinalizado?(u(),p(r,{key:1,rotulo:a.$filters.data(i.dataHoraFinalizado),escuro:"",icone:"today",cor:"tertiary"},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Data Finaliza\xE7\xE3o")]),_:1})]),_:2},1032,["rotulo"])):v("",!0)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),R(e(h,{onClick:C=>s.abrirItem(i.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:o(()=>[i.status?(u(),p(te,{key:0,class:"col-auto q-mx-auto q-py-xs",color:i.status==="Ativo"?"primary":"tertiary"},{default:o(()=>[n(V(i.status)+" ",1),e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Status")]),_:1})]),_:2},1032,["color"])):v("",!0)]),_:2},1032,["onClick"]),[[ae,t.tabSelecionada.valor!="Ativos"&&t.tabSelecionada.valor!="Cancelados"]]),e(h,{onClick:C=>s.abrirItem(i.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:o(()=>[i.dataHoraEmissao?(u(),p(r,{key:0,rotulo:a.$filters.data(i.dataHoraEmissao),icone:"today",cor:"transparent",class:"col-auto q-mx-auto q-py-xs"},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Data Emiss\xE3o")]),_:1})]),_:2},1032,["rotulo"])):v("",!0)]),_:2},1032,["onClick"]),e(h,{onClick:C=>s.abrirItem(i.id),class:"hideonmobile maxw100 q-pl-sm no-margin"},{default:o(()=>[i.dataHoraFinalizado?(u(),p(r,{key:0,rotulo:a.$filters.data(i.dataHoraFinalizado),icone:"today",cor:"transparent",class:"col-auto q-mx-auto q-py-xs"},{default:o(()=>[e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Data Finaliza\xE7\xE3o")]),_:1})]),_:2},1032,["rotulo"])):v("",!0)]),_:2},1032,["onClick"]),e(h,{onClick:C=>s.abrirItem(i.id),class:"hideonmobile maxw140 q-pl-sm no-margin"},{default:o(()=>[e(F,{class:"text-tertiary text-weight-bold text-right"},{default:o(()=>[n(V(a.$filters.numeroZerosDireita(i.totalContrato,4,2))+" ",1),e(_,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n("Valor do Contrato")]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),e(h,{side:"",top:""},{default:o(()=>[e(w,{class:"q-pa-none"},{default:o(()=>[e(h,{class:"hideonmobile q-pr-sm no-margin"},{default:o(()=>[e(g,{onClick:C=>s.abrirItem(i.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024),e(g,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:o(()=>[e(J,null,{default:o(()=>[R((u(),p(L,{link:"","no-border":"",separator:""},{default:o(()=>[i.status==="Ativo"?(u(),p(w,{key:0,onClick:C=>s.removerItem(i),clickable:""},{default:o(()=>[e(h,{avatar:""},{default:o(()=>[e(P,{name:"delete"})]),_:1}),e(h,null,{default:o(()=>[n("Remover")]),_:1})]),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)),[[le]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(K)]))),128))]),_:1})]),_:1},8,["busca","checkBox","onAtualizar","onCriarClick","onRemoverClick","onCheckBoxClick","onLimparFiltrosClick","lista","tabs","tabSelecionada","paginacao","mostrar"]),e(f,{onAtualizar:s.atualizar,ref:"contrato"},null,8,["onAtualizar"])])}var xe=G(fe,[["render",be]]);export{xe as default};
