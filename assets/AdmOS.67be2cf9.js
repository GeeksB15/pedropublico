import{_ as j,Y as G,by as H,bj as g,aC as V,a$ as k,b0 as P,cP as Z,aD as K,r as h,o as c,n as v,f as a,w as r,h as q,j as O,i as z,k as p,Q as A,E as Q,I as T,B as m,F as X,s as Y,t as S,e as b,d as _,y as J,u as W,N as U,d_ as E,m as F,ax as $,G as oo,O as ao,R as N,S as y,T as R,M as eo,H as I,L as to,aq as B,b3 as so}from"./index.c8ffb049.js";import{C as ro}from"./Campo.edb61bc8.js";import{O as lo}from"./OSTrocarStatus.95e0a687.js";import{M as no}from"./ModalHistoricoStatus.07449841.js";import{d as io}from"./vuedraggable.umd.f5b30fb3.js";const co={components:{Badge:G,Campo:ro,OSTrocarStatus:lo,ModalHistoricoStatus:no,draggable:io},data(){return{drawer:!0,showfilters:!1,empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date(H()).toDateString()),entregueFim:new Date(new Date(H()).toDateString()),fraseFiltro:"",listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeOS"},{label:"Entrega para esta semana",value:"bordaAmarelaOS"},{label:"Entrega atrasada",value:"bordaVermelhaOS"}]}},methods:{async eventoEnd(){for(const l in this.listas)for(const o of this.listas[l])if(o.status!==l){g.log("AdmOS","eventoEnd De:",o.status,"Para:",l,"codigo:",o.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoUsuario:null,nomeCliente:o.nomeCliente,observacao:"",statusAtual:o.status,statusNovo:l},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(l){g.log("AdmOS","eventoConfirmaTroca",{...l}),this.$q.loading.show();try{let o;$db.usuario.logado.cpf&&(o=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(t=>{var e;return t.numeroDocumentoNacional.replace(/\D/g,"")===((e=$db.usuario.logado.cpf)==null?void 0:e.replace(/\D/g,""))})),l.cpfUsuario=o==null?void 0:o.numeroDocumentoNacional,await V.os.trocaStatusOnline(l),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(o){this.$q.notifyError("Erro na troca de status",o)}finally{this.$q.loading.hide()}},eventoCancelarTroca(l){g.log("AdmOS","eventoCancelarTroca",l),this.atualiza()},async empresaOpcoesCarregar(){const l=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=l.map(o=>({label:o.nome,value:o.codigoContato,id:o.id}))},filtraDebounce(){k.exports.debounce(this.refazFiltro,700)()},refazFiltro(){g.log("AdmOSs","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const l=P(this.fraseFiltro.toUpperCase()).split(" ").filter(o=>o!=="");for(const o in this.listas)for(const n of this.listas[o]){const t=P(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroOS)+" ");let e=!0;for(const d of l)isNaN(Number(d))?e=e&&t.includes(d):e=e&&t.includes(" "+d+" ");this.empresaSelecionada&&(e=e&&this.empresaSelecionada.value===n.codigoEmpresa),n.mostra=e}},async atualiza(){try{const l=await V.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,empresas:this.empresaOpcoes.map(t=>t.id)});g.log("AdmOS","atualiza()",l.length),Z(!l||!l.length,"N\xE3o h\xE1 ordens de servi\xE7o");let o=await V.configuracoes.le({nome:"vendas.os.status"});o=o.filter(t=>!["Processando","Entregue"].includes(t.texto));const n={Processando:[]};for(const t of k.exports.orderBy(o,"valor","asc").map(e=>e.texto))n[t]=[];n.Entregue=[];for(const t of l){let e="bordaVerdeOS",d="",w="Normal";if(t.status==="Entregue"){if(!!t.dataHoraPrevisto&&!!t.dataHoraFinalizado){const f=new Date(new Date(t.dataHoraPrevisto).toDateString()),i=(new Date(new Date(t.dataHoraFinalizado).toDateString())-f)/(1e3*60*60*24);e=i>=0?"bordaVermelhaOS":i>-7?"bordaAmarelaOS":"bordaVerdeOS",d=i>=0?"negative":i>-7?"warning":"",w=i>=0?"Atrasado":i>-7?"Aten\xE7\xE3o":"Normal"}}else if(t.dataHoraPrevisto){const f=new Date(new Date(t.dataHoraPrevisto).toDateString()),i=(new Date(new Date().toDateString())-f)/(1e3*60*60*24);e=i>=0?"bordaVermelhaOS":i>-7?"bordaAmarelaOS":"bordaVerdeOS",d=i>=0?"negative":i>-7?"warning":"",w=i>=0?"Atrasado":i>-7?"Aten\xE7\xE3o":"Normal"}const C={id:t.id,codigoCompra:t.codigoCompra||"-",codigoContatoResponsavel:t.codigoContatoResponsavel,codigoDocumento:t.codigoDocumento,codigoContato:t.codigoContato,codigoEmpresa:t.codigoEmpresa,descricaoEmpresa:t.descricaoEmpresa,descricao:t.descricao,corBorda:e,corLabel:d,txtLabel:w,dataHoraEmissao:new Date(t.dataHoraEmissao),dataHoraFinalizado:new Date(t.dataHoraFinalizado),dataHoraRetorno:new Date(t.dataHoraRetorno),dataHoraPrevisto:new Date(t.dataHoraPrevisto),mostra:!0,nomeCliente:t.nomeCliente||"-",nomeResponsavel:t.nomeResponsavel||"-",numeroVenda:t.numeroVenda?String(t.numeroVenda):"-",numeroOS:t.numeroOS?String(t.numeroOS):"-",status:t.status};n[t.status]&&n[t.status].push(C)}this.listas=n,this.refazFiltro()}catch(l){this.$q.notifyError("Erro na consulta online de oss",l)}},async irParaAtendimento(l){const o=await K().contato.where({codigoContato:l}).first()||{};o.id&&this.$router.push({name:"Atendimento",params:{id:o.id}})}},watch:{entregueInicio(){g.log("AdmOSs","entregueInicio"),this.atualiza()},entregueFim(){g.log("AdmOSs","entregueFim"),this.atualiza()}},async created(){g.log("AdmOSs","created()"),await this.empresaOpcoesCarregar(),this.atualiza()}},uo={id:"AdmOS"},mo={class:"row overflowXOS filterfalse"},po={class:"q-pa-none"},fo={key:0,class:"row"},go={class:"col-12"},vo={class:"q-pa-md"},bo={class:"row q-mt-xs"},So={class:"col-6"},ho={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},_o={key:0,class:"text-subtitle1 text-weight-medium"},wo={key:1,class:"text-caption"},Co={class:"col-12"},Oo={key:0,class:"text-caption q-mb-xs"},yo={key:1,class:"text-caption q-mb-xs"},Do={class:"text-caption"};function xo(l,o,n,t,e,d){const w=h("barraTopo"),C=h("campo"),f=h("badge"),D=h("draggable"),i=h("OS-trocar-status"),L=h("modal-historico-status");return c(),v("div",uo,[a(Q,{elevated:"",class:"bg-gradiente text-white"},{default:r(()=>[a(w),a(q,{class:"q-px-sm"},{default:r(()=>[a(O,{name:"view_week",size:"sm"}),a(z,null,{default:r(()=>o[9]||(o[9]=[p("Adm. OS")])),_:1}),a(A,{onClick:o[0]||(o[0]=u=>e.showfilters=!e.showfilters),icon:"mdi-filter",round:"",dense:"",flat:""})]),_:1})]),_:1}),a(I,null,{default:r(()=>[a(T,null,{default:r(()=>[m("div",mo,[(c(!0),v(X,null,Y(e.listas,(u,x)=>(c(),v("div",{key:x,class:"no-shadow col q-px-none coluna"},[m("div",po,[a(q,{class:"no-shadow q-py-none q-px-sm text-white"},{default:r(()=>[a(z,null,{default:r(()=>[p(S(x),1)]),_:2},1024)]),_:2},1024),x==="Entregue"?(c(),v("div",fo,[m("div",go,[m("div",vo,[a(C,{modelValue:e.entregueInicio,"onUpdate:modelValue":o[1]||(o[1]=s=>e.entregueInicio=s),rotulo:"In\xEDcio",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(C,{modelValue:e.entregueFim,"onUpdate:modelValue":o[2]||(o[2]=s=>e.entregueFim=s),rotulo:"Fim",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"])])])])):b("",!0),a(D,{onEnd:d.eventoEnd,list:u,draggable:".extratoOS",delay:"250",group:"osGroup",itemKey:"id",class:"dragAreaOS"},{item:r(({element:s})=>[s.mostra&&(e.prazoSelecionado===null||e.prazoSelecionado===s.corBorda)?(c(),_(J,{key:0,class:W([s.corBorda,"q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 extratoOS bg-white"])},{default:r(()=>[m("div",bo,[m("div",So,[s.corLabel?(c(),_(f,{key:0,cor:s.corLabel,rotulo:s.txtLabel,escuro:"",class:"q-mx-xs"},null,8,["cor","rotulo"])):(c(),_(f,{key:1,rotulo:s.txtLabel,class:"q-mx-xs"},null,8,["rotulo"]))]),m("div",ho,[s.numeroVenda&&s.numeroVenda!=="-"?(c(),_(f,{key:0,cor:"light",rotulo:s.numeroVenda,icone:"shopping_cart",class:"q-mx-sm"},null,8,["rotulo"])):b("",!0),s.numeroOS&&s.numeroOS!=="-"?(c(),_(f,{key:1,escuro:"",rotulo:s.numeroOS,icone:"assignment_turned_in",cor:"tertiary"},null,8,["rotulo"])):b("",!0)])]),a(U,{class:"q-pa-xs q-mb-sm"},{default:r(()=>[s.nomeCliente?(c(),v("div",_o,S(s.nomeCliente),1)):b("",!0),s.nomeCliente!==s.descricao?(c(),v("div",wo,S(s.descricao),1)):b("",!0)]),_:2},1024),a(U,{class:"row q-pa-xs q-pb-none"},{default:r(()=>[m("div",Co,[s.descricaoEmpresa&&s.descricaoEmpresa!=="-"?(c(),v("div",Oo,[m("span",null,[a(E,{icon:"business",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+S(s.descricaoEmpresa)+" ",1),a(F,{anchor:"bottom middle",self:"center middle"},{default:r(()=>o[10]||(o[10]=[p(" Empresa ")])),_:1})])])):b("",!0),s.nomeResponsavel&&s.nomeResponsavel!=="-"?(c(),v("div",yo,[m("span",null,[a(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+S(s.nomeResponsavel)+" ",1),a(F,{anchor:"bottom middle",self:"center middle"},{default:r(()=>o[11]||(o[11]=[p(" Respons\xE1vel ")])),_:1})])])):b("",!0),m("div",Do,[m("span",null,[a(E,{icon:"calendar_today",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+S(l.$filters.data(s.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?s.dataHoraFinalizado:s.dataHoraPrevisto))+" ",1),a(F,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(S(s.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para"),1)]),_:2},1024)])]),a(A,{icon:"more_vert",dense:"",round:"",unelevated:"",color:"white","text-color":"tertiary",class:"botaoVerMaisVert"},{default:r(()=>[a($,null,{default:r(()=>[oo((c(),_(ao,{link:"",separator:""},{default:r(()=>[a(N,{onClick:M=>l.$refs.modalHistoricoStatus.mostrar({idDocumento:s.id}),clickable:""},{default:r(()=>[a(y,{avatar:""},{default:r(()=>[a(O,{name:"history"})]),_:1}),a(y,null,{default:r(()=>[a(R,null,{default:r(()=>o[12]||(o[12]=[p("Hist\xF3rico do Status")])),_:1})]),_:1})]),_:2},1032,["onClick"]),a(N,{onClick:M=>d.irParaAtendimento(s.codigoContato),clickable:""},{default:r(()=>[a(y,{avatar:""},{default:r(()=>[a(O,{name:"launch"})]),_:1}),a(y,null,{default:r(()=>[a(R,null,{default:r(()=>o[13]||(o[13]=[p("Ir para o Atendimentos")])),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[eo]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["class"])):b("",!0)]),_:2},1032,["onEnd","list"])])]))),128))])]),_:1})]),_:1}),a(so,{modelValue:e.showfilters,"onUpdate:modelValue":o[7]||(o[7]=u=>e.showfilters=u),bordered:"",side:"right",class:"hide-scrollbar"},{default:r(()=>[a(to,{view:"hHh lpR lFr"},{default:r(()=>[a(Q,{class:"bg-white"},{default:r(()=>[a(q,{class:"text-tertiary border-bottom"},{default:r(()=>[a(O,{class:"text-h5",name:"mdi-filter"}),a(z,null,{default:r(()=>o[14]||(o[14]=[p("Filtro Avan\xE7ado")])),_:1}),a(A,{dense:"",flat:"",icon:"close",round:"",onClick:o[3]||(o[3]=u=>e.showfilters=!e.showfilters)})]),_:1})]),_:1}),a(I,null,{default:r(()=>[a(T,{class:"q-pa-md"},{default:r(()=>[a(C,{modelValue:e.fraseFiltro,"onUpdate:modelValue":[o[4]||(o[4]=u=>e.fraseFiltro=u),d.filtraDebounce],dense:"",rotulo:"Por cliente ou respons\xE1vel",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"]),a(B,{modelValue:e.prazoSelecionado,"onUpdate:modelValue":o[5]||(o[5]=u=>e.prazoSelecionado=u),options:e.prazoOpcoes,clearable:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","options"]),a(B,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[o[6]||(o[6]=u=>e.empresaSelecionada=u),d.refazFiltro],clearable:"",options:e.empresaOpcoes,label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(i,{modelValue:e.trocarStatusModal,"onUpdate:modelValue":o[8]||(o[8]=u=>e.trocarStatusModal=u),dados:e.trocarStatusDados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),a(L,{ref:"modalHistoricoStatus"},null,512)])}var Fo=j(co,[["render",xo]]);export{Fo as default};
