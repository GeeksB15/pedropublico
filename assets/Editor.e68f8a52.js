import{_ as me,bO as R,r as D,o as v,d as k,w as c,f as i,M as fe,G as pe,h as he,H as be,Q as S,N as ve,i as ge,s as Pe,I as ke,J as Te,p as T,P as ee,F as ye,u as Ae,S as Ue,T as N,U as te,k as d,t as j,D as oe,e as P,aC as Xe,dn as B,bP as we,dp as Ye,dq as Ve,bG as Ze,C as e,A as L,W as $e,cm as et,c6 as tt}from"./index.a1a1867c.js";import{M as ot}from"./MonacoEditor.bdb459e7.js";import{V as at}from"./Visualizador.cc6fd64a.js";var O=typeof window!="undefined"?window:null,Ce=O===null,J=Ce?void 0:O.document,_="addEventListener",x="removeEventListener",ce="getBoundingClientRect",Q="_a",w="_b",q="_c",Z="horizontal",V=function(){return!1},rt=Ce?"calc":["","-webkit-","-moz-","-o-"].filter(function(o){var t=J.createElement("div");return t.style.cssText="width:"+o+"calc(9px)",!!t.style.length}).shift()+"calc",Fe=function(o){return typeof o=="string"||o instanceof String},je=function(o){if(Fe(o)){var t=J.querySelector(o);if(!t)throw new Error("Selector "+o+" did not match a DOM element");return t}return o},C=function(o,t,u){var p=o[t];return p!==void 0?p:u},$=function(o,t,u,p){if(t){if(p==="end")return 0;if(p==="center")return o/2}else if(u){if(p==="start")return 0;if(p==="center")return o/2}return o},lt=function(o,t){var u=J.createElement("div");return u.className="gutter gutter-"+t,u},it=function(o,t,u){var p={};return Fe(t)?p[o]=t:p[o]=rt+"("+t+"% - "+u+"px)",p},st=function(o,t){var u;return u={},u[o]=t+"px",u},nt=function(o,t){if(t===void 0&&(t={}),Ce)return{};var u=o,p,r,n,z,f,h;Array.from&&(u=Array.from(u));var ae=je(u[0]),A=ae.parentNode,G=getComputedStyle?getComputedStyle(A):null,b=G?G.flexDirection:null,re=C(t,"sizes")||u.map(function(){return 100/u.length}),le=C(t,"minSize",100),ie=Array.isArray(le)?le:u.map(function(){return le}),se=C(t,"maxSize",1/0),Le=Array.isArray(se)?se:u.map(function(){return se}),Ne=C(t,"expandToMin",!1),M=C(t,"gutterSize",10),K=C(t,"gutterAlign","center"),ne=C(t,"snapOffset",30),Ie=Array.isArray(ne)?ne:u.map(function(){return ne}),de=C(t,"dragInterval",1),I=C(t,"direction",Z),ue=C(t,"cursor",I===Z?"col-resize":"row-resize"),Re=C(t,"gutter",lt),Se=C(t,"elementStyle",it),Me=C(t,"gutterStyle",st);I===Z?(p="width",r="clientX",n="left",z="right",f="clientWidth"):I==="vertical"&&(p="height",r="clientY",n="top",z="bottom",f="clientHeight");function H(s,a,l,m){var y=Se(p,a,l,m);Object.keys(y).forEach(function(g){s.style[g]=y[g]})}function He(s,a,l){var m=Me(p,a,l);Object.keys(m).forEach(function(y){s.style[y]=m[y]})}function W(){return h.map(function(s){return s.size})}function ze(s){return"touches"in s?s.touches[0][r]:s[r]}function Ee(s){var a=h[this.a],l=h[this.b],m=a.size+l.size;a.size=s/this.size*m,l.size=m-s/this.size*m,H(a.element,a.size,this[w],a.i),H(l.element,l.size,this[q],l.i)}function Be(s){var a,l=h[this.a],m=h[this.b];!this.dragging||(a=ze(s)-this.start+(this[w]-this.dragOffset),de>1&&(a=Math.round(a/de)*de),a<=l.minSize+l.snapOffset+this[w]?a=l.minSize+this[w]:a>=this.size-(m.minSize+m.snapOffset+this[q])&&(a=this.size-(m.minSize+this[q])),a>=l.maxSize-l.snapOffset+this[w]?a=l.maxSize+this[w]:a<=this.size-(m.maxSize-m.snapOffset+this[q])&&(a=this.size-(m.maxSize+this[q])),Ee.call(this,a),C(t,"onDrag",V)(W()))}function Oe(){var s=h[this.a].element,a=h[this.b].element,l=s[ce](),m=a[ce]();this.size=l[p]+m[p]+this[w]+this[q],this.start=l[n],this.end=l[z]}function Qe(s){if(!getComputedStyle)return null;var a=getComputedStyle(s);if(!a)return null;var l=s[f];return l===0?null:(I===Z?l-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight):l-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),l)}function _e(s){var a=Qe(A);if(a===null||ie.reduce(function(g,E){return g+E},0)>a)return s;var l=0,m=[],y=s.map(function(g,E){var F=a*g/100,X=$(M,E===0,E===s.length-1,K),Y=ie[E]+X;return F<Y?(l+=Y-F,m.push(0),Y):(m.push(F-Y),F)});return l===0?s:y.map(function(g,E){var F=g;if(l>0&&m[E]-l>0){var X=Math.min(l,m[E]-l);l-=X,F=g-X}return F/a*100})}function Je(){var s=this,a=h[s.a].element,l=h[s.b].element;s.dragging&&C(t,"onDragEnd",V)(W()),s.dragging=!1,O[x]("mouseup",s.stop),O[x]("touchend",s.stop),O[x]("touchcancel",s.stop),O[x]("mousemove",s.move),O[x]("touchmove",s.move),s.stop=null,s.move=null,a[x]("selectstart",V),a[x]("dragstart",V),l[x]("selectstart",V),l[x]("dragstart",V),a.style.userSelect="",a.style.webkitUserSelect="",a.style.MozUserSelect="",a.style.pointerEvents="",l.style.userSelect="",l.style.webkitUserSelect="",l.style.MozUserSelect="",l.style.pointerEvents="",s.gutter.style.cursor="",s.parent.style.cursor="",J.body.style.cursor=""}function Ge(s){if(!("button"in s&&s.button!==0)){var a=this,l=h[a.a].element,m=h[a.b].element;a.dragging||C(t,"onDragStart",V)(W()),s.preventDefault(),a.dragging=!0,a.move=Be.bind(a),a.stop=Je.bind(a),O[_]("mouseup",a.stop),O[_]("touchend",a.stop),O[_]("touchcancel",a.stop),O[_]("mousemove",a.move),O[_]("touchmove",a.move),l[_]("selectstart",V),l[_]("dragstart",V),m[_]("selectstart",V),m[_]("dragstart",V),l.style.userSelect="none",l.style.webkitUserSelect="none",l.style.MozUserSelect="none",l.style.pointerEvents="none",m.style.userSelect="none",m.style.webkitUserSelect="none",m.style.MozUserSelect="none",m.style.pointerEvents="none",a.gutter.style.cursor=ue,a.parent.style.cursor=ue,J.body.style.cursor=ue,Oe.call(a),a.dragOffset=ze(s)-a.end}}re=_e(re);var U=[];h=u.map(function(s,a){var l={element:je(s),size:re[a],minSize:ie[a],maxSize:Le[a],snapOffset:Ie[a],i:a},m;if(a>0&&(m={a:a-1,b:a,dragging:!1,direction:I,parent:A},m[w]=$(M,a-1===0,!1,K),m[q]=$(M,!1,a===u.length-1,K),b==="row-reverse"||b==="column-reverse")){var y=m.a;m.a=m.b,m.b=y}if(a>0){var g=Re(a,I,l.element);He(g,M,a),m[Q]=Ge.bind(m),g[_]("mousedown",m[Q]),g[_]("touchstart",m[Q]),A.insertBefore(g,l.element),m.gutter=g}return H(l.element,l.size,$(M,a===0,a===u.length-1,K),a),a>0&&U.push(m),l});function xe(s){var a=s.i===U.length,l=a?U[s.i-1]:U[s.i];Oe.call(l);var m=a?l.size-s.minSize-l[q]:s.minSize+l[w];Ee.call(l,m)}h.forEach(function(s){var a=s.element[ce]()[p];a<s.minSize&&(Ne?xe(s):s.minSize=a)});function Ke(s){var a=_e(s);a.forEach(function(l,m){if(m>0){var y=U[m-1],g=h[y.a],E=h[y.b];g.size=a[m-1],E.size=l,H(g.element,g.size,y[w],g.i),H(E.element,E.size,y[q],E.i)}})}function We(s,a){U.forEach(function(l){if(a!==!0?l.parent.removeChild(l.gutter):(l.gutter[x]("mousedown",l[Q]),l.gutter[x]("touchstart",l[Q])),s!==!0){var m=Se(p,l.a.size,l[w]);Object.keys(m).forEach(function(y){h[l.a].element.style[y]="",h[l.b].element.style[y]=""})}})}return{setSizes:Ke,getSizes:W,collapse:function(a){xe(h[a])},destroy:We,parent:A,pairs:U}};const qe="Buscar relat\xF3rio",dt={data(){return{carregando:!0,listaFiltrada:[],placeholder:qe,termo:"",visivel:!1}},methods:{filtrar(){let o;if(this.termo){const t=$utils.removerAcentos(this.termo.toUpperCase()).split(" ").filter(u=>u!=="");o=this.listaCompleta.filter(u=>{const p=$utils.removerAcentos(" "+$utils.stringOrEmpty(u.codigoObjeto).toUpperCase()+"  "+$utils.stringOrEmpty(u.nomeObjeto).toUpperCase()+" "+$utils.stringOrEmpty(u.descricao).toUpperCase());let r=!0;for(const n of t)isNaN(Number(n))?r=r&&p.includes(n):r=r&&p.includes(" "+n+" ");return r})}else o=this.listaCompleta;this.listaFiltrada=o.slice(0,100),this.carregando=!1},limpar(){this.listaFiltrada=[],this.placeholder=qe,this.termo=""},onHide(){this.resolve({}),this.limpar()},onShow(){this.$refs.search.focus()},item_click(o={}){this.resolve(o),this.visivel=!1},async show(o){return this.carregando=!0,this.visivel=!0,this.listaCompleta=(await R.objeto.leOnline({colunas:"id codigoObjeto descricao documentacao nomeObjeto tipo",filtros:{tipo:"vue"}})).sort((t,u)=>$utils.stringOrEmpty(t.nomeObjeto).localeCompare($utils.stringOrEmpty(u.nomeObjeto))),this.filtrar(),new Promise((t,u)=>{this.resolve=t})}},mounted(){$g.promptEditorRelatorio={show:this.show}}},ut={key:0,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"},ct={key:1,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"};function mt(o,t,u,p,r,n){const z=D("badge");return v(),k(oe,{modelValue:r.visivel,"onUpdate:modelValue":t[1]||(t[1]=f=>r.visivel=f),maximized:"",onHide:t[2]||(t[2]=f=>n.onHide()),onShow:t[3]||(t[3]=f=>n.onShow())},{default:c(()=>[i(fe,{class:"bg-white",container:""},{default:c(()=>[i(pe,null,{default:c(()=>[i(he,null,{default:c(()=>[be(i(S,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[ve]]),i(ge,null,{default:c(()=>[i(Pe,{modelValue:r.termo,"onUpdate:modelValue":[t[0]||(t[0]=f=>r.termo=f),n.filtrar],color:"none",ref:"search",dark:"",placeholder:r.placeholder,debounce:"600",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close"},null,8,["modelValue","placeholder","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1}),i(ke,{class:"u-container"},{default:c(()=>[i(Te,null,{default:c(()=>[r.carregando?(v(),T("div",ut," Carregando... ")):r.listaFiltrada.length?(v(),k(ee,{key:2,link:"","no-border":"",separator:""},{default:c(()=>[(v(!0),T(ye,null,Ae(r.listaFiltrada,f=>(v(),k(Ue,{key:f.id,clickable:"",onClick:h=>n.item_click(f),class:"row"},{default:c(()=>[i(N,{class:"col"},{default:c(()=>[i(te,null,{default:c(()=>[d(j(f.nomeObjeto),1)]),_:2},1024),i(te,{caption:""},{default:c(()=>[d(j(f.descricao),1)]),_:2},1024)]),_:2},1024),i(N,{class:"col-auto"},{default:c(()=>[i(z,{cor:"primary",escuro:""},{default:c(()=>[d("#"+j(f.codigoObjeto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(v(),T("div",ct," Nenhum resultado encontrado "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ft=me(dt,[["render",mt]]);const De="Buscar usuario, obs, publicado...",pt={computed:{usuario(){try{return JSON.parse(localStorage.usuario)}catch{return{}}}},data(){return{carregando:!0,listaFiltrada:[],placeholder:De,termo:"",visivel:!1}},props:{idObjeto:{type:String}},methods:{filtrar(){let o;if(this.termo){const t=$utils.removerAcentos(this.termo.toUpperCase()).split(" ").filter(u=>u!=="");o=this.listaCompleta.filter(u=>{const p=$utils.removerAcentos(" "+$utils.stringOrEmpty(u.obs).toUpperCase()+"  "+(u.publicado?"Publicado":"Salvo").toUpperCase()+"  "+$utils.stringOrEmpty(u.usuario).toUpperCase());let r=!0;for(const n of t)isNaN(Number(n))?r=r&&p.includes(n):r=r&&p.includes(" "+n+" ");return r})}else o=this.listaCompleta;this.listaFiltrada=o.slice(0,100),this.carregando=!1},limpar(){this.listaFiltrada=[],this.placeholder=De,this.termo=""},onHide(){this.resolve({acao:"fechar",dados:{}}),this.limpar()},onShow(){this.$refs.search.focus()},item_click(o={}){this.resolve({acao:"selecionar",dados:o}),this.visivel=!1},comparar_click(o={}){this.resolve({acao:"comparar",dados:o}),this.visivel=!1},async show(o){return this.carregando=!0,this.visivel=!0,this.listaCompleta=(await R.objetoVersao.leOnline({colunas:"id idObjeto idUsuario dataHora obs publicado usuario",filtros:{idObjeto:this.idObjeto}})).sort((t,u)=>-$utils.stringOrEmpty(t.dataHora).localeCompare($utils.stringOrEmpty(u.dataHora))),this.filtrar(),new Promise((t,u)=>{this.resolve=t})}},mounted(){$g.promptEditorRelatorioVersao={show:this.show}}},ht={key:0,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"},bt={key:1,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"};function vt(o,t,u,p,r,n){const z=D("badge");return v(),k(oe,{modelValue:r.visivel,"onUpdate:modelValue":t[1]||(t[1]=f=>r.visivel=f),maximized:"",onHide:t[2]||(t[2]=f=>n.onHide()),onShow:t[3]||(t[3]=f=>n.onShow())},{default:c(()=>[i(fe,{class:"bg-white",container:""},{default:c(()=>[i(pe,null,{default:c(()=>[i(he,null,{default:c(()=>[be(i(S,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[ve]]),i(ge,null,{default:c(()=>[i(Pe,{modelValue:r.termo,"onUpdate:modelValue":[t[0]||(t[0]=f=>r.termo=f),n.filtrar],color:"none",ref:"search",dark:"",placeholder:r.placeholder,debounce:"600",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close"},null,8,["modelValue","placeholder","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1}),i(ke,{class:"u-container"},{default:c(()=>[i(Te,null,{default:c(()=>[r.carregando?(v(),T("div",ht," Carregando... ")):r.listaFiltrada.length?(v(),k(ee,{key:2,link:"","no-border":"",separator:""},{default:c(()=>[(v(!0),T(ye,null,Ae(r.listaFiltrada,f=>(v(),k(Ue,{key:f.id,clickable:"",onClick:h=>n.item_click(f),class:"row"},{default:c(()=>[i(N,{class:"col"},{default:c(()=>[f.obs?(v(),k(te,{key:0},{default:c(()=>[d(j(f.obs),1)]),_:2},1024)):P("",!0),f.dataHora?(v(),k(te,{key:1,caption:""},{default:c(()=>[d(j(f.publicado?"Publicado":"Salvo")+" em "+j(o.$filters.dataHora(f.dataHora)),1)]),_:2},1024)):P("",!0)]),_:2},1024),i(N,{class:"col-auto"},{default:c(()=>[f.usuario?(v(),k(z,{key:0,cor:f.idUsuario===n.usuario.id?"primary":"grey",class:"q-mr-sm",denso:"",escuro:""},{default:c(()=>[d(j(f.usuario),1)]),_:2},1032,["cor"])):P("",!0)]),_:2},1024),i(N,{class:"col-auto"},{default:c(()=>[i(z,{cor:f.publicado?"positive":"grey",denso:"",escuro:""},{default:c(()=>[d(j(f.id),1)]),_:2},1032,["cor"])]),_:2},1024),i(N,{class:"col-auto"},{default:c(()=>[i(S,{class:"q-px-sm q-mr-sm",dense:"",label:"Comparar",onClick:h=>n.comparar_click(f)},null,8,["onClick"])]),_:2},1024),i(N,{class:"col-auto"},{default:c(()=>[i(S,{class:"q-px-sm",color:"primary",dense:"",label:"Abrir",onClick:h=>n.item_click(f)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(v(),T("div",bt," Nenhum resultado encontrado "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var gt=me(pt,[["render",vt]]);const kt={components:{MonacoEditor:ot,Visualizador:at,promptEditorRelatorio:ft,promptEditorRelatorioVersao:gt},data(){return{alterarConteudo:null,alterouConteudo:!1,areaConfiguracoes:!0,atualizarAutomaticamente:!!parseInt(localStorage.editorAtualizar),campoObservacao:"",campos:{codigoObjeto:"",descricao:"",documentacao:"",nomeObjeto:""},componenteEditor:{parametro:"",estilo:"",script:"",template:""},componenteVisualizador:{},componenteDiff:{},chaveDiff:0,modalBoasVindas:!1,modalPublicar:!1,modoDiff:!1,publicando:!1,salvando:!1}},computed:{editorOptions(){return{automaticLayout:!0,lineNumbersMinChars:2}},idObjetoValido(){return String(this.id).length===36},id(){return this.$route.params.id},temId(){return this.id!==void 0&&this.id!==""},parametroBase64(){return Xe.encodeToUrl(this.componenteEditor.parametro||"")},rotaImprimir(){return{name:"Imprimir",params:{nome:this.campos.nomeObjeto||"x",parametro:this.parametroBase64||void 0}}},usuario(){try{return JSON.parse(localStorage.usuario)}catch{return{}}},versao(){return this.$route.params.versao}},methods:{abrirConfiguracoes(){this.areaConfiguracoes=!0},async abrirPromptBuscar(){try{const o=await $g.promptEditorRelatorio.show({});o&&String(o.id).length===36&&this.confirmarSaida().onOk(()=>{this.$router.push({params:{id:o.id,versao:""}})})}catch(o){$q.notifyError("Erro ao abrir tela de buscar relat\xF3rio",o)}},async abrirPromptHistorico(){try{const o=await $g.promptEditorRelatorioVersao.show({});o&&o.dados&&String(o.dados.id).length===36&&this.confirmarSaida().onOk(()=>{o.acao==="selecionar"?this.$router.push({params:{id:this.id,versao:o.dados.id}}):o.acao==="comparar"&&(this.componenteDiff=JSON.parse(atob(o.dados.codigoPersonalizado)),this.modoDiff=!0,this.chaveDiff++)})}catch(o){$q.notifyError("Erro ao buscar vers\xE3o relat\xF3rio",o)}},aoIniciarEditor(o){o.onKeyDown(t=>{const u=t.browserEvent||{};(u.ctrlKey||u.metaKey)&&u.which===13&&(t.stopPropagation(),this.atualizarVisualizador())})},atualizarVisualizador(){if(this.atualizarAutomaticamente)return null;$utils.gconsole.log("editor","atualizarVisualizador"),this.componenteVisualizador=B(this.componenteEditor)},atualizarComponente(o){typeof o=="string"&&(o=JSON.parse(atob(o))),this.componenteEditor={parametro:o.parametro||"",estilo:o.estilo||"",script:o.script||"",template:o.template||""},$utils.gconsole.log("editor","atualizarComponente"),this.componenteVisualizador=B(this.componenteEditor),this.alterouConteudo=!1},async carregarObjeto(o){try{const t=String(o).length!==36?null:(await R.objeto.leOnline({colunas:"id codigoObjeto codigoPersonalizado descricao documentacao nomeObjeto tipo",filtros:{id:o}}))[0];if(!t)return $q.notify("Objeto inexistente.");this.campos.codigoObjeto=t.codigoObjeto,this.campos.nomeObjeto=t.nomeObjeto,this.campos.descricao=t.descricao,this.campos.documentacao=t.documentacao||"",this.atualizarComponente(t.codigoPersonalizado),this.abrirConfiguracoes(),this.fecharDiff()}catch(t){throw $q.notify("N\xE3o foi poss\xEDvel carregar o objeto."),t}},async carregarVersao(o){try{const t=String(o).length!==36?null:(await R.objetoVersao.leOnline({colunas:"id idObjeto idUsuario codigoPersonalizado dataHora obs publicado usuario",filtros:{id:o}}))[0];if(!t)return $q.notify("Vers\xE3o inexistente.");this.campos.documentacao=t.documentacao||"",this.atualizarComponente(t.codigoPersonalizado),this.fecharDiff()}catch(t){throw $q.notify("N\xE3o foi poss\xEDvel carregar vers\xE3o."),t}},compararVersao(o){this.componenteDiff=JSON.parse(atob(o.codigoPersonalizado)),this.modoDiff=!0,this.chaveDiff++,this.fecharModalHistorico()},confirmarSaida(){return this.alterouConteudo?$q.dialog({title:"Sair sem salvar?",message:"Parece que existem modifica\xE7\xF5es que n\xE3o foram salvas. Deseja continuar?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}):{onOk(o){o()}}},fecharDiff(){!this.modoDiff||(this.modoDiff=!1,this.chaveDiff++)},async publicar(){this.publicando=!0;try{const o=await this.gravar(this.id,!0,this.campoObservacao);$q.notifyPositive("Publicado!"),this.campoObservacao="",this.modalPublicar=!1,this.$router.push({params:{versao:o}})}catch{$q.notifyError("Erro ao publicar.")}finally{this.publicando=!1}},redefinirCampos(){this.campos.codigoObjeto="",this.campos.descricao="",this.campos.nomeObjeto=""},redefinirComponente(){this.componenteEditor={parametro:"{}",estilo:`.foo {
  color: green;
}`,script:`vue = {
  data: () => ({
    foo: 'Solu\xE7\xF5es'
  })
}`,template:`<div class="foo">
  Geeks {{ foo }}
</div>`},$utils.gconsole.log("editor","redefinirComponente"),this.componenteVisualizador=B(this.componenteEditor),this.alterouConteudo=!1},async incluir(){this.confirmarSaida().onOk(()=>{(this.id===0||this.id==="0")&&(this.redefinirCampos(),this.redefinirComponente()),this.$router.push({params:{id:"0",versao:""}})})},async gravar(o,t,u){const p=we(),r=btoa(JSON.stringify(this.componenteEditor));(t||!this.idObjetoValido)&&await R.objeto.grava({...this.campos,id:o,tipo:"vue",codigoPersonalizado:r});try{const z=await fetch("http://localhost:8002/gravar",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({codigoPersonalizado:"aa"})})}catch{}const n={id:p,idObjeto:o,idUsuario:this.usuario.id,codigoPersonalizado:r,dataHora:Ye(new Date).replace(/'/g,""),documentacao:this.campos.documentacao||"",publicado:t?1:0,usuario:this.usuario.nome};return u&&(n.obs=u),await R.objetoVersao.grava(n),p},async salvar(){if(this.campos.nomeObjeto==="")return $q.notify("O identificador \xE9 obrigat\xF3rio."),this.abrirConfiguracoes(),setTimeout(()=>this.$refs.campoNomeObjeto.focus(),1),!1;this.salvando=!0;try{$q.loading.show();const o=this.idObjetoValido?this.id:we(),t=await this.gravar(o);this.alterouConteudo=!1,this.$router.push({params:{id:o,versao:t}}),$q.notifyPositive("Salvo com sucesso!")}catch(o){throw $q.notify("Erro ao salvar."),o}finally{this.salvando=!1,$q.loading.hide()}},teclas(o){if(!!o&&(o.ctrlKey||o.metaKey))switch(o.which){case 13:o.preventDefault(),o.stopImmediatePropagation(),o.stopPropagation(),this.atualizarVisualizador();break;case 79:o.preventDefault(),this.abrirPromptBuscar();break;case 83:o.preventDefault(),this.salvar();break}},async lerArquivo(){try{const t=await(await fetch("http://localhost:8002/ler",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({codigoPersonalizado:"aa"})})).text();let u="";const p={ignoreAttributes:!1,allowBooleanAttributes:!0,preserveOrder:!0,unpairedTags:["hr","br","link","meta"],stopNodes:["*.pre","*.script"],processEntities:!0,htmlEntities:!0},n=new Ve.XMLParser(p).parse(t);console.log("json",n);const z={ignoreAttributes:!1,format:!0,preserveOrder:!0,unpairedTags:["hr","br","link","meta"],stopNodes:["*.pre","*.script"]},h=new Ve.XMLBuilder(z).build(n);await fetch("http://localhost:8002/gravar",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({conteudo:h,arquivoNome:""})})}catch{}}},async created(){if(this.redefinirComponente(),this.idObjetoValido)try{$q.loading.show(),await this.carregarObjeto(this.id),this.versao&&await this.carregarVersao(this.versao)}finally{$q.loading.hide()}else this.temId||(this.modalBoasVindas=!0);document.addEventListener("keydown",this.teclas),this.alterarConteudo=$lodash.debounce(()=>{this.alterouConteudo=!0,this.atualizarAutomaticamente&&($utils.gconsole.log("editor","created"),this.componenteVisualizador=B(this.componenteEditor))},500)},mounted(){globalThis.tela=this,this.divisor=new nt(["#editor","#visualizador"],{minSize:[300,20]})},beforeUnmount(){document.removeEventListener("keydown",this.teclas),this.divisor&&this.divisor.destroy()},watch:{async id(o){o&&o!=="0"?this.carregarObjeto(o):(this.redefinirCampos(),this.redefinirComponente())},atualizarAutomaticamente(o){o||($utils.gconsole.log("editor","atualizarAutomaticamente"),this.componenteVisualizador=B(this.componenteEditor)),localStorage.setItem("editorAtualizar",o?1:0)}}},yt={key:2},Ct={class:"Editor-codigo u-alturaConteudo row"},St={id:"editor",class:"u-alturaConteudo bg-dark text-white col col-lg-6"},zt={class:"bg-grey-10 q-pb-md q-pt-sm q-px-md"},Et=e("table",{class:"TabelaEscura text-caption q-mb-md q-mx-md"},[e("thead",null,[e("tr",null,[e("th",null,"Atalho"),e("th",null,"Windows"),e("th",null,"Linux"),e("th",null,"macOS")])]),e("tbody",null,[e("tr",null,[e("td",null,"Abrir documento"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"O")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"O")])]),e("tr",null,[e("td",null,"Salvar documento"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"S")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"S")])]),e("tr",null,[e("td",null,"Atualizar componente"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"ENTER")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"ENTER")])])])],-1),Ot=e("table",{class:"TabelaEscura text-caption q-mb-md q-mx-md"},[e("thead",null,[e("tr",null,[e("th",null,"Atalho"),e("th",null,"Windows"),e("th",null,"Linux"),e("th",null,"macOS")])]),e("tbody",null,[e("tr",null,[e("td",null,"Paleta de comandos"),e("td",{class:"text-center",colspan:"3"},[e("kbd",null,"F1")])]),e("tr",null,[e("td",null,"Colapsar tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"K"),d(" | "),e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"0")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"K"),d(" | "),e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"0")])]),e("tr",null,[e("td",null,"Comentar"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"/")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"/")])]),e("tr",null,[e("td",null,"Expandir tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"K"),d(" | "),e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"J")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"K"),d(" | "),e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"J")])]),e("tr",null,[e("td",null,"Formatar sele\xE7\xE3o"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"K"),d(" | "),e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"K"),d(" | "),e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"Formatar tudo"),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"SHIFT"),d(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"SHIFT"),d(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"SHIFT"),d(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"Localizar"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"M\xFAltiplos cursores"),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"ALT"),d(" + "),e("kbd",null,"SHIFT"),d(" + "),e("kbd",null,"\u2191\u2193")]),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"SHIFT"),d(" + "),e("kbd",null,"\u2191\u2193")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"SHIFT"),d(" + "),e("kbd",null,"\u2191\u2193")])]),e("tr",null,[e("td",null,"Selecionar tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"A")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"A")])]),e("tr",null,[e("td",null,"Substituir"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),d(" + "),e("kbd",null,"H")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),d(" + "),e("kbd",null,"H")])])])],-1),_t={id:"visualizador",class:"Editor-visualizador u-alturaConteudo col col-lg-6"},xt={class:"layout-padding bg-white q-pa-xl"},wt=e("h4",{class:"q-mb-sm q-mt-none"},"Bem-vindo ao Editor.",-1),Vt=e("p",null,"Atrav\xE9s desta interface \xE9 poss\xEDvel criar ou editar objetos do sistema.",-1),jt={class:"q-mt-lg"},qt={class:"layout-padding bg-white q-pa-xl"},Dt=e("h4",{class:"q-mb-sm q-mt-none"},"Publicar",-1),Pt=e("p",null,"Deixe uma mensagem para recordar o que h\xE1 de novo nesta vers\xE3o.",-1),Tt={class:"q-mt-lg"};function At(o,t,u,p,r,n){const z=D("badge"),f=D("campo"),h=D("monaco-editor"),ae=D("visualizador"),A=D("promptEditorRelatorio"),G=D("promptEditorRelatorioVersao");return v(),k(fe,{class:"Editor"},{default:c(()=>[i(pe,null,{default:c(()=>[i(he,{color:"dark"},{default:c(()=>[i(ge,{onClick:n.abrirConfiguracoes},{default:c(()=>[d(j(r.campos.nomeObjeto||"Editor")+" ",1),n.idObjetoValido?(v(),k(z,{key:0,class:"Editor-id",cor:"grey-10"},{default:c(()=>[d(j(r.campos.codigoObjeto),1)]),_:1})):(v(),k(z,{key:1,class:"Editor-id",cor:"negative"},{default:c(()=>[d("Rascunho")]),_:1})),r.campos.nomeObjeto?(v(),T("span",yt,"Editor")):P("",!0)]),_:1},8,["onClick"]),r.modoDiff?(v(),k(S,{key:0,class:"q-mr-sm",color:"negative",icon:"close",label:"Fechar Diff",onClick:n.fecharDiff},null,8,["onClick"])):P("",!0),i(Ze,{class:"q-mr-sm"},{default:c(()=>[r.atualizarAutomaticamente?P("",!0):(v(),k(S,{key:0,color:"blue",icon:"play_arrow",label:"Atualizar",onClick:n.atualizarVisualizador},null,8,["onClick"])),n.idObjetoValido&&n.id?(v(),k(S,{key:1,color:"blue-5",icon:"remove_red_eye",target:"_blank",to:n.rotaImprimir},null,8,["to"])):P("",!0)]),_:1}),i(S,{color:"white",class:"q-ml-sm",label:"Novo",icon:"add","text-color":"dark",onClick:n.incluir},null,8,["onClick"]),i(S,{color:"white",class:"q-ml-sm",label:"Abrir",icon:"search","text-color":"dark",onClick:n.abrirPromptBuscar},null,8,["onClick"]),i(S,{color:"yellow",class:"q-ml-sm",disabled:r.salvando,label:r.salvando?"Salvando...":"Salvar",icon:"save","text-color":"dark",onClick:n.salvar},null,8,["disabled","label","onClick"]),n.idObjetoValido?(v(),T(ye,{key:1},[i(S,{color:"white",class:"q-ml-sm",label:"Hist\xF3rico",icon:"history","text-color":"dark",onClick:n.abrirPromptHistorico},null,8,["onClick"]),i(S,{color:"yellow",class:"q-ml-sm",label:"Publicar",icon:"publish","text-color":"dark",onClick:t[0]||(t[0]=b=>r.modalPublicar=!0)})],64)):P("",!0)]),_:1})]),_:1}),i(ke,null,{default:c(()=>[e("div",Ct,[e("div",St,[i(ee,{class:"q-pb-none","no-border":""},{default:c(()=>[i(L,{modelValue:r.areaConfiguracoes,"onUpdate:modelValue":t[5]||(t[5]=b=>r.areaConfiguracoes=b),class:"Editor-editorItem",group:"editor",icon:"settings",label:"Configura\xE7\xF5es"},{default:c(()=>[e("div",zt,[i(f,{modelValue:r.campos.nomeObjeto,"onUpdate:modelValue":t[1]||(t[1]=b=>r.campos.nomeObjeto=b),ref:"campoNomeObjeto",dark:"",rotulo:"Identificador"},null,8,["modelValue"]),i(f,{modelValue:r.campos.descricao,"onUpdate:modelValue":t[2]||(t[2]=b=>r.campos.descricao=b),dark:"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"]),i(f,{modelValue:r.componenteEditor.parametro,"onUpdate:modelValue":t[3]||(t[3]=b=>r.componenteEditor.parametro=b),dark:"",ajuda:n.parametroBase64,rotulo:"Par\xE2metro",tipo:"textoArea"},null,8,["modelValue","ajuda"]),i($e,{modelValue:r.atualizarAutomaticamente,"onUpdate:modelValue":t[4]||(t[4]=b=>r.atualizarAutomaticamente=b),class:"q-mt-lg",label:"Atualizar pr\xE9-visualiza\xE7\xE3o ao digitar?"},null,8,["modelValue"]),i(ee,{class:"q-mt-lg q-pa-none",dark:"",separator:""},{default:c(()=>[i(L,{group:"configuracoes",label:"Atalhos da ferramenta"},{default:c(()=>[Et]),_:1}),i(L,{group:"configuracoes",label:"Atalhos do editor"},{default:c(()=>[Ot]),_:1})]),_:1})])]),_:1},8,["modelValue"]),i(L,{class:"Editor-editorItem",group:"editor",icon:"dashboard",label:"Template (HTML)"},{default:c(()=>[(v(),k(h,{key:r.chaveDiff,class:"Editor-editor",modelValue:r.componenteEditor.template,"onUpdate:modelValue":t[6]||(t[6]=b=>r.componenteEditor.template=b),language:"html",diffEditor:r.modoDiff,original:r.componenteDiff.template,options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","diffEditor","original","options","onEditorDidMount","onChange"]))]),_:1}),i(L,{class:"Editor-editorItem",group:"editor",icon:"code",label:"JavaScript (Vue)","default-opened":""},{default:c(()=>[(v(),k(h,{key:r.chaveDiff+1,class:"Editor-editor",modelValue:r.componenteEditor.script,"onUpdate:modelValue":t[7]||(t[7]=b=>r.componenteEditor.script=b),language:"javascript",diffEditor:r.modoDiff,original:r.componenteDiff.script,options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","diffEditor","original","options","onEditorDidMount","onChange"]))]),_:1}),i(L,{class:"Editor-editorItem",group:"editor",icon:"format_paint",label:"Estilos (CSS)"},{default:c(()=>[(v(),k(h,{key:r.chaveDiff+2,class:"Editor-editor",modelValue:r.componenteEditor.estilo,"onUpdate:modelValue":t[8]||(t[8]=b=>r.componenteEditor.estilo=b),language:"css",diffEditor:r.modoDiff,original:r.componenteDiff.estilo,options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","diffEditor","original","options","onEditorDidMount","onChange"]))]),_:1}),i(L,{class:"Editor-editorItem",group:"editor",icon:"speaker_notes",label:"Documenta\xE7\xE3o (Markdown)"},{default:c(()=>[i(h,{class:"Editor-editor",modelValue:r.campos.documentacao,"onUpdate:modelValue":t[9]||(t[9]=b=>r.campos.documentacao=b),language:"markdown",options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","options","onEditorDidMount","onChange"])]),_:1})]),_:1})]),e("div",_t,[i(ae,{class:"",componente:r.componenteVisualizador},null,8,["componente"])])]),i(oe,{modelValue:r.modalBoasVindas,"onUpdate:modelValue":t[10]||(t[10]=b=>r.modalBoasVindas=b),"no-backdrop-dismiss":"","no-esc-dismiss":""},{default:c(()=>[e("div",xt,[wt,Vt,e("div",jt,[i(S,{color:"primary",label:"Novo",icon:"add",onClick:n.incluir},null,8,["onClick"]),i(S,{color:"primary",class:"q-ml-sm",label:"Abrir",icon:"search",onClick:n.abrirPromptBuscar},null,8,["onClick"])])])]),_:1},8,["modelValue"]),i(oe,{modelValue:r.modalPublicar,"onUpdate:modelValue":t[12]||(t[12]=b=>r.modalPublicar=b),"no-backdrop-dismiss":"","no-esc-dismiss":""},{default:c(()=>[e("div",qt,[Dt,Pt,i(f,{modelValue:r.campoObservacao,"onUpdate:modelValue":t[11]||(t[11]=b=>r.campoObservacao=b),rotulo:"Mensagem",placeholder:"Escreva a sua mensagem...",tipo:"textoArea"},null,8,["modelValue"]),e("div",Tt,[be(i(S,{label:"Cancelar",color:"tertiary",flat:""},null,512),[[ve]]),i(S,{color:"primary",unelevated:"",class:"q-ml-sm",label:"Publicar",icon:"publish",onClick:n.publicar},null,8,["onClick"])])]),i(et,{visible:r.modalPublicar&&r.publicando},{default:c(()=>[i(tt,{size:"50px",color:"primary"})]),_:1},8,["visible"])]),_:1},8,["modelValue"]),i(A),i(G,{idObjeto:n.id},null,8,["idObjeto"])]),_:1})]),_:1})}var Nt=me(kt,[["render",At]]);export{Nt as default};
