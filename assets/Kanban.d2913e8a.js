import{_ as P,by as E,bj as u,aC as h,a$ as q,b0 as y,cP as k,r as C,o as g,n as v,f as s,w as i,h as D,j as U,i as O,k as f,E as Q,I as R,y as F,B as r,Q as T,q as B,aq as z,F as V,s as H,t as m,e as _,d as N,u as I,N as x,l as M,H as j}from"./index.188ab8e6.js";import{C as K}from"./Campo.d9b8e121.js";import{d as L}from"./vuedraggable.umd.6920df3d.js";const G={components:{Campo:K,draggable:L},data(){return{empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date(E()).toDateString()),entregueFim:new Date(new Date(E()).toDateString()),fraseFiltro:"",listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeOS"},{label:"Entrega para esta semana",value:"bordaAmarelaOS"},{label:"Entrega atrasada",value:"bordaVermelhaOS"}]}},methods:{async eventoEnd(){for(const t in this.listas)for(const a of this.listas[t])if(a.status!==t){u.log("AdmOS","eventoEnd De:",a.status,"Para:",t,"codigo:",a.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:a.codigoContatoResponsavel,codigoDocumento:a.codigoDocumento,codigoUsuario:null,nomeCliente:a.nomeCliente,observacao:"",statusAtual:a.status,statusNovo:t},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(t){u.log("AdmOS","eventoConfirmaTroca",{...t}),this.$q.loading.show();try{let a;$db.usuario.logado.cpf&&(a=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(o=>{var e;return o.numeroDocumentoNacional.replace(/\D/g,"")===((e=$db.usuario.logado.cpf)==null?void 0:e.replace(/\D/g,""))})),t.cpfUsuario=a==null?void 0:a.numeroDocumentoNacional,await h.os.trocaStatusOnline(t),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(a){this.$q.notifyError("Erro na troca de status",a)}finally{this.$q.loading.hide()}},eventoCancelarTroca(t){u.log("AdmOS","eventoCancelarTroca",t),this.atualiza()},async empresaOpcoesCarregar(){u.log("AdmOS","empresaOpcoesCarregar()"),this.empresaOpcoes=(await h.empresa.leOnline()).map(t=>({label:t.nome,value:t.codigoContato}))},filtraDebounce(){q.exports.debounce(this.refazFiltro,700)()},refazFiltro(){u.log("AdmOSs","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const t=y(this.fraseFiltro.toUpperCase()).split(" ").filter(a=>a!=="");for(const a in this.listas)for(const n of this.listas[a]){const o=y(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroOS)+" ");let e=!0;for(const d of t)isNaN(Number(d))?e=e&&o.includes(d):e=e&&o.includes(" "+d+" ");this.empresaSelecionada&&(e=e&&this.empresaSelecionada===n.codigoEmpresa),n.mostra=e}},async atualiza(){try{const t=await h.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim});u.log("AdmOS","atualiza()",t.length),k(!t||!t.length,"N\xE3o h\xE1 ordens de servi\xE7o");let a=await h.configuracoes.le({nome:"vendas.os.status"});a=a.filter(o=>!["Processando","Entregue"].includes(o.texto));const n={Processando:[]};for(const o of q.exports.orderBy(a,"valor","asc").map(e=>e.texto))n[o]=[];n.Entregue=[];for(const o of t){let e="bordaVerdeOS";if(o.status==="Entregue"){if(!!o.dataHoraPrevisto&&!!o.dataHoraFinalizado){const S=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date(o.dataHoraFinalizado).toDateString())-S)/(1e3*60*60*24);e=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}}else if(o.dataHoraPrevisto){const S=new Date(new Date(o.dataHoraPrevisto).toDateString()),p=(new Date(new Date().toDateString())-S)/(1e3*60*60*24);e=p>=0?"bordaVermelhaOS":p>-7?"bordaAmarelaOS":"bordaVerdeOS"}const d={id:o.id,codigoCompra:o.codigoCompra||"-",codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoEmpresa:o.codigoEmpresa,descricaoEmpresa:o.descricaoEmpresa,corBorda:e,dataHoraEmissao:new Date(o.dataHoraEmissao),dataHoraFinalizado:new Date(o.dataHoraFinalizado),dataHoraRetorno:new Date(o.dataHoraRetorno),dataHoraPrevisto:new Date(o.dataHoraPrevisto),mostra:!0,nomeCliente:o.nomeCliente||"-",nomeResponsavel:o.nomeResponsavel||"-",numeroVenda:o.numeroVenda||"-",numeroOS:o.numeroOS||"-",status:o.status};n[o.status]&&n[o.status].push(d)}this.listas=n,this.refazFiltro()}catch(t){this.$q.notifyError("Erro na consulta online de oss",t)}}},watch:{entregueInicio(){u.log("AdmOSs","entregueInicio"),this.atualiza()},entregueFim(){u.log("AdmOSs","entregueFim"),this.atualiza()}},created(){u.log("AdmOSs","created()"),this.atualiza()}},X={id:"Kanban"},J={class:"filters row q-pa-sm q-ma-md bg-white",style:{"border-radius":"5px","min-height":"50px"}},W={class:"col-auto"},Y={class:"col-10 col-md-5 q-ml-sm"},Z={class:"col-6 col-md q-pl-none"},$={class:"col-6 col-md q-pl-none"},aa={class:"row overflowXOS"},ea={class:"bg-white q-pa-xs"},oa={key:0,class:"row"},ta={class:"col-12 q-pl-none"},sa={style:{display:"block"}},ra={style:{display:"block"}};function na(t,a,n,o,e,d){const S=C("barraTopo"),b=C("campo"),p=C("draggable"),A=C("OS-trocar-status");return g(),v("div",X,[s(Q,{elevated:"",class:"bg-gradiente text-white"},{default:i(()=>[s(S),s(D,{class:"q-px-sm"},{default:i(()=>[s(U,{name:"view_week",size:"sm"}),s(O,null,{default:i(()=>a[6]||(a[6]=[f("Kanban")])),_:1})]),_:1})]),_:1}),s(j,null,{default:i(()=>[s(R,null,{default:i(()=>[s(F,{class:"row no-shadow"},{default:i(()=>[s(D,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(O,{class:"q-pa-none"},{default:i(()=>[r("div",J,[r("div",W,[s(T,{icon:"filter_list",round:"",color:"tertiary",class:"no-shadow u-semClique"})]),r("div",Y,[s(B,{modelValue:e.fraseFiltro,"onUpdate:modelValue":[a[0]||(a[0]=c=>e.fraseFiltro=c),d.filtraDebounce],debounce:500,placeholder:"Filtrar cliente ou respons\xE1vel"},null,8,["modelValue","onUpdate:modelValue"])]),r("div",Z,[s(z,{modelValue:e.prazoSelecionado,"onUpdate:modelValue":a[1]||(a[1]=c=>e.prazoSelecionado=c),options:e.prazoOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por prazo"},null,8,["modelValue","options"])]),r("div",$,[s(z,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[a[2]||(a[2]=c=>e.empresaSelecionada=c),d.refazFiltro],onClick:d.empresaOpcoesCarregar,options:e.empresaOpcoes,clearable:"",class:"q-mx-sm",placeholder:"Filtrar por empresa"},null,8,["modelValue","onClick","onUpdate:modelValue","options"])])])]),_:1})]),_:1})]),_:1}),r("div",aa,[(g(!0),v(V,null,H(e.listas,(c,w)=>(g(),v("div",{key:w,class:"no-shadow q-pa-sm col"},[r("div",ea,[s(D,{"text-color":"black",class:"no-shadow q-pa-none",color:"transparent"},{default:i(()=>[s(O,{class:"q-py-none"},{default:i(()=>[f(m(w),1)]),_:2},1024)]),_:2},1024),w==="Entregue"?(g(),v("div",oa,[r("div",ta,[s(b,{modelValue:e.entregueInicio,"onUpdate:modelValue":a[3]||(a[3]=l=>e.entregueInicio=l),class:"q-mx-sm",rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),s(b,{modelValue:e.entregueFim,"onUpdate:modelValue":a[4]||(a[4]=l=>e.entregueFim=l),class:"q-mx-sm",rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])):_("",!0),s(p,{onEnd:d.eventoEnd,list:c,draggable:".extratoOS",delay:"400",group:"osGroup",class:"dragAreaOS bg-white"},{default:i(()=>[t.os.mostra&&(e.prazoSelecionado===null||e.prazoSelecionado===t.os.corBorda)?(g(!0),v(V,{key:0},H(c,l=>(g(),N(F,{key:l.codigoDocumento,class:I([l.corBorda,"q-pa-sm q-mb-md shadow-2 extratoOS"])},{default:i(()=>[s(x,{class:"q-py-none"},{right:i(()=>[r("div",null,[r("small",sa,"Venda: "+m(l.numeroVenda),1),r("small",ra,"OS: "+m(l.numeroOS),1)])]),default:i(()=>[f(m(l.nomeCliente)+" ",1),r("span",null,"Empresa: "+m(l.descricaoEmpresa),1)]),_:2},1024),s(M,{class:"q-my-sm"}),s(x,{class:"row q-py-none"},{default:i(()=>[f(" T\xE9cnico: "+m(l.nomeResponsavel)+" ",1),a[8]||(a[8]=r("br",null,null,-1)),f(" Data de Emissao: "+m(t.$filters.data(l.dataHoraEmissao))+" ",1),a[9]||(a[9]=r("br",null,null,-1)),l.dataHoraRetorno?(g(),v(V,{key:0},[f(" Data de Retorno: "+m(t.$filters.data(l.dataHoraRetorno))+" ",1),a[7]||(a[7]=r("br",null,null,-1))],64)):_("",!0),f(" Previs\xE3o de Entrega: "+m(t.$filters.data(l.dataHoraPrevisto))+" ",1),a[10]||(a[10]=r("br",null,null,-1))]),_:2},1024)]),_:2},1032,["class"]))),128)):_("",!0)]),_:2},1032,["onEnd","list"])])]))),128))])]),_:1})]),_:1}),s(A,{modelValue:e.trocarStatusModal,"onUpdate:modelValue":a[5]||(a[5]=c=>e.trocarStatusModal=c),dados:e.trocarStatusDados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"])])}var ca=P(G,[["render",na]]);export{ca as default};
