import{_ as R,d6 as Q,r as v,o as u,n as V,f as a,w as o,aq as P,O as S,F as w,s as I,R as _,S as d,B as N,T as C,k as n,t as m,m as b,d as g,e as h,j as z,d_ as O,Q as H,ax as L,G as A,M as j,l as M}from"./index.129a5639.js";import{L as G}from"./Lista.0485e31d.js";import{F as J}from"./FaturaModal.3d745322.js";import"./QBtnDropdown.549d789e.js";import"./QBtnGroup.dde1c940.js";import"./QScrollArea.93b95b42.js";import"./DocumentosFiscais.765df2e1.js";import"./Campo.2ebba21e.js";import"./compactarValidarNFe.c3faa32e.js";import"./obterItens.7428dd74.js";import"./codigosANP.a6c1a264.js";import"./emitirNFe.35117289.js";import"./VendaCard.95088836.js";import"./ModalHistoricoStatus.29ca6929.js";import"./EnvelopeCard.bfc1726f.js";const X={components:{Lista:G,Envelope:Q,Fatura:J},data(){return{carregando:!1,lista:[],contatos:{},configImpressaoEnvelope:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"mdi-glasses",titulo:"Envelopes",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},tabSelecionada:{valor:"Todos"},tabs:[{valor:"Todos",rotulo:"Todos"},{valor:"Or\xE7amento",rotulo:"Or\xE7amento"},{valor:"Processando",rotulo:"Processando"},{valor:"Translado Loja para Pedido",rotulo:"Translado Loja para Pedido"},{valor:"Translado Pedido para Loja",rotulo:"Translado Pedido para Loja"},{valor:"Aguardando Retorno",rotulo:"Aguardando Retorno"},{valor:"Processando Montagem",rotulo:"Processando Montagem"},{valor:"Pronto para Entrega",rotulo:"Pronto para Entrega"},{valor:"Cliente Informado",rotulo:"Cliente Informado"},{valor:"Entregue",rotulo:"Entregues"}],busca:"",filtros:{termoBusca:null,frase:null,numeroEnvelope:null,numeroOrdemCompra:null,prazoSelecionado:null,empresaSelecionada:null,status:null,dataHoraEmissao:{ini:null,fim:null},dataHoraPrevisto:{ini:null,fim:null},dataHoraFinalizado:{ini:null,fim:null}},empresaOpcoes:[],prazoOpcoes:[{label:"Entrega para pr\xF3ximas semanas",value:"adiantadoEntrega"},{label:"Entrega para esta semana",value:"proximaEntrega"},{label:"Entrega atrasada",value:"atrasadoEntrega"}],paginacao:{atual:1,maximo:1,total:1,limite:25,ordenacao:["descricaoConcatenada"]}}},methods:{async atualizar(r){var p;const l=$utils.logarIni("EnvelopeLista");try{$q.loading.show(),this.carregando=!0,this.lista=[];const{tabSelecionada:i,buscarDadosRecentes:t}=r!=null?r:{};let s,c=["dataHoraEmissao","dataHoraFinalizado"],k=["desc","desc"];t&&(s=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"ListaDeEnvelopes"}),s!=null&&s._id&&(this.tabSelecionada.valor=s.tabSelecionada,this.filtros=s.filtros,this.busca=s.termoBusca,this.paginacao.limite=s.limit,c=s.sort,k=s.dir));let y=$utils.eliminarVazios(this.filtros);i!=null&&i.valor&&(this.tabSelecionada.valor=i.valor),y.status=this.tabSelecionada.valor,y.termoBusca=this.busca;const E=await $db.envelope.leListaCompleta({filtros:y,limit:this.paginacao.limite,page:this.paginacao.atual,sort:c,dir:k});this.lista=E.data.vendas,this.contatos=E.data.contatos,this.paginacao.total=E.total,this.paginacao.maximo=E.totalPages;const x=localStorage.getItem("idFatura");localStorage.removeItem("idFatura"),this.lista.some(q=>q.idFatura===x)&&this.abrirFatura(x),$db.hibrido.isOnline()&&this.carregarImagensContatos(this.contatos),s!=null&&s._id||(s={_id:"ListaDeEnvelopes",tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(y),termoBusca:this.busca,limit:this.paginacao.limite,sort:c,dir:k},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:s})),$utils.logarFim(l,((p=this.lista)==null?void 0:p.length)||0)}catch(i){$q.notifyError("Ocorreu um erro ao consultar envelopes."),console.error(i)}finally{$q.loading.hide(),this.carregando=!1}},async carregarImagensContatos(r){const l=Object.keys(r);if(!!l.length){await $utils.dormir(200);try{const p=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:l}});for(const i of p)r[i.id].imagem=i.imagem||""}catch(p){console.error("Erro ao carregar imagens de contatos - ",p)}}},async configuraImpressoes(r){await this.configuraImpressaoEnvelope(r)},imprimir(r,l){$imprimir(r,l.id),this.configImpressaoEnvelope=[]},async configuraImpressaoEnvelope(r){const l=await $db.configuracoes.porNome("impressao.envelope",r.idEmpresa);this.configImpressaoEnvelope=[...l.length?l.map(p=>({texto:"Imprimir Envelope",...p})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async empresaOpcoesCarregar(){const r=JSON.parse(localStorage.getItem("clienteSistema"));$utils.verificarErro(!r,"Ocorreu erro ao consultar clienteSistema");const l=await $db.empresa.leOnlinePlat({codigoClienteSistema:r.codigoClienteSistema});for(const i of l){const t=await $db.contato.leOnline({codigoContato:i.codigoContato});i.contato=t[0]||{}}let p=[];for(const i of l)i.sigla&&p.push({nome:`${i.sigla} - ${i.contato.apelido}`,codigoContato:i.contato.codigoContato,id:i.contato.id}),i.sigla||p.push({nome:`${i.contato.apelido} - ${i.contato.numeroDocumentoNacional}`,codigoContato:i.contato.codigoContato,id:i.contato.id});this.empresaOpcoes=p.map(i=>({label:i.nome,value:i.codigoContato,id:i.id}))},async abrirEnvelope(r){await this.$refs.envelope.mostrar({idEnvelope:r}),r&&this.$router.push({params:{id:r}})},abrirFatura(r){this.$refs.fatura.mostrar({id:r})},limparRota(){this.$router.push({params:{id:""}})},limparFiltrosClick(){this.filtros={termoBusca:null,frase:null,numeroEnvelope:null,numeroOrdemCompra:null,prazoSelecionado:null,empresaSelecionada:null,status:null,dataHoraEmissao:{ini:null,fim:null},dataHoraPrevisto:{ini:null,fim:null},dataHoraFinalizado:{ini:null,fim:null}},this.atualizar()}},async mounted(){this.empresaOpcoesCarregar(),this.atualizar({buscarDadosRecentes:!0}),this.$route.params.id&&await this.abrirEnvelope(this.$route.params.id)}},K={id:"EnvelopeLista"},W={class:"mw80 text-center"};function Y(r,l,p,i,t,s){const c=v("campo"),k=v("badgeCopiarUid"),y=v("avatar"),E=v("g-col"),x=v("badge"),q=v("g-row"),F=v("g-label"),T=v("Lista"),U=v("Envelope"),B=v("Fatura");return u(),V("div",K,[a(T,{busca:t.busca,"onUpdate:busca":l[12]||(l[12]=e=>t.busca=e),onAtualizar:s.atualizar,onCriarClick:s.abrirEnvelope,onLimparFiltrosClick:s.limparFiltrosClick,carregando:t.carregando,lista:t.lista,tabSelecionada:t.tabSelecionada,tabs:t.tabs,paginacao:t.paginacao,mostrar:t.mostrar},{filtroCampos:o(()=>[a(c,{modelValue:t.filtros.frase,"onUpdate:modelValue":l[0]||(l[0]=e=>t.filtros.frase=e),rotulo:"Por cliente, paciente ou respons\xE1vel",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(c,{modelValue:t.filtros.numeroEnvelope,"onUpdate:modelValue":l[1]||(l[1]=e=>t.filtros.numeroEnvelope=e),rotulo:"N\xFAmero Envelope",dense:"",tipo:"decimal",decimals:"0",zerosDireita:"0",class:"q-field--with-bottom"},null,8,["modelValue"]),a(c,{modelValue:t.filtros.numeroOrdemCompra,"onUpdate:modelValue":l[2]||(l[2]=e=>t.filtros.numeroOrdemCompra=e),rotulo:"N\xFAmero Ordem Compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(P,{modelValue:t.filtros.prazoSelecionado,"onUpdate:modelValue":l[3]||(l[3]=e=>t.filtros.prazoSelecionado=e),options:t.prazoOpcoes,clearable:"",dense:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","options"]),a(P,{modelValue:t.filtros.empresaSelecionada,"onUpdate:modelValue":l[4]||(l[4]=e=>t.filtros.empresaSelecionada=e),options:t.empresaOpcoes,label:"Por empresa",clearable:"",dense:"",class:"q-mb-xl"},null,8,["modelValue","options"]),a(c,{modelValue:t.filtros.dataHoraEmissao.ini,"onUpdate:modelValue":l[5]||(l[5]=e=>t.filtros.dataHoraEmissao.ini=e),rotulo:"Data cria\xE7\xE3o",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),a(c,{modelValue:t.filtros.dataHoraEmissao.fim,"onUpdate:modelValue":l[6]||(l[6]=e=>t.filtros.dataHoraEmissao.fim=e),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),a(c,{modelValue:t.filtros.dataHoraPrevisto.ini,"onUpdate:modelValue":l[7]||(l[7]=e=>t.filtros.dataHoraPrevisto.ini=e),rotulo:"Data previs\xE3o",tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),a(c,{modelValue:t.filtros.dataHoraPrevisto.fim,"onUpdate:modelValue":l[8]||(l[8]=e=>t.filtros.dataHoraPrevisto.fim=e),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),a(c,{modelValue:t.filtros.dataHoraFinalizado.ini,"onUpdate:modelValue":l[9]||(l[9]=e=>t.filtros.dataHoraFinalizado.ini=e),rotulo:`Data
          finalizado`,tipo:"data",dense:"",class:"q-mb-xs"},null,8,["modelValue"]),a(c,{modelValue:t.filtros.dataHoraFinalizado.fim,"onUpdate:modelValue":l[10]||(l[10]=e=>t.filtros.dataHoraFinalizado.fim=e),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mb-xl"},null,8,["modelValue"]),a(c,{modelValue:t.paginacao.limite,"onUpdate:modelValue":l[11]||(l[11]=e=>t.paginacao.limite=e),rotulo:"Quantidade por p\xE1gina",tipo:"quantidade",min:"1",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:o(()=>[a(S,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:o(()=>[(u(!0),V(w,null,I(t.lista,e=>(u(),V("div",{key:e.id,class:"itemHover"},[a(_,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:o(()=>[a(d,{class:"hideonmobile col-auto q-pa-none"},{default:o(()=>[N("div",W,[a(k,{id:e.id,numero:e.numero,cor:"positive",dica:"N\xFAmero Envelope"},null,8,["id","numero"])])]),_:2},1024),a(d,{class:"col-md col-lg col-xl no-margin"},{default:o(()=>[a(_,{class:"q-pa-none"},{default:o(()=>[a(d,{class:"col-auto items-center"},{default:o(()=>[a(y,{imagem:(t.contatos[e.idContato]||{}).imagem,rotulo:e.descricaoContato,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1024),a(d,{class:"col"},{default:o(()=>[a(C,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:o(()=>[n(m(e.descricaoContato)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>l[15]||(l[15]=[n("Paciente")])),_:1})]),_:2},1024),e.idContatoResponsavel!==e.idContato&&t.contatos[e.idContatoResponsavel]?(u(),g(C,{key:0,lines:"2",class:"text-weight-medium ellipsis-2-lines",caption:""},{default:o(()=>[n(m(t.contatos[e.idContatoResponsavel].nome)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>l[16]||(l[16]=[n("Respons\xE1vel")])),_:1})]),_:2},1024)):h("",!0),a(d,{class:"hideondesktop q-mt-sm"},{default:o(()=>[a(q,{mg:"xs-b"},{default:o(()=>[a(E,{col:"sm-shrink"},{default:o(()=>[a(k,{id:e.id,numero:e.numero,cor:"positive",dica:"N\xFAmero Envelope",class:"q-mr-sm"},null,8,["id","numero"])]),_:2},1024),a(E,{col:"sm-shrink"},{default:o(()=>[a(x,{cor:e.status==="Entregue"?"positive":"light",escuro:e.status==="Entregue",class:"q-mr-sm"},{default:o(()=>[n(m(e.status)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>l[17]||(l[17]=[n("Status")])),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1024)]),_:2},1024),a(q,{mg:"xs-b"},{default:o(()=>[a(E,{col:"xs12 sm-shrink"},{default:o(()=>[e.dataHoraEmissao?(u(),g(F,{key:0,inline:"",tip:"Empresa",icon:"business xs tertiary left"},{default:o(()=>[n(m(e.descricaoEmpresa),1)]),_:2},1024)):h("",!0)]),_:2},1024),a(E,{col:"xs12",mg:"xs-t"},{default:o(()=>[e.dataHoraEmissao?(u(),g(F,{key:0,tip:`Criado \xE1s ${r.$filters.hora(e.dataHoraEmissao)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:o(()=>[n(m(r.$filters.data(e.dataHoraEmissao)),1)]),_:2},1032,["tip"])):h("",!0),e.dataHoraPrevisto?(u(),g(F,{key:1,tip:"Previs\xE3o para entrega",icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:o(()=>[n(m(r.$filters.data(e.dataHoraPrevisto)),1)]),_:2},1024)):h("",!0),e.dataHoraFinalizado?(u(),g(F,{key:2,tip:`Finalizado \xE1s ${r.$filters.hora(e.dataHoraFinalizado)}`,icon:"mdi-calendar-today xs tertiary",inline:"",class:"q-mr-sm"},{default:o(()=>[n(m(r.$filters.data(e.dataHoraFinalizado)),1)]),_:2},1032,["tip"])):h("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:o(()=>[e.dataHoraEmissao?(u(),g(C,{key:0,color:"tertiary",lines:"1",class:"ellipsis"},{default:o(()=>[a(z,{name:"mdi-calendar-today"}),n(" "+m(r.$filters.data(e.dataHoraEmissao))+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n(" Criado \xE1s "+m(r.$filters.hora(e.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):h("",!0)]),_:2},1024),a(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:o(()=>[e.dataHoraPrevisto?(u(),g(C,{key:0,color:"tertiary",lines:"1",class:"ellipsis"},{default:o(()=>[a(z,{name:"mdi-calendar-today"}),n(" "+m(r.$filters.data(e.dataHoraPrevisto))+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>l[18]||(l[18]=[n("Previs\xE3o para entrega")])),_:1})]),_:2},1024)):h("",!0)]),_:2},1024),a(d,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:o(()=>[e.dataHoraFinalizado?(u(),g(C,{key:0,color:"tertiary",lines:"1",class:"ellipsis"},{default:o(()=>[a(z,{name:"mdi-calendar-today"}),n(" "+m(r.$filters.data(e.dataHoraFinalizado))+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n(" Finalizado \xE1s "+m(r.$filters.hora(e.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):h("",!0)]),_:2},1024),a(d,{class:"hideonmobile maxw170 q-pl-sm no-margin"},{default:o(()=>[a(x,{cor:e.status==="Entregue"?"positive":"light",escuro:e.status==="Entregue",class:"col-auto q-mx-auto"},{default:o(()=>[n(m(e.status)+" ",1),a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>l[19]||(l[19]=[n("Status")])),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1024),a(d,{class:"hideonmobile col-shrink q-pl-sm no-margin"},{default:o(()=>[a(_,{class:"q-pa-none"},{default:o(()=>[a(d,{class:"col-shrink"},{default:o(()=>[a(O,{color:"light","text-color":"tertiary",icon:"business",size:"md"},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>[n(" Empresa: "+m(e.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"col-shrink"},{default:o(()=>[a(O,{color:"light","text-color":"tertiary",icon:"person",size:"md"},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>{var f;return[n(" Respons\xE1vel: "+m(((f=t.contatos[e.idContatoResponsavel])==null?void 0:f.nome)||""),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"hideonmobile col-shrink q-pl-sm no-margin"},{default:o(()=>[a(_,{class:"q-pa-none"},{default:o(()=>[a(d,{style:{width:"32px"}},{default:o(()=>[a(H,{onClick:f=>s.abrirEnvelope(e.id),size:"md",color:"primary",round:"",flat:"",dense:"",icon:e.dataHoraFinalizado?"remove_red_eye":"edit"},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>l[20]||(l[20]=[n("Editar")])),_:1})]),_:2},1032,["onClick","icon"])]),_:2},1024),a(d,{style:{width:"32px"}},{default:o(()=>[a(H,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",size:"md",onClick:s.configuraImpressoes},{default:o(()=>[a(L,null,{default:o(()=>[a(S,{link:"",separator:""},{default:o(()=>[(u(!0),V(w,null,I(t.configImpressaoEnvelope,f=>(u(),g(_,{key:f.valor,onClick:D=>s.imprimir(f.valor,e),clickable:""},{default:o(()=>[a(d,{avatar:""},{default:o(()=>[a(z,{name:"print"})]),_:1}),a(d,null,{default:o(()=>[a(C,null,{default:o(()=>[n(m(f.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024),a(d,{style:{width:"32px"}},{default:o(()=>[e.idFatura?(u(),g(H,{key:0,onClick:f=>s.abrirFatura(e.idFatura),icon:"how_to_vote",size:"md",color:"primary",round:"",flat:"",dense:""},{default:o(()=>[a(b,{anchor:"bottom middle",self:"center middle"},{default:o(()=>l[21]||(l[21]=[n("Fatura")])),_:1})]),_:2},1032,["onClick"])):h("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(d,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:o(()=>[a(_,{class:"q-pa-none"},{default:o(()=>[a(d,{class:"no-margin"},{default:o(()=>[a(H,{icon:"more_vert",size:"md",round:"",flat:"",dense:"",onClick:s.configuraImpressoes},{default:o(()=>[a(L,null,{default:o(()=>[A((u(),g(S,{link:"","no-border":"",separator:""},{default:o(()=>[a(_,{clickable:"",onClick:f=>s.abrirEnvelope(e.id)},{default:o(()=>[a(d,{avatar:""},{default:o(()=>[a(z,{name:"edit"})]),_:1}),a(d,null,{default:o(()=>l[22]||(l[22]=[n("Editar")])),_:1})]),_:2},1032,["onClick"]),(u(!0),V(w,null,I(t.configImpressaoEnvelope,f=>(u(),g(_,{clickable:"",key:f.valor,onClick:D=>s.imprimir(f.valor,e)},{default:o(()=>[a(d,{avatar:""},{default:o(()=>[a(z,{name:"print"})]),_:1}),a(d,null,{default:o(()=>[a(C,null,{default:o(()=>[n(m(f.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[j]])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(M)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onCriarClick","onLimparFiltrosClick","carregando","lista","tabSelecionada","tabs","paginacao","mostrar"]),a(U,{onAtualizar:l[13]||(l[13]=e=>s.atualizar({tabSelecionada:{valor:"Todos"}})),onFechou:s.limparRota,ref:"envelope"},null,8,["onFechou"]),a(B,{onExecutar:l[14]||(l[14]=e=>s.atualizar({tabSelecionada:{valor:"Todos"}})),ref:"fatura"},null,512)])}var pa=R(X,[["render",Y]]);export{pa as default};
