import{_ as Q,bl as z,r as v,o as f,d as S,w as s,B as u,f as t,h as F,i as y,k as p,G as B,Q as _,M as H,at as $,C as j,$ as G,n as h,j as w,E as T,I as U,F as K,s as X,t as b,e as C,y as J,u as W,N as k,e6 as E,m as I,az as Y,O as Z,R as O,S as D,T as A,H as M,L as oo,as as q,b5 as eo}from"./index.353e304f.js";import{C as to}from"./Campo.f3ecfc86.js";import{M as ao}from"./ModalHistoricoStatus.875151c0.js";import{d as so}from"./vuedraggable.umd.eb97883f.js";const lo={components:{Campo:to},data(){return{confirmado:!1}},emits:["cancelar","confirmar","update:modelValue"],methods:{eventoConfirmar(){z.log("CRMTrocarStatus","eventoConfirmar",this.dados),this.confirmado=!0,this.eventoInput(!1),this.$emit("confirmar",this.dados)},eventoCancelar(){z.log("CRMTrocarStatus","eventoCancelar",this.dados),this.confirmado=!1,this.eventoInput(!1)},eventoInput(a){this.$emit("update:modelValue",a)}},props:{modelValue:{required:!0,type:Boolean},dados:{required:!0,type:Object}},watch:{modelValue(a){a?this.confirmado=!1:this.confirmado||this.$emit("cancelar",this.dados)}}},io={container:"",class:"bg-white"};function ro(a,e,l,r,o,d){const i=v("campo"),g=v("row");return f(),S(j,{"model-value":l.modelValue,"onUpdate:modelValue":d.eventoInput},{default:s(()=>[u("div",io,[t(F,{class:"bg-primary text-white"},{default:s(()=>[t(y,null,{default:s(()=>[p("Trocar status")]),_:1}),B(t(_,{flat:"",round:"",dense:"",icon:"close"},null,512),[[H]])]),_:1}),u("form",{onSubmit:e[4]||(e[4]=$((...m)=>d.eventoConfirmar&&d.eventoConfirmar(...m),["prevent"])),class:"q-pa-md"},[t(g,{class:"q-col-gutter-sm"},{default:s(()=>[t(i,{modelValue:l.dados.nomeCliente,"onUpdate:modelValue":e[0]||(e[0]=m=>l.dados.nomeCliente=m),somenteLeitura:"",class:"col-12",rotulo:"Cliente"},null,8,["modelValue"]),t(i,{modelValue:l.dados.statusAtual,"onUpdate:modelValue":e[1]||(e[1]=m=>l.dados.statusAtual=m),somenteLeitura:"",class:"col-12",rotulo:"De"},null,8,["modelValue"]),t(i,{modelValue:l.dados.statusNovo,"onUpdate:modelValue":e[2]||(e[2]=m=>l.dados.statusNovo=m),somenteLeitura:"",class:"col-12",rotulo:"Para"},null,8,["modelValue"]),t(i,{modelValue:l.dados.observacao,"onUpdate:modelValue":e[3]||(e[3]=m=>l.dados.observacao=m),modelModifiers:{trim:!0},class:"col-12",maxlength:"50",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:1}),t(F,{color:"light"},{default:s(()=>[t(y),t(_,{flat:"",color:"tertiary",onClick:d.eventoCancelar,label:"Cancelar"},null,8,["onClick"]),t(_,{unelevated:"",color:"primary",type:"submit",label:"Trocar"})]),_:1})],32)])]),_:1},8,["model-value","onUpdate:modelValue"])}var no=Q(lo,[["render",ro]]);const x={Or\u00E7amento:[],Conclu\u00EDdo:[]},co={components:{Badge:G,CrmTrocarStatus:no,ModalHistoricoStatus:ao,draggable:so},data(){return{showfilters:!1,empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),fraseFiltro:"",listas:$utils.clonarV2(x),tamanhoLista:{},listasFiltradas:$utils.clonarV2(x),total:{},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeCRM"},{label:"Entrega para esta semana",value:"bordaAmarelaCRM"},{label:"Entrega atrasada",value:"bordaVermelhaCRM"}],vendedorDigitadorSelecionado:null,vendedoresDigitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1}},methods:{async eventoEnd(){for(const a in this.listasFiltradas)for(const e of this.listasFiltradas[a])if(e.crmFunilStatus!==a){$utils.gconsole.log("FunilVendas","eventoEnd De:",e.crmFunilStatus,"Para:",a,"codigo:",e.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.crmFunilStatus,statusNovo:a},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(a){$utils.gconsole.log("FunilVendas","eventoConfirmaTroca",{...a}),this.$q.loading.show();try{let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(r=>{var o;return r.numeroDocumentoNacional.replace(/\D/g,"")===((o=$db.usuario.logado.cpf)==null?void 0:o.replace(/\D/g,""))})),a.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await $db.crm.trocaStatusOnline(a),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(e){this.$q.notifyError("Erro na troca de status",e)}finally{this.$q.loading.hide()}},eventoCancelarTroca(a){$utils.gconsole.log("FunilVendas","eventoCancelarTroca",a),this.atualiza()},async empresaOpcoesCarregar(){const a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=a.map(e=>({label:e.nome,value:e.codigoContato,id:e.id}))},async irParaAtendimento(a){const e=await $erp().contato.where({codigoContato:a}).first()||{};e.id&&this.$router.push({name:"Atendimento",params:{id:e.id}})},filtraDebounce(){$lodash.debounce(this.refazFiltro,700)()},refazFiltro(){$utils.gconsole.log("FunilVendas","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const a=$utils.removerAcentos((this.fraseFiltro||"").toUpperCase()).split(" ").filter(r=>r!==""),e={};for(const r in this.listas)for(const o of this.listas[r]){const d=$utils.removerAcentos((o.id||"").toUpperCase()+(o.nomeCliente||"").toUpperCase()+(o.nomeDigitador||"").toUpperCase()+(o.nomeVendedor||"").toUpperCase()+" "+String(o.numeroVenda||"")+" ");let i=!0;for(const g of a)isNaN(Number(g))?i=i&&d.includes(g):i=i&&d.includes(" "+g+" ");this.empresaSelecionada&&(i=i&&this.empresaSelecionada.value===o.codigoEmpresa),this.vendedorDigitadorSelecionado&&(i=i&&(this.vendedorDigitadorSelecionado.value===o.codigoContatoDigitador||this.vendedorDigitadorSelecionado.value===o.codigoContatoVendedor)),o.mostra=i,o.mostra&&(e[o.crmFunilStatus]=(e[o.crmFunilStatus]||0)+(o.totalDocumento||0))}const l={};for(const r in this.listas)this.tamanhoLista[r]=10,l[r]=this.listas[r].filter(o=>o.mostra).slice(0,this.tamanhoLista[r]),document.getElementById(r);this.listasFiltradas=l,this.$nextTick(()=>{for(const r in this.listasFiltradas)document.getElementById(r).removeEventListener("scroll",this.scrollHandler),document.getElementById(r).addEventListener("scroll",this.scrollHandler)}),this.total=e},scrollHandler(a){const e=a.target.id;a.target.scrollHeight-a.target.scrollTop-a.target.offsetHeight<100&&(this.tamanhoLista[e]+=10,this.listasFiltradas[e]=this.listas[e].filter(r=>r.mostra).slice(0,this.tamanhoLista[e]))},async atualiza(){try{const a=await $db.crm.leOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,...this.diretivaContatosAcessaTodosContatos?{}:{codigoContato:$db.usuario.logado.codigoContato}});$utils.gconsole.log("FunilVendas","atualiza()",a.length),$utils.verificarAlerta(!a||!a.length,"N\xE3o h\xE1 or\xE7amentos");let e=await $db.configuracoes.le({nome:"vendas.crm.status"});e=e.filter(o=>!["Or\xE7amento","Conclu\xEDdo"].includes(o.texto));const l={Or\u00E7amento:[]};for(const o of $lodash.orderBy(e,"valor","asc").map(d=>d.texto))l[o]=[];l.Conclu\u00EDdo=[];const r={};for(const o of a){let d="bordaVerdeCRM";const i={id:o.id,codigoContatoDigitador:o.codigoContatoDigitador||0,codigoContatoVendedor:o.codigoContatoVendedor||0,codigoDocumento:o.codigoDocumento||0,codigoContato:o.codigoContato||0,codigoEmpresa:o.codigoEmpresa||0,descricaoEmpresa:o.descricaoEmpresa||"",corBorda:d,dataHoraEmissao:new Date(o.dataHoraEmissao||""),mostra:!0,nomeCliente:o.nomeCliente||"-",nomeVendedor:o.nomeVendedor||"-",nomeDigitador:o.nomeDigitador||"-",numeroVenda:o.numeroVenda||"-",status:o.status||"",crmFunilStatus:o.crmFunilStatus||"Or\xE7amento",totalDocumento:o.totalDocumento||0};l[i.crmFunilStatus]&&(l[i.crmFunilStatus].push(i),r[i.crmFunilStatus]=(r[i.crmFunilStatus]||0)+(i.totalDocumento||0))}this.listas=l,this.total=r,this.refazFiltro()}catch(a){this.$q.notifyError("Erro na consulta online de or\xE7amentos",a)}}},watch:{entregueInicio(){$utils.gconsole.log("FunilVendas","entregueInicio"),this.atualiza()},entregueFim(){$utils.gconsole.log("FunilVendas","entregueFim"),this.atualiza()}},created(){$utils.gconsole.log("FunilVendas","created()"),$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then(a=>{this.diretivaContatosAcessaTodosContatos=a,this.diretivaContatosAcessaTodosContatos&&(this.vendedoresDigitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then(e=>{e.forEach(l=>{l.codigo&&this.vendedoresDigitadoresOpcoes.push({label:l.nome,value:l.codigo})})})),this.empresaOpcoesCarregar(),this.atualiza()})},beforeUnmount(){for(const a in x)!document.getElementById(a)||document.getElementById(a).removeEventListener("scroll",this.scrollHandler)}},uo={id:"FunilVendas"},mo={class:"row overflowXCRM"},fo={class:"q-pa-none"},po={key:0,class:"text-body2"},go={key:0,class:"row"},ho={class:"col-12"},vo={class:"q-pa-md"},Co={class:"row q-mt-xs"},Vo=u("div",{class:"col-6"},null,-1),bo={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},_o={class:"col-12"},Fo={key:0,class:"text-caption q-mb-xs"},yo={key:1,class:"text-caption q-mb-xs"},wo={key:2,class:"text-caption"};function Do(a,e,l,r,o,d){const i=v("barraTopo"),g=v("campo"),m=v("badge"),L=v("draggable"),R=v("crm-trocar-status"),N=v("modal-historico-status");return f(),h("div",uo,[t(T,{elevated:"",class:"bg-gradiente text-white"},{default:s(()=>[t(i),t(F,{class:"q-px-sm"},{default:s(()=>[t(w,{name:"view_week",size:"sm"}),t(y,null,{default:s(()=>[p("Funil de Vendas")]),_:1}),t(_,{onClick:e[0]||(e[0]=c=>o.showfilters=!o.showfilters),icon:"mdi-filter",round:"",dense:"",flat:""})]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(U,null,{default:s(()=>[u("div",mo,[(f(!0),h(K,null,X(o.listasFiltradas,(c,V)=>(f(),h("div",{key:V,class:"no-shadow q-pa-none col coluna"},[u("div",fo,[t(F,{class:"no-shadow q-py-none q-px-sm text-white"},{default:s(()=>[t(y,null,{default:s(()=>[p(b(V),1)]),_:2},1024),o.total[V]?(f(),h("div",po,b(a.$filters.numero(o.total[V],2)),1)):C("",!0)]),_:2},1024),V==="Conclu\xEDdo"?(f(),h("div",go,[u("div",ho,[u("div",vo,[t(g,{modelValue:o.entregueInicio,"onUpdate:modelValue":e[1]||(e[1]=n=>o.entregueInicio=n),rotulo:"In\xEDcio",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),t(g,{modelValue:o.entregueFim,"onUpdate:modelValue":e[2]||(e[2]=n=>o.entregueFim=n),rotulo:"Fim",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"])])])])):C("",!0),t(L,{onEnd:d.eventoEnd,list:c,id:V,group:"osGroup",itemKey:"codigoDocumento",draggable:".extratoCRM",delay:"250",class:"dragAreaCRM"},{item:s(({element:n})=>[n.mostra&&(o.prazoSelecionado===null||o.prazoSelecionado.value===n.corBorda)?(f(),S(J,{key:0,class:W([n.corBorda,"q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 bg-white extratoCRM"])},{default:s(()=>[u("div",Co,[Vo,u("div",bo,[t(m,{rotulo:a.$filters.numero(n.totalDocumento,2),icone:"shopping_cart",cor:"light",dica:"Total",class:"q-mx-sm"},null,8,["rotulo"]),t(m,{rotulo:n.numeroVenda,dica:"Vendas",icone:"assignment_turned_in",cor:"tertiary",escuro:""},null,8,["rotulo"])])]),t(k,{class:"q-pa-xs q-mb-sm text-subtitle1 text-weight-medium"},{default:s(()=>[p(b(n.nomeCliente),1)]),_:2},1024),t(k,{class:"row q-pa-xs q-pb-none"},{default:s(()=>[u("div",_o,[n.nomeVendedor&&n.nomeVendedor!=="-"?(f(),h("div",Fo,[u("span",null,[t(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+b(n.nomeVendedor)+" ",1),t(I,{anchor:"bottom middle",self:"center middle"},{default:s(()=>[p(" Vendedor ")]),_:1})])])):C("",!0),n.descricaoEmpresa&&n.descricaoEmpresa!=="-"?(f(),h("div",yo,[u("span",null,[t(E,{icon:"business",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+b(n.descricaoEmpresa)+" ",1),t(I,{anchor:"bottom middle",self:"center middle"},{default:s(()=>[p(" Empresa ")]),_:1})])])):C("",!0),n.dataHoraEmissao?(f(),h("div",wo,[u("span",null,[t(E,{icon:"calendar_today",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+b(a.$filters.data(n.dataHoraEmissao)),1)])])):C("",!0),t(_,{icon:"more_vert",dense:"",round:"",unelevated:"",color:"white","text-color":"tertiary",class:"botaoVerMaisVert"},{default:s(()=>[t(Y,null,{default:s(()=>[B((f(),S(Z,{link:"",separator:""},{default:s(()=>[t(O,{onClick:P=>a.$refs.modalHistoricoStatus.mostrar({idDocumento:n.codigoDocumento}),clickable:""},{default:s(()=>[t(D,{avatar:""},{default:s(()=>[t(w,{name:"history"})]),_:1}),t(D,null,{default:s(()=>[t(A,null,{default:s(()=>[p("Hist\xF3rico do Status")]),_:1})]),_:1})]),_:2},1032,["onClick"]),t(O,{onClick:P=>d.irParaAtendimento(n.codigoContato),clickable:""},{default:s(()=>[t(D,{avatar:""},{default:s(()=>[t(w,{name:"launch"})]),_:1}),t(D,null,{default:s(()=>[t(A,null,{default:s(()=>[p("Ir para o Atendimento")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[H]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["class"])):C("",!0)]),_:2},1032,["onEnd","list","id"])])]))),128))])]),_:1})]),_:1}),t(eo,{modelValue:o.showfilters,"onUpdate:modelValue":e[8]||(e[8]=c=>o.showfilters=c),bordered:"",side:"right",class:"hide-scrollbar"},{default:s(()=>[t(oo,{view:"hHh lpR lFr"},{default:s(()=>[t(T,{class:"bg-white"},{default:s(()=>[t(F,{class:"text-tertiary border-bottom"},{default:s(()=>[t(w,{class:"text-h5",name:"mdi-filter"}),t(y,null,{default:s(()=>[p("Filtro Avan\xE7ado")]),_:1}),t(_,{dense:"",flat:"",icon:"close",round:"",onClick:e[3]||(e[3]=c=>o.showfilters=!o.showfilters)})]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(U,{class:"q-pa-md"},{default:s(()=>[t(g,{modelValue:o.fraseFiltro,"onUpdate:modelValue":[e[4]||(e[4]=c=>o.fraseFiltro=c),d.filtraDebounce],dense:"",rotulo:"Por cliente ou respons\xE1vel",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"]),o.diretivaContatosAcessaTodosContatos?(f(),S(q,{key:0,modelValue:o.vendedorDigitadorSelecionado,"onUpdate:modelValue":[e[5]||(e[5]=c=>o.vendedorDigitadorSelecionado=c),d.refazFiltro],options:o.vendedoresDigitadoresOpcoes,clearable:"",label:"Vendedor / Digitador",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])):C("",!0),t(q,{modelValue:o.prazoSelecionado,"onUpdate:modelValue":e[6]||(e[6]=c=>o.prazoSelecionado=c),options:o.prazoOpcoes,clearable:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","options"]),t(q,{modelValue:o.empresaSelecionada,"onUpdate:modelValue":[e[7]||(e[7]=c=>o.empresaSelecionada=c),d.refazFiltro],options:o.empresaOpcoes,clearable:"",label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:o.trocarStatusModal,"onUpdate:modelValue":e[9]||(e[9]=c=>o.trocarStatusModal=c),dados:o.trocarStatusDados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),t(N,{ref:"modalHistoricoStatus"},null,512)])}var zo=Q(co,[["render",Do]]);export{zo as default};
