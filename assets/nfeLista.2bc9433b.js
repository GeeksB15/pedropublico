import{_ as z,Z as T,Y as H,r as y,o as r,n as k,d as f,w as a,f as e,S as m,B as _,T as F,k as c,t as p,j as N,m as S,Q as V,ax as B,O as w,F as E,s as x,R as C,G as A,M as P,e as v,l as j,bj as q,b0 as L,a$ as M,c4 as R,y as G,h as O,b1 as W,b2 as U,bd as Q,bc as Y}from"./index.f2a220da.js";import{a as Z,n as J}from"./nfePrincipal.341dd0eb.js";import"./compactarValidarNFe.97394362.js";import"./obterItens.d48753e1.js";import"./codigosANP.a6c1a264.js";const K={components:{BadgeCopiarUid:T,Badge:H},data(){return{detalhesVisivel:!1,configImpressaoNFe:[]}},methods:{abrirNFe(){$utils.emitter.emit("abrirNFe",this.nota.id)},async configuraImpressao(d){const o=await $db.configuracoes.porNome("impressao.nfe",d);this.configImpressaoNFe=o.length?o.map(l=>({texto:"Imprimir DANFE",...l})):[{valor:"nfe-danfe",texto:"DANFE"},{valor:"nfe-danfe-simplificado",texto:"DANFE Simplificado"},{valor:"duplicata-mercantil",texto:"Duplicata Mercantil"}]}},mixins:[Z],props:{nota:{required:!0,type:Object}},async created(){var h,t,s;const d=(h=this.nota)==null?void 0:h.idDocumento,o=(s=(t=this.nota)==null?void 0:t.cpfCnpjEmitente)==null?void 0:s.replace(/\D/g,"");let l;if(d){const u=await $db.hibrido.le({table:"documento",id:d});l=u==null?void 0:u.idEmpresa}if(!l&&o){const g=(await $erp().empresa.toArray()).find(b=>{var n;return((n=b.numeroDocumentoNacional)==null?void 0:n.replace(/\D/g,""))===o});l=g==null?void 0:g.idContato}await this.configuraImpressao(l)}},X={class:"col-12"},$={class:"col-12"},ee={class:"text-tertiary q-col-gutter-xs"};function ae(d,o,l,h,t,s){const u=y("BadgeCopiarUid"),g=y("badge"),b=y("row");return r(),k(E,null,[l.nota.id?(r(),f(C,{key:0,"manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:a(()=>[e(m,{avatar:"",center:"",class:"mw120"},{default:a(()=>[e(u,{id:l.nota.id,numero:l.nota.nNF,class:"q-mr-sm",cor:"positive"},null,8,["id","numero"])]),_:1}),e(m,{clickable:""},{default:a(()=>[e(b,{class:"items-center q-col-gutter-x-sm"},{default:a(()=>[_("div",{class:"col",onClick:o[0]||(o[0]=(...n)=>s.abrirNFe&&s.abrirNFe(...n))},[e(F,{class:"text-tertiary text-weight-bold"},{default:a(()=>[c(p(l.nota.xNomeDestinatario||"Destinat\xE1rio n\xE3o preenchido"),1)]),_:1}),e(b,{class:"hideondesktop items-center q-my-sm"},{default:a(()=>[_("div",X,[e(F,{caption:"",class:"text-tertiary"},{default:a(()=>[e(N,{name:"event"}),c(" "+p(d.$filters.data(l.nota.dataHoraEmissao)),1)]),_:1}),e(g,{cor:"tertiary",escuro:""},{default:a(()=>[c(p(l.nota.situacao)+p(l.nota.tpAmb==="2"?" - Homologa\xE7\xE3o":""),1)]),_:1})]),_("div",$,[e(F,{caption:"",class:"text-tertiary text-weight-bold q-mt-sm"},{default:a(()=>[c(p(d.$filters.numero(l.nota.vNF,2))+" ",1),e(S,null,{default:a(()=>o[3]||(o[3]=[c("Valor da nota")])),_:1})]),_:1})])]),_:1})])]),_:1})]),_:1}),e(m,{onClick:s.abrirNFe,avatar:"",class:"mw100 hideonmobile"},{default:a(()=>[e(F,{class:"text-tertiary"},{default:a(()=>[e(N,{name:"event"}),c(" "+p(d.$filters.data(l.nota.dataHoraEmissao)),1)]),_:1})]),_:1},8,["onClick"]),e(m,{onClick:s.abrirNFe,avatar:"",class:"mw100 hideonmobile"},{default:a(()=>[e(g,{cor:"tertiary",escuro:""},{default:a(()=>[c(p(l.nota.situacao)+p(l.nota.tpAmb==="2"?" - Homologa\xE7\xE3o":""),1)]),_:1})]),_:1},8,["onClick"]),e(m,{onClick:s.abrirNFe,class:"hideonmobile"},{default:a(()=>[e(F,{caption:"",class:"text-right text-tertiary text-weight-bold"},{default:a(()=>[c(p(d.$filters.numero(l.nota.vNF,2))+" ",1),e(S,null,{default:a(()=>o[4]||(o[4]=[c("Valor da nota")])),_:1})]),_:1})]),_:1},8,["onClick"]),e(m,{side:"",top:""},{default:a(()=>[_("div",ee,[e(V,{rounded:"",dense:"",flat:"",icon:d.emDigitacao?"edit":"remove_red_eye",color:"tertiary",class:"no-shadow q-ma-xs hideonmobile",size:"md",onClick:s.abrirNFe,style:{float:"right"}},null,8,["icon","onClick"]),e(V,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs hideonmobile",size:"md",style:{float:"right"}},{default:a(()=>[e(B,null,{default:a(()=>[e(w,{link:"",separator:""},{default:a(()=>[(r(!0),k(E,null,x(t.configImpressaoNFe,n=>(r(),f(C,{clickable:"",key:n.valor,onClick:I=>{var i,D;return d.$imprimir(n.valor,(D=(i=l.nota)==null?void 0:i.id)!=null?D:"0")}},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:"mdi-printer"})]),_:1}),e(m,null,{default:a(()=>[e(F,null,{default:a(()=>[c(p(n.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),e(V,{rounded:"",dense:"",flat:"",icon:t.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs hideonmobile",color:"tertiary",style:{float:"right"},onClick:o[1]||(o[1]=n=>t.detalhesVisivel=!t.detalhesVisivel)},null,8,["icon"]),e(V,{dense:"",flat:"",icon:"more_vert",round:"",size:"md",class:"hideondesktop"},{default:a(()=>[e(B,null,{default:a(()=>[A((r(),f(w,{link:"","no-border":"",separator:""},{default:a(()=>[e(C,{class:"hideondesktop",clickable:"",onClick:s.abrirNFe},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:d.emDigitacao?"edit":"remove_red_eye"},null,8,["name"])]),_:1}),e(m,null,{default:a(()=>[c(p(d.emDigitacao?"Editar":"Consultar"),1)]),_:1})]),_:1},8,["onClick"]),(r(!0),k(E,null,x(t.configImpressaoNFe,n=>(r(),f(C,{class:"hideondesktop",clickable:"",key:n.valor,onClick:I=>{var i,D;return d.$imprimir(n.valor,(D=(i=l.nota)==null?void 0:i.id)!=null?D:"0")}},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:"mdi-printer"})]),_:1}),e(m,null,{default:a(()=>[e(F,null,{default:a(()=>[c(p(n.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),e(C,{class:"hideondesktop",clickable:"",onClick:o[2]||(o[2]=n=>t.detalhesVisivel=!t.detalhesVisivel)},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:t.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]),_:1}),e(m,null,{default:a(()=>o[5]||(o[5]=[c(" Detalhes ")])),_:1})]),_:1})]),_:1})),[[P]])]),_:1})]),_:1})])]),_:1})]),_:1})):v("",!0),t.detalhesVisivel?(r(),f(C,{key:1,class:"q-px-xs"},{default:a(()=>[e(m,{class:"q-px-none fullWidth"},{default:a(()=>[e(N,{name:"business"}),c(" "+p(l.nota.xFantEmitente||l.nota.xNomeEmitente),1)]),_:1})]),_:1})):v("",!0),e(j)],64)}var te=z(K,[["render",ae]]);const oe={components:{nfeCard:te,nfePrincipal:J},data(){return{dataFim:null,dataIni:null,grupos:[],notasEmDigitacao:[],notasEmitidas:[],notasOutras:[],tabSelecionada:""}},methods:{async atualizar(){q.log("NFeLista","atualizar()");let d=new Date,o=new Date;try{this.$q.loading.show(),this.dataIni&&this.dataFim&&(d=new Date(this.dataIni).setHours(0,0,0,0),o=new Date(this.dataFim).setHours(23,59,59,0));const l={filtros:{periodo:{dataIni:new Date(d).toLocaleDateString("pt-BR"),dataFim:new Date(o).toLocaleDateString("pt-BR")}}};let h=(await $db.documentoFiscalEletronico.leListaNFeCompletaOnline(l)).data;if(this.grupos.length){const s=this.grupos.map(u=>L(u.label).toUpperCase());h=h.filter(u=>{const g=L(u.chNFe.toUpperCase()+u.xNomeEmitente.toUpperCase()+u.xFantEmitente.toUpperCase()+u.cpfCnpjDestinatario.toUpperCase()+u.xNomeDestinatario.toUpperCase()+" "+String(u.nNF)+" ");let b=!0;for(const n of s)n.length>9||isNaN(Number(n))?b=b&&g.includes(n):b=b&&g.includes(" "+n+" ");return b})}h=M.exports.orderBy(h,["dataHoraEmissao"],["desc"]),this.notasEmDigitacao=h.filter(s=>["Em digita\xE7\xE3o"].includes(s.situacao)).slice(0,30),this.notasEmitidas=h.filter(s=>["Emitido","Carta de Corre\xE7\xE3o"].includes(s.situacao)).slice(0,30),this.notasOutras=h.filter(s=>!["Em digita\xE7\xE3o","Carta de Corre\xE7\xE3o","Emitido"].includes(s.situacao)).slice(0,30);let t=this.notasEmDigitacao.length?"notasEmDigitacao":"";t||(t=this.notasEmitidas.length?"notasEmitidas":""),t||(t=this.notasOutras.length?"notasEmitidas":""),this.tabSelecionada=t}catch(l){this.$q.notifyError("Erro ao carregar notas",l)}finally{this.$q.loading.hide()}},fechouNFe(d){q.log("NFeLista","fechouNFe()",d),d&&this.atualizar()},limparFiltro(){this.grupos=[],this.dataFim=new Date,this.dataIni=new Date(R().add(-7,"days"))}},created(){q.log("NFeLista","created()")},mounted(){q.log("NFeLista","mounted()"),this.limparFiltro(),this.atualizar()}},le={class:"NFeLista q-pb-md q-px-none"},ie={class:"col-12 col-md-6"},se={class:"col"},ne={class:"col"},re={key:1,class:"q-pa-lg text-center"};function de(d,o,l,h,t,s){const u=y("gchips"),g=y("campo"),b=y("row"),n=y("nfeCard"),I=y("nfePrincipal");return r(),k("div",le,[e(O,{class:"bg-light"},{default:a(()=>[e(G,{class:"no-shadow bg-light full-width"},{default:a(()=>[e(b,{class:"items-center"},{default:a(()=>[_("div",ie,[e(u,{modelValue:t.grupos,"onUpdate:modelValue":[o[0]||(o[0]=i=>t.grupos=i),s.atualizar],placeholder:t.grupos.length?"":"Filtre por Empresa, Destinat\xE1rio, N\xFAmero...",before:[{icon:"mdi-filter",handler(){d.filtrar()}}]},null,8,["modelValue","onUpdate:modelValue","placeholder","before"])]),_("div",se,[e(g,{modelValue:t.dataIni,"onUpdate:modelValue":[o[1]||(o[1]=i=>t.dataIni=i),s.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),o[5]||(o[5]=_("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[_("label",null,"at\xE9")],-1)),_("div",ne,[e(g,{modelValue:t.dataFim,"onUpdate:modelValue":[o[2]||(o[2]=i=>t.dataFim=i),s.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1})]),_:1}),t.tabSelecionada?(r(),k(E,{key:0},[e(O,{class:"bg-light q-px-sm"},{default:a(()=>[e(W,{modelValue:t.tabSelecionada,"onUpdate:modelValue":o[3]||(o[3]=i=>t.tabSelecionada=i),class:"text-primary",align:"left",style:{"border-bottom":"1px solid #0000001f"}},{default:a(()=>[t.notasEmDigitacao.length?(r(),f(U,{key:0,label:"Em digita\xE7\xE3o",name:"notasEmDigitacao",active:""})):v("",!0),t.notasEmitidas.length?(r(),f(U,{key:1,label:"Emitidas",name:"notasEmitidas"})):v("",!0),t.notasOutras.length?(r(),f(U,{key:2,label:"Outras",name:"notasOutras"})):v("",!0)]),_:1},8,["modelValue"])]),_:1}),e(Y,{modelValue:t.tabSelecionada,"onUpdate:modelValue":o[4]||(o[4]=i=>t.tabSelecionada=i),animated:"",class:"transparent q-pa-none"},{default:a(()=>[t.notasEmDigitacao.length?(r(),f(Q,{key:0,name:"notasEmDigitacao",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),k(E,null,x(t.notasEmDigitacao,i=>(r(),f(n,{key:i.id,nota:i},null,8,["nota"]))),128))]),_:1})]),_:1})):v("",!0),t.notasEmitidas.length?(r(),f(Q,{key:1,name:"notasEmitidas",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),k(E,null,x(t.notasEmitidas,i=>(r(),f(n,{key:i.id,nota:i},null,8,["nota"]))),128))]),_:1})]),_:1})):v("",!0),t.notasOutras.length?(r(),f(Q,{key:2,name:"notasOutras",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),k(E,null,x(t.notasOutras,i=>(r(),f(n,{key:i.id,nota:i},null,8,["nota"]))),128))]),_:1})]),_:1})):v("",!0)]),_:1},8,["modelValue"])],64)):(r(),k("div",re,o[6]||(o[6]=[_("p",null,[_("small",null,"N\xE3o h\xE1 notas com o filtro selecionado")],-1)]))),e(I,{onFechar:s.fechouNFe},null,8,["onFechar"])])}var he=z(oe,[["render",de]]);export{he as default};
