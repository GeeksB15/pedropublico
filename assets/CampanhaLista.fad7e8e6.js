import{_ as R,o as h,d as w,w as t,f as a,y as W,h as T,i as N,k as d,G as q,Q as k,M as U,dn as aa,C as I,r as C,N as Y,P as ma,L as oa,E as ea,t as y,H as ta,I as pa,D as ia,n as L,F as J,s as Z,B as f,e as D,q as G,J as la,a0 as ha,dv as fa,dx as va,ek as ga,el as Ca,dT as _a,bd as H,az as K,R as z,S as A,j as P,O as X,T as $,z as ba,as as ya,m as B,ei as wa,bF as Aa,l as ka}from"./index.9b156bba.js";import{L as Da}from"./Lista.e33ba20c.js";import{Q as qa}from"./QDate.87f5fb81.js";import{G as xa}from"./GenericModal.d886d0c6.js";import{G as Va}from"./GChipsV2.cdff2fe0.js";import{J as sa}from"./JsonViewer.522116ce.js";import{s as ra}from"./selecaoContaWhatsapp.d2b8e04a.js";import"./xlsx.d5d25b50.js";import"./QBtnDropdown.2d29d66b.js";import"./QBtnGroup.4d3a3d67.js";import"./QScrollArea.e1ed3c28.js";const Ea={data(){return{visivel:!1}},methods:{async anexar(e){const o=await this.toBase64(e[0]);await $utils.geeksApi({ret:{funcao:"D280149A-F8EA-4103-B4AA-656707767F19",idCampanha:this.idCampanha,anexo:o,nomeArquivo:e[0].name}}),this.resolve(!0),this.visivel=!1},onHide(){this.resolve()},async mostrar({idCampanha:e}){return this.idCampanha=e,this.visivel=!0,new Promise((o,l)=>{this.resolve=o})},toBase64(e){return new Promise((o,l)=>{const c=new FileReader;c.readAsDataURL(e),c.onload=()=>o(c.result),c.onerror=i=>l(i)})}}};function $a(e,o,l,c,i,n){return h(),w(I,{modelValue:i.visivel,"onUpdate:modelValue":o[0]||(o[0]=u=>i.visivel=u),onHide:o[1]||(o[1]=u=>n.onHide())},{default:t(()=>[a(W,null,{default:t(()=>[a(T,null,{default:t(()=>[a(N,null,{default:t(()=>[d("Anexar")]),_:1}),q(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[U]])]),_:1}),a(aa,{"auto-expand":"",color:"none",class:"mobile-only",label:"Foto","hide-upload-btn":"","hide-upload-progress":"","dark-light":"",url:"",ref:"fotoCampo",factory:n.anexar},null,8,["factory"]),a(aa,{"auto-expand":"",color:"none",class:"mobile-hide",extensions:".jpg,.mp3,.mp4",label:"Anexo","hide-upload-btn":"","auto-upload":"","dark-light":"",url:"",ref:"fotoCampo",factory:n.anexar},null,8,["factory"])]),_:1})]),_:1},8,["modelValue"])}var Fa=R(Ea,[["render",$a]]);const Ba={data(){return{visivel:!1,idContato:"",nome:"",apelido:"",email:"",telefone:""}},methods:{onHide(){this.resolve()},async mostrar({idCampanha:e}){return this.idCampanha=e,this.visivel=!0,new Promise((o,l)=>{this.resolve=o})},async salvarContato(){try{this.$q.loading.show(),(await $utils.geeksApi({ret:{funcao:"B18C0CB3-5EA1-4E1C-8C31-EB354E5E3DB1",idCampanha:this.idCampanha,idContato:this.idContato,nome:this.nome,apelido:this.apelido,telefone:this.telefone,email:this.email}})).data.ret.erro?$q.notifyError("ret.data.ret.erro"):(this.resolve(!0),this.cancelarContato())}finally{this.$q.loading.hide()}},cancelarContato(){this.idContato="",this.nome="",this.apelido="",this.email="",this.telefone="",this.visivel=!1},async abrirModalContato(){const e={ativo:!0},o=await $g.promptContato.show({filtro:e,placeholder:"Selecione"});if(!o)return;let c=(await $db.contato.leCompletoV3(o.id)).telefone.filter(function(i){return i.tipoTelefone.indexOf("WhatsApp")!==-1});this.idContato=o.id,this.nome=o.nome,this.apelido=o.apelido,this.telefone="",c.length!==0&&c[0].telefone&&(this.telefone=c[0].telefone),this.email=""}}};function Ua(e,o,l,c,i,n){const u=C("campo");return h(),w(I,{modelValue:i.visivel,"onUpdate:modelValue":o[3]||(o[3]=g=>i.visivel=g),onHide:o[4]||(o[4]=g=>n.onHide())},{default:t(()=>[a(W,{class:"row"},{default:t(()=>[a(T,{class:"bg-primary text-white row"},{default:t(()=>[a(N,null,{default:t(()=>[d("Contato")]),_:1}),q(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[U]])]),_:1}),a(Y,{class:"col-12"},{default:t(()=>[a(u,{modelValue:i.nome,"onUpdate:modelValue":o[0]||(o[0]=g=>i.nome=g),rotulo:"Nome",after:[{icon:"search",handler:n.abrirModalContato}],rules:[g=>!!g||"Campo Obrigat\xF3rio"]},null,8,["modelValue","after","rules"]),a(u,{modelValue:i.apelido,"onUpdate:modelValue":o[1]||(o[1]=g=>i.apelido=g),class:"col-12",tipo:"texto",rotulo:"Apelido",rules:[g=>!!g||""]},null,8,["modelValue","rules"]),a(u,{modelValue:i.telefone,"onUpdate:modelValue":o[2]||(o[2]=g=>i.telefone=g),class:"col-12",tipo:"Telefone",rotulo:"Telefone",mask:"(##) #####-####",rules:[g=>!!g||"Campo Obrigat\xF3rio"]},null,8,["modelValue","rules"])]),_:1}),a(Y,{class:"col-12"},{default:t(()=>[a(ma,{align:"right",class:"row"},{default:t(()=>[a(k,{flat:"",class:"bg-primary text-white row",onClick:n.salvarContato},{default:t(()=>[d("Salvar")]),_:1},8,["onClick"]),a(k,{flat:"",onClick:n.cancelarContato},{default:t(()=>[d("Cancelar")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Sa=R(Ba,[["render",Ua]]);const Ha={components:{GChipsV2:Va},data(){return{show:!1,filtro:[]}},emits:["hide","aplicar"],methods:{async handlerSeletor(e){var c,i;const o=(i=(c=this.props)==null?void 0:c.filtro[e])==null?void 0:i.handler;let l;!o||(l=await o(),l&&this.filtro[e].valor.push(l))},async aplicar(){let e=!1;this.$refs.form.getValidationComponents().forEach(o=>{!o.validate()&&!e&&(e=!0)}),!e&&this.$emit("aplicar",$utils.clonarV2(this.filtro))}},props:{props:Object},watch:{props(){var o,l,c,i;const e=[];for(const n of(l=(o=this.props)==null?void 0:o.filtro)!=null?l:[]){const u={};"campo"in n&&(u.campo=n.campo),"operador"in n&&(u.operador=n.operador),"valor"in n&&(u.valor=n.valor),e.push(u)}this.filtro=e,this.show=(i=(c=this.props)==null?void 0:c.show)!=null?i:!1}}},za={class:"col-12"},Pa={key:0,class:"col-4"},Ma={class:"col-8"},Oa=["onClick"],La={class:"col-12"},Ta={class:"col-12"},Na={class:"q-mb-sm"},Ra={class:"col-md-6"},ja={class:"row"},Ia={class:"col-6 col-md-6"},Qa={class:"col-6 col-md-6"},Ga={class:"col-md-6"},Ja={class:"row"},Wa={class:"col-6 col-md-6"},Ya={class:"col-6 col-md-6"},Ka={class:"col-12"},Xa={class:"q-mb-sm"},Za={class:"col-6 col-sm"},ao={class:"col-6 col-sm"};function oo(e,o,l,c,i,n){const u=C("row"),g=C("campo"),_=C("GChipsV2");return h(),w(I,{modelValue:i.show,"onUpdate:modelValue":o[0]||(o[0]=p=>i.show=p),onHide:o[1]||(o[1]=p=>e.$emit("hide"))},{default:t(()=>[a(oa,{container:"",view:"hHh lpR fFf",class:"q-layout-modal bg-white"},{default:t(()=>[a(ea,null,{default:t(()=>[a(T,null,{default:t(()=>[a(N,null,{default:t(()=>[d(y(l.props.titulo),1)]),_:1}),q(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[U]])]),_:1})]),_:1}),a(ta,null,{default:t(()=>[a(pa,null,{default:t(()=>[a(ia,{ref:"form",class:"col q-pa-md"},{default:t(()=>[(h(!0),L(J,null,Z(i.filtro,(p,v)=>(h(),L("div",{key:v},[l.props.filtro[v].tipo==="botao"&&l.props.filtro[v].handler?(h(),w(u,{key:0,class:"q-mb-xl"},{default:t(()=>[f("div",za,[a(k,{color:"primary",icon:l.props.filtro[v].icone,label:l.props.filtro[v].titulo,onClick:b=>n.handlerSeletor(v),style:{width:"100%"}},null,8,["icon","label","onClick"])])]),_:2},1024)):D("",!0),l.props.filtro[v].tipo==="seletor"&&l.props.filtro[v].handler?(h(),w(u,{key:1,class:"q-mb-xl"},{default:t(()=>[p.operador?(h(),L("div",Pa,[a(g,{tipo:"seletor","rotulo-fixo":l.props.filtro[v].titulo,options:l.props.filtro[v].operadores,modelValue:p.operador,"onUpdate:modelValue":b=>p.operador=b},null,8,["rotulo-fixo","options","modelValue","onUpdate:modelValue"])])):D("",!0),f("div",Ma,[f("div",{onClick:b=>n.handlerSeletor(v)},[a(_,{modelValue:p.valor,"onUpdate:modelValue":b=>p.valor=b,class:"q-px-none",useInput:!1,placeholder:"Filtre por C\xF3digo, N\xFAmero..."},null,8,["modelValue","onUpdate:modelValue"])],8,Oa)])]),_:2},1024)):D("",!0),l.props.filtro[v].tipo==="seletor"&&l.props.filtro[v].opcoes?(h(),w(u,{key:2,class:"q-mb-xl"},{default:t(()=>[f("div",La,[a(g,{tipo:"seletor","rotulo-fixo":l.props.filtro[v].titulo,options:l.props.filtro[v].opcoes,modelValue:p.valor,"onUpdate:modelValue":b=>p.valor=b,clearable:""},null,8,["rotulo-fixo","options","modelValue","onUpdate:modelValue"])])]),_:2},1024)):D("",!0),l.props.filtro[v].tipo==="periodoDiaMes"?(h(),w(u,{key:3,class:"q-mb-xl"},{default:t(()=>[f("div",Ta,[f("strong",Na,y(l.props.filtro[v].titulo),1),a(u,null,{default:t(()=>{var b,F,S,m,V,r,E,Q;return[f("div",Ra,[d(" Data Inicial "),f("div",ja,[f("div",Ia,[a(G,{label:"Dia",modelValue:p.valor.diaInicio,"onUpdate:modelValue":M=>p.valor.diaInicio=M,rules:(F=(b=l.props.filtro[v].rules)==null?void 0:b.diaInicio)!=null?F:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),f("div",Qa,[a(G,{label:"M\xEAs",modelValue:p.valor.mesInicio,"onUpdate:modelValue":M=>p.valor.mesInicio=M,rules:(m=(S=l.props.filtro[v].rules)==null?void 0:S.mesInicio)!=null?m:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])])])]),f("div",Ga,[d(" Data Final "),f("div",Ja,[f("div",Wa,[a(G,{label:"Dia",modelValue:p.valor.diaFim,"onUpdate:modelValue":M=>p.valor.diaFim=M,rules:(r=(V=l.props.filtro[v].rules)==null?void 0:V.diaFim)!=null?r:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),f("div",Ya,[a(G,{label:"M\xEAs",modelValue:p.valor.mesFim,"onUpdate:modelValue":M=>p.valor.mesFim=M,rules:(Q=(E=l.props.filtro[v].rules)==null?void 0:E.mesFim)!=null?Q:[],mask:"#","reverse-fill-mask":"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])])])])]}),_:2},1024)])]),_:2},1024)):D("",!0),l.props.filtro[v].tipo==="periodoData"?(h(),w(u,{key:4,class:"q-mb-xl"},{default:t(()=>[f("div",Ka,[f("strong",Xa,y(l.props.filtro[v].titulo),1),a(u,null,{default:t(()=>[f("div",Za,[a(g,{modelValue:p.valor.inicio,"onUpdate:modelValue":b=>p.valor.inicio=b,rotulo:"In\xEDcio",clearable:"",tipo:"data"},null,8,["modelValue","onUpdate:modelValue"])]),f("div",ao,[a(g,{modelValue:p.valor.fim,"onUpdate:modelValue":b=>p.valor.fim=b,rotulo:"Fim",clearable:"",tipo:"data"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)])]),_:2},1024)):D("",!0)]))),128))]),_:1},512)]),_:1})]),_:1}),a(la,null,{default:t(()=>[a(T,{class:"bg-light"},{default:t(()=>[a(N,{class:"text-right"},{default:t(()=>[q(a(k,{flat:"",size:"md","no-ripple":"",color:"tertiary",label:"Cancelar",class:"q-mr-sm"},null,512),[[U]]),a(k,{"no-ripple":"",label:"Aplicar",color:"primary",unelevated:"",class:"no-shadow",onClick:n.aplicar},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var eo=R(Ha,[["render",oo]]);const to={components:{selecaoContaWhatsapp:ra},data(){return{visivel:!1,telefone:"",anexo:[],campanha:{},socket:{conectado:!1,socket:{}}}},emits:["atualizar"],methods:{onHide(){this.resolve({})},testarEnvio(){try{const e=this.telefone,o=this.campanha.mensagem,l=this.contaWhats,c=this.anexo;this.whatsEnvia({funcao:"enviar mensagem",telDestino:e,mensa:o,anexo:c,banco:l}),this.visivel=!1}catch(e){console.log(e.message)}},whatsEnvia(e){if(this.socket=$g.conexaoWpp,this.socket.conectado)try{this.socket.socket.send(JSON.stringify(e))}catch(o){console.log(o.message)}},show(e,o){return this.visivel=!0,this.telefone="",this.campanha=e,this.anexo=o,this.contaWhats=this.campanha.conexao,new Promise((l,c)=>{this.resolve=l})},whatsAlterarConta(e){this.contaWhats=e}}},io={class:"layout-padding"},lo={class:"col-12"},so={class:"col-12"},ro={class:"q-mt-lg text-right"};function no(e,o,l,c,i,n){const u=C("selecaoContaWhatsapp"),g=C("campo"),_=C("row");return h(),w(I,{modelValue:i.visivel,"onUpdate:modelValue":o[2]||(o[2]=p=>i.visivel=p),onHide:o[3]||(o[3]=p=>n.onHide())},{default:t(()=>[a(W,{class:"q-dialog-plugin"},{default:t(()=>[a(T,{class:"bg-primary text-white"},{default:t(()=>[a(N,null,{default:t(()=>[d("Testar Envio da Campanha")]),_:1}),q(a(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[U]])]),_:1}),f("div",io,[a(ia,{class:"q-pa-md",onSubmit:n.testarEnvio},{default:t(()=>[a(_,{class:"items-center q-col-gutter-md"},{default:t(()=>[f("div",lo,[a(u,{conta:e.contaWhats,onAtualizarConexao:o[0]||(o[0]=p=>n.whatsAlterarConta(p)),outlined:""},null,8,["conta"])]),f("div",so,[a(g,{modelValue:i.telefone,"onUpdate:modelValue":o[1]||(o[1]=p=>i.telefone=p),tipo:"texto",rotulo:"Telefone"},null,8,["modelValue"])])]),_:1}),f("div",ro,[q(a(k,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[U]]),a(k,{color:"primary",class:"text-white",unelevated:"",label:"Enviar Teste",type:"submit"})])]),_:1},8,["onSubmit"])])]),_:1})]),_:1},8,["modelValue"])}var co=R(to,[["render",no]]);const uo={components:{modalAnexo:Fa,modalContato:Sa,BadgeCopiarUid:ha,SeletorCampoTabela:fa,GenericModal:xa,PromptGrupoUnico:va,PromptSegmentoUnico:ga,PromptOrigemMarketingUnico:Ca,FiltroDinamico:eo,JsonViewer:sa,CampanhaTesteEnvio:co,selecaoContaWhatsapp:ra},data(){const e=new Date(new Date($utils.dataAtual()).toDateString()),l=new Date(e).setDate(1);return{campanha:{id:"",descricao:"Descri\xE7\xE3o",dataHoraCriacao:$utils.dataAtual(),status:"Rascunho",tipo:"",idContato:"",mensagem:"Mensagem",responsavel:"",idEmpresa:""},campanhaOriginal:{},campanhaContato:[],campanhaAnexo:[],contatoGrupo:[],vendedores:[],filtro:{periodo:{aniversario:{from:`${e.getFullYear()}-${e.getMonth()}-${e.getDate()}`,to:`${e.getFullYear()}-${e.getMonth()}-${e.getDate()+1}`},receitaVencida:{from:l,to:""}}},lastFimReceita:null,opcaoAdicionar:"",grupo:"",segmento:"",vendedor:"",visivel:!1,somenteLeitura:!1,modalTitle:"Filtre contatos",filtroDinamico:null,empresa:{},sistemaPai:"",objetoConexoes:{},opcoesTipo:[],contatoCampo:"",opcoesContatos:[]}},emits:["atualizar"],methods:{async atualizar({id:e}){try{this.$q.loading.show();const o=await $utils.geeksApi({ret:{funcao:"5FBF590B-9B92-4C38-A205-3B4233541140",id:e}});this.campanha=o.data.ret.campanha,this.campanha.conexao||(this.campanha.conexao=this.clienteSistema.bancoDeDados),this.somenteLeitura=o.data.ret.campanha.status!=="Rascunho",this.campanhaOriginal=$utils.clonarV2(this.campanha),await this.$nextTick(),this.atualizarAnexo(o.data.ret.campanhaAnexo),this.atualizarContato(o.data.ret.campanhaContato)}catch(o){$q.notifyError("Ocorreu um erro ao atualizar",o)}finally{this.$q.loading.hide()}},async atualizarAnexo(e){try{await this.$nextTick(),this.campanhaAnexo=e}catch(o){$q.notifyError("Ocorreu um erro ao atualizar anexo",o)}},async atualizarContato(e){try{await this.$nextTick(),this.campanhaContato=e.map(o=>(o.ordenar=this.$utils.removerCaracteresEspeciais(o.nome),o)).sort((o,l)=>o.ordenar>l.ordenar?1:l.ordenar>o.ordenar?-1:0)}catch(o){$q.notifyError("Ocorreu um erro ao atualizar contato",o)}try{await this.$nextTick();const o={};for(const{conexaoEnvio:l}of this.campanhaContato)if(!o[l])if(!l)o[l]="Sem envio";else if(l.startsWith("cpf")){const c=l.substring(3),i=(await $db.contato.le({numeroDocumentoNacional:c}))[0];o[l]=(i==null?void 0:i.nome)+" - CPF"}else if(l.startsWith("cnpj")){const c=l.replace("_","/").substring(4),i=(await $db.hibrido.lista({table:"empresa",whereFilter:{numeroDocumentoNacional:c}}))[0];o[l]=((i==null?void 0:i.sigla)||(i==null?void 0:i.apelido))+" - CNPJ"}else o[l]=l;this.objetoConexoes=o}catch(o){$q.notifyError("Ocorreu um erro ao atualizar conexao de envio",o)}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.campanhaOriginal,this.campanha)},async salvar(){let e=this.verificarSeAlterouCampos();Object.keys(e).length!==0&&(e.funcao="65A200F2-9B9F-40E6-BD3A-282B77FC6BFB",e.id=this.campanha.id,await $utils.geeksApi({ret:e}))},async salvar_click(e){try{$q.loading.show(),this.campanha.idContato||(this.campanha.idContato=$db.usuario.logado.id),await this.salvar(),e||(this.$router.replace({params:{id:""}}),this.$emit("atualizar"),this.visivel=!1)}catch(o){$q.notifyError("Ocorreu um erro ao salvar",o)}finally{$q.loading.hide()}},async enviar_click(){if(this.campanhaContato.length===0){this.$q.notifyError("N\xE3o \xE9 permitido enviar campanha sem lista de contatos!");return}try{$q.loading.show(),this.campanha.status="Enviando",this.campanha.dataHoraDisparo=$utils.dataAtual(),this.campanha.log=`${await this.formatDate(new Date($utils.dataAtual()))} - Campanha disparada por ${$db.usuario.logado.nome} (${$db.usuario.logado.numeroDocumentoNacional}) 
${this.campanha.log||""}`,await this.salvar(),this.fechar()}catch(e){$q.notifyError("Ocorreu um erro!",e)}finally{$q.loading.hide()}},async rascunho_click(){try{$q.loading.show(),this.campanha.status="Rascunho",this.campanha.log=`${await this.formatDate(new Date($utils.dataAtual()))} - Campanha retornada para Rascunho por ${$db.usuario.logado.nome} (${$db.usuario.logado.numeroDocumentoNacional}) 
${this.campanha.log||""}`,await this.salvar(),this.fechar()}catch(e){$q.notifyError("Ocorreu um erro!",e)}finally{$q.loading.hide()}},async mostrar(e){await this.atualizar(e),this.visivel=!0},fechar(){this.$router.replace({params:{id:""}}),this.$emit("atualizar"),this.visivel=!1},async anexar_click(){const e=this.campanha.id;await this.$refs.modalAnexo.mostrar({idCampanha:e})&&(await this.salvar(),await this.atualizar({id:e}))},showFiltersModal(e){e==="carteira-aniversariantes"?this.modalTitle="Aniversariantes":e==="carteira-receitas-vencidas"&&(this.modalTitle="Receitas vencidas"),this.opcaoAdicionar=e,this.$refs.filtersModal.show()},async anexoDownload(e){const o=await $utils.geeksApi({item:{funcao:"B546B803-45E8-40B5-9F28-CFCC323AD5FD",id:e.id}});let l=document.createElement("a");l.href=o.data.item.anexo,l.download=o.data.item.nomeArquivo,l.click()},async anexoRemove(e){this.$q.dialog({cancel:{label:"Manter",push:!0,color:"tertiary",flat:!0},title:"Tem certeza?",message:"Ao continuar voc\xEA ir\xE1 perder esse anexo.",ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{if(this.campanhaContato.find(i=>i.status==="Enviado")){this.$q.notifyError("N\xE3o \xE9 permitido remover o anexo de uma campanha que j\xE1 foi enviada!");return}this.$q.loading.show();const o=this.campanha,l=o.id,c=await $utils.geeksApi({ret:{funcao:"BE8B810E-A49A-4B38-84B8-B758AD5064EF",id:e.id}});await this.atualizar({id:l}),this.campanha=o}finally{this.$q.loading.hide()}})},async adicionarContato(){const e=this.campanha.id;await this.$refs.modalContato.mostrar({idCampanha:e})&&(await this.salvar(),await this.atualizar({id:e}))},async adicionarPorGrupo(){let e=this.grupo;try{this.$q.loading.show(),await this.salvar();const o=this.campanha,l=o.id,c=await $utils.geeksApi({ret:{funcao:"ACC16F3A-88EC-43C6-A9B1-82828ED6E593",idCampanha:l,grupo:e,idEmpresa:this.campanha.idEmpresa}});this.showAddPositiveMsg(),await this.atualizar({id:l}),this.campanha=o}finally{this.$q.loading.hide()}},async adicionarPorSegmento(){let e=this.segmento;try{this.$q.loading.show(),await this.salvar();const o=this.campanha,l=o.id,c=await $utils.geeksApi({ret:{funcao:"3127C40C-0DD3-42A3-A37E-8ACACB52B88D",idCampanha:l,segmento:e,idEmpresa:this.campanha.idEmpresa}});this.showAddPositiveMsg(),await this.atualizar({id:l}),this.campanha=o}finally{this.$q.loading.hide()}},async adicionarPorVendedor(e){this.grupo="",this.$forceUpdate();try{this.$q.loading.show(),await this.salvar();const o=this.campanha,l=o.id,c=await $utils.geeksApi({ret:{funcao:"7B03B118-39D4-4BFB-9F64-12A7020F441F",idCampanha:l,idVendedor:e.id,idEmpresa:this.campanha.idEmpresa}});this.showAddPositiveMsg(),await this.atualizar({id:l}),this.campanha=o}finally{this.$q.loading.hide()}},async adicionarPorContato(e){this.grupo="",this.$forceUpdate();try{this.$q.loading.show(),await this.salvar();const o=this.campanha,l=o.id,c=await $utils.geeksApi({ret:{funcao:"61003235-3E37-4E2F-A7B7-A1F25FD12470",idCampanha:l,idContato:e.id}});this.showAddPositiveMsg(),await this.atualizar({id:l}),this.campanha=o}finally{this.$q.loading.hide()}},async adicionarPorDataAniversario(){let e=new Date(this.filtro.periodo.aniversario.from),o=new Date(this.filtro.periodo.aniversario.to);typeof this.filtro.periodo.aniversario=="string"&&(e=new Date(this.filtro.periodo.aniversario),o=new Date(this.filtro.periodo.aniversario));try{this.$q.loading.show(),await this.salvar();const c=this.campanha.id,i=await $utils.geeksApi({ret:{funcao:"E3BDE3F3-6D9A-424A-B4EB-B28E9757A1E5",idCampanha:c,ini:{mes:e.getMonth()+1,dia:e.getDate()},fim:{mes:o.getMonth()+1,dia:o.getDate()},idEmpresa:this.campanha.idEmpresa}});this.showAddPositiveMsg(),await this.atualizar({id:c})}finally{this.$q.loading.hide()}},async adicionarPorDataReceitaVencida(){const e=new Date(this.filtro.periodo.receitaVencida.from),o=new Date(this.filtro.periodo.receitaVencida.to);if(this.lastFimReceita&&this.lastFimReceita===o.toString())return!1;this.lastFimReceita=o.toString();try{this.$q.loading.show(),await this.salvar();const c=this.campanha.id,i=await $utils.geeksApi({ret:{funcao:"BA806BC5-CAF1-4673-AD4C-572B4AF8DB25",idCampanha:c,ini:{ano:e.getFullYear(),mes:e.getMonth()+1,dia:e.getDate()},fim:{ano:o.getFullYear(),mes:o.getMonth()+1,dia:o.getDate()},idEmpresa:this.campanha.idEmpresa}});this.showAddPositiveMsg(),await this.atualizar({id:c})}finally{this.$q.loading.hide()}},showAddPositiveMsg(){$q.notifyPositive("Contatos vinculados com sucesso!")},async contatoRemoveTodos(){this.$q.dialog({cancel:{label:"Voltar",push:!0,color:"tertiary",flat:!0},title:"Limpar?",message:"Ao continuar sua lista de envio ficar\xE1 limpa.",ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{if(this.campanhaContato.find(c=>c.status==="Enviado")){this.$q.notifyError("N\xE3o \xE9 permitido remover um contato para o qual a campanha j\xE1 foi enviada!");return}this.$q.loading.show();const e=this.campanha,o=e.id,l=await $utils.geeksApi({ret:{funcao:"AE0FFC21-984C-46E0-A9E6-6E8A192DC750",id:o}});await this.atualizar({id:o}),this.campanha=e}finally{this.$q.loading.hide()}})},async contatoRemove(e){try{if((e==null?void 0:e.status)!=="Enviado"){this.$q.loading.show();const o=this.campanha,l=o.id,c=await $utils.geeksApi({ret:{funcao:"15D77453-DEE7-4DD1-B34C-3F6C8D2CC687",id:e.id}});await this.atualizar({id:l}),this.campanha=o}e.status==="Enviado"&&this.$q.notifyError("N\xE3o \xE9 permitido remover um contato para o qual a campanha j\xE1 foi enviada!")}finally{this.$q.loading.hide()}},async concluirFiltros(){this.opcaoAdicionar==="contato-grupo"&&this.adicionarPorGrupo(),this.opcaoAdicionar==="carteira-vendedor"&&this.adicionarPorVendedor(),this.opcaoAdicionar==="carteira-aniversariantes"&&this.adicionarPorDataAniversario(),this.opcaoAdicionar==="carteira-receitas-vencidas"&&this.adicionarPorDataReceitaVencida()},async abrirModalMultiplos(){this.opcoesTipo=_a.map(e=>({label:e.rotulo,value:e.valor})),this.filtroDinamico={show:!0,titulo:"Filtro",filtro:[{titulo:"Empresa",campo:"contatoIdEmpresa",tipo:"seletor",operador:"or",operadores:[{label:"Pelo menos um",value:"or"}],valor:[],handler:async()=>{const e=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione a empresa"});return e?{value:e.id,label:e.apelido||e.nome}:!1}},{titulo:"Grupo",campo:"contatoGrupoDescricao",tipo:"seletor",operador:"and",operadores:[{label:"Cont\xE9m todos",value:"and"},{label:"Cont\xE9m pelo menos um",value:"or"}],valor:[],handler:async()=>{const e=await $g.promptGrupoUnico.show();if(!!e.descricao)return{value:e.descricao,label:e.descricao}}},{titulo:"Carteira do Vendedor",campo:"contatoIdContatoVendedor",tipo:"seletor",operador:"or",operadores:[{label:"Pelo menos um",value:"or"}],valor:[],handler:async()=>{const e=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o vendedor"});if(!!e)return{value:e.id,label:e.nome}}},{titulo:"Profiss\xE3o/Segmento",campo:"contatoSegmento",tipo:"seletor",operador:"or",operadores:[{label:"Pelo menos um",value:"or"}],valor:[],handler:async()=>{const e=await $g.promptSegmentoUnico.show();if(!!e.descricao)return{value:e.descricao,label:e.descricao}}},{titulo:"Origem Marketing",campo:"contatoOrigemMarketing",tipo:"seletor",operador:"or",operadores:[{label:"Pelo menos um",value:"or"}],valor:[],handler:async()=>{const e=await $g.promptOrigemMarketingUnico.show();if(!!e.descricao)return{value:e.descricao,label:e.descricao}}},{titulo:"Tipo de Produto",campo:"tipoProduto",tipo:"seletor",opcoes:this.opcoesTipo,valor:null},{titulo:"Sexo",campo:"contatoSexo",tipo:"seletor",opcoes:[{label:"Masculino",value:"Masculino"},{label:"Feminino",value:"Feminino"},{label:"Outro",value:"Outro"}],valor:null},{titulo:"Anivers\xE1rio",campo:"contatoDataAbertura",tipo:"periodoDiaMes",valor:{diaInicio:"",mesInicio:"",diaFim:"",mesFim:""}},{titulo:"Data da Venda",campo:"vendaDataHoraFinalizado",tipo:"periodoData",valor:{inicio:null,fim:null}},{titulo:"Per\xEDodo sem venda",campo:"periodoSemVenda",tipo:"periodoData",valor:{inicio:null,fim:null}}]},[23,37,40,42,52,53,57,58,63,68].includes(this.clienteSistema.codigoSistema)&&(this.filtroDinamico.filtro.push({titulo:"Data do Envelope",campo:"envelopeDataHoraFinalizado",tipo:"periodoData",valor:{inicio:null,fim:null}}),this.filtroDinamico.filtro.push({titulo:"Receitas Vencidas",campo:"receitaDataHoraFinalizado",tipo:"periodoData",valor:{inicio:null,fim:null}}))},async aplicarFiltroDinamico(e){try{if($q.loading.show(),await this.filtroVazio(e))return $q.notifyError("\xC9 necess\xE1rio pelo menos um filtro para aplic\xE1-lo.");await this.salvar();const o=(await $utils.geeksApi({payload:{funcao:"A8198AC8-69C0-41E2-92AE-109161145256",idCampanha:this.campanha.id,filtro:e}})).data.payload,l=o.filtrosUtilizados,c=o.qtdeContatos;if(l.length>0&&c>0){const i=await this.formatarFiltros(l);this.campanha.log=`${await this.formatDate(new Date($utils.dataAtual()))} - Adicionado os contatos por ${$db.usuario.logado.nome} (${$db.usuario.logado.numeroDocumentoNacional}) utilizando o(s) filtro(s) por:
${i}

${this.campanha.log||""}`,await this.salvar()}if(c===0){$q.notifyError("N\xE3o h\xE1 contatos para o filtro selecionado.");return}this.filtroDinamico=null,this.showAddPositiveMsg(),await this.atualizar({id:this.campanha.id})}catch(o){$q.notify({type:"negative",message:o.message}),console.error(o)}finally{$q.loading.hide()}},async filtroVazio(e){return e.every(o=>Array.isArray(o.valor)?o.valor.length===0:typeof o.valor=="object"&&o.valor!==null?Object.values(o.valor).every(l=>l===""||l===null):o.valor===null||o.valor===void 0)},async criar(){this.campanha={id:$utils.uuid(),descricao:"Descri\xE7\xE3o",dataHoraCriacao:$utils.dataAtual(),status:"Rascunho",tipo:"Whatsapp",mensagem:"Mensagem",idContato:$db.usuario.logado.id,responsavel:$db.usuario.logado.nome,conexao:this.clienteSistema.bancoDeDados,log:`${await this.formatDate(new Date($utils.dataAtual()))} - Campanha criada por ${$db.usuario.logado.nome} (${$db.usuario.logado.numeroDocumentoNacional})`},this.campanhaContato=[],this.campanhaAnexo=[],this.campanhaOriginal={},this.visivel=!0,this.somenteLeitura=!1},uploadClick(){this.$refs.Upload.click()},async abrirArquivo(e){const o=this.$refs.Upload.files;if(FileReader&&o&&o.length){var l=new FileReader;l.onload=()=>{},l.readAsDataURL(o[0]),await this.anexar(o[0])}},toBase64(e){return new Promise((o,l)=>{const c=new FileReader;c.readAsDataURL(e),c.onload=()=>o(c.result),c.onerror=i=>l(i)})},async anexar(e){await this.salvar();const o=await this.toBase64(e);await $utils.geeksApi({ret:{funcao:"D280149A-F8EA-4103-B4AA-656707767F19",idCampanha:this.campanha.id,anexo:o,nomeArquivo:e.name}}),await this.atualizar({id:this.campanha.id})},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)},async testarEnvio_click(){console.log("teste de Envio de Campanha");const e=[];this.campanhaAnexo&&this.campanhaAnexo.forEach(async o=>{const l=await this.buscaAnexo(o.id);e.push(l)}),await $utils.dormir(2e3),await this.$refs.testeEnvio.show(this.campanha,e)},async buscaAnexo(e){try{const o=await $utils.geeksApi({item:{funcao:"B546B803-45E8-40B5-9F28-CFCC323AD5FD",id:e}});return{anexo:o.data.item.anexo,nomeArquivo:o.data.item.nomeArquivo}}catch(o){console.log(o.message)}},async alteraResponsavelEmpresa(e){let o,l,c;e==="responsavel"&&(o={ativo:!0,usuario:!0},l="Selecione o respons\xE1vel",c="o respons\xE1vel"),e==="empresa"&&(o={ativo:!0,empresas:!0},l="Selecione a empresa",c="a empresa"),await $q.dialog({title:"Selecione uma das op\xE7\xF5es abaixo:",options:{type:"radio",model:"alterar",items:[{label:`Alterar ${c}`,value:"alterar",color:"primary"},{label:`Remover ${c}`,value:"remover",color:"negative"}]},cancel:{label:"CANCELAR",push:!0,color:"negative",flat:!0},ok:{label:"CONFIRMAR",push:!0,textColor:"primary",flat:!0}}).onOk(async i=>{if((await $utils.geeksApi({ler:{funcao:"5FBF590B-9B92-4C38-A205-3B4233541140",id:this.campanha.id}})).data.ler.campanha||await this.salvar_click("rapido"),i==="remover")try{if(e==="responsavel"&&!this.campanha.idContato)return $q.notifyPositive("Nenhum respons\xE1vel vinculado para remover!");if(e==="empresa"&&!this.campanha.idEmpresa)return $q.notifyPositive("Nenhuma empresa vinculada para remover!");const u=await $utils.geeksApi({alterar:{funcao:"7FD8CA64-9FB6-4105-92D0-AC0603E09E3A",idCampanha:this.campanha.id,tipo:e,acao:i}});await this.atualizar({id:this.campanha.id}),$q.notifyPositive(`Removido ${c} com sucesso.`)}catch(u){$q.notifyError(`Ocorreu um erro ao remover ${c} da campanha!`),console.error(u)}if(i==="alterar")try{const u=await $g.promptContato.show({filtro:o,placeholder:l});if(e==="responsavel"&&!u){$q.notifyError("Nenhum respons\xE1vel selecionado!");return}if(e==="empresa"&&!u){$q.notifyError("Nenhuma empresa selecionada!");return}const g=await $utils.geeksApi({alterarConexao:{funcao:"7FD8CA64-9FB6-4105-92D0-AC0603E09E3A",idCampanha:this.campanha.id,tipo:e,acao:i,idContato:u.id,nomeContato:u.nome}});await this.atualizar({id:this.campanha.id}),$q.notifyPositive(`Alterado ${c} com sucesso.`)}catch(u){$q.notifyError(`Ocorreu um erro ao alterar ${c} da campanha!`),console.error(u)}}).onCancel(()=>{})},async formatDate(e){if(!(e instanceof Date))throw new Error('Argumento "data" inv\xE1lido. Voc\xEA deve passar uma inst\xE2ncia de data');const o=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),u=String(e.getSeconds()).padStart(2,"0");return`${c}/${l}/${o} - ${i}:${n}:${u}`},async whatsAlterarConta(e){this.campanha.conexao=e},async formatarFiltros(e){return e.length>1?e.join(`
`):e[0]},async contatoBuscar(e,o){try{if(e=e.trim(),this.opcoesContatos=[],e.length>1){const l=(await $db.contato.ler({filtros:{termoBusca:e,ativo:!0}})).data;this.opcoesContatos=l.map(c=>({data:c,label:`${c.apelido} | ${c.nome}`,stamp:"#0000000",sublabel:c.nome,value:c.nome}))}o()}catch{o(),this.$q.notify("Ocorreu um erro ao obter os contatos.")}},async contatoAdicionar(e){var o;this.grupo="",this.contatoCampo="",this.$forceUpdate();try{this.$q.loading.show(),await this.salvar();const l=this.campanha,c=l.id,i=await $utils.geeksApi({ret:{funcao:"61003235-3E37-4E2F-A7B7-A1F25FD12470",idCampanha:c,idContato:e.data.id}});if((o=i.data.ret)!=null&&o.erro){$q.notifyError(i.data.ret.erro);return}this.showAddPositiveMsg(),await this.atualizar({id:c}),this.campanha=l}finally{this.$q.loading.hide()}}},watch:{async"$route.params.id"(){const e=this.$route.params.id;!e||await this.mostrar({id:e})}},mounted(){this.sistemaPai=$utils.sistemaPai(),this.clienteSistema=JSON.parse(localStorage.getItem("clienteSistema"))||{}}},mo={class:"mw80 text-center"},po={style:{padding:"10px","padding-bottom":"0px"}},ho={class:"u-container relative-position"};function fo(e,o,l,c,i,n){const u=C("ajuda"),g=C("g-label"),_=C("g-col"),p=C("badge"),v=C("BadgeCopiarUid"),b=C("g-row"),F=C("campo"),S=C("selecaoContaWhatsapp"),m=C("modalAnexo"),V=C("modalContato"),r=C("SeletorCampoTabela"),E=C("GenericModal"),Q=C("PromptGrupoUnico"),M=C("PromptSegmentoUnico"),na=C("PromptOrigemMarketingUnico"),ca=C("FiltroDinamico"),da=C("JsonViewer"),ua=C("CampanhaTesteEnvio");return h(),L(J,null,[a(I,{modelValue:i.visivel,"onUpdate:modelValue":o[15]||(o[15]=s=>i.visivel=s),persistent:"",maximized:"",onKeyup:Aa(n.fechar,["esc"])},{default:t(()=>[a(oa,{view:"hHh LpR fFf",container:"",class:"bg-light"},{default:t(()=>[a(ea,null,{default:t(()=>[a(T,null,{default:t(()=>[a(k,{onClick:n.fechar,icon:"arrow_back",round:"",flat:"",dense:""},null,8,["onClick"]),a(N,null,{default:t(()=>[d("Campanha: "+y(i.campanha.descricao),1)]),_:1}),a(u,{class:"q-ml-sm"}),q(a(k,{onClick:o[0]||(o[0]=s=>n.salvar_click()),label:"Salvar",color:"white","text-color":"primary",class:"q-ml-sm",unelevated:""},null,512),[[H,!i.somenteLeitura]]),e.$db.usuario.desenvolvedor()?(h(),w(k,{key:0,icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:t(()=>[a(K,null,{default:t(()=>[q((h(),w(z,{clickable:"",onClick:o[1]||(o[1]=s=>n.mostrarJsonViewer())},{default:t(()=>[a(A,{avatar:""},{default:t(()=>[a(P,{name:"mdi-file-replace",size:"sm"})]),_:1}),a(A,null,{default:t(()=>[d("Ver Objeto")]),_:1})]),_:1})),[[U]])]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}),a(ta,{class:"u-container"},{default:t(()=>[a(b,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(_,{col:"12"},{default:t(()=>[a(b,null,{default:t(()=>[a(_,{col:"xs",class:"center-header"},{default:t(()=>[a(g,{text:"sub1 medium",icon:"edit_note sm tertiary left"},{default:t(()=>[d("Detalhes")]),_:1})]),_:1}),a(_,{col:"xs-shrink",class:"center-header"},{default:t(()=>[a(p,{rotulo:i.campanha.status,cor:i.campanha.status==="Enviada"?"tertiary":"light",escuro:i.campanha.status==="Enviada"},null,8,["rotulo","cor","escuro"]),a(v,{id:i.campanha.id,cor:"positive",class:"q-mx-sm"},null,8,["id"]),a(k,{icon:"more_vert",flat:"",dense:"",round:"",size:"md"},{default:t(()=>[a(K,null,{default:t(()=>[a(X,{link:"","no-border":"",separator:""},{default:t(()=>[q((h(),w(z,{clickable:"",onClick:o[2]||(o[2]=s=>n.alteraResponsavelEmpresa("responsavel"))},{default:t(()=>[a(A,{avatar:""},{default:t(()=>[a(P,{name:"how_to_reg"})]),_:1}),a(A,null,{default:t(()=>[a($,null,{default:t(()=>[d("Alterar respons\xE1vel")]),_:1})]),_:1})]),_:1})),[[U]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(_,{col:"12 md5"},{default:t(()=>{var s;return[a(F,{somenteLeitura:i.somenteLeitura||typeof((s=this.campanhaContato.find(x=>x.status==="Enviado"))==null?void 0:s.id)!="undefined",modelValue:i.campanha.descricao,"onUpdate:modelValue":o[3]||(o[3]=x=>i.campanha.descricao=x),rotulo:"Titulo da campanha",filled:"",dense:"",class:"q-md-b"},null,8,["somenteLeitura","modelValue"])]}),_:1}),a(_,{col:"12 md"},{default:t(()=>[a(F,{modelValue:i.campanha.responsavel,"onUpdate:modelValue":o[4]||(o[4]=s=>i.campanha.responsavel=s),rotulo:"Respons\xE1vel",somenteLeitura:"",filled:"",dense:"",class:"q-md-b"},null,8,["modelValue"])]),_:1}),a(_,{col:"12 md"},{default:t(()=>[a(S,{conta:i.campanha.conexao,onAtualizarConexao:o[5]||(o[5]=s=>n.whatsAlterarConta(s)),filled:""},null,8,["conta"])]),_:1}),a(_,{col:"12"},{default:t(()=>{var s;return[a(F,{modelValue:i.campanha.mensagem,"onUpdate:modelValue":o[6]||(o[6]=x=>i.campanha.mensagem=x),tipo:"textoArea",rotulo:"Mensagem",somenteLeitura:i.somenteLeitura||typeof((s=this.campanhaContato.find(x=>x.status==="Enviado"))==null?void 0:s.id)!="undefined"},null,8,["modelValue","somenteLeitura"])]}),_:1}),a(_,{col:"12"},{default:t(()=>[a(g,{caption:""},{default:t(()=>[d(" Voc\xEA pode usar os seguintes argumentos na mensagem para deixar ainda mais personalizado sua campanha: "),a(p,{class:"q-mr-xs"},{default:t(()=>[d("[Nome]")]),_:1}),a(p,{class:"q-mr-xs"},{default:t(()=>[d("[PrimeiroNome]")]),_:1}),a(p,{class:"q-mr-xs"},{default:t(()=>[d("[Apelido]")]),_:1}),a(p,{class:"q-mr-xs"},{default:t(()=>[d("[PrimeiroApelido]")]),_:1})]),_:1})]),_:1}),a(_,{col:"12"},{default:t(()=>[a(ba,{"expand-separator":"",icon:"description",label:"Log",caption:"Registro de atividades"},{default:t(()=>[a(W,null,{default:t(()=>[a(Y,{style:{whiteSpace:"pre-wrap"}},{default:t(()=>[d(y(i.campanha.log),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(b,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(_,{col:"12"},{default:t(()=>[a(k,{onClick:n.uploadClick,disable:!!i.campanhaContato.find(s=>s.status==="Enviado"),icon:"image",label:"Anexos","icon-right":"add",size:"md",outline:"","text-color":"tertiary",class:"full-width"},null,8,["onClick","disable"]),f("input",{ref:"Upload",type:"file",id:"Upload",onChange:o[7]||(o[7]=(...s)=>n.abrirArquivo&&n.abrirArquivo(...s)),style:{visibility:"hidden"}},null,544),(h(!0),L(J,null,Z(i.campanhaAnexo,s=>(h(),w(b,{key:s,gutter:"sm",mg:"sm-y",items:"center",bordered:"","rounded-borders":"",class:"itemHover"},{default:t(()=>[a(_,{col:"xs-shrink"},{default:t(()=>{var x,O;return[a(v,{id:(x=s==null?void 0:s.id)!=null?x:"",numero:((O=s==null?void 0:s.id)!=null?O:"").slice(-8),cor:"positive"},null,8,["id","numero"])]}),_:2},1024),a(_,{col:"xs",onClick:x=>n.anexoDownload(s),class:"cursor-pointer"},{default:t(()=>[a(g,{text:"bold",color:"tertiary"},{default:t(()=>[d(y(s.nomeArquivo),1)]),_:2},1024)]),_:2},1032,["onClick"]),a(_,{col:"xs-shrink"},{default:t(()=>[q(a(k,{onClick:x=>n.anexoRemove(s),disable:!!i.campanhaContato.find(x=>x.status==="Enviado"),icon:"delete",size:"md",color:"tertiary",round:"",flat:"",dense:""},null,8,["onClick","disable"]),[[H,!i.somenteLeitura]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(b,{gutter:"md",mg:"md",items:"center",bg:"bg-white"},{default:t(()=>[a(_,{col:"xs"},{default:t(()=>[a(g,{text:"sub1 medium",icon:"person sm tertiary left"},{default:t(()=>[d("Contatos ("+y(i.campanhaContato.length)+")",1)]),_:1})]),_:1}),a(_,{col:"xs-shrink"},{default:t(()=>[q(a(ya,{modelValue:i.contatoCampo,"onUpdate:modelValue":[o[8]||(o[8]=s=>i.contatoCampo=s),n.contatoAdicionar],"use-input":"","input-debounce":"500",label:"Contatos",options:i.opcoesContatos,outlined:"",onFilter:n.contatoBuscar,dense:""},null,8,["modelValue","options","onFilter","onUpdate:modelValue"]),[[H,!i.somenteLeitura]])]),_:1}),a(_,{col:"xs-shrink"},{default:t(()=>[q(a(k,{onClick:n.abrirModalMultiplos,icon:"add",size:"md",round:"",flat:"",dense:""},{default:t(()=>[a(B,null,{default:t(()=>[d(" Adicionar contatos por filtro ")]),_:1})]),_:1},8,["onClick"]),[[H,!i.somenteLeitura]]),q(a(k,{onClick:o[9]||(o[9]=s=>n.contatoRemoveTodos({})),disable:!!i.campanhaContato.find(s=>s.status==="Enviado"),icon:"delete",size:"md",color:"tertiary",round:"",flat:"",dense:"",class:"q-mr-xs"},{default:t(()=>[a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Excluir todos")]),_:1})]),_:1},8,["disable"]),[[H,!i.somenteLeitura]])]),_:1}),i.campanhaContato.length>0?(h(),w(_,{key:0,col:"xs12"},{default:t(()=>[a(wa,{items:i.campanhaContato,style:{"max-height":"65vh"}},{default:t(({item:s,index:x})=>[(h(),w(z,{key:x,class:"q-py-sm q-px-xs items-center border-full itemHover"},{default:t(()=>[a(A,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:t(()=>{var O,j;return[f("div",mo,[a(v,{id:(O=s==null?void 0:s.idContato)!=null?O:"",numero:((j=s==null?void 0:s.idContato)!=null?j:"").slice(-8),cor:"positive"},null,8,["id","numero"])])]}),_:2},1024),a(A,{clickable:""},{default:t(()=>[a($,{lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[d(y(s.nome)+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Nome")]),_:1})]),_:2},1024),a($,{caption:"",lines:"1",class:"text-tertiary ellipsis"},{default:t(()=>[d(y(s.apelido)+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Apelido")]),_:1})]),_:2},1024),a(A,{class:"hideondesktop q-mt-sm"},{default:t(()=>[a(b,{items:"center",class:"hideondesktop"},{default:t(()=>[a(_,{col:"12 sm-shrink"},{default:t(()=>{var O,j;return[s!=null&&s.idContato?(h(),w(v,{key:0,id:(O=s==null?void 0:s.idContato)!=null?O:"",numero:((j=s==null?void 0:s.idContato)!=null?j:"").slice(-8),cor:"positive",class:"q-mr-sm"},null,8,["id","numero"])):D("",!0),a(p,{cor:s.status==="Enviado"?"tertiary":"light",escuro:s.status==="Enviado",rotulo:s.status==="Enviado"?"Enviado":"Rascunho",class:"q-mr-sm q-mb-sm"},null,8,["cor","escuro","rotulo"]),a(p,{cor:s!=null&&s.conexaoEnvio?"primary":"tertiary",escuro:!0,rotulo:i.objetoConexoes[s==null?void 0:s.conexaoEnvio]||"",class:"col-auto q-mx-auto"},null,8,["cor","rotulo"])]}),_:2},1024),s.dataHoraEnvio?(h(),w(_,{key:0,col:"12 sm-shrink",class:"q-mr-sm"},{default:t(()=>[a(g,{caption:"",icon:"mdi-calendar-today xs tertiary left"},{default:t(()=>[d(y(e.$filters.dataHora(s.dataHoraEnvio)),1)]),_:2},1024)]),_:2},1024)):D("",!0),s.telefone?(h(),w(_,{key:1,col:"12 sm-shrink",class:"q-mr-sm"},{default:t(()=>[a(g,{caption:"",icon:"phone xs tertiary left"},{default:t(()=>[d(y(s.telefone),1)]),_:2},1024)]),_:2},1024)):D("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(A,{class:"hideonmobile maxw160 q-pl-sm no-margin"},{default:t(()=>[a($,null,{default:t(()=>[a(g,{icon:"phone xs tertiary left",tip:"Telefone"},{default:t(()=>[d(y(s.telefone),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(A,{class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[s.dataHoraEnvio?(h(),w($,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[a(P,{name:"mdi-calendar-today"}),d(" "+y(e.$filters.data(s.dataHoraEnvio))+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Enviado \xE1s "+y(e.$filters.hora(s.dataHoraEnvio)),1)]),_:2},1024)]),_:2},1024)):D("",!0)]),_:2},1024),a(A,{class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:t(()=>[a(p,{cor:s.status==="Enviado"?"tertiary":"light",escuro:s.status==="Enviado",rotulo:s.status==="Enviado"?"Enviado":"Rascunho",class:"col-auto q-mx-auto"},{default:t(()=>[a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Status")]),_:1})]),_:2},1032,["cor","escuro","rotulo"])]),_:2},1024),a(A,{class:"hideonmobile q-pl-sm no-margin",style:{"max-width":"max-content"}},{default:t(()=>[a(p,{cor:s!=null&&s.conexaoEnvio?"primary":"tertiary",escuro:!0,rotulo:i.objetoConexoes[s==null?void 0:s.conexaoEnvio]||"",class:"col-auto q-mx-auto"},{default:t(()=>[a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Conex\xE3o utilizada para envio da mensagem")]),_:1})]),_:2},1032,["cor","rotulo"])]),_:2},1024),q(a(A,{class:"col-auto q-pl-sm no-margin"},{default:t(()=>[a(k,{onClick:O=>n.contatoRemove(s),disable:s.status==="Enviado",icon:"delete",size:"md",color:"tertiary",round:"",flat:"",dense:""},null,8,["onClick","disable"])]),_:2},1536),[[H,!i.somenteLeitura]])]),_:2},1024))]),_:1},8,["items"])]),_:1})):D("",!0)]),_:1})]),_:1}),a(m,{ref:"modalAnexo"},null,512),a(V,{ref:"modalContato"},null,512),a(E,{ref:"filtersModal"},{genericHeader:t(()=>[d(y(i.modalTitle),1)]),genericContent:t(()=>[q(f("div",po,[a(b,{items:"center",justify:"center"},{default:t(()=>[a(_,{class:"q-my-none q-mx-auto"},{default:t(()=>[i.opcaoAdicionar==="contato-grupo"?(h(),w(r,{key:0,modelValue:i.grupo,"onUpdate:modelValue":o[10]||(o[10]=s=>i.grupo=s),tabela:"contatoGrupo",campo:"label",label:"Filtre",buscarSemCaractere:!0,filtro:{ativo:!0,vendedores:!0}},null,8,["modelValue"])):D("",!0),i.opcaoAdicionar==="carteira-vendedor"?(h(),w(r,{key:1,modelValue:i.vendedor,"onUpdate:modelValue":o[11]||(o[11]=s=>i.vendedor=s),tabela:"contato",campo:"nome",label:"Filtre",buscarSemCaractere:!0,filtro:{ativo:!0,vendedores:!0},enableObj:!0},null,8,["modelValue"])):D("",!0),i.opcaoAdicionar==="carteira-aniversariantes"?(h(),w(b,{key:2,gutter:"md",mg:"md-l-ng",class:"date-without-year"},{default:t(()=>[a(_,{col:"12"},{default:t(()=>[a(qa,{modelValue:i.filtro.periodo.aniversario,"onUpdate:modelValue":o[12]||(o[12]=s=>i.filtro.periodo.aniversario=s),title:"Aniversariantes",range:"",subtitle:"Selecione um periodo"},null,8,["modelValue"])]),_:1})]),_:1})):D("",!0),i.opcaoAdicionar==="carteira-receitas-vencidas"?(h(),w(b,{key:3,gutter:"md",mg:"md-t",class:"invalid-recipes"},{default:t(()=>[a(_,{col:"12"},{default:t(()=>[a(F,{modelValue:i.filtro.periodo.receitaVencida.from,"onUpdate:modelValue":o[13]||(o[13]=s=>i.filtro.periodo.receitaVencida.from=s),tipo:"data",class:"no-shadow full-width",after:[{icon:"mdi-close-circle",handler(){i.filtro.periodo.receitaVencida.ini=""}}],rotulo:"De",dense:""},null,8,["modelValue","after"])]),_:1}),a(_,{col:"12"},{default:t(()=>[a(F,{modelValue:i.filtro.periodo.receitaVencida.to,"onUpdate:modelValue":o[14]||(o[14]=s=>i.filtro.periodo.receitaVencida.to=s),tipo:"data",class:"no-shadow full-width",after:[{icon:"mdi-close-circle",handler(){i.filtro.periodo.receitaVencida.fim=""}}],rotulo:"at\xE9",col:"12",dense:""},null,8,["modelValue","after"])]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1})],512),[[H,!i.somenteLeitura]])]),genericFooter:t(()=>[q(a(k,{onClick:n.concluirFiltros,label:"Avan\xE7ar",color:"primary",flat:""},null,8,["onClick"]),[[U]])]),_:1},512),a(la,{class:"bg-light q-pa-sm text-right u-bordaCima"},{default:t(()=>[f("div",ho,[q(a(k,{onClick:n.testarEnvio_click,type:"submit",icon:"send",label:"Testar Envio",color:"primary",unelevated:""},null,8,["onClick"]),[[H,!i.somenteLeitura]]),q(a(k,{onClick:n.enviar_click,type:"submit",icon:"send",label:"Enviar",color:"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[H,!i.somenteLeitura]]),q(a(k,{onClick:n.rascunho_click,type:"submit",label:"Voltar para Rascunho",color:"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[H,i.somenteLeitura]])])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(Q,{ref:"PromptGrupoUnico"},null,512),a(M,{ref:"PromptSegmentoUnico"},null,512),a(na,{ref:"PromptOrigemMarketingUnico"},null,512),a(ca,{props:i.filtroDinamico,onAplicar:n.aplicarFiltroDinamico},null,8,["props","onAplicar"]),a(da,{ref:"jsonViewer"},null,512),a(ua,{ref:"testeEnvio",onAtualizar:n.atualizar},null,8,["onAtualizar"])],64)}var vo=R(uo,[["render",fo]]);const go={components:{Lista:Da,campanhaFicha:vo,JsonViewer:sa},data(){return{usuario:"",lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"campaign",titulo:"Campanhas",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},busca:"",filtrosOriginal:{},filtros:{termoBusca:null,tipo:null,descricao:null,mensagem:null,dataHoraCriacaoDe:null,dataHoraCriacaoAte:null,dataHoraDisparoDe:null,dataHoraDisparoAte:null,dataHoraUltimoDisparoDe:null,dataHoraUltimoDisparoAte:null},tabSelecionada:{valor:"Rascunho"},tabs:[{valor:"Rascunho",rotulo:"Rascunhos"},{valor:"Enviando",rotulo:"Enviando"},{valor:"Enviada",rotulo:"Enviadas"},{valor:"Todos",rotulo:"Todos"}],paginacao:{atual:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(e){var o,l,c,i,n,u,g,_,p,v,b,F;try{$q.loading.show(),this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor;let{buscarDadosRecentes:S}=e!=null?e:{},m={},V={};S&&(m=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"CampanhasLista_"+((o=this.usuario)==null?void 0:o.id)}),m!=null&&m._id&&(this.tabSelecionada.valor=m==null?void 0:m.tabSelecionada,this.busca=(m==null?void 0:m.busca)||"",this.filtros={termoBusca:((l=m==null?void 0:m.filtros)==null?void 0:l.termoBusca)||null,tipo:((c=m==null?void 0:m.filtros)==null?void 0:c.tipo)||null,descricao:((i=m==null?void 0:m.filtros)==null?void 0:i.descricao)||null,mensagem:((n=m==null?void 0:m.filtros)==null?void 0:n.mensagem)||null,dataHoraCriacaoDe:((u=m==null?void 0:m.filtros)==null?void 0:u.dataHoraCriacaoDe)||null,dataHoraCriacaoAte:((g=m==null?void 0:m.filtros)==null?void 0:g.dataHoraCriacaoAte)||null,dataHoraDisparoDe:((_=m==null?void 0:m.filtros)==null?void 0:_.dataHoraDisparoDe)||null,dataHoraDisparoAte:((p=m==null?void 0:m.filtros)==null?void 0:p.dataHoraDisparoAte)||null,dataHoraUltimoDisparoDe:((v=m==null?void 0:m.filtros)==null?void 0:v.dataHoraUltimoDisparoDe)||null,dataHoraUltimoDisparoAte:((b=m==null?void 0:m.filtros)==null?void 0:b.dataHoraUltimoDisparoAte)||null},this.compareObject(this.filtrosOriginal,this.filtros,["termoBusca"])&&(this.$refs.campanhasLista.filtros=!0))),V=$utils.eliminarVazios(this.filtros),V.status=this.tabSelecionada.valor,this.tabSelecionada.valor==="Todos"&&delete V.status,this.busca&&(/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(this.busca)?(V={},this.tabSelecionada.valor="Todos",this.paginacao.atual=1,V.id=this.busca):V.termoBusca=this.busca);const r=(await $utils.geeksApi({ret:{funcao:"5FBF590B-9B92-4C38-A205-3B4233541140",filtros:V,limit:this.paginacao.limite,page:this.paginacao.atual,sort:"descricao"}})).data.ret;r.total||(r.total=r.total=r.data.length),r.totalPages||(r.totalPages=r.total/this.paginacao.limite),this.lista=r.data,this.paginacao.total=r.total,this.paginacao.maximo=r.totalPages,m={_id:"CampanhasLista_"+((F=this.usuario)==null?void 0:F.id),tabSelecionada:this.tabSelecionada.valor,busca:this.busca,filtros:$utils.clonar(V)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:m})}catch(S){$q.notifyError("Erro iniciar",S)}finally{$q.loading.hide()}},async abrir(e){this.$router.replace({params:{id:e}}).finally(()=>{this.$refs.modalFicha.mostrar({id:e})})},async copiarCampanha(e){this.$q.dialog({title:"Duplicar Campanha?",message:"Deseja criar uma c\xF3pia desta campanha?",cancel:{label:"Voltar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{this.$q.loading.show();const o=await $utils.geeksApi({ret:{funcao:"5FBF590B-9B92-4C38-A205-3B4233541140",id:e}}),l=$utils.clonar(o.data.ret.campanha),c=$utils.clonar(o.data.ret.campanhaContato),i=$utils.clonar(o.data.ret.campanhaAnexo);if(l.id=$utils.uuid(),l.status="Rascunho",l.dataHoraCriacao=new Date,l.dataHoraDisparo=null,l.dataHoraUltimoDisparo=null,l.log=null,await $utils.geeksApi({ret:{funcao:"65A200F2-9B9F-40E6-BD3A-282B77FC6BFB",...l}}),i.length>0)for(let n in i){if(!i[n].anexo){const u=await $utils.geeksApi({buscaAnexo:{funcao:"B546B803-45E8-40B5-9F28-CFCC323AD5FD",id:i[n].id}});i[n].anexo=u.data.buscaAnexo.anexo}i[n].id=$utils.uuid(),i[n].idCampanha=l.id,await $utils.geeksApi({ret:{funcao:"D280149A-F8EA-4103-B4AA-656707767F19",idCampanha:l.id,anexo:i[n].anexo,nomeArquivo:i[n].nomeArquivo}})}if(c.length>0)for(let n of c)(await $utils.geeksApi({ret:{funcao:"B18C0CB3-5EA1-4E1C-8C31-EB354E5E3DB1",idCampanha:l.id,idContato:n.idContato,nome:n.nome,apelido:n.apelido,telefone:n.telefone,email:n.email}})).data.ret.erro?$q.notifyError("ret.data.ret.erro"):console.log("contato adicionado!");await this.atualizar(),this.editarCopiaCampanha_click(l.id)}catch(o){console.log(o.message)}finally{this.$q.loading.hide()}})},editarCopiaCampanha_click(e){this.$q.dialog({title:"Campanha duplicada",message:"Deseja editar agora a c\xF3pia da campanha?",cancel:{label:"N\xE3o",push:!0,class:"bg-linght",textColor:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async()=>{try{this.$q.loading.show(),this.abrir(e)}catch(o){console.log(o.message)}finally{this.$q.loading.hide()}})},criarClick(){this.$refs.modalFicha.criar()},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)},async deletarCampanhaRascunho(e){const o=await $utils.geeksApi({deletar:{funcao:"B0DD9B0A-F684-4829-8772-B42670470017",id:e}});o.data.deletar.erro===0?$q.notifyPositive(o.data.deletar.mensagem):$q.notifyError(o.data.deletar.mensagem),await this.atualizar()},compareObject(e,o,l=[]){const c=Object.keys(e);for(const i of c)if(!l.includes(i)){if(typeof e[i]=="object"&&e[i]!==null){if(!this.compareObject(e[i],o[i],l))continue;return!0}else if(e[i]!==o[i])return!0}return!1}},async mounted(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),this.$route.params.id&&this.$route.params.id.length?(this.$refs.modalFicha.mostrar({id:this.$route.params.id}),this.busca=this.$route.params.id,await this.atualizar()):await this.atualizar({buscarDadosRecentes:!0})}},Co={id:"CampanhasLista"},_o={class:"mw80 text-center"},bo={class:"text-weight-medium q-mr-xs"},yo={class:"text-weight-medium q-mr-xs"},wo={class:"text-weight-medium q-mr-xs"},Ao={class:"text-weight-medium"},ko={class:"text-weight-medium"},Do={class:"text-weight-medium"},qo={class:"text-weight-medium"},xo={class:"text-weight-medium"};function Vo(e,o,l,c,i,n){const u=C("campo"),g=C("BadgeCopiarUid"),_=C("avatar"),p=C("badge"),v=C("g-col"),b=C("g-label"),F=C("g-row"),S=C("Lista"),m=C("campanhaFicha"),V=C("JsonViewer");return h(),L("div",Co,[a(S,{ref:"campanhasLista",busca:i.busca,"onUpdate:busca":o[10]||(o[10]=r=>i.busca=r),onCriarClick:n.criarClick,onAtualizar:n.atualizar,onLimparFiltrosClick:n.limparFiltrosClick,lista:i.lista,tabSelecionada:i.tabSelecionada,tabs:i.tabs,paginacao:i.paginacao,mostrar:i.mostrar},{menuExtras:t(()=>[q((h(),w(z,{onClick:o[0]||(o[0]=r=>n.mostrarJsonViewer()),clickable:""},{default:t(()=>[a(A,{avatar:""},{default:t(()=>[a(P,{name:"mdi-file-replace",size:"sm"})]),_:1}),a(A,null,{default:t(()=>[d("Ver Objeto")]),_:1})]),_:1})),[[U]])]),filtroCampos:t(()=>[a(u,{modelValue:i.filtros.descricao,"onUpdate:modelValue":o[1]||(o[1]=r=>i.filtros.descricao=r),dense:"",rotulo:"Nome da Campanha",class:"q-mt-sm"},null,8,["modelValue"]),a(u,{modelValue:i.filtros.mensagem,"onUpdate:modelValue":o[2]||(o[2]=r=>i.filtros.mensagem=r),dense:"",rotulo:"Mensagem",class:"q-mt-lg"},null,8,["modelValue"]),a(u,{modelValue:i.filtros.dataHoraCriacaoDe,"onUpdate:modelValue":o[3]||(o[3]=r=>i.filtros.dataHoraCriacaoDe=r),dense:"",rotulo:"Data cria\xE7\xE3o",tipo:"data",class:"q-mt-xl"},null,8,["modelValue"]),a(u,{modelValue:i.filtros.dataHoraCriacaoAte,"onUpdate:modelValue":o[4]||(o[4]=r=>i.filtros.dataHoraCriacaoAte=r),rotulo:"at\xE9",tipo:"data",dense:"",class:"q-mt-sm"},null,8,["modelValue"]),a(u,{modelValue:i.filtros.dataHoraDisparoDe,"onUpdate:modelValue":o[5]||(o[5]=r=>i.filtros.dataHoraDisparoDe=r),dense:"",rotulo:"Data disparo",tipo:"data",class:"q-mt-xl"},null,8,["modelValue"]),a(u,{modelValue:i.filtros.dataHoraDisparoAte,"onUpdate:modelValue":o[6]||(o[6]=r=>i.filtros.dataHoraDisparoAte=r),dense:"",rotulo:"at\xE9",tipo:"data",class:"q-mt-sm"},null,8,["modelValue"]),a(u,{modelValue:i.filtros.dataHoraUltimoDisparoDe,"onUpdate:modelValue":o[7]||(o[7]=r=>i.filtros.dataHoraUltimoDisparoDe=r),dense:"",rotulo:"Data \xFAltimo disparo",tipo:"data",class:"q-mt-xl"},null,8,["modelValue"]),a(u,{modelValue:i.filtros.dataHoraUltimoDisparoAte,"onUpdate:modelValue":o[8]||(o[8]=r=>i.filtros.dataHoraUltimoDisparoAte=r),dense:"",rotulo:"at\xE9",tipo:"data",class:"q-mt-sm"},null,8,["modelValue"]),a(u,{modelValue:i.paginacao.limite,"onUpdate:modelValue":o[9]||(o[9]=r=>i.paginacao.limite=r),dense:"",tipo:"quantidade",rotulo:"Quantidade por p\xE1gina",min:"1",class:"q-mt-xl q-mb-lg"},null,8,["modelValue"])]),itemLista:t(()=>[a(X,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:t(()=>[(h(!0),L(J,null,Z(i.lista,r=>(h(),L("div",{key:r.id,class:"itemHover"},[a(z,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[a(A,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:t(()=>[f("div",_o,[a(g,{id:r.id,numero:r.id.slice(-8),cor:"positive",dica:"ID Campanha"},null,8,["id","numero"])])]),_:2},1024),a(A,{class:"col no-margin"},{default:t(()=>[a(z,{class:"q-pa-none"},{default:t(()=>[a(A,{class:"col-auto items-center"},{default:t(()=>[a(_,{imagem:r.imagem,rotulo:r.descricao,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1024),a(A,{onClick:E=>n.abrir(r.id),class:"col cursor-pointer"},{default:t(()=>[a($,{lines:"2",class:"text-weight-bold ellipsis-2-lines"},{default:t(()=>[f("span",null,[d(y(r.descricao||"Sem descri\xE7\xE3o")+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Descri\xE7\xE3o")]),_:1})])]),_:2},1024),r.responsavel?(h(),w($,{key:0,caption:""},{default:t(()=>[f("span",null,[d(y(r.responsavel)+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d("Respons\xE1vel")]),_:1})])]),_:2},1024)):D("",!0),a(A,{class:"hideondesktop q-mt-sm"},{default:t(()=>[a(F,{mg:"xs-b"},{default:t(()=>[a(v,{col:"12",class:"q-mt-xs"},{default:t(()=>[a(g,{id:r.id,escuro:"",cor:"positive",numero:r.id.slice(-8),class:"q-mr-sm"},null,8,["id","numero"]),a(p,{rotulo:r.status,class:"q-mr-sm",cor:r.status!=="Rascunho"?"tertiary":"light",escuro:r.status!=="Rascunho"},null,8,["rotulo","cor","escuro"])]),_:2},1024),r.dataHoraCriacao?(h(),w(v,{key:0,col:"12",class:"q-mt-xs"},{default:t(()=>[a(b,null,{default:t(()=>[d(" Cria\xE7\xE3o: "),f("span",bo,y(e.$filters.data(r.dataHoraCriacao)),1),d(" "+y(e.$filters.hora(r.dataHoraCriacao)),1)]),_:2},1024)]),_:2},1024)):D("",!0),r.dataHoraDisparo?(h(),w(v,{key:1,col:"12",class:"q-mt-xs"},{default:t(()=>[a(b,null,{default:t(()=>[d(" Disparo: "),f("span",yo,y(e.$filters.data(r.dataHoraDisparo)),1),d(" "+y(e.$filters.hora(r.dataHoraDisparo)),1)]),_:2},1024)]),_:2},1024)):D("",!0),r.dataHoraUltimoDisparo?(h(),w(v,{key:2,col:"12",class:"q-mt-xs"},{default:t(()=>[a(b,null,{default:t(()=>[d(" \xDAltimo: "),f("span",wo,y(e.$filters.data(r.dataHoraUltimoDisparo)),1),d(" "+y(e.$filters.hora(r.dataHoraUltimoDisparo)),1)]),_:2},1024)]),_:2},1024)):D("",!0),a(v,{col:"12",class:"q-mt-xs"},{default:t(()=>[a(b,{inline:"",class:"q-mr-sm"},{default:t(()=>[d(" Contatos: "),f("span",Ao,y(r.qtdeContatos),1)]),_:2},1024),a(b,{inline:"",class:"q-mr-sm"},{default:t(()=>[d(" Enviados: "),f("span",ko,y(r.qtdeEnviado),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),a(A,{onClick:E=>n.abrir(r.id),class:"hideonmobile maxw150 q-pl-sm no-margin cursor-pointer"},{default:t(()=>[r.dataHoraCriacao?(h(),w($,{key:0,caption:"",lines:"1",class:"ellipsis"},{default:t(()=>[f("span",null,[a(P,{name:"mdi-calendar-today",class:"q-mr-xs"}),f("span",Do,y(e.$filters.data(r.dataHoraCriacao)),1),d(" "+y(e.$filters.hora(r.dataHoraCriacao))+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d(" Criado ")]),_:1})])]),_:2},1024)):D("",!0),r.dataHoraDisparo?(h(),w($,{key:1,caption:"",lines:"1",class:"ellipsis"},{default:t(()=>[f("span",null,[a(P,{name:"mdi-calendar-today",class:"q-mr-xs"}),f("span",qo,y(e.$filters.data(r.dataHoraDisparo)),1),d(" "+y(e.$filters.hora(r.dataHoraDisparo))+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d(" Disparado ")]),_:1})])]),_:2},1024)):D("",!0),r.dataHoraUltimoDisparo?(h(),w($,{key:2,caption:"",lines:"1",class:"ellipsis"},{default:t(()=>[f("span",null,[a(P,{name:"mdi-calendar",class:"q-mr-xs"}),f("span",xo,y(e.$filters.data(r.dataHoraUltimoDisparo)),1),d(" "+y(e.$filters.hora(r.dataHoraUltimoDisparo))+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[d(" \xDAltimo Disparo ")]),_:1})])]),_:2},1024)):D("",!0)]),_:2},1032,["onClick"]),a(A,{onClick:E=>n.abrir(r.id),class:"hideonmobile maxw90 q-pl-sm no-margin cursor-pointer"},{default:t(()=>[a(p,{rotulo:r.status,dica:"Status",class:"col-auto q-mx-auto",cor:r.status!=="Rascunho"?"tertiary":"light",escuro:r.status!=="Rascunho"},null,8,["rotulo","cor","escuro"])]),_:2},1032,["onClick"]),a(A,{onClick:E=>n.abrir(r.id),class:"hideonmobile maxw60 q-pl-sm no-margin cursor-pointer"},{default:t(()=>[a($,{class:"text-weight-bold text-right"},{default:t(()=>[d(y(r.qtdeContatos),1)]),_:2},1024),a($,{caption:"",class:"text-right"},{default:t(()=>[d("Contatos")]),_:1})]),_:2},1032,["onClick"]),a(A,{onClick:E=>n.abrir(r.id),class:"hideonmobile maxw60 q-pl-sm no-margin cursor-pointer"},{default:t(()=>[a($,{class:"text-weight-bold text-right"},{default:t(()=>[d(y(r.qtdeEnviado),1)]),_:2},1024),a($,{caption:"",class:"text-right"},{default:t(()=>[d("Enviados")]),_:1})]),_:2},1032,["onClick"]),a(A,{class:"col-auto q-pl-sm no-margin"},{default:t(()=>[a(z,{class:"q-pa-none"},{default:t(()=>[a(A,{class:"hideonmobile no-margin"},{default:t(()=>[a(k,{onClick:E=>n.abrir(r.id),round:"",flat:"",dense:"",icon:"edit",size:"md",color:"primary"},null,8,["onClick"])]),_:2},1024),a(A,{class:"no-margin"},{default:t(()=>[a(k,{icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:t(()=>[a(K,null,{default:t(()=>[q((h(),w(X,{link:"","no-border":"",separator:""},{default:t(()=>[a(z,{onClick:E=>n.abrir(r.id),clickable:"",class:"hideondesktop"},{default:t(()=>[a(A,{avatar:""},{default:t(()=>[a(P,{name:"edit"})]),_:1}),a(A,null,{default:t(()=>[d("Editar")]),_:1})]),_:2},1032,["onClick"]),a(z,{onClick:E=>n.copiarCampanha(r.id),clickable:""},{default:t(()=>[a(A,{avatar:""},{default:t(()=>[a(P,{name:"content_copy"})]),_:1}),a(A,null,{default:t(()=>[d("Duplicar")]),_:1})]),_:2},1032,["onClick"]),r.status==="Rascunho"&&r.qtdeEnviado===0?(h(),w(z,{key:0,onClick:E=>n.deletarCampanhaRascunho(r.id),clickable:""},{default:t(()=>[a(A,{avatar:""},{default:t(()=>[a(P,{name:"delete"})]),_:1}),a(A,null,{default:t(()=>[d("Excluir")]),_:1})]),_:2},1032,["onClick"])):D("",!0)]),_:2},1024)),[[U]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(ka)]))),128))]),_:1})]),_:1},8,["busca","onCriarClick","onAtualizar","onLimparFiltrosClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),a(m,{ref:"modalFicha",onAtualizar:n.atualizar},null,8,["onAtualizar"]),a(V,{ref:"jsonViewer"},null,512)])}var Lo=R(go,[["render",Vo]]);export{Lo as default};
