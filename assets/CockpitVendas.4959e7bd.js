import{_ as I,bh as q,c4 as U,r as h,o as t,n as p,f as d,w as c,B as b,j as E,d as g,Q as A,ax as O,G as Q,R as N,S as P,k as j,M as B,e as m,y as H,z,bC as C,F as y,s as _,O as R,aV as S}from"./index.188ab8e6.js";import{G as T}from"./GChipsV2.9138ddff.js";import{n as G}from"./nfePrincipal.e422e0b1.js";import{V as J}from"./VendaCard.ae4ba91e.js";import{E as M}from"./EnvelopeCard.3fec4b25.js";import{J as L}from"./JsonViewer.3dbbef92.js";import"./compactarValidarNFe.fa14073c.js";import"./obterItens.304de8cb.js";import"./codigosANP.a6c1a264.js";import"./emitirNFe.35117289.js";import"./DocumentosFiscais.faec51ff.js";import"./Campo.d9b8e121.js";import"./ModalHistoricoStatus.544a4c46.js";const K={components:{GChipsV2:T,nfePrincipal:G,VendaCard:J,VendaModal:q,EnvelopeCard:M,JsonViewer:L},computed:{temVendasAbertas(){return!!this.vendasAbertas.length},temVendasCanceladas(){return!!this.vendasCanceladas.length},temVendasFinalizadas(){return!!this.vendasFinalizadas.length},temRegistros(){return this.temVendasAbertas||this.temVendasCanceladas||this.temVendasFinalizadas}},data(){return{grupos:[],vendasAbertas:[],vendasCanceladas:[],vendasFinalizadas:[],dataIni:null,dataFim:null,carregando:!1,paginacao:{page:1,rowsPerPage:25},modalDevolucaoGarantia:{visivel:!1},pagination:{maxPages:7,perPage:5,vendasAbertas:{page:1,min:1,max:1},vendasFinalizadas:{page:1,min:1,max:1},vendasCanceladas:{page:1,min:1,max:1}}}},methods:{adicionarOrcamento(){this.$refs.modalVenda.mostrar()},fechouNFe(n){n&&$utils.emitter.emit("atualizarDocumentosFiscais")},async atualizar(){this.paginacao={page:1,rowsPerPage:25},this.carregando=!0,await this.filtrar(),this.carregando=!1},executar(n){this.atualizar()},async filtrar(){let n=[],i={};this.$route.params.id&&(i=await $db.contato.le({id:this.$route.params.id})),i.id||this.$router.go(-1);let r;r=await $db.hibrido.lista({table:"documento",where:{tipo:"Venda",idContatoVendedor:i.id}}),n=n.concat(r),r=await $db.hibrido.lista({table:"documento",where:{tipo:"Venda",idContatoDigitador:i.id}}),r=r.filter(o=>!n.map(({id:s})=>s).includes(o.id)),n=n.concat(r),r=await $db.hibrido.lista({table:"documento",where:{tipo:"Venda",idEmpresa:i.id}}),r=r.filter(o=>!n.map(({id:s})=>s).includes(o.id)),n=n.concat(r),r=await $db.hibrido.lista({table:"documento",where:{tipo:"Envelope",idContatoVendedor:i.id}}),n=n.concat(r),r=await $db.hibrido.lista({table:"documento",where:{tipo:"Envelope",idContatoDigitador:i.id}}),r=r.filter(o=>!n.map(({id:s})=>s).includes(o.id)),n=n.concat(r),r=await $db.hibrido.lista({table:"documento",where:{tipo:"Envelope",idEmpresa:i.id}}),r=r.filter(o=>!n.map(({id:s})=>s).includes(o.id)),n=n.concat(r);const k=await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos"),a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(k||(n=n.filter(o=>a.find(s=>s.id===o.idEmpresa))),this.dataIni&&this.dataFim){const o=new Date(this.dataIni).setHours(0,0,0,0),s=new Date(this.dataFim).setHours(0,0,0,0);n=n.filter(v=>{let f=v.dataHoraFinalizado||v.dataHoraEmissao;if(f)return f=new Date(f).setHours(0,0,0,0),f>=o&&f<=s})}if(this.grupos.length){const o=[];for(const s of n){const v=[];let f=!0,x="";const w=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:s.id}});for(const e of w){if(!e.idItem)continue;const u=await $erp().item.get(e.idItem);v.find(D=>D===u.id)||(x+=`${u.codigoItem} ${u.referencia||""} ${u.codigoBarras||""} ${u.marca||""} ${u.descricao||""} `,v.push(u.id))}x+=`#${s.numero} ${s.descricaoEmpresa||""} ${s.descricaoContato||""} `,x+=`${s.numeroDocumentoContato||""} ${(s.numeroDocumentoContato||"").replace(/\D/g,"")}`,x=$utils.tratamentoCompletoString(x),o.push(s.id);for(const e of this.grupos)if(f=x.search($utils.tratamentoCompletoString(e))>-1,!f){o.pop();break}}n=n.filter(s=>o.find(v=>v===s.id))}n=$lodash.orderBy(n,["dataHoraFinalizado","dataHoraEmissao"],["desc","desc"]);const l=n.filter(o=>o.status==="Or\xE7amento"),F=n.filter(o=>!["N\xE3o Aprovado","Cancelado","Or\xE7amento"].includes(o.status)),V=n.filter(o=>["N\xE3o Aprovado","Cancelado"].includes(o.status));this.pagination.vendasAbertas.max=(l.length/5|0)+(l.length%5>0?1:0),this.pagination.vendasFinalizadas.max=(F.length/5|0)+(F.length%5>0?1:0),this.pagination.vendasCanceladas.max=(V.length/5|0)+(V.length%5>0?1:0),this.vendasAbertas=l,this.vendasFinalizadas=F,this.vendasCanceladas=V},limparFiltro(){this.grupos=[],this.dataFim=new Date,this.dataIni=new Date(U().add(-7,"days"))},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},props:{periodo:Object},watch:{"$route.params.id"(n){!~this.$route.name.indexOf("CockpitVendas")||(this.limparFiltro(),this.atualizar())}},mounted(){if(this.$route.params.id){if(this.limparFiltro(),this.periodo&&this.periodo.ini&&this.periodo.fim){const n=new Date(new Date().setHours(0,0,0,0)).toISOString().replace(/\d{4}-\d{2}-\d{2}/g,"");this.dataIni=this.periodo.ini.replace(/T.+$/g,n),this.dataFim=this.periodo.fim.replace(/T.+$/g,n)}this.atualizar()}}},W={class:"AtendimentoVenda q-pb-md"},X={class:"col-12 col-md-6"},Y={class:"col"},Z={class:"col"},$={key:0,class:"col-12",style:{"margin-bottom":"50px"}},aa={key:1,class:"col-12",style:{"margin-bottom":"50px"}},ea={key:0,class:"col-12",style:{"margin-bottom":"50px"}},na={key:1,class:"col-12",style:{"margin-bottom":"50px"}},ia={key:0,class:"col-12",style:{"margin-bottom":"50px"}},ta={key:1,class:"col-12",style:{"margin-bottom":"50px"}},sa={key:1,class:"q-pa-lg text-center"},oa={key:2,class:"q-mt-lg text-center"};function la(n,i,r,k,a,l){const F=h("GChipsV2"),V=h("campo"),o=h("row"),s=h("VendaCard"),v=h("EnvelopeCard"),f=h("VendaModal"),x=h("nfePrincipal"),w=h("JsonViewer");return t(),p("div",W,[d(H,{class:"q-pa-sm no-shadow"},{default:c(()=>[d(o,{class:"items-center q-col-gutter-md"},{default:c(()=>[b("div",X,[d(F,{modelValue:a.grupos,"onUpdate:modelValue":[i[0]||(i[0]=e=>a.grupos=e),l.atualizar],placeholder:"Filtre por C\xF3digo, Produto, Marca, N\xFAmero..."},{prepend:c(()=>[d(E,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),b("div",Y,[d(V,{modelValue:a.dataIni,"onUpdate:modelValue":[i[1]||(i[1]=e=>a.dataIni=e),l.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),i[11]||(i[11]=b("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[b("label",null,"at\xE9")],-1)),b("div",Z,[d(V,{modelValue:a.dataFim,"onUpdate:modelValue":[i[2]||(i[2]=e=>a.dataFim=e),l.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),n.$db.usuario.desenvolvedor()?(t(),g(A,{key:0,icon:"more_vert",round:"",flat:""},{default:c(()=>[d(O,null,{default:c(()=>[Q((t(),g(N,{clickable:"",onClick:i[3]||(i[3]=e=>l.mostrarJsonViewer())},{default:c(()=>[d(P,{avatar:""},{default:c(()=>[d(E,{name:"mdi-file-replace",size:"sm"})]),_:1}),d(P,null,{default:c(()=>i[10]||(i[10]=[j("Ver Objeto")])),_:1})]),_:1})),[[B]])]),_:1})]),_:1})):m("",!0)]),_:1})]),_:1}),!a.carregando&&l.temRegistros?(t(),g(R,{key:0,class:"no-border row"},{default:c(()=>[l.temVendasAbertas?(t(),g(z,{key:0,class:"col-12 q-mb-xl","default-opened":"",label:"Abertas (Total R$ "+n.$filters.numero(a.vendasAbertas.reduce((e,u)=>e+u.totalDocumento,0),2)+")",group:"vendasAbertas"},{default:c(()=>[a.pagination.vendasAbertas.max>1?(t(),p("div",$,[d(C,{modelValue:a.pagination.vendasAbertas.page,"onUpdate:modelValue":i[4]||(i[4]=e=>a.pagination.vendasAbertas.page=e),min:a.pagination.vendasAbertas.min,max:a.pagination.vendasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(t(!0),p(y,null,_(a.vendasAbertas.slice((a.pagination.vendasAbertas.page-1)*a.pagination.perPage,a.pagination.vendasAbertas.page*a.pagination.perPage),e=>(t(),p("div",{key:e.id},[e.tipo==="Venda"?(t(),g(s,{key:0,id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):m("",!0),e.tipo==="Envelope"?(t(),g(v,{key:1,id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):m("",!0)]))),128)),a.pagination.vendasAbertas.max>1?(t(),p("div",aa,[d(C,{modelValue:a.pagination.vendasAbertas.page,"onUpdate:modelValue":i[5]||(i[5]=e=>a.pagination.vendasAbertas.page=e),min:a.pagination.vendasAbertas.min,max:a.pagination.vendasAbertas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),l.temVendasFinalizadas?(t(),g(z,{key:1,class:"col-12 q-mb-xl","default-opened":"",label:"Finalizadas (Total R$ "+n.$filters.numero(a.vendasFinalizadas.reduce((e,u)=>e+u.totalDocumento,0),2)+")",group:"vendasFinalizadas"},{default:c(()=>[a.pagination.vendasFinalizadas.max>1?(t(),p("div",ea,[d(C,{modelValue:a.pagination.vendasFinalizadas.page,"onUpdate:modelValue":i[6]||(i[6]=e=>a.pagination.vendasFinalizadas.page=e),min:a.pagination.vendasFinalizadas.min,max:a.pagination.vendasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(t(!0),p(y,null,_(a.vendasFinalizadas.slice((a.pagination.vendasFinalizadas.page-1)*a.pagination.perPage,a.pagination.vendasFinalizadas.page*a.pagination.perPage),e=>(t(),p("div",{key:e.id},[e.tipo==="Venda"?(t(),g(s,{key:0,id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):m("",!0),e.tipo==="Envelope"?(t(),g(v,{key:1,id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):m("",!0)]))),128)),a.pagination.vendasFinalizadas.max>1?(t(),p("div",na,[d(C,{modelValue:a.pagination.vendasFinalizadas.page,"onUpdate:modelValue":i[7]||(i[7]=e=>a.pagination.vendasFinalizadas.page=e),min:a.pagination.vendasFinalizadas.min,max:a.pagination.vendasFinalizadas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0),l.temVendasCanceladas?(t(),g(z,{key:2,class:"col-12 q-mb-xl","default-opened":"",label:"Canceladas (Total R$ "+n.$filters.numero(a.vendasCanceladas.reduce((e,u)=>e+u.totalDocumento,0),2)+")",group:"vendasCanceladas"},{default:c(()=>[a.pagination.vendasCanceladas.max>1?(t(),p("div",ia,[d(C,{modelValue:a.pagination.vendasCanceladas.page,"onUpdate:modelValue":i[8]||(i[8]=e=>a.pagination.vendasCanceladas.page=e),min:a.pagination.vendasCanceladas.min,max:a.pagination.vendasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0),(t(!0),p(y,null,_(a.vendasCanceladas.slice((a.pagination.vendasCanceladas.page-1)*a.pagination.perPage,a.pagination.vendasCanceladas.page*a.pagination.perPage),e=>(t(),p("div",{key:e.id},[e.tipo==="Venda"?(t(),g(s,{key:0,id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):m("",!0),e.tipo==="Envelope"?(t(),g(v,{key:1,id:e.id,onExecutar:l.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):m("",!0)]))),128)),a.pagination.vendasCanceladas.max>1?(t(),p("div",ta,[d(C,{modelValue:a.pagination.vendasCanceladas.page,"onUpdate:modelValue":i[9]||(i[9]=e=>a.pagination.vendasCanceladas.page=e),min:a.pagination.vendasCanceladas.min,max:a.pagination.vendasCanceladas.max,ellipses:"","max-pages":a.pagination.maxPages,class:"float-right"},null,8,["modelValue","min","max","max-pages"])])):m("",!0)]),_:1},8,["label"])):m("",!0)]),_:1})):m("",!0),!a.carregando&&!l.temRegistros?(t(),p("div",sa,i[12]||(i[12]=[b("p",null,[b("small",null,"Registros n\xE3o encontrados")],-1)]))):m("",!0),a.carregando?(t(),p("div",oa,[d(S,{color:"tertiary",size:50})])):m("",!0),d(A,{round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},onClick:l.adicionarOrcamento},null,8,["onClick"]),d(f,{ref:"modalVenda",onExecutar:l.executar},null,8,["onExecutar"]),d(x,{onFechar:l.fechouNFe},null,8,["onFechar"]),d(w,{ref:"jsonViewer"},null,512)])}var Ca=I(K,[["render",la]]);export{Ca as default};
