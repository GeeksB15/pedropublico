import{_ as Q,Y as G,r as E,o as f,d as _,w as s,f as i,L as Y,E as W,h as U,G as X,Q as w,M as Z,i as P,k as h,H as K,I as aa,B as r,j,t as m,aq as oa,n as y,aV as ta,e as C,N as k,m as z,u as O,y as I,P as N,O as V,F as A,s as $,R as M,J as ea,aY as ia,C as sa,X as ra,c$ as B,ax as na,S as T,T as R,z as J}from"./index.f2a220da.js";import{C as la}from"./CaixaFechar.f0477eec.js";import{G as da}from"./GChipsV2.ac8e38be.js";const ca={components:{Badge:G,CaixaFechar:la},data(){return{documentoCaixa:{},mostrarDinheiro:!1,documentoStatusSelecionado:{},documentoStatus:[],caixa:{},campos:{},dinheiro:{},acertoDinheiro:0,acertos:[],totalAcertos:0,totalDinheiro:0,formasPagamento:[],totaisFormasPagamento:{},outrasFormasPagamento:{},condicoesPagamentoFechamento:{},valorAberturaSistema:0,valorFundoCaixa:0,valorFundoCaixaSistema:0,valorFechamento:0,diferencaFundo:0,diferencaAbertura:0,contatos:{},usuarios:{},documentos:{},mostrarSangrias:!1,sangrias:[],totalSangrias:0,mostrarSangriaFinal:!1,sangriaFinal:[],totalSangriaFinal:0,observacoesSangrias:{},mostrarDespesas:!1,despesas:[],totalDespesas:0,mostrarSuprimentos:!1,suprimentos:[],totalSuprimentos:0,visivel:!1,edicao:!1,carregando:!0,faturaModal:{visivel:!1,id:""},vendaModal:{visivel:!1,id:""},visibilidade:{botao:{reabrir:!1,finalizar:!1}},atualizarAoFecharModal:!1}},emits:["executar","update:modelValue"],methods:{aoFecharModal(){this.atualizarAoFecharModal&&this.$emit("executar","atualizar")},obterDivergencias(){let l=[],a=$utils.arredondar(-this.diferencaFundo);if(a){let g=this.formasPagamento.filter(b=>b.tipo===1);g.length&&(g=g[0],l.push({...g,diferenca:a}))}for(const g of this.formasPagamento.filter(b=>b.tipo!==1&&b.tipoFinanceiro==="T\xEDtulo Liquidado")){let b=(this.totaisFormasPagamento[g.id]||{}).totalSistema||0,o=(this.totaisFormasPagamento[g.id]||{}).totalInformadoUsuario||0;a=$utils.arredondar(b-o),a&&l.push({...g,diferenca:a})}return l},cor(l,a,g){let b=(this.totaisFormasPagamento[g]||{}).totalSistema||0,o=(this.totaisFormasPagamento[g]||{}).totalInformadoUsuario||0,p=$utils.arredondar(b-o);if(a==="card"){switch(l){case"outraFormaPagamento":if(p)return"itemError";break}return"itemOk"}switch(l){case"abertura":if(this.diferencaAbertura)return"text-negative";break;case"fundo":if(this.diferencaFundo)return"text-negative";break;case"outraFormaPagamento":if(p)return"text-negative";break}return"text-blue-8"},async atualizar(){var l;try{this.$q.loading.show({message:"Processando..."}),this.documentoCaixa=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa}),this.caixa=await $db.caixa.leCache({id:this.documentoCaixa.idCaixa});const a=await $db.contato.le({id:this.documentoCaixa.idEmpresa}),g=await $db.hibrido.le({table:"contato",id:this.documentoCaixa.idContato});let b=await $db.documentoStatus.le({idDocumento:this.documentoCaixa.id});switch(b=$lodash.orderBy(b,"dataHoraEmissao","desc"),b.pop(),this.visibilidade={botao:{reabrir:!1,finalizar:!1,fechar:!1}},b[0].statusFinalizado){case"Aguardando Confer\xEAncia":this.visibilidade.botao.reabrir=!0,this.visibilidade.botao.finalizar=!0;break;case"Reaberto":this.visibilidade.botao.fechar=!0;break;case"Fechado":this.visibilidade.botao.reabrir=!0;break}let o={};this.documentoStatus=[];for(let e of b){const d=await $db.contatoCpf.leCache(e.cpfUsuario);this.documentoStatus.push({label:`${e.statusFinalizado} - ${this.$filters.dataHora(e.dataHoraEmissao)} - ${(l=d==null?void 0:d.nome)!=null?l:"Usu\xE1rio n\xE3o identificado"}`,value:e.id,statusFinalizado:e.statusFinalizado})}this.documentoStatusSelecionado=this.documentoStatus[0],this.campos.caixaEmpresaNome=a.nome,this.campos.dataHoraAbertura=this.documentoCaixa.dataHoraEmissao,this.campos.nomeUsuarioAbertura=g.nome,this.valorAberturaSistema=0;const p=`declare @codigoFinanceiroPlanoConta int = (select codigoFinanceiroPlanoConta from financeiroPlanoConta where id = ${$utils.sqlStr(this.caixa.idPlanoConta)})
            declare @codigoEmpresa int = (select codigoEmpresa from documento where id = ${$utils.sqlStr(this.documentoCaixa.id)})
            declare @dataAbertura varchar(10) = (select format(cast(dataHoraEmissao as date), 'dd/MM/yyyy') dataAbertura from documento where id = ${$utils.sqlStr(this.documentoCaixa.id)})

          if (@codigoFinanceiroPlanoConta is not null and @codigoEmpresa is not null and @dataAbertura is not null)
          begin
            exec sp_financeiroMovimentacao_calcula_saldoPeriodo @codigoFinanceiroPlanoConta, @codigoEmpresa, 'DataPagamento', @dataAbertura, @dataAbertura, 0
          end`;let n=new Date(this.documentoCaixa.dataHoraEmissao).setMilliseconds(0);n=new Date(n);let u=await $utils.executarSql(p);u=$lodash.orderBy(u,"Ordem","asc"),u=u.filter(e=>!e.DataMovimento||new Date(e.DataMovimento)<n);const x=u[u.length-1];this.valorAberturaSistema=$utils.arredondar(x.ValorSaldo||0),this.diferencaAbertura=$utils.arredondar(((this.documentoCaixa||{}).valorAbertura||0)-this.valorAberturaSistema),this.$q.loading.hide(),this.visivel=!0,this.preencherConferencia()}catch(a){this.$q.notifyError("N\xE3o foi poss\xEDvel abrir a confer\xEAncia.",a)}finally{this.$q.loading.hide()}},fechar(){this.$refs.Fechar.mostrar({idDocumentoCaixa:this.documentoCaixa.id})},async finalizar(){var l,a;try{let g=this.obterDivergencias(),b="Deseja finalizar a confer\xEAncia?",o="Deseja finalizar a confer\xEAncia e lan\xE7ar movimenta\xE7\xF5es financeiras para acertar as diverg\xEAncias?";try{await new Promise((F,S)=>{this.$q.dialog({message:g.length?o:b,noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{F()}).onCancel(()=>{S()})}),this.$q.loading.show({message:"Processando..."})}catch{return}const p=$utils.dataAtual(),n=[],u=[];if(g.length){let F=await $db.documentoStatus.le({idDocumento:this.documentoCaixa.id});F=F.filter(q=>q.operacao==="Fechamento Caixa"&&q.statusFinalizado==="Aguardando Confer\xEAncia"&&q.statusOriginal==="Aberto");const S=F.length?F[0].dataHoraEmissao:p;let H=await $db.configuracoes.le({nome:"financeiro.planocontas.diferencacaixa"});if(H.length){const q=parseInt(H[0].valor);Number.isInteger(q)&&(H=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:q}))}if(!(H||{}).id){this.$q.notify("Faltando par\xE2metro da conta Diferen\xE7a de Caixa.");return}for(const q of g){const t=$utils.uuid();u.push(t),n.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:t,idEmpresa:this.documentoCaixa.idEmpresa,idContato:$db.usuario.logado.id,idFinanceiroPlanoConta:H.id,valorDebito:q.diferenca>0?q.diferenca:0,valorCredito:q.diferenca<0?Math.abs(q.diferenca):0,dataEmissao:p,dataCompetencia:S,dataVencimento:S,dataMovimento:S,descricao:`Acerto do caixa #${this.documentoCaixa.id} Conta ${q.descricao}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id}),n.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:t,idEmpresa:this.documentoCaixa.idEmpresa,idContato:$db.usuario.logado.id,idFinanceiroPlanoConta:q.tipo===1?this.documentoCaixa.idFinanceiroPlanoContaCaixa:q.idFinanceiroPlanoConta,valorDebito:q.diferenca<0?Math.abs(q.diferenca):0,valorCredito:q.diferenca>0?q.diferenca:0,dataEmissao:p,dataCompetencia:S,dataVencimento:S,dataMovimento:S,descricao:`Acerto do caixa #${this.documentoCaixa.id} Conta ${q.descricao}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id})}}const x={id:$utils.uuid(),idDocumento:this.documentoCaixa.id,operacao:"Confer\xEAncia Finalizada",statusOriginal:"Aguardando Confer\xEAncia",statusFinalizado:"Fechado",dataHoraEmissao:p,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:this.documentoCaixa.id};let e=$utils.clonar(this.documentoCaixa);e.status="Fechado";let d,v=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:this.documentoStatus[0].value}});((l=v==null?void 0:v[0])==null?void 0:l.tabela)==="caixaCompleto"?(d=JSON.parse((a=v[0])==null?void 0:a.json),d.acertos=d.acertos||[],console.log("Finalizando",$utils.clonarV2(d))):v=v.map(F=>({...F,id:$utils.uuid(),idDocumentoStatus:x.id,dataHoraEmissao:p})),await $db.documento.grava({atual:e,original:this.documentoCaixa}),await $db.documentoStatus.grava({atual:x});for(const F of u)await $db.financeiroMovimentacaoN.grava({atual:{id:F}});for(const F of n)d?d.acertos.push(F):v.push({id:$utils.uuid(),idDocumentoCaixa:e.id,idDocumentoStatus:x.id,tabela:"financeiroMovimentacao",idTabela:F.id,json:JSON.stringify(F),dataHoraEmissao:p}),await $db.financeiroMovimentacao.grava({atual:F});if(d){console.log("Finalizado",$utils.clonarV2(d));const F={id:$utils.uuid(),idDocumentoCaixa:e.id,idDocumentoStatus:x.id,tabela:"caixaCompleto",json:JSON.stringify(d),dataHoraEmissao:p};await $db.hibrido.grava("caixaConsolidacao2",{atual:F})}else for(const F of v)await $db.hibrido.grava("caixaConsolidacao2",{atual:F});this.$q.loading.hide(),this.$emit("executar","atualizar"),this.visivel=!1,this.$q.notify({message:"Confer\xEAncia finalizada.",type:"positive"})}catch(g){this.$q.notifyError("N\xE3o foi poss\xEDvel finalizar a confer\xEAncia.",g)}finally{this.$q.loading.hide()}},async preencherConferencia(){var S,H,q;this.carregando=!0,await $utils.dormir(500),this.refreshData();const l=this.documentoStatusSelecionado.value;let a=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:l}});if(((S=a[0])==null?void 0:S.tabela)==="caixaCompleto")return this.preencherConferenciaNew(a);if(!a.length)try{const t=await $utils.geeksApi({caixaConsolidacao2:{funcao:"6B2B2761-B645-4818-BAC0-5DB6D946FDA1",idDocumentoStatus:l}});a=(H=t==null?void 0:t.data)==null?void 0:H.caixaConsolidacao2}catch(t){$q.notify({message:"N\xE3o foi poss\xEDvel obter informa\xE7\xF5es do servidor. Por favor, verifique sua conex\xE3o e tente novamente.",type:"negative"}),console.error(t)}a=a.map(t=>({...t,json:JSON.parse(t.json)}));let g={},b={};for(let t of a)if((q=t.json)!=null&&q.idContato){const c=await $db.contato.le({id:t.json.idContato}),D=await $db.usuario.le({id:t.json.idContato});c!=null&&c.id&&(g[c.id]=c),D!=null&&D.id&&(b[D.id]=D)}this.contatos=g,this.usuarios=b;let o=a.filter(t=>t.tabela==="financeiroMovimentacao"&&t.json.documentoTipo==="Acerto").map(t=>t.json);const p=a.filter(t=>t.tabela==="financeiroTitulo").map(t=>t.json),n=a.filter(t=>t.tabela==="financeiroMovimentacao").map(t=>t.json);this.sangrias=n.filter(t=>["Sangria"].includes(t.documentoTipo)&&t.valorCredito>0),this.totalSangrias=$utils.arredondar(this.sangrias.reduce((t,c)=>t+(c.valorCredito||0),0)),this.sangriaFinal=n.filter(t=>["Sangria Final"].includes(t.documentoTipo)&&t.valorCredito>0),this.totalSangriaFinal=$utils.arredondar(this.sangriaFinal.reduce((t,c)=>t+(c.valorCredito||0),0)),this.carregarObservacoesSangrias(),this.suprimentos=n.filter(t=>t.documentoTipo==="Suprimento"&&t.valorDebito>0),this.totalSuprimentos=$utils.arredondar(this.suprimentos.reduce((t,c)=>t+(c.valorDebito||0),0));const u=n.filter(t=>t.documentoTipo==="DespesaSimples"&&t.valorCredito>0);this.despesas=p.filter(t=>u.find(c=>c.idFinanceiroMovimentacaoN===t.idFinanceiroMovimentacaoAgrupamento)),this.totalDespesas=$utils.arredondar(this.despesas.reduce((t,c)=>t+(c.valorRealizado||0),0)),this.formasPagamento=(await $db.formaPagamento.listaCache()).map(t=>({id:t.id,idFinanceiroPlanoConta:t.idFinanceiroPlanoConta,tipoFinanceiro:t.tipoFinanceiro,tipo:t.tipo,descricao:t.descricao,mostrar:!1}));const x=a.filter(t=>t.tabela==="documentoCondicaoPagamento"&&t.json.ordem).map(t=>t.json);this.valorFechamento=$utils.arredondar(x.reduce((t,c)=>(this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&(t+=c.valor||0),t),0)),this.condicoesPagamentoFechamento=x.reduce((t,c)=>(t[c.idFormaPagamento]=c,t),{});let e=a.filter(t=>t.tabela==="documentoCondicaoPagamento"&&!t.json.ordem).map(t=>t.json);this.dinheiro=e.reduce((t,c)=>(this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&t.push(c),t),[]),this.totalDinheiro=$utils.arredondar(this.dinheiro.reduce((t,c)=>t+(c.valor||0),0)),this.valorFundoCaixa=$utils.arredondar(this.valorFechamento-this.sangriaFinal.filter(t=>t.documentoTipo==="Sangria Final").reduce((t,c)=>t+(c.valorCredito||0),0));const d=this.valorAberturaSistema+this.totalDinheiro-this.totalSangrias-this.totalSangriaFinal-this.totalDespesas+this.totalSuprimentos;this.diferencaFundo=$utils.arredondar(this.valorFundoCaixa-d),this.acertoDinheiro=o.filter(t=>t.idFinanceiroPlanoConta===this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((t,c)=>t+(c.valorDebito||0)-(c.valorCredito||0),0),this.valorFundoCaixaSistema=$utils.arredondar(d+this.acertoDinheiro),this.acertoDinheiro=$utils.arredondar(this.acertoDinheiro*-1),this.outrasFormasPagamento=e.reduce((t,c)=>(!t[c.idFormaPagamento]&&this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta!==this.caixa.idPlanoConta)&&(t[c.idFormaPagamento]=[]),t[c.idFormaPagamento]&&t[c.idFormaPagamento].push(c),t),{});let v=e.reduce((t,c)=>(t[c.idFormaPagamento]||(t[c.idFormaPagamento]={totalInformadoUsuario:0}),t[c.idFormaPagamento]&&(t[c.idFormaPagamento].totalSistema===void 0?t[c.idFormaPagamento].totalSistema=c.valor||0:t[c.idFormaPagamento].totalSistema+=c.valor||0),t),{});v=x.reduce((t,c)=>(t[c.idFormaPagamento]||(t[c.idFormaPagamento]={totalSistema:0}),t[c.idFormaPagamento]&&(t[c.idFormaPagamento].totalInformadoUsuario===void 0?t[c.idFormaPagamento].totalInformadoUsuario=c.valor||0:t[c.idFormaPagamento].totalInformadoUsuario+=c.valor||0),t),v);for(const t in v)v[t].totalSistema=$utils.arredondar(v[t].totalSistema),v[t].totalInformadoUsuario=$utils.arredondar(v[t].totalInformadoUsuario);this.totaisFormasPagamento=v;let F=e.reduce((t,c)=>(t[c.idDocumento]||(t[c.idDocumento]={}),t),{});for(let t in F)F[t]=await $db.hibrido.le({table:"documento",id:t});this.documentos=F,this.acertos=o.filter(t=>t.idFinanceiroPlanoConta!==this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((t,c)=>{const D=this.formasPagamento.find(L=>L.idFinanceiroPlanoConta===c.idFinanceiroPlanoConta);return D&&t.push({descricao:D.descricao,valor:$utils.arredondar((c.valorCredito||0)-(c.valorDebito||0))}),t},[]),this.totalAcertos=$utils.arredondar(this.acertos.reduce((t,c)=>t+c.valor,0)),this.carregando=!1},async preencherConferenciaNew(l){var p;const a=JSON.parse((p=l[0])==null?void 0:p.json);console.log("PreencherConferencia",$utils.clonarV2(a));let g=a.acertos||[];this.sangrias=a.sangrias,this.totalSangrias=a.totalSangrias,this.sangriaFinal=(a.sangriaFinal||[]).filter(n=>n.valorCredito>0),this.totalSangriaFinal=$utils.arredondar($utils.somar(this.sangriaFinal,"valorCredito")),this.suprimentos=a.suprimentos,this.totalSuprimentos=a.totalSuprimentos,this.despesas=a.despesas,this.totalDespesas=a.totalDespesas,this.formasPagamento=(await $db.formaPagamento.listaCache()).map(n=>({...n,mostrar:!1})),l.filter(n=>n.tabela==="documentoCondicaoPagamento"&&n.json.ordem).map(n=>n.json),this.valorFechamento=a.campos.fechamento,this.dinheiro=a.pagamentos.reduce((n,u)=>(this.formasPagamento.find(x=>x.id===u.idFormaPagamento&&x.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&n.push(u),n),[]),this.totalDinheiro=$utils.arredondar(this.dinheiro.reduce((n,u)=>n+(u.valor||0),0)),this.valorFundoCaixa=a.campos.fundoCaixa;const b=this.valorAberturaSistema+this.totalDinheiro-this.totalSangrias-this.totalSangriaFinal-this.totalDespesas+this.totalSuprimentos;this.diferencaFundo=$utils.arredondar(this.valorFundoCaixa-b),this.acertoDinheiro=g.filter(n=>n.idFinanceiroPlanoConta===this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((n,u)=>n+(u.valorDebito||0)-(u.valorCredito||0),0),this.valorFundoCaixaSistema=$utils.arredondar(b+this.acertoDinheiro),this.acertoDinheiro=$utils.arredondar(this.acertoDinheiro*-1),this.outrasFormasPagamento=a.pagamentos.reduce((n,u)=>(!n[u.idFormaPagamento]&&this.formasPagamento.find(x=>x.id===u.idFormaPagamento&&x.idFinanceiroPlanoConta!==this.caixa.idPlanoConta)&&(n[u.idFormaPagamento]=[]),n[u.idFormaPagamento]&&n[u.idFormaPagamento].push(u),n),{});const o={};for(const n of a.valoresDigitados)o[n.id]={totalSistema:(n==null?void 0:n.totalSistema)||0,totalInformadoUsuario:(n==null?void 0:n.valor)||0};for(const n of a.condicaoPagamentoDinheiro)o[n.id]={totalSistema:(n==null?void 0:n.totalSistema)||0};this.totaisFormasPagamento=o,this.documentos=a.faturas.reduce((n,u)=>(n[u.id]=u,n),{}),this.acertos=g.filter(n=>n.idFinanceiroPlanoConta!==this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((n,u)=>{const x=this.formasPagamento.find(e=>e.idFinanceiroPlanoConta===u.idFinanceiroPlanoConta);return x&&n.push({descricao:x.descricao,valor:$utils.arredondar((u.valorCredito||0)-(u.valorDebito||0))}),n},[]),this.totalAcertos=$utils.arredondar(this.acertos.reduce((n,u)=>n+u.valor,0)),this.carregando=!1},async reabrir(){var l,a;try{try{await new Promise((d,v)=>{this.$q.dialog({message:"Deseja reabrir o caixa para corre\xE7\xE3o?",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{d()}).onCancel(()=>{v()})}),this.$q.loading.show({message:"Processando..."})}catch{return}const g=$utils.dataAtual();let b=$utils.clonar(this.documentoCaixa),o,p=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:this.documentoStatus[0].value}});((l=p==null?void 0:p[0])==null?void 0:l.tabela)==="caixaCompleto"?(o=JSON.parse((a=p[0])==null?void 0:a.json),console.log("Reabrindo",$utils.clonarV2(o))):p=p.map(d=>({...d,json:JSON.parse(d.json)}));let n,u;if(o)n=o.sangriaFinal||[],u=o.acertos||[];else{let d=p.filter(v=>v.tabela==="financeiroMovimentacao").map(v=>v.json);n=d.filter(v=>v.documentoTipo==="Sangria Final"),u=d.filter(v=>v.documentoTipo==="Acerto")}const x=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{idDocumentoCaixa:b.id,documentoTipo:"Acerto"}});u=u.concat(x);const e={id:$utils.uuid(),idDocumento:b.id,operacao:"Fechamento Caixa",statusOriginal:this.documentoStatus[0].statusFinalizado,statusFinalizado:"Reaberto",dataHoraEmissao:g,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:b.id};o?o.acertos=[]:(p=p.filter(d=>!["Sangria Final","Acerto"].includes(d.json.documentoTipo)),p=p.map(d=>({...d,id:$utils.uuid(),idDocumentoStatus:e.id,dataHoraEmissao:g,json:JSON.stringify(d.json)}))),b.status="Reaberto",b.dataHoraFinalizado="",await $db.documento.grava({atual:b,original:this.documentoCaixa}),await $db.documentoStatus.grava({atual:e}),await $db.financeiroMovimentacao.remove(u);for(const d of n)await $db.hibrido.grava("financeiroMovimentacao",{atual:{...d,valorCredito:0,valorDebito:0},original:d});if(o){o.sangriaFinal=await $db.caixa.leSangriaFinal(this.idDocumentoCaixa),console.log("Reaberto",$utils.clonarV2(o));const d={id:$utils.uuid(),idDocumentoCaixa:b.id,idDocumentoStatus:e.id,tabela:"caixaCompleto",json:JSON.stringify(o),dataHoraEmissao:g};await $db.hibrido.grava("caixaConsolidacao2",{atual:d})}else for(const d of p)await $db.hibrido.grava("caixaConsolidacao2",{atual:d});this.atualizar(),this.atualizarAoFecharModal=!0,this.$q.loading.hide()}catch(g){this.$q.notifyError("N\xE3o foi poss\xEDvel abrir a confer\xEAncia.",g)}finally{this.$q.loading.hide()}},refreshData(){this.mostrarDinheiro=!1,this.dinheiro={},this.acertoDinheiro=0,this.acertos=[],this.totalAcertos=0,this.formasPagamento=[],this.totaisFormasPagamento={},this.outrasFormasPagamento={},this.condicoesPagamentoFechamento={},this.valorFechamento=0,this.diferencaFundo=0,this.contatos={},this.usuarios={},this.documentos={},this.mostrarSangrias=!1,this.sangrias=[],this.totalSangrias=0,this.mostrarSangriaFinal=!1,this.sangriaFinal=[],this.totalSangriaFinal=0,this.mostrarDespesas=!1,this.despesas=[],this.totalDespesas=0,this.mostrarSuprimentos=!1,this.suprimentos=[],this.totalSuprimentos=0,this.mostrarDivergencias=!1,this.divergencias=[],this.totalDivergencias=0,this.edicao=!1,this.faturaModal={visivel:!1,id:""},this.vendaModal={visivel:!1,id:""}},async carregarObservacoesSangrias(){let l=await $db.hibrido.lista({table:"documento",whereIn:{id:this.sangrias.map(a=>a.documentoId)}});for(const a of l)this.observacoesSangrias[a.id]=a.observacao;l=await $db.hibrido.lista({table:"documento",whereIn:{id:this.sangriaFinal.map(a=>a.documentoId)}});for(const a of l)this.observacoesSangrias[a.id]=a.observacao}},props:{idDocumentoCaixa:{required:!0,type:String},modelValue:{required:!0,type:Boolean}},watch:{modelValue(l){l&&(this.atualizar(),this.refreshData())},visivel(l){this.$emit("update:modelValue",l)}}},ma={class:"layout-padding q-pa-none q-pb-md"},ua={class:"q-pt-md"},ha={class:"bg-white round-borders q-pa-md"},fa={class:"col-12 col-lg-8 text-tertiary"},pa={class:"Faturamento-historico col-12 col-lg-4 text-caption text-tertiary text-right"},ga={key:0,class:"q-mt-lg text-center"},va={key:1},ba={class:"col-auto"},Ca={class:"col-auto"},xa={key:0,class:"col-auto"},_a={class:"col-auto"},Fa={class:"q-pr-md q-pl-xs q-pt-md"},ya={class:"row"},qa={class:"q-pa-xs"},wa={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Sa={key:0,class:"q-px-md q-pb-md"},Da={class:"col-9 col-lg-10 q-pl-sm"},Pa={class:"row"},ka={class:"col-12 col-sm"},za={class:"col-12 col-sm"},Aa={class:"col-12 col-sm"},$a={class:"col-12 col-sm"},Va={class:"q-pr-md q-pl-xs q-pt-md"},Ea={class:"row"},Ia={class:"q-pa-xs"},Ma={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},ja={key:0,class:"q-px-md q-pb-md"},Ha={class:"col-9 col-lg-10 q-pl-sm"},Na={class:"row"},Oa={class:"col-12 col-sm"},Ta={class:"col-12 col-sm"},Ua={class:"col-12 col-sm"},Qa={class:"col-12 col-sm"},Ba={class:"q-pr-md q-pl-xs q-pt-md"},Ra={class:"row"},Ja={class:"q-pa-xs"},La={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Ga={key:1,class:"q-px-md q-pb-md"},Ya={class:"col-9 col-lg-10 q-pl-sm"},Wa={class:"row"},Xa={class:"col-12 col-sm"},Za={class:"col-12 col-sm"},Ka={class:"col-12 col-sm"},ao={class:"q-pr-md q-pl-xs q-pt-md"},oo={class:"row"},to={class:"q-pa-xs"},eo={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},io={key:0,class:"q-px-md q-pb-md"},so={class:"col-9 col-lg-10 q-pl-sm"},ro={class:"row"},no={class:"col-12 col-sm"},lo={class:"col-12 col-sm"},co={class:"col-12 col-sm"},mo={class:"col-12 col-sm"},uo={class:"col-12 col-sm"},ho={class:"q-pr-md q-pl-xs q-pt-md"},fo={class:"row"},po={class:"q-pa-xs"},go={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},vo={key:0,class:"q-px-md q-pb-md"},bo={class:"col-9 col-lg-10 q-pl-sm"},Co={class:"row"},xo={class:"col-12 col-sm"},_o={class:"col-12 col-sm"},Fo={class:"col-12 col-sm"},yo={class:"col-12 col-sm"},qo={class:"col-12 col-sm"},wo={key:4,class:"q-title"},So={class:"q-pr-md q-pl-xs q-pt-md"},Do={class:"row"},Po={class:"text-right text-h5 text-warning text-weight-bold q-mb-sm"},ko={class:"q-px-md q-pb-md"},zo={class:"col-9 col-lg-10 q-pl-sm"},Ao={class:"row"},$o={class:"col-12 col-sm"},Vo={class:"col-12 col-sm"},Eo={class:"q-pr-md q-pl-xs q-pt-md"},Io={class:"row"},Mo={class:"q-pa-xs"},jo={class:"text-weight-normal text-tertiary text-body2 q-pa-none q-ma-none"},Ho={key:1,class:"q-px-md q-pb-md"},No={class:"col-9 col-lg-10 q-pl-sm"},Oo={class:"row"},To={class:"col-12 col-sm"},Uo={class:"col-12 col-sm"},Qo={class:"col-12 col-sm"};function Bo(l,a,g,b,o,p){const n=E("row"),u=E("badge"),x=E("CaixaFechar");return f(),_(sa,{modelValue:o.visivel,"onUpdate:modelValue":a[11]||(a[11]=e=>o.visivel=e),onHide:p.aoFecharModal,maximized:"",class:"caixaconferir"},{default:s(()=>[i(Y,{view:"hHh LpR fFf",container:"",class:"bg-light"},{default:s(()=>[i(W,null,{default:s(()=>[i(U,{class:"bg-primary text-white"},{default:s(()=>[X(i(w,{icon:"arrow_back",round:"",flat:"",dense:""},null,512),[[Z]]),i(P,null,{default:s(()=>a[12]||(a[12]=[h("Conferir caixa")])),_:1})]),_:1})]),_:1}),i(K,null,{default:s(()=>[i(aa,{class:"u-container"},{default:s(()=>[r("div",ma,[r("div",ua,[r("div",ha,[i(n,{class:"items-center q-col-gutter-md"},{default:s(()=>[r("div",fa,[i(j,{name:"place"}),h(" "+m(o.campos.caixaEmpresaNome),1)]),r("div",pa,[r("div",null,[h(m(l.$filters.dataHora(o.campos.dataHoraAbertura))+" ",1),i(j,{name:"calendar_today"}),a[13]||(a[13]=r("br",null,null,-1)),h(" "+m(o.campos.nomeUsuarioAbertura)+" ",1),i(j,{name:"person"})])]),i(oa,{modelValue:o.documentoStatusSelecionado,"onUpdate:modelValue":[a[0]||(a[0]=e=>o.documentoStatusSelecionado=e),p.preencherConferencia],label:"Hist\xF3rico",options:o.documentoStatus,filter:"",style:{"white-space":"pre-wrap !important"}},null,8,["modelValue","options","onUpdate:modelValue"])]),_:1}),o.carregando?(f(),y("div",ga,[i(ta,{color:"tertiary",size:50})])):C("",!0),o.carregando?C("",!0):(f(),y("div",va,[i(n,{class:"q-col-gutter-md justify-around"},{default:s(()=>[r("div",ba,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(l.$filters.numero(o.valorAberturaSistema,2))+" ",1),i(z,null,{default:s(()=>a[14]||(a[14]=[h("Valor no sistema")])),_:1})]),_:1}),i(P,{class:O(["q-display-1 text-weight-bold text-center",p.cor("abertura")])},{default:s(()=>[h(m(l.$filters.numero(o.documentoCaixa.valorAbertura,2))+" ",1),i(z,null,{default:s(()=>a[15]||(a[15]=[h("Valor digitado pelo usu\xE1rio")])),_:1})]),_:1},8,["class"]),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(l.$filters.numero(o.diferencaAbertura,2))+" ",1),i(z,null,{default:s(()=>a[16]||(a[16]=[h("Diferen\xE7a")])),_:1})]),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[17]||(a[17]=[h(" Abertura ")])),_:1})]),r("div",Ca,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[18]||(a[18]=[h("\xA0")])),_:1}),i(P,{class:O(["q-display-1 text-weight-bold text-center",p.cor("fundo")])},{default:s(()=>[h(m(l.$filters.numero(o.valorFechamento,2))+" ",1),i(z,null,{default:s(()=>a[19]||(a[19]=[h("Valor digitado pelo usu\xE1rio")])),_:1})]),_:1},8,["class"]),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[20]||(a[20]=[h("\xA0")])),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[21]||(a[21]=[h(" Fechamento ")])),_:1})]),o.acertoDinheiro?(f(),y("div",xa,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[22]||(a[22]=[h("\xA0")])),_:1}),i(P,{class:"q-display-1 text-weight-bold text-center text-warning"},{default:s(()=>[h(m(l.$filters.numero(o.acertoDinheiro,2)),1)]),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[23]||(a[23]=[h("\xA0")])),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[24]||(a[24]=[h(" Acerto ")])),_:1})])):C("",!0),r("div",_a,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(l.$filters.numero(o.valorFundoCaixaSistema,2))+" ",1),i(z,null,{default:s(()=>a[25]||(a[25]=[h("Valor no sistema")])),_:1})]),_:1}),i(P,{class:O(["q-display-1 text-weight-bold text-center",p.cor("fundo")])},{default:s(()=>[h(m(l.$filters.numero(o.valorFundoCaixa,2)),1)]),_:1},8,["class"]),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(l.$filters.numero(o.diferencaFundo,2))+" ",1),i(z,null,{default:s(()=>a[26]||(a[26]=[h("Diferen\xE7a")])),_:1})]),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[27]||(a[27]=[h(" Fundo Caixa ")])),_:1})])]),_:1}),o.suprimentos.length?(f(),_(I,{key:0,class:"itemOk q-mt-md"},{default:s(()=>[r("div",Fa,[r("div",ya,[i(P,null,{default:s(()=>a[28]||(a[28]=[h(" Suprimentos ")])),_:1}),r("div",qa,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.suprimentos.length),1)]),_:1})]),r("div",wa,m(l.$filters.numero(o.totalSuprimentos,2)),1)])]),i(N,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarSuprimentos?(f(),_(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[1]||(a[1]=e=>o.mostrarSuprimentos=!o.mostrarSuprimentos)})):C("",!0),o.mostrarSuprimentos?C("",!0):(f(),_(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[2]||(a[2]=e=>o.mostrarSuprimentos=!o.mostrarSuprimentos)}))]),_:1}),o.mostrarSuprimentos?(f(),y("div",Sa,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),y(A,null,$(o.suprimentos,e=>(f(),_(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d,v;return[r("div",Da,[r("div",Pa,[r("div",ka,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||((v=o.usuarios[e.idContato])==null?void 0:v.nome)||"Nome n\xE3o encontrado"),1),r("div",za,m(e.documentoTipo),1),r("div",Aa,m(l.$filters.numero(e.valorDebito,2)),1),r("div",$a,m(l.$filters.dataHora(e.dataMovimento)),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),o.despesas.length?(f(),_(I,{key:1,class:"itemOk q-mt-md"},{default:s(()=>[r("div",Va,[r("div",Ea,[i(P,null,{default:s(()=>a[29]||(a[29]=[h(" Despesas ")])),_:1}),r("div",Ia,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.despesas.length),1)]),_:1})]),r("div",Ma,m(l.$filters.numero(o.totalDespesas,2)),1)])]),i(N,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarDespesas?(f(),_(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[3]||(a[3]=e=>o.mostrarDespesas=!o.mostrarDespesas)})):C("",!0),o.mostrarDespesas?C("",!0):(f(),_(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[4]||(a[4]=e=>o.mostrarDespesas=!o.mostrarDespesas)}))]),_:1}),o.mostrarDespesas?(f(),y("div",ja,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),y(A,null,$(o.despesas,e=>(f(),_(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d;return[r("div",Ha,[r("div",Na,[r("div",Oa,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||"Nome n\xE3o encontrado"),1),r("div",Ta,m(e.documentoTipo),1),r("div",Ua,m(l.$filters.numero(e.valorRealizado,2)),1),r("div",Qa,m(l.$filters.dataHora(e.dataMovimento)),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),i(I,{class:"itemOk q-my-md"},{default:s(()=>{var e,d;return[r("div",Ba,[r("div",Ra,[i(P,null,{default:s(()=>a[30]||(a[30]=[h(" Dinheiro ")])),_:1}),r("div",Ja,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.dinheiro.length),1)]),_:1})]),r("div",La,m(l.$filters.numero((d=o.totaisFormasPagamento[(e=o.dinheiro[0])==null?void 0:e.idFormaPagamento])==null?void 0:d.totalSistema,2)),1)])]),o.dinheiro.length?(f(),_(N,{key:0,class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarDinheiro?(f(),_(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[5]||(a[5]=v=>o.mostrarDinheiro=!o.mostrarDinheiro)})):C("",!0),o.mostrarDinheiro?C("",!0):(f(),_(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[6]||(a[6]=v=>o.mostrarDinheiro=!o.mostrarDinheiro)}))]),_:1})):C("",!0),o.mostrarDinheiro?(f(),y("div",Ga,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),y(A,null,$(o.dinheiro,v=>(f(),_(M,{key:v.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var F;return[r("div",Ya,[r("div",Wa,[r("div",Xa,[h(m((F=o.documentos[v.idDocumento])==null?void 0:F.descricaoContato)+" ",1),i(u,{cor:"primary",escuro:"",class:"q-mx-sm"},{default:s(()=>{var S;return[h("#"+m((S=o.documentos[v.idDocumento])==null?void 0:S.numero),1)]}),_:2},1024)]),a[31]||(a[31]=r("div",{class:"col-12 col-sm"}," Dinheiro ",-1)),r("div",Za,m(l.$filters.numero(v.valor,2)),1),r("div",Ka,m(l.$filters.data(v.dataVencimento)),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]}),_:1}),o.sangrias.length?(f(),_(I,{key:2,class:"itemOk q-my-md q-mb-xl"},{default:s(()=>[r("div",ao,[r("div",oo,[i(P,null,{default:s(()=>a[32]||(a[32]=[h(" Sangrias ")])),_:1}),r("div",to,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.sangrias.length),1)]),_:1})]),r("div",eo,m(l.$filters.numero(o.totalSangrias,2)),1)])]),i(N,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarSangrias?(f(),_(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[7]||(a[7]=e=>o.mostrarSangrias=!o.mostrarSangrias)})):C("",!0),o.mostrarSangrias?C("",!0):(f(),_(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[8]||(a[8]=e=>o.mostrarSangrias=!o.mostrarSangrias)}))]),_:1}),o.mostrarSangrias?(f(),y("div",io,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),y(A,null,$(o.sangrias,e=>(f(),_(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d,v;return[r("div",so,[r("div",ro,[r("div",no,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||((v=o.usuarios[e.idContato])==null?void 0:v.nome)||"Nome n\xE3o encontrado"),1),r("div",lo,m(e.documentoTipo),1),r("div",co,m(l.$filters.numero(e.valorCredito,2)),1),r("div",mo,m(l.$filters.dataHora(e.dataMovimento)),1),r("div",uo,m(e.documentoObservacao||o.observacoesSangrias[e.documentoId]),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),o.sangriaFinal.length?(f(),_(I,{key:3,class:"itemOk q-my-md q-mb-xl"},{default:s(()=>[r("div",ho,[r("div",fo,[i(P,null,{default:s(()=>a[33]||(a[33]=[h(" Sangria Final ")])),_:1}),r("div",po,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.sangriaFinal.length),1)]),_:1})]),r("div",go,m(l.$filters.numero(o.totalSangriaFinal,2)),1)])]),i(N,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarSangriaFinal?(f(),_(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[9]||(a[9]=e=>o.mostrarSangriaFinal=!o.mostrarSangriaFinal)})):C("",!0),o.mostrarSangriaFinal?C("",!0):(f(),_(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[10]||(a[10]=e=>o.mostrarSangriaFinal=!o.mostrarSangriaFinal)}))]),_:1}),o.mostrarSangriaFinal?(f(),y("div",vo,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),y(A,null,$(o.sangriaFinal,e=>(f(),_(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d,v;return[r("div",bo,[r("div",Co,[r("div",xo,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||((v=o.usuarios[e.idContato])==null?void 0:v.nome)||"Nome n\xE3o encontrado"),1),r("div",_o,m(e.documentoTipo),1),r("div",Fo,m(l.$filters.numero(e.valorCredito,2)),1),r("div",yo,m(l.$filters.dataHora(e.dataMovimento)),1),r("div",qo,m(e.documentoObservacao||o.observacoesSangrias[e.documentoId]),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),o.acertos.length||o.formasPagamento.filter(e=>e.tipo!==1&&(o.outrasFormasPagamento[e.id]||(o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario)).length?(f(),y("div",wo," Outras formas de pagamento ")):C("",!0),o.acertos.length?(f(),_(I,{key:5,class:"itemWarning q-mt-md"},{default:s(()=>[r("div",So,[r("div",Do,[i(P,null,{default:s(()=>a[34]||(a[34]=[h(" Acertos ")])),_:1}),r("div",Po,m(l.$filters.numero(o.totalAcertos,2)),1)])]),r("div",ko,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),y(A,null,$(o.acertos,(e,d)=>(f(),_(M,{key:d,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>[r("div",zo,[r("div",Ao,[r("div",$o,m(e.descricao),1),r("div",Vo,m(l.$filters.numero(e.valor,2)),1)])])]),_:2},1024))),128))]),_:1})])]),_:1})):C("",!0),(f(!0),y(A,null,$(o.formasPagamento.filter(e=>e.tipo!==1&&(o.outrasFormasPagamento[e.id]||(o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario)),e=>(f(),_(I,{key:e.id,class:O(["q-mt-md",p.cor("outraFormaPagamento","card",e.id)])},{default:s(()=>[r("div",Eo,[r("div",Io,[i(P,null,{default:s(()=>[h(m(e.descricao),1)]),_:2},1024),r("div",Mo,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.outrasFormasPagamento[e.id]?(o.outrasFormasPagamento[e.id]||[]).length:0),1)]),_:2},1024)]),r("div",{class:O(["text-right text-h5 text-weight-bold q-mb-sm",p.cor("outraFormaPagamento","",e.id)])},[r("span",null,[h(m(l.$filters.numero((o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario,2))+" ",1),i(z,null,{default:s(()=>a[35]||(a[35]=[h("Digitado pelo usu\xE1rio")])),_:1})]),r("p",jo,[h(m(l.$filters.numero((o.totaisFormasPagamento[e.id]||{}).totalSistema-(o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario,2))+" ",1),i(z,null,{default:s(()=>a[36]||(a[36]=[h("Diferen\xE7a")])),_:1})])],2)])]),o.outrasFormasPagamento[e.id]?(f(),_(N,{key:0,class:"content-center justify-center q-mt-lg"},{default:s(()=>[e.mostrar?(f(),_(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:d=>e.mostrar=!e.mostrar},null,8,["onClick"])):C("",!0),e.mostrar?C("",!0):(f(),_(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:d=>e.mostrar=!e.mostrar},null,8,["onClick"]))]),_:2},1024)):C("",!0),e.mostrar?(f(),y("div",Ho,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),y(A,null,$(o.outrasFormasPagamento[e.id],d=>(f(),_(M,{key:d.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var v;return[r("div",No,[r("div",Oo,[r("div",To,[h(m((v=o.documentos[d.idDocumento])==null?void 0:v.descricaoContato)+" ",1),i(u,{cor:"primary",escuro:"",class:"q-mx-sm"},{default:s(()=>{var F,S;return[h(" #"+m((S=(F=o.documentos[d.idDocumento])==null?void 0:F.id)==null?void 0:S.slice(-6)),1)]}),_:2},1024)]),r("div",Uo,m(l.$filters.numero(d.valor,2)),1),r("div",Qo,m(l.$filters.data(d.dataVencimento)),1)])])]}),_:2},1024))),128))]),_:2},1024)])):C("",!0)]),_:2},1032,["class"]))),128))]))])])])]),_:1})]),_:1}),i(ea,{class:"bg-light",bordered:""},{default:s(()=>[i(U,{class:"bg-light text-tertiary q-pa-sm u-container"},{default:s(()=>[i(ia),o.visibilidade.botao.reabrir?(f(),_(w,{key:0,onClick:p.reabrir,color:"negative",flat:"",label:"Reabrir",unelevated:""},null,8,["onClick"])):C("",!0),o.visibilidade.botao.finalizar?(f(),_(w,{key:1,onClick:p.finalizar,label:"finalizar",color:"primary",class:"q-ml-sm",unelevated:""},null,8,["onClick"])):C("",!0),o.visibilidade.botao.fechar?(f(),_(w,{key:2,onClick:p.fechar,color:"primary",label:"refechar caixa",class:"q-ml-sm",unelevated:""},null,8,["onClick"])):C("",!0)]),_:1})]),_:1})]),_:1}),i(x,{ref:"Fechar",onFechado:p.atualizar},null,8,["onFechado"])]),_:1},8,["modelValue","onHide"])}var Ro=Q(ca,[["render",Bo]]);const Jo={components:{Avatar:ra,CaixaConferir:Ro},data(){return{empresa:{},contato:{},caixaConferirModal:{visivel:!1}}},emits:["atualizar"],methods:{abrirCaixaConferirModal(){this.caixaConferirModal.visivel=!0},async atualizar(){this.empresa=await $db.contato.le({id:this.documento.idEmpresa}),this.contato=await $db.contato.le({id:this.documento.idContato})},executar(l){switch(l){case"atualizar":this.atualizar(),this.$emit("atualizar")}}},props:{documento:{required:!0,type:Object}},mounted(){this.atualizar()}},Lo={id:"CaixaCard",class:"q-mb-md"},Go={class:"col-12 col-md-6 q-pl-none"},Yo={class:"col-12 col-md"},Wo={class:"text-left q-my-none"},Xo={class:"text-weight-bold"},Zo={class:"col-6 col-md-auto"},Ko={class:"text-left q-my-none"},at={class:"col-6 col-md-auto"},ot={class:"text-left q-my-none"},tt={class:"col-6 col-md"},et={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},it={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},st={class:"col-6 col-md-auto"};function rt(l,a,g,b,o,p){const n=E("avatar"),u=E("row"),x=E("CaixaConferir");return f(),y("div",Lo,[i(I,{class:"extratoItem bg-white q-pa-sm no-shadow"},{default:s(()=>[i(u,{class:"items-center q-mx-none q-px-none q-mb-sm"},{default:s(()=>[r("div",Go,[i(U,{class:"q-pa-none"},{default:s(()=>[i(n,{imagem:o.contato.imagem,rotulo:o.contato.nome,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"]),i(P,null,{default:s(()=>[h(m(o.contato.apelido),1)]),_:1}),i(B,{rounded:"",color:"grey",small:"",class:"q-ma-sm"},{default:s(()=>[h(m(g.documento.status),1)]),_:1}),i(B,{class:"q-mr-sm",rounded:"",color:"positive"},{default:s(()=>[h(" #"+m(parseInt(g.documento.numero)||(g.documento.id||"").slice(-6)),1)]),_:1})]),_:1})]),r("div",Yo,[r("p",Wo,[r("span",Xo,[i(j,{name:"business "}),h(" "+m(o.empresa.apelido),1)]),a[3]||(a[3]=r("br",null,null,-1)),h(" "+m(o.empresa.nome),1)])]),r("div",Zo,[r("p",Ko,[g.documento.dataHoraEmissao?(f(),_(j,{key:0,name:"mdi-calendar-today "})):C("",!0),h(" "+m(l.$filters.data(g.documento.dataHoraEmissao))+" ",1),i(z,null,{default:s(()=>a[4]||(a[4]=[h(" Abertura ")])),_:1})])]),r("div",at,[r("p",ot,[g.documento.dataHoraEmissao?(f(),_(j,{key:0,name:"mdi-calendar-today"})):C("",!0),h(" "+m(l.$filters.data(g.documento.dataHoraFinalizado))+" ",1),i(z,null,{default:s(()=>a[5]||(a[5]=[h(" Fechamento ")])),_:1})])]),r("div",tt,[r("p",et,m(l.$filters.numero(g.documento.totalDocumento,2)),1),r("p",it,m(l.$filters.numero(g.documento.subTotal,2)),1)]),r("div",st,[i(w,{rounded:"",dense:"",flat:"",icon:"edit",class:"no-shadow q-ma-xs",size:"md",color:"primary",style:{float:"right"},onClick:p.abrirCaixaConferirModal},{default:s(()=>[i(z,null,{default:s(()=>a[6]||(a[6]=[h(" Abrir confer\xEAncia ")])),_:1})]),_:1},8,["onClick"]),i(w,{rounded:"",dense:"",flat:"",icon:"print",class:"no-shadow q-ma-xs",size:"md",color:"primary",style:{float:"right"}},{default:s(()=>[i(na,null,{default:s(()=>[i(V,{link:"",separator:""},{default:s(()=>[i(M,{clickable:"",onClick:a[0]||(a[0]=e=>{l.$imprimir("fechamento-de-caixa",g.documento.id)})},{default:s(()=>[i(T,{avatar:""},{default:s(()=>[i(j,{name:"print"})]),_:1}),i(T,null,{default:s(()=>[i(R,null,{default:s(()=>a[7]||(a[7]=[h("Imprimir Fechamento")])),_:1})]),_:1})]),_:1}),i(M,{clickable:"",onClick:a[1]||(a[1]=e=>{l.$imprimir("conferencia-de-caixa",g.documento.id)})},{default:s(()=>[i(T,{avatar:""},{default:s(()=>[i(j,{name:"print"})]),_:1}),i(T,null,{default:s(()=>[i(R,null,{default:s(()=>a[8]||(a[8]=[h("Imprimir Confer\xEAncia")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),i(x,{modelValue:o.caixaConferirModal.visivel,"onUpdate:modelValue":a[2]||(a[2]=e=>o.caixaConferirModal.visivel=e),idDocumentoCaixa:g.documento.id,onExecutar:p.executar},null,8,["modelValue","idDocumentoCaixa","onExecutar"])])}var nt=Q(Jo,[["render",rt]]);const lt={components:{CaixaCard:nt,GChipsV2:da},data(){return{documentosCaixaConferencia:[],documentosCaixaFechado:[],dataIni:"",dataFim:"",termosPesquisa:[]}},methods:{async filtrar(){let l=[];const a=await $db.contatoEmpresa.listaCache();let g=new Date(new Date(this.dataIni).toDateString()),b=new Date(new Date(this.dataFim).toDateString());for(const n of a)(await $db.hibrido.lista({table:"documento",where:{tipo:"Caixa",idEmpresa:n.id}})).forEach(x=>{const e=new Date(new Date(x.dataHoraEmissao).toDateString());e<=b&&e>=g&&l.push(x)});l.sort((n,u)=>new Date(n.dataHoraEmissao)>new Date(u.dataHoraEmissao)?-1:1);for(let n of this.termosPesquisa)n=n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(),/^#\d+$/gi.test(n)?l=l.filter(u=>u.numero===Number(n.slice(1))):l=l.filter(u=>{const x=a.find(e=>e.id===u.idEmpresa);return((x.nome||"")+(x.apelido||"")).normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().search(n)!==-1});let o=l.filter(n=>n.status==="Aguardando Confer\xEAncia"),p=l.filter(n=>n.status==="Fechado");this.documentosCaixaConferencia=o,this.documentosCaixaFechado=p}},mounted(){const l=new Date(new Date().toDateString()),a=new Date(l);a.setDate(a.getDate()-7),this.dataIni=a,this.dataFim=l,this.filtrar()}},dt={class:"CaixaTesouraria"},ct={class:"col-12 col-md-6"},mt={class:"col"},ut={class:"col"},ht={class:"q-pa-sm"};function ft(l,a,g,b,o,p){const n=E("GChipsV2"),u=E("campo"),x=E("row"),e=E("caixa-card");return f(),y("div",dt,[i(I,{class:"q-pa-sm q-mx-sm no-shadow"},{default:s(()=>[i(x,{class:"items-center q-col-gutter-md"},{default:s(()=>[r("div",ct,[i(n,{modelValue:o.termosPesquisa,"onUpdate:modelValue":[a[0]||(a[0]=d=>o.termosPesquisa=d),p.filtrar],class:"q-px-none",placeholder:"Termo de pesquisa"},{prepend:s(()=>[i(j,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),r("div",mt,[i(u,{modelValue:o.dataIni,"onUpdate:modelValue":a[1]||(a[1]=d=>o.dataIni=d),tipo:"data",onInput:p.filtrar,dense:"",outlined:""},null,8,["modelValue","onInput"])]),a[3]||(a[3]=r("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[r("label",null,"at\xE9")],-1)),r("div",ut,[i(u,{modelValue:o.dataFim,"onUpdate:modelValue":a[2]||(a[2]=d=>o.dataFim=d),tipo:"data",onInput:p.filtrar,dense:"",outlined:""},null,8,["modelValue","onInput"])])]),_:1})]),_:1}),r("div",ht,[i(V,{class:"no-border"},{default:s(()=>[i(J,{"default-opened":"",label:"Aguardando Confer\xEAncia"},{default:s(()=>[(f(!0),y(A,null,$(o.documentosCaixaConferencia,d=>(f(),y("div",{key:d.id},[i(e,{documento:d,onAtualizar:p.filtrar},null,8,["documento","onAtualizar"])]))),128))]),_:1})]),_:1}),i(V,{class:"no-border"},{default:s(()=>[i(J,{"default-opened":"",label:"Fechado"},{default:s(()=>[(f(!0),y(A,null,$(o.documentosCaixaFechado,d=>(f(),y("div",{key:d.id},[i(e,{documento:d,onAtualizar:p.filtrar},null,8,["documento","onAtualizar"])]))),128))]),_:1})]),_:1})])])}var bt=Q(lt,[["render",ft]]);export{bt as default};
